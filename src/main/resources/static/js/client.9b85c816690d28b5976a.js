(()=>{"use strict";var e,t={3890:(e,t,n)=>{var s=n(3935),i=n(7294),r=(n(8660),n(3195)),o=n(935);function a(e,t){return o.G0([e,o.lB,o.S1,o.i0("")],null!=t?t:e.name)}function l(e){return null!=e}const c=o.dt({attemptId:o.pk,exerciseId:o.pk,questionIds:o.IX(o.pk)},"ExerciseAttempt"),d=a(c),u=o.dt({attemptId:o.pk,questionsCount:o.pk,totalInteractionsCount:o.pk,totalInteractionsWithErrorsCount:o.pk,averageGrade:o.pk},"ExerciseStatisticsItem"),p=o.IX(u),m=o.dt({name:o.Z_,canCreateSupplementaryQuestion:o.O7}),h=o.G0([o.dt({type:o.i0("SUCCESS"),message:o.Z_}),o.dt({type:o.i0("ERROR"),message:o.Z_,violationLaw:m})]),w=o.r$({grade:o.G0([o.pk,o.lB]),violations:o.G0([o.IX(o.pk),o.lB]),correctAnswers:o.G0([o.IX(o.bc([o.pk,o.pk])),o.lB]),correctSteps:o.G0([o.pk,o.lB]),stepsLeft:o.G0([o.pk,o.lB]),stepsWithErrors:o.G0([o.pk,o.lB]),message:o.G0([o.IX(h),o.lB]),strategyDecision:o.G0([o.mM({CONTINUE:null,FINISH:null}),o.lB])},"Feedback"),g=o.jV([w,o.r$({trace:o.G0([o.IX(o.Z_),o.lB])})]),f=o.dt({requireContext:o.O7,showSupplementaryQuestions:o.O7},"QuestionOptions"),v=o.jV([f,o.dt({showTrace:o.O7,multipleSelectionEnabled:o.O7,requireAllAnswers:o.O7}),o.r$({orderNumberOptions:o.jV([o.dt({delimiter:o.Z_,position:o.mM({PREFIX:null,SUFFIX:null,NONE:null})}),o.r$({replacers:o.G0([o.IX(o.Z_),o.lB])})])})],"OrderQuestionOptions"),E=o.jV([f,o.dt({multipleSelectionEnabled:o.O7}),o.G0([o.dt({displayMode:o.i0("combobox")}),o.dt({displayMode:o.i0("dragNdrop"),draggableStyle:o.Z_,dropzoneStyle:o.Z_,dropzoneHtml:o.Z_})])],"MatchingQuestionOptions"),y=o.jV([f,o.dt({displayMode:o.mM({radio:null,dragNdrop:null})})],"SingleChoiceQuestionOptions"),x=o.jV([f,o.G0([o.jV([o.dt({displayMode:o.i0("switch")}),o.r$({selectorReplacers:o.G0([o.bc([o.Z_,o.Z_]),o.lB])})]),o.dt({displayMode:o.i0("dragNdrop"),dropzoneHtml:o.Z_,dropzoneStyle:o.Z_,draggableStyle:o.Z_})])],"MultiChoiceQuestionOptions"),b=o.mM({SINGLE_CHOICE:null,MULTI_CHOICE:null,MATCHING:null,ORDER:null},"QuestionType"),I=o.Z_,_=o.dt({id:o.pk,text:I},"QuestionAnswer"),q=o.dt({attemptId:o.pk,questionId:o.pk,type:b,options:f,text:I,answers:o.IX(_),responses:o.G0([o.IX(o.bc([o.pk,o.pk])),o.lB]),feedback:o.G0([w,o.lB])},"QuestionBase"),C=o.jV([q,o.dt({type:o.i0("ORDER"),options:v,feedback:o.G0([g,o.lB])}),o.r$({initialTrace:o.G0([o.IX(o.Z_),o.lB])})],"OrderQuestion"),S=o.jV([q,o.dt({type:o.i0("SINGLE_CHOICE"),options:y})],"SingleChoiceQuestion"),k=o.jV([q,o.dt({type:o.i0("MULTI_CHOICE"),options:x})],"MultiChoiceQuestion"),Q=o.jV([q,o.dt({type:o.i0("MATCHING"),answers:o.IX(_),groups:o.IX(_),options:E})],"MatchingQuestion"),A=o.G0([C,S,k,Q],"Question"),L=a(A),O=o.mM({STUDENT:null,TEACHER:null,ADMIN:null},"Role"),N=o.dt({id:o.pk,displayName:o.Z_,email:o.G0([o.Z_,o.lB]),roles:o.IX(O)},"UserInfo"),M=o.dt({newQuestionGenerationEnabled:o.O7,supplementaryQuestionsEnabled:o.O7,correctAnswerGenerationEnabled:o.O7},"ExerciseOptions"),$=o.dt({id:o.pk,options:M},"Exercise"),H=o.dt({sessionId:o.Z_,exercise:$,user:N,language:o.mM({RU:null,EN:null})},"SessionInfo");var P=n(7997),T=n(5974),j=n(7967),Z=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};function R(e,t){return Z(this,void 0,void 0,(function*(){return console.log(`ajax get: ${e}`),yield G(e,void 0,t)}))}function z(e,t,n){return Z(this,void 0,void 0,(function*(){const s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return console.log(`ajax post: ${e}`,t),yield G(e,s,n)}))}function G(e,t,n){return Z(this,void 0,void 0,(function*(){const s=new P.Fetcher(e,t).handle(200,(e=>(0,T.right)(e)),n).handle(500,(e=>(0,T.left)(e))).discardRest((()=>(0,T.left)({message:"Unexpected server error"}))),[i,r]=yield s.run().catch((()=>Z(this,void 0,void 0,(function*(){return[(0,T.left)({message:"Connection error"}),j.none]}))));if(j.isSome(r)){const e={message:`Type inconsistency for properties of ${null==n?void 0:n.name} type: ${B(r.value).join(", ")}`};return console.error(e),(0,T.left)(e)}return T.fold((e=>console.error(e)),(e=>console.log(e)))(i),i}))}const B=e=>e.map((e=>e.context.map((({key:e})=>e)).join(".")));var F;let V=F=class{static initEndpointPath(){const e=/^\/(?:.+\/(?<!\/pages\/))?/.exec(window.location.pathname);return e?e[0]:"/"}loadSessionInfo(){return R(`${F.endpointPath}loadSessionInfo`,H)}getQuestion(e){return R(`${F.endpointPath}getQuestion?questionId=${e}`,A)}generateQuestion(e){return R(`${F.endpointPath}generateQuestion?attemptId=${e}`,A)}generateSupplementaryQuestion(e){return z(`${F.endpointPath}generateSupplementaryQuestion`,e,L)}generateNextCorrectAnswer(e){return R(`${F.endpointPath}generateNextCorrectAnswer?questionId=${e}`,w)}addQuestionAnswer(e){return z(`${F.endpointPath}addQuestionAnswer`,e,w)}getExistingExerciseAttempt(e){return R(`${F.endpointPath}getExistingExerciseAttempt?exerciseId=${e}`,d)}createExerciseAttempt(e){return R(`${F.endpointPath}createExerciseAttempt?exerciseId=${e}`,c)}getExerciseStatistics(e){return R(`${F.endpointPath}getExerciseStatistics?exerciseId=${e}`,p)}getExercises(){return R(`${F.endpointPath}getExercises`,o.IX(o.pk))}};V.endpointPath=F.initEndpointPath(),V=F=function(e,t,n,s){var i,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(r<3?i(o):r>3?i(t,n,o):i(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o}([(0,r.b2)()],V);var D=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};let X=class{loadSessionInfo(){return D(this,void 0,void 0,(function*(){return console.log("loadSessionInfo"),T.right({sessionId:"test_session",exercise:{id:-1,options:{correctAnswerGenerationEnabled:!0,newQuestionGenerationEnabled:!0,supplementaryQuestionsEnabled:!0}},language:"EN",user:{id:999999,displayName:"front user",email:"test@mail.ru",roles:["ADMIN"]}})}))}getExistingExerciseAttempt(e){return D(this,void 0,void 0,(function*(){return console.log(`getExistingExerciseAttempt?exerciseId=${e}`),T.right("")}))}createExerciseAttempt(e){return D(this,void 0,void 0,(function*(){return console.log(`createExerciseAttempt?exerciseId=${e}`),T.right({attemptId:-1,exerciseId:-1,questionIds:[1,2,3,4,5,6,7]})}))}getQuestion(e){return D(this,void 0,void 0,(function*(){let t;return console.log(`getQuestion?questionId=${e}`),1===e&&(t={type:"SINGLE_CHOICE",attemptId:-1,questionId:1,text:"question text",answers:[{id:0,text:"answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:1,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:2,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "}],responses:[],feedback:null,options:{requireContext:!1,showSupplementaryQuestions:!0,displayMode:"radio"}}),2===e&&(t={type:"MULTI_CHOICE",attemptId:-1,questionId:2,text:"question text",answers:[{id:0,text:"answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:1,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:2,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "}],responses:[],feedback:null,options:{requireContext:!1,showSupplementaryQuestions:!0,displayMode:"switch"}}),3===e&&(t={type:"SINGLE_CHOICE",attemptId:-1,questionId:3,text:'question text with <span id="answer_0">select1</span> and <span id="answer_1">select2</span>',answers:[],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"radio"}}),4===e&&(t={type:"MULTI_CHOICE",attemptId:-1,questionId:4,text:'question text with <span id="answer_0"></span> and <span id="answer_1"></span>',answers:[],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"switch"}}),5===e&&(t={type:"MATCHING",attemptId:-1,questionId:5,text:"question text ",answers:[{id:0,text:"test1"},{id:1,text:"test2"},{id:3,text:"test3"}],groups:[{id:0,text:'<div style="width:70px; height: 40px;">group1<div/>'},{id:1,text:'<div style="width:50px;height: 100px;">group2 group2 group2 group2<div/>'}],responses:[],feedback:null,options:{requireContext:!1,showSupplementaryQuestions:!0,displayMode:"dragNdrop",multipleSelectionEnabled:!0,dropzoneStyle:'{ "display": "inline-block", "minHeight": "40px", "minWidth": "80px" }',dropzoneHtml:"drop",draggableStyle:'{ "padding": "10px", "border": "5px solid", "borderRadius": "5px", "borderColor": "black", "backgroundColor": "white" }'}}),6===e&&(t={type:"MATCHING",attemptId:-1,questionId:6,text:'question text with <span id="answer_0">drop</span> and <span id="answer_1">drop</span>',answers:[],groups:[{id:0,text:'<div style="width:70px; height: 40px;">group1<div/>'},{id:1,text:'<div style="width:50px;height: 100px;">group2 group2 group2 group2<div/>'}],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"dragNdrop",multipleSelectionEnabled:!1,dropzoneStyle:'{ "display": "inline-block", "minHeight": "40px", "minWidth": "80px" }',dropzoneHtml:"drop",draggableStyle:'{ "padding": "10px", "border": "5px solid", "borderRadius": "5px", "borderColor": "black", "backgroundColor": "white" }'}}),7===e&&(t={type:"MULTI_CHOICE",attemptId:-1,questionId:7,text:'question text with <span id="answer_0"></span> and <span id="answer_1"></span>',answers:[],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"dragNdrop",dropzoneStyle:'{ "display": "inline-block", "height": "20px", "width": "20px" }',dropzoneHtml:"",draggableStyle:'{ "height": "20px", "width": "20px" }'}}),t?T.right(t):T.left({message:"No such question"})}))}generateQuestion(e){return D(this,void 0,void 0,(function*(){return console.log(`generateQuestion?attemptId=${e}`),T.left({message:"Method not implemented."})}))}generateSupplementaryQuestion(e){return D(this,void 0,void 0,(function*(){return console.log("generateSupplementaryQuestion",e),T.left({message:"Method not implemented."})}))}generateNextCorrectAnswer(e){return D(this,void 0,void 0,(function*(){return console.log(`generateNextCorrectAnswer?questionId=${e}`),T.left({message:"Method not implemented."})}))}addQuestionAnswer(e){return D(this,void 0,void 0,(function*(){return console.log("addQuestionAnswer",e),T.left({message:"Method not implemented."})}))}getExerciseStatistics(e){return D(this,void 0,void 0,(function*(){return console.log(`getExerciseStatistics?exerciseId=${e}`),T.left({message:"Method not implemented."})}))}getExercises(){return D(this,void 0,void 0,(function*(){return console.log("getExercises"),T.left({message:"Method not implemented."})}))}};X=function(e,t,n,s){var i,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(r<3?i(o):r>3?i(t,n,o):i(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o}([(0,r.b2)()],X);var U=n(8949),W=n(427),J=n(902),K=function(e,t,n,s){var i,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(r<3?i(o):r>3?i(t,n,o):i(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o},Y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ee=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};let te=class{constructor(e){this.exerciseController=e,this.isQuestionLoading=!1,this.answersHistory=[],this.isFeedbackLoading=!1,this.isFeedbackVisible=!0,this.feedback=void 0,this.question=void 0,this.onQuestionLoaded=e=>{(0,U.z)((()=>{var t,n;e.options.requireContext&&(e.text=e.text.replaceAll(/(\<.*?\sid\s*?\=([\'\"]))\s*(answer_.+?\2)(.*?\>)/gim,`$1question_${e.questionId}_$3$4`)),this.question=e,this.feedback=null!==(t=e.feedback)&&void 0!==t?t:void 0,this.isFeedbackVisible=!0,this.answersHistory=null!==(n=e.responses)&&void 0!==n?n:[]}))},this.loadQuestion=e=>ee(this,void 0,void 0,(function*(){(0,U.z)((()=>this.isQuestionLoading=!0));const t=yield this.exerciseController.getQuestion(e);if((0,U.z)((()=>this.isQuestionLoading=!1)),T.isLeft(t))throw t.left;this.onQuestionLoaded(t.right)})),this.generateQuestion=e=>ee(this,void 0,void 0,(function*(){(0,U.z)((()=>this.isQuestionLoading=!0));const t=yield this.exerciseController.generateQuestion(e);if((0,U.z)((()=>this.isQuestionLoading=!1)),T.isLeft(t))throw t.left;this.onQuestionLoaded(t.right)})),this.generateSupplementaryQuestion=(e,t,n)=>ee(this,void 0,void 0,(function*(){const s={exerciseAttemptId:e,questionId:t,violationLaws:(0,J.pipe)(W.fromArray(n),j.getOrElse((()=>["invalid_law"])))};(0,U.z)((()=>this.isQuestionLoading=!0));const i=yield this.exerciseController.generateSupplementaryQuestion(s);if((0,U.z)((()=>this.isQuestionLoading=!1)),T.isLeft(i))throw i.left;i.right&&this.onQuestionLoaded(i.right)})),this.generateNextCorrectAnswer=()=>ee(this,void 0,void 0,(function*(){const{question:e}=this;if(!e)throw new Error("Current question not found");(0,U.z)((()=>this.isFeedbackLoading=!0));const t=yield this.exerciseController.generateNextCorrectAnswer(e.questionId);if((0,U.z)((()=>this.isFeedbackLoading=!1)),T.isLeft(t))throw t.left;const n=t.right;(0,U.z)((()=>{this.feedback=n,this.isFeedbackVisible=!0,n&&n.correctAnswers&&this.isHistoryChanged(n.correctAnswers)&&(this.answersHistory=n.correctAnswers)}))})),this.sendAnswersImpl=(e,t,n)=>ee(this,void 0,void 0,(function*(){const s=(0,U.ZN)({attemptId:e,questionId:t,answers:(0,U.ZN)(n)});(0,U.z)((()=>this.isFeedbackLoading=!0));const i=yield this.exerciseController.addQuestionAnswer(s);if((0,U.z)((()=>this.isFeedbackLoading=!1)),T.isLeft(i))throw i.left;const r=i.right;(0,U.z)((()=>{this.feedback=r,this.isFeedbackVisible=!0,r&&r.correctAnswers&&this.isHistoryChanged(r.correctAnswers)&&(this.answersHistory=r.correctAnswers)}))})),this.sendAnswers=()=>ee(this,void 0,void 0,(function*(){const{question:e,answersHistory:t}=this;e&&(yield this.sendAnswersImpl(e.attemptId,e.questionId,(0,U.ZN)(t)))})),this.onAnswersChanged=(e,t=!0)=>ee(this,void 0,void 0,(function*(){if((0,U.z)((()=>this.answersHistory.push(e))),t)try{yield this.sendAnswers()}catch(e){(0,U.z)((()=>{this.answersHistory.pop()}))}})),this.updateAnswersHistory=(e,t=!0)=>ee(this,void 0,void 0,(function*(){const n=this.answersHistory;if((0,U.z)((()=>this.answersHistory=[...e])),t)try{yield this.sendAnswers()}catch(e){(0,U.z)((()=>{this.answersHistory=n}))}})),this.isHistoryChanged=e=>{const{answersHistory:t,question:n}=this;if(!n)throw new Error("no question");switch(n.type){case"ORDER":return e.length!==t.length||JSON.stringify(e)!==JSON.stringify(t);case"MATCHING":case"MULTI_CHOICE":case"SINGLE_CHOICE":return e.length!==t.length||JSON.stringify([...e].sort())!==JSON.stringify([...t].sort())}},(0,U.rC)(this)}};var ne,se;K([U.LO,Y("design:type",Boolean)],te.prototype,"isQuestionLoading",void 0),K([U.LO,Y("design:type",Array)],te.prototype,"answersHistory",void 0),K([U.LO,Y("design:type",Boolean)],te.prototype,"isFeedbackLoading",void 0),K([U.LO,Y("design:type",Boolean)],te.prototype,"isFeedbackVisible",void 0),K([U.LO,Y("design:type",Object)],te.prototype,"feedback",void 0),K([U.LO,Y("design:type",Object)],te.prototype,"question",void 0),K([U.aD,Y("design:type",Object)],te.prototype,"sendAnswers",void 0),te=K([(0,r.b2)(),(ne=0,se=(0,r.f3)(V),function(e,t){se(e,t,ne)}),Y("design:paramtypes",[Object])],te);var ie=n(3706),re=function(e,t,n,s){var i,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(r<3?i(o):r>3?i(t,n,o):i(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o},oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ae=function(e,t){return function(n,s){t(n,s,e)}},le=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};let ce=class{constructor(e,t){this.exerciseController=e,this.isSessionLoading=!1,this.sessionInfo=void 0,this.currentAttempt=void 0,this.exerciseState="INITIAL",this.registerOnStrategyDecisionChangedAction=()=>{(0,U.EH)((()=>{var e;"FINISH"===(null===(e=this.currentQuestion.feedback)||void 0===e?void 0:e.strategyDecision)&&"COMPLETED"!==this.exerciseState&&this.setExerciseState("COMPLETED")}))},this.setExerciseState=e=>{(0,U.z)((()=>{this.exerciseState!==e&&(this.exerciseState=e)}))},this.loadSessionInfo=()=>le(this,void 0,void 0,(function*(){if(this.sessionInfo)throw new Error("Session exists");if(this.isSessionLoading)return;(0,U.z)((()=>this.isSessionLoading=!0));const e=yield this.exerciseController.loadSessionInfo();if((0,U.z)((()=>this.isSessionLoading=!1)),T.isLeft(e))throw e.left;this.onSessionLoaded(e.right)})),this.loadExistingExerciseAttempt=()=>le(this,void 0,void 0,(function*(){const{sessionInfo:e}=this;if(!e)throw new Error("Session is not defined");const t=e.exercise.id,n=yield this.exerciseController.getExistingExerciseAttempt(t);if(T.isLeft(n))throw n.left;const s=n.right;return!!s&&((0,U.z)((()=>{this.currentAttempt=s})),!0)})),this.createExerciseAttempt=()=>le(this,void 0,void 0,(function*(){const{sessionInfo:e}=this;if(!e)throw new Error("Session is not defined");const t=e.exercise.id,n=yield this.exerciseController.createExerciseAttempt(+t);if(T.isLeft(n))throw n.left;(0,U.z)((()=>{this.currentAttempt=n.right}))})),this.generateQuestion=()=>le(this,void 0,void 0,(function*(){const{sessionInfo:e,currentAttempt:t}=this;if(!e||!t)throw new Error("Session is not defined");yield this.currentQuestion.generateQuestion(t.attemptId),(0,U.z)((()=>{var e,n;t.questionIds.push(null!==(n=null===(e=this.currentQuestion.question)||void 0===e?void 0:e.questionId)&&void 0!==n?n:-1)}))})),this.changeLanguage=e=>{(0,U.z)((()=>{this.sessionInfo&&this.sessionInfo.language!==e&&(this.sessionInfo.language=e,ie.Z.changeLanguage(e))}))},(0,U.rC)(this),this.currentQuestion=t,this.registerOnStrategyDecisionChangedAction()}onSessionLoaded(e){(0,U.z)((()=>{this.isSessionLoading=!1,this.sessionInfo=e,this.sessionInfo.language!==ie.Z.language&&ie.Z.changeLanguage(this.sessionInfo.language)}))}};re([U.LO,oe("design:type",Boolean)],ce.prototype,"isSessionLoading",void 0),re([U.LO,oe("design:type",Object)],ce.prototype,"sessionInfo",void 0),re([U.LO,oe("design:type",Object)],ce.prototype,"currentAttempt",void 0),re([U.LO,oe("design:type",te)],ce.prototype,"currentQuestion",void 0),re([U.LO,oe("design:type",String)],ce.prototype,"exerciseState",void 0),ce=re([(0,r.b2)(),ae(0,(0,r.f3)(V)),ae(1,(0,r.f3)(te)),oe("design:paramtypes",[Object,te])],ce);var de=n(5361);r.nC.register(V,{useFactory:()=>{var e;return null!==(null!==(e=new URLSearchParams(window.location.search).get("sandbox"))&&void 0!==e?e:null)?new X:new V}}),r.nC.register(te,te),r.nC.registerSingleton(ce),ie.Z.use(de.Db).init({resources:{EN:{translation:{question_header:"Question",language_header:"Language",signedin_as_header:"Signed in as",nextCorrectAnswerBtn:"I'm confused, tell me the next correct step",generateNextQuestion_nextQuestion:"Next question",generateNextQuestion_warning:"Warning",generateNextQuestion_continueAttempt:"Continue attempt",generateNextQuestion_modalMessage1:"It is recommended to move on to the next question only after solving all the previous ones.",generateNextQuestion_modalMessage2:"Are you sure you want to move on to the next question?",generateSupQuestion_gotit:"Got it",generateSupQuestion_details:"More details",grade_feeback:"Grade",correctsteps_feeback:"Correct steps",stepswitherrors_feeback:"Steps with errors",stepsleft_feeback:"Steps left",issolved_feeback:"Solved",foundExisitingAttempt_title:"Found existing attempt",foundExisitingAttempt_descr:"Would you like to continue the existing attempt or start a new one",foundExisitingAttempt_continueattempt:"Continue",foundExisitingAttempt_newattempt:"New",exercise_completed:"Exercise completed"}},RU:{translation:{question_header:"Вопрос",language_header:"Язык",signedin_as_header:"Пользователь",nextCorrectAnswerBtn:"Я в замешательстве, подскажи следующий корректный шаг",generateNextQuestion_nextQuestion:"Следующий вопрос",generateNextQuestion_warning:"Предупреждение",generateNextQuestion_continueAttempt:"Продолжить попытку",generateNextQuestion_modalMessage1:"Рекомендуется переходить к следующему вопросу только после решения всех предыдущих.",generateNextQuestion_modalMessage2:"Вы действительно хотите перейти к следующему вопросу?",generateSupQuestion_gotit:"Понятно",generateSupQuestion_details:"Разобраться подробнее",grade_feeback:"Оценка",correctsteps_feeback:"Правильных шагов",stepswitherrors_feeback:"Шагов с ошибками",stepsleft_feeback:"Шагов осталось",issolved_feeback:"Задача решена",foundExisitingAttempt_title:"Найдена неоконченная попытка",foundExisitingAttempt_descr:"Вы хотите продолжить существующую попытку или начать новую",foundExisitingAttempt_continueattempt:"Продолжить",foundExisitingAttempt_newattempt:"Новая",exercise_completed:"Упражнение завершено"}}},lng:"EN",interpolation:{escapeValue:!1}});var ue=n(3727),pe=n(5977),me=n(150),he=n(5005),we=n(8134),ge=n(4202);const fe=e=>{const{isVisible:t,children:n}=e;return t?i.createElement(i.Fragment,null,n):null},ve=e=>{const{title:t,primaryBtnTitle:n,handlePrimaryBtnClicked:s,secondaryBtnTitle:r,handleSecondaryBtnClicked:o,children:a,closeButton:c,show:d,handleClose:u,type:p,size:m}=e;return i.createElement(fe,{isVisible:null==d||d},i.createElement(Ee,{type:null!=p?p:"MODAL",show:null==d||d,onHide:u,size:m},i.createElement(fe,{isVisible:l(t)&&t.length>0},i.createElement(ge.Z.Header,{closeButton:c},i.createElement(ge.Z.Title,null,t))),i.createElement(ge.Z.Body,null,a),r||n?i.createElement(ge.Z.Footer,null,r?i.createElement(he.Z,{variant:"secondary",onClick:o},r):null,n?i.createElement(he.Z,{variant:"primary",onClick:s},n):null):null))},Ee=e=>{const{type:t,show:n,onHide:s,children:r,size:o}=e;return"DIALOG"===t?i.createElement(ge.Z.Dialog,{size:o},r):i.createElement(ge.Z,{size:o,show:n,onHide:s},r)};var ye=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const xe=(0,me.Pi)((()=>{var e;const[t]=(0,i.useState)((()=>r.nC.resolve(ce))),{t:n}=(0,we.$)(),[s,o]=(0,i.useState)(!1);if(!(null===(e=t.sessionInfo)||void 0===e?void 0:e.exercise.options.newQuestionGenerationEnabled))return null;const{sessionInfo:a,currentAttempt:l}=t,{question:c,isQuestionLoading:d,isFeedbackLoading:u}=t.currentQuestion;if(!c||!a||!l||d||u)return null;const p=()=>{o(!1)},m=()=>ye(void 0,void 0,void 0,(function*(){o(!1);const{questionIds:e=[]}=l,n=e.indexOf(c.questionId);n===e.length-1?yield t.generateQuestion():yield t.currentQuestion.loadQuestion(e[n+1])}));return i.createElement(i.Fragment,null,i.createElement(he.Z,{onClick:()=>ye(void 0,void 0,void 0,(function*(){var e;const{questionIds:n=[]}=l,s=n.indexOf(c.questionId)===n.length-1;0!==(null===(e=t.currentQuestion.feedback)||void 0===e?void 0:e.stepsLeft)&&s?o(!0):yield m()})),variant:"primary"},n("generateNextQuestion_nextQuestion")),i.createElement(ve,{show:s,title:n("generateNextQuestion_warning"),type:"MODAL",size:"lg",primaryBtnTitle:n("generateNextQuestion_continueAttempt"),handlePrimaryBtnClicked:p,secondaryBtnTitle:n("generateNextQuestion_nextQuestion"),handleSecondaryBtnClicked:m,closeButton:!1,handleClose:p},i.createElement("div",null,n("generateNextQuestion_modalMessage1")),i.createElement("div",null,n("generateNextQuestion_modalMessage2"))))}));var be=n(8889),Ie=n(8966);const _e=(0,me.Pi)((()=>{var e,t;const[n]=(0,i.useState)((()=>r.nC.resolve(ce)));if(!n.currentQuestion.question||!n.currentAttempt)return null;const{questionId:s}=n.currentQuestion.question,o=n.currentAttempt.questionIds.map(((e,t)=>({id:e,number:t+1})));if(0===o.length)return null;const a=null!==(t=null===(e=o.find((e=>e.id===s)))||void 0===e?void 0:e.number)&&void 0!==t?t:-1,l=a-5<=0?"BEGIN":a+5>o.length?"END":"MIDDLE",c=Math.floor(2.5);return i.createElement("div",{className:"d-flex justify-content-center"},i.createElement(Ie.Z,{className:"p-3",style:{marginBottom:"0 !important"}},i.createElement(fe,{isVisible:o.length<=10},o.map((e=>i.createElement(Ie.Z.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number)))),i.createElement(fe,{isVisible:o.length>10},i.createElement(Ie.Z.First,{disabled:s===o[0].id,onClick:()=>n.currentQuestion.loadQuestion(o[0].id)}),i.createElement(Ie.Z.Prev,{disabled:s===o[0].id,onClick:()=>n.currentQuestion.loadQuestion(o[o.findIndex((e=>s===e.id))-1].id)}),i.createElement(fe,{isVisible:"BEGIN"===l},o.filter((e=>e.number<=7)).map((e=>i.createElement(Ie.Z.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number))),i.createElement(Ie.Z.Ellipsis,{disabled:!0}),i.createElement(Ie.Z.Item,{key:o[o.length-1].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(o[o.length-1].id)},o[o.length-1].number)),i.createElement(fe,{isVisible:"MIDDLE"===l},i.createElement(Ie.Z.Item,{key:o[0].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(o[0].id)},o[0].number),i.createElement(Ie.Z.Ellipsis,{disabled:!0}),o.filter((e=>e.number>=a-c&&e.number<=a+c)).map((e=>i.createElement(Ie.Z.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number))),i.createElement(Ie.Z.Ellipsis,{disabled:!0}),i.createElement(Ie.Z.Item,{key:o[o.length-1].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(o[o.length-1].id)},o[o.length-1].number)),i.createElement(fe,{isVisible:"END"===l},i.createElement(Ie.Z.Item,{key:o[0].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(o[0].id)},o[0].number),i.createElement(Ie.Z.Ellipsis,{disabled:!0}),o.filter((e=>e.number>o.length-7)).map((e=>i.createElement(Ie.Z.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number)))),i.createElement(Ie.Z.Next,{disabled:s===o[o.length-1].id,onClick:()=>n.currentQuestion.loadQuestion(o[o.findIndex((e=>s===e.id))+1].id)}),i.createElement(Ie.Z.Last,{disabled:s===o[o.length-1].id,onClick:()=>n.currentQuestion.loadQuestion(o[o.length-1].id)}))))})),qe=(0,me.Pi)((()=>{var e;const[t]=(0,i.useState)((()=>r.nC.resolve(ce))),{t:n,i18n:s}=(0,we.$)(),{currentAttempt:o,sessionInfo:a,currentQuestion:l}=t;if(!o||!a)return null;const{user:c}=a,d=o.questionIds.findIndex((e=>{var t;return(null===(t=l.question)||void 0===t?void 0:t.questionId)===e}));return i.createElement(be.Z,{className:"px-0"},i.createElement(fe,{isVisible:-1!==d},i.createElement("h5",null,n("question_header")," #",d+1)),i.createElement(be.Z.Collapse,{className:"justify-content-end"},i.createElement(_e,null),i.createElement(be.Z.Text,{className:"px-2"},n("language_header"),": ",i.createElement("a",{href:"#"},a.language)),i.createElement(be.Z.Toggle,null),i.createElement(be.Z.Text,{className:"px-2"},n("signedin_as_header"),": ",i.createElement(ue.rU,{to:`statistics?exerciseId=${null===(e=t.currentAttempt)||void 0===e?void 0:e.exerciseId}`},c.displayName))))}));var Ce=n(6968);const Se=e=>{var t;const n=null!==(t=e.delay)&&void 0!==t?t:0,[s,r]=(0,i.useState)(0===n);return(0,i.useEffect)((()=>{n>0&&setTimeout((()=>!s&&r(!0)),n)})),s?i.createElement(Ce.Z,{animation:"border",variant:"primary"}):null},ke=e=>{const{children:t,isLoading:n}=e;return n?i.createElement(Se,Object.assign({},e)):i.createElement(i.Fragment,null,t)},Qe=(0,me.Pi)((()=>{var e;const[t]=(0,i.useState)((()=>r.nC.resolve(ce))),{t:n}=(0,we.$)();if(!(null===(e=t.sessionInfo)||void 0===e?void 0:e.exercise.options.correctAnswerGenerationEnabled))return null;const{sessionInfo:s,currentAttempt:o,currentQuestion:a}=t,{question:l,isFeedbackLoading:c,feedback:d,isQuestionLoading:u}=a;return l&&s&&o&&!c&&!u&&0!==(null==d?void 0:d.stepsLeft)?i.createElement(he.Z,{onClick:()=>{t.currentQuestion.generateNextCorrectAnswer()},variant:"primary"},n("nextCorrectAnswerBtn")):null}));var Ae=n(4320),Le=n(1694),Oe=n(5665),Ne=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]])}return n};const Me=(0,me.Pi)((e=>{const{question:t}=e,{options:n}=t;switch(!0){case"combobox"===n.displayMode&&!n.requireContext:return i.createElement(He,Object.assign({},e));case"combobox"===n.displayMode&&n.requireContext:return i.createElement(Pe,Object.assign({},e));case"dragNdrop"===n.displayMode:return i.createElement($e,Object.assign({},e))}return i.createElement("div",null,"Not Implemented")})),$e=(0,me.Pi)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;if("dragNdrop"!==t.options.displayMode)return null;const{groups:r=[]}=t,{options:o}=t,a=o.dropzoneStyle&&JSON.parse(o.dropzoneStyle)||{},l=o.dropzoneStyle&&JSON.parse(o.draggableStyle)||{};return(0,i.useEffect)((()=>{document.querySelectorAll(`[id^="question_${t.questionId}_answer_"]`).forEach((e=>{e.classList.add("comp-ph-dropzone"),Object.keys(a).forEach((t=>e.style[t]=a[t])),e.innerHTML=`<div class="comp-ph-dropzone-placeholder">${o.dropzoneHtml}</div>`}));const e=new Ae.Droppable(document.querySelectorAll(".comp-ph-droppable-container"),{draggable:".comp-ph-draggable",dropzone:".comp-ph-dropzone",plugins:[Ae.Plugins.ResizeMirror],mirror:{constrainDimensions:!0}});e.on("drag:over",(()=>console.log("is out"))),e.on("droppable:stop",(e=>{var n,i,r,a,l,c,d;const u=null===(a=null===(r=null===(i=null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.dragEvent)||void 0===i?void 0:i.data)||void 0===r?void 0:r.source)||void 0===a?void 0:a.id,p=null===(c=null===(l=null==e?void 0:e.data)||void 0===l?void 0:l.dropzone)||void 0===c?void 0:c.id;if(u&&p){if(o.multipleSelectionEnabled){const e=`dragAnswerWrapper_${null!==(d=u.split("_")[1])&&void 0!==d?d:""}`,t=document.getElementById(e),n=document.getElementById(u);e!==p&&t&&n&&(t.innerHTML=n.outerHTML)}setTimeout((()=>{const e=[...document.querySelectorAll(`[id^="question_${t.questionId}_answer_"] > [id^="dragAnswer_"]`)].map((e=>{var n,s,i;return[+(null!==(s=null===(n=e.parentElement)||void 0===n?void 0:n.id.split(`question_${t.questionId}_answer_`)[1])&&void 0!==s?s:""),+(null!==(i=null==e?void 0:e.id.split("dragAnswer_")[1])&&void 0!==i?i:"")]}));s(e)}),10)}}))}),[t.questionId]),i.createElement("div",null,i.createElement("div",{className:"row"},i.createElement("div",{className:"col-md"},o.requireContext?i.createElement("p",{className:"comp-ph-droppable-container comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}}):i.createElement("p",{className:"d-flex flex-column comp-ph-droppable-container comp-ph-question-text"},t.answers.map((e=>i.createElement("div",{className:"d-flex flex-row mb-3"},i.createElement("div",{className:"mr-2 mt-1"},i.createElement("div",{id:`question_${t.questionId}_answer_${e.id}`})),i.createElement("div",{dangerouslySetInnerHTML:{__html:e.text}})))))),i.createElement("div",{className:"col-md comp-ph-droppable-container d-flex justify-content-start align-items-start flex-column"},r.map((e=>i.createElement("div",{id:`dragAnswerWrapper_${e.id}`,className:"comp-ph-dropzone mb-2",style:a},i.createElement("div",{className:"comp-ph-dropzone-placeholder",dangerouslySetInnerHTML:{__html:o.dropzoneHtml}}),i.createElement("div",{id:`dragAnswer_${e.id}`,className:"comp-ph-draggable",style:l,dangerouslySetInnerHTML:{__html:e.text}})))))))})),He=(0,me.Pi)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;if("combobox"!==t.options.displayMode)return null;const{groups:r=[]}=t,o=r.reduce(((e,t)=>t.text.length>e?t.text.length:e),0);return i.createElement("div",null,i.createElement("p",{className:"mb-5 comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}}),i.createElement("div",null,t.answers.map((e=>{var a,l;return i.createElement("div",{className:"row mb-3"},i.createElement("div",{className:"col-md-6",dangerouslySetInnerHTML:{__html:t.text}}),i.createElement("div",{className:"col-md-auto"},i.createElement("div",{style:{width:8*o+100+"px"}},i.createElement(Le.ZP,{defaultValue:null!==(l=null===(a=n().find((t=>t[0]===e.id)))||void 0===a?void 0:a[1])&&void 0!==l?l:null,options:r.map((e=>({value:e.id,label:e.text}))),components:{Option:Te,SingleValue:je},onChange:t=>{if(!t)return;const i=[...n().filter((t=>t[0]!==e.id)),[e.id,+t.value]];s(i)}}))))}))))})),Pe=(0,me.Pi)((e=>{const{question:t,getAnswers:n,onChanged:r}=e;if("combobox"!==t.options.displayMode)return null;const{groups:o=[],options:a}=t;return(0,i.useEffect)((()=>{document.querySelectorAll(`[id^="question_${t.questionId}_answer_"]`).forEach((e=>{var a;const l=+(null===(a=e.id)||void 0===a?void 0:a.split(`question_${t.questionId}_answer_`)[1]),c=i.createElement(Le.ZP,{options:o.map((e=>({value:e.id,label:e.text}))),components:{Option:Te,SingleValue:je},onChange:e=>{if(!e)return;const t=[...n().filter((e=>e[0]!==l)),[l,+e.value]];r(t)}});s.render(c,e)}))}),[t.questionId]),i.createElement("div",null,i.createElement("p",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}}))})),Te=e=>{const{innerRef:t,innerProps:n,children:s}=e,r=Ne(e,["innerRef","innerProps","children"]);return i.createElement(Oe.c.Option,Object.assign({},r),i.createElement("div",Object.assign({ref:t},n,{dangerouslySetInnerHTML:{__html:e.label}})))},je=e=>{var t;const{innerRef:n,innerProps:s,children:r}=e,o=Ne(e,["innerRef","innerProps","children"]);return i.createElement(Oe.c.SingleValue,Object.assign({},o),null===(t=e.getValue())||void 0===t?void 0:t.map((e=>i.createElement("div",Object.assign({ref:n},s,{dangerouslySetInnerHTML:{__html:e.label}})))))},Ze=({id:e,title:t,onChange:n})=>i.createElement("label",{htmlFor:e,onClick:()=>n(t)},t.split(/\s+/).map((e=>e[0].toUpperCase()+e.slice(1))).join(" ")),Re=({id:e,value:t,name:n,selected:s})=>i.createElement("input",{id:e,type:"radio",name:n,checked:s===t}),ze=e=>{const[t,n]=(0,i.useState)(e.selected),s=t=>{var s;n(t),null===(s=e.onChange)||void 0===s||s.call(e,t)};return i.createElement("div",{id:e.id,className:"switch-field d-inline-flex flex-row"},e.values.map((n=>i.createElement("span",null,i.createElement(Re,{id:`${e.id}_${n}_checkbox`,name:`${e.id}_switch`,value:n,selected:t}),i.createElement(Ze,{id:`${e.id}_${n}_checkbox`,title:n,onChange:s})))))},Ge=(0,me.Pi)((e=>{const{question:t}=e,{options:n}=t;switch(!0){case"switch"==n.displayMode&&!n.requireContext:return i.createElement(Be,Object.assign({},e));case"switch"===n.displayMode&&n.requireContext:return i.createElement(Fe,Object.assign({},e));case"dragNdrop"===n.displayMode:return i.createElement(Ve,Object.assign({},e))}return i.createElement("div",null,"Not implemented")})),Be=(0,me.Pi)((e=>{var t;const{question:n,getAnswers:s,onChanged:r}=e;if("switch"!==n.options.displayMode)return null;const{options:o}=n,a=null!==(t=o.selectorReplacers)&&void 0!==t?t:["no","yes"];return i.createElement("div",null,i.createElement("p",null,i.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:n.text}})),i.createElement("p",{className:"d-flex flex-column"},n.answers.map((e=>{var t,o,l;return i.createElement("div",{className:"d-flex flex-row mb-3"},i.createElement("div",{className:"mr-2 mt-1"},i.createElement(ze,{id:`question_${n.questionId}_anwser_${e.id}`,selected:null!==(l=a[null===(o=null===(t=s().filter((t=>t[0]===e.id)))||void 0===t?void 0:t[0])||void 0===o?void 0:o[1]])&&void 0!==l?l:"",values:a,onChange:t=>((e,t)=>{const n=a.indexOf(t),i=[...s().filter((t=>t[0]!==e)),[e,n]];r(i)})(e.id,t)})),i.createElement("div",null,e.text))}))))})),Fe=(0,me.Pi)((e=>{var t;const{question:n,getAnswers:r,onChanged:o}=e;if("switch"!==n.options.displayMode)return null;const{options:a}=n,l=null!==(t=a.selectorReplacers)&&void 0!==t?t:["no","yes"];return(0,i.useEffect)((()=>{document.querySelectorAll(`[id^="question_${n.questionId}_answer_"]`).forEach((e=>{var t,a,c,d,u;const p=null!==(a=null===(t=e.id)||void 0===t?void 0:t.split(`question_${n.questionId}_answer_`)[1])&&void 0!==a?a:-1,m=i.createElement(ze,{id:e.id,selected:null!==(u=l[null===(d=null===(c=r().filter((e=>e[0]===+p)))||void 0===c?void 0:c[0])||void 0===d?void 0:d[1]])&&void 0!==u?u:"",values:l,onChange:e=>((e,t)=>{const n=l.indexOf(t),s=[...r().filter((t=>t[0]!==e)),[e,n]];o(s)})(+p,e)});s.render(m,e),e.id=""}))}),[n.questionId]),(0,i.useEffect)((()=>{document.querySelectorAll(`input[id^="question_${n.questionId}_answer_"]`).forEach((e=>{var t;null===(t=e.id)||void 0===t||t.split(`question_${n.questionId}_answer_`)[1],e.checked=void 0})),r().forEach((([e,t])=>{const s=`question_${n.questionId}_answer_${e}_${l[t]}_checkbox`,i=document.getElementById(s);i&&setTimeout((()=>i.checked=!0),10)}))}),[n.questionId]),i.createElement("div",null,i.createElement("p",null,i.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:n.text}})))})),Ve=(0,me.Pi)((e=>{const{question:t,getAnswers:n,onChanged:s,answers:r}=e;if("dragNdrop"!==t.options.displayMode)return null;const o=Object.assign(Object.assign({},t),{type:"MATCHING",options:Object.assign(Object.assign({},t.options),{multipleSelectionEnabled:!0}),groups:[{id:0,text:'<span class="badge badge-success" style="height: 100%; width: 100%;display: flex; align-items: center;justify-content: center;">✓</span>'},{id:1,text:'<span class="badge badge-danger" style="height: 100%; width: 100%;display: flex; align-items: center;justify-content: center;">x</span>'}]});return i.createElement($e,{question:o,getAnswers:n,onChanged:s,answers:r})})),De=(0,me.Pi)((e=>{var t,n;const{question:s,getAnswers:r,onChanged:o,feedback:a}=e;if(!s.options.requireContext)return null;const{options:c}=s,d=null!==(t=c.orderNumberOptions)&&void 0!==t?t:{delimiter:"/",position:"SUFFIX"},u=document.createElement("div");u.innerHTML=s.text,(0,i.useEffect)((()=>{document.querySelectorAll(`[id^="question_${s.questionId}_answer_"]`).forEach((e=>{var t,n;const i=+(null!==(n=null===(t=e.id)||void 0===t?void 0:t.split(`question_${s.questionId}_answer_`)[1])&&void 0!==n?n:"");e.addEventListener("click",(()=>o([...r(),[i,i]])))})),document.querySelectorAll("[data-comp-ph-pos]").forEach((e=>{const t=e.getAttribute("data-comp-ph-pos");e.innerHTML+=`<span class="comp-ph-expr-top-hint">${t}</span>`}))}),[s.questionId]),(0,i.useEffect)((()=>{document.querySelectorAll(`[id^="question_${s.questionId}_answer_"]`).forEach((e=>{var t;const n=e.getAttribute("data-comp-ph-pos");e.innerHTML=(null===(t=u.querySelector(`#${e.id}`))||void 0===t?void 0:t.innerHTML)+(n?`<span class="comp-ph-expr-top-hint">${n}</span>`:""),e.classList.remove("disabled")})),r().forEach((([e],t)=>{var n,i;const r=document.querySelector(`#question_${s.questionId}_answer_${e}`);if(!r)return 0;if("NONE"!==d.position){const e=null!==(i=null===(n=d.replacers)||void 0===n?void 0:n[t])&&void 0!==i?i:t+1,s="PREFIX"===d.position?[e,r.innerHTML]:"SUFFIX"===d.position?[r.innerHTML,e]:[r.innerHTML];r.innerHTML=s.join(d.delimiter)}c.multipleSelectionEnabled&&r.classList.add("disabled")}))}),[s.questionId,r().length]);const p=null!==(n=null==a?void 0:a.trace)&&void 0!==n?n:0===r().length?s.initialTrace:null,m=c.showTrace&&l(p)&&p.length>0;return i.createElement("div",null,i.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:s.text}}),i.createElement(fe,{isVisible:m},i.createElement("p",null,i.createElement("table",{className:"comp-ph-trace"},i.createElement("tbody",null,null==p?void 0:p.map((e=>i.createElement("tr",null,i.createElement("td",{dangerouslySetInnerHTML:{__html:e}})))))))))})),Xe=(0,me.Pi)((e=>{const{question:t}=e;switch(!0){case"radio"===t.options.displayMode&&!t.options.requireContext:return i.createElement(Ue,Object.assign({},e));case"radio"===t.options.displayMode&&t.options.requireContext:return i.createElement(We,Object.assign({},e))}return i.createElement("div",null,"Not implemented")})),Ue=(0,me.Pi)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;return"radio"!==t.options.displayMode?null:i.createElement("div",null,i.createElement("div",{className:"mb-3"},i.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}})),i.createElement("div",{className:"d-flex flex-column"},t.answers.map(((e,r)=>i.createElement("label",{htmlFor:`question_${t.questionId}_answer_${e.id}`,className:"d-flex flex-row "+(r!==t.answers.length-1?"mb-3":"")},i.createElement("div",{className:"mr-2 mt-1"},i.createElement("input",{id:`question_${t.questionId}_answer_${e.id}`,name:`switch_${t.questionId}`,type:"radio",checked:n().some((t=>t[0]===e.id)),onChange:t=>{return n=e.id,void(t.target.checked&&s([[n,n]]));var n}})),i.createElement("div",null,e.text))))))})),We=(0,me.Pi)((e=>{const{question:t,getAnswers:n,onChanged:r}=e;if("radio"!==t.options.displayMode)return null;const{options:o}=t;return(0,i.useEffect)((()=>{document.querySelectorAll(`[id^="question_${t.questionId}_answer_"]`).forEach((e=>{var o,a;const l=null!==(a=null===(o=e.id)||void 0===o?void 0:o.split(`question_${t.questionId}_answer_`)[1])&&void 0!==a?a:-1,c=i.createElement("label",{htmlFor:`question_${t.questionId}_answer_${l}`},i.createElement("input",{id:`question_${t.questionId}_answer_${l}`,name:`switch_${t.questionId}`,type:"radio",checked:n().some((e=>e[0]===+l)),onChange:e=>{return t=+l,void(e.target.checked&&r([[t,t]]));var t}}),i.createElement("span",{dangerouslySetInnerHTML:{__html:e.innerHTML}}));s.render(c,e),e.id=""}))}),[t.questionId]),(0,i.useEffect)((()=>{document.querySelectorAll(`input[id^="question_${t.questionId}_answer_"]`).forEach((e=>{e.checked=void 0})),n().forEach((([e])=>{const n=document.getElementById(`question_${t.questionId}_answer_${e}`);n&&setTimeout((()=>n.checked=!0),10)}))}),[t.questionId,n()]),i.createElement("div",null,i.createElement("p",null,i.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}})))})),Je=(0,me.Pi)((e=>{const{question:t,answers:n,onChanged:s,getAnswers:r,feedback:o,isFeedbackLoading:a}=e;let l;switch(t.type){case"MATCHING":l=i.createElement(Me,{question:t,onChanged:s,answers:n,getAnswers:r});break;case"MULTI_CHOICE":l=i.createElement(Ge,{question:t,onChanged:s,answers:n,getAnswers:r});break;case"SINGLE_CHOICE":l=i.createElement(Xe,{question:t,onChanged:s,answers:n,getAnswers:r});break;case"ORDER":l=i.createElement(De,{question:t,onChanged:s,answers:n,getAnswers:r,feedback:o})}return i.createElement("div",{className:`comp-ph-question-wrapper ${0===(null==o?void 0:o.stepsLeft)?"comp-ph-question-wrapper--finished":""} ${a?"comp-ph-question-wrapper--loading-feedback":""}`},l)}));var Ke=n(7977),Ye=n(8375),et=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const tt=(0,me.Pi)((({violationLaw:e})=>{var t;const[n]=(0,i.useState)((()=>r.nC.resolve(ce))),[s]=(0,i.useState)((()=>r.nC.resolve(te))),{t:o}=(0,we.$)(),[a,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!0),[u,p]=(0,i.useState)(!0);return(null===(t=n.sessionInfo)||void 0===t?void 0:t.exercise.options.supplementaryQuestionsEnabled)&&!1!==e.canCreateSupplementaryQuestion?i.createElement(fe,{isVisible:u},i.createElement(fe,{isVisible:c},i.createElement("div",{className:"d-flex flex-row mt-3"},i.createElement(he.Z,{onClick:()=>et(void 0,void 0,void 0,(function*(){var t,i;d(!1),l(!0),(null===(t=n.currentAttempt)||void 0===t?void 0:t.attemptId)&&n.currentQuestion.question&&(yield s.generateSupplementaryQuestion(n.currentAttempt.attemptId,null===(i=n.currentQuestion.question)||void 0===i?void 0:i.questionId,[e].map((e=>e.name))),s.question||(console.log("no need to generate sup question"),p(!1)))})),variant:"primary"},o("generateSupQuestion_details")),i.createElement(he.Z,{onClick:()=>{p(!1)},variant:"success",className:"ml-2"},o("generateSupQuestion_gotit")))),i.createElement(ve,{type:"DIALOG",size:"xl",show:a,closeButton:!1,handleClose:()=>l(!1)},i.createElement(nt,{store:s,showExtendedFeedback:!1,onChanged:()=>et(void 0,void 0,void 0,(function*(){var e,t,i;console.log("show feedback for 3 seconds"),yield(3e3,new Promise((e=>setTimeout((()=>e()),3e3))));const r=(null===(e=s.feedback)||void 0===e?void 0:e.messages)&&"ERROR"===s.feedback.messages[0].type&&s.feedback.messages[0].violationLaw||null;if(!r)return console.log("empty violation laws"),void p(!1);(null===(t=n.currentAttempt)||void 0===t?void 0:t.attemptId)&&n.currentQuestion.question?(yield s.generateSupplementaryQuestion(n.currentAttempt.attemptId,null===(i=n.currentQuestion.question)||void 0===i?void 0:i.questionId,[r].map((e=>e.name))),s.question||(console.log("no need to generate sup question"),p(!1))):console.log("problems with attempt")}))}))):null}));const nt=(0,me.Pi)((e=>{const{store:t,showExtendedFeedback:n,onChanged:s}=e,r=t.question;return t.isQuestionLoading?i.createElement("div",{className:"mt-2"},i.createElement(Se,null)):r?i.createElement(i.Fragment,null,i.createElement(Je,{question:r,answers:t.answersHistory,getAnswers:()=>t.answersHistory,onChanged:e=>{return n=void 0,i=void 0,o=function*(){t.isHistoryChanged(e)&&(yield t.updateAnswersHistory(e),null==s||s(e))},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{l(o.next(e))}catch(e){t(e)}}function a(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}l((o=o.apply(n,i||[])).next())}));var n,i,r,o},feedback:t.feedback,isFeedbackLoading:t.isFeedbackLoading}),i.createElement(st,{store:t,showExtendedFeedback:n})):null})),st=(0,me.Pi)((({store:e,showExtendedFeedback:t})=>{const{feedback:n,isFeedbackLoading:s,isFeedbackVisible:r,isQuestionLoading:o,question:a}=e,{t:c}=(0,we.$)();if(s)return i.createElement("div",{className:"mt-2"},i.createElement(Se,null));if(!n||o||!a)return null;const d=l(n.stepsLeft)&&0===n.stepsLeft?[{type:"SUCCESS",message:c("issolved_feeback")}]:n.messages;return i.createElement("div",{className:"comp-ph-feedback-wrapper mt-2"},i.createElement(fe,{isVisible:r},i.createElement("div",null,null==d?void 0:d.map((e=>i.createElement(it,{message:e,showGenerateSupQuestion:t&&a.options.showSupplementaryQuestions&&"ERROR"===e.type&&e.violationLaw.canCreateSupplementaryQuestion})))),i.createElement(fe,{isVisible:t},i.createElement("div",null,i.createElement(fe,{isVisible:null!==n.grade},i.createElement(Ke.Z,{variant:"primary"},c("grade_feeback"),": ",n.grade)," "),i.createElement(fe,{isVisible:null!==n.correctSteps},i.createElement(Ke.Z,{variant:"success"},c("correctsteps_feeback"),": ",n.correctSteps)," "),i.createElement(fe,{isVisible:l(n.stepsWithErrors)&&n.stepsWithErrors>0},i.createElement(Ke.Z,{variant:"danger"},c("stepswitherrors_feeback"),": ",n.stepsWithErrors)," "),i.createElement(fe,{isVisible:l(n.stepsLeft)&&n.stepsLeft>0},i.createElement(Ke.Z,{variant:"info"},c("stepsleft_feeback"),": ",n.stepsLeft)," ")))))})),it=(0,me.Pi)((({message:e,showGenerateSupQuestion:t})=>{const n="SUCCESS"===e.type?"success":"danger";return i.createElement(Ye.Z,{variant:n},e.message,t&&"ERROR"===e.type&&e.violationLaw&&i.createElement(tt,{violationLaw:e.violationLaw})||null)})),rt=(0,me.Pi)((()=>{const[e]=(0,i.useState)((()=>r.nC.resolve(ce)));return i.createElement(nt,{store:e.currentQuestion,showExtendedFeedback:!0})}));var ot=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const at=(0,me.Pi)((()=>{const[e]=(0,i.useState)((()=>r.nC.resolve(ce))),{exerciseState:t,setExerciseState:n}=e,{t:s}=(0,we.$)();(0,i.useEffect)((()=>{ot(void 0,void 0,void 0,(function*(){e.currentQuestion.question?n("EXERCISE"):(yield e.loadSessionInfo(),(yield e.loadExistingExerciseAttempt())?n("MODAL"):(n("EXERCISE"),yield a()))}))}),[]);const o=()=>ot(void 0,void 0,void 0,(function*(){var t,n,s;if(null===(t=e.currentAttempt)||void 0===t?void 0:t.questionIds.length){const t=null===(n=e.currentAttempt)||void 0===n?void 0:n.questionIds.length;yield e.currentQuestion.loadQuestion(null===(s=e.currentAttempt)||void 0===s?void 0:s.questionIds[t-1])}else yield e.generateQuestion()})),a=()=>ot(void 0,void 0,void 0,(function*(){e.currentQuestion.isQuestionLoading=!0,yield e.createExerciseAttempt(),yield o()}));return i.createElement(ke,{isLoading:"INITIAL"===t},i.createElement(fe,{isVisible:"EXERCISE"===t||"COMPLETED"===t},i.createElement(qe,null),i.createElement("div",{className:"mt-5"},i.createElement(rt,null),i.createElement(fe,{isVisible:"EXERCISE"===t},i.createElement("div",{className:"mt-3"},i.createElement(Qe,null)),i.createElement("div",{className:"mt-2"},i.createElement(xe,null))),i.createElement(fe,{isVisible:"COMPLETED"===t},i.createElement("div",{className:"mt-3"},i.createElement(Ye.Z,{variant:"success"},s("exercise_completed")))))),i.createElement(fe,{isVisible:"MODAL"===t},i.createElement(ve,{type:"DIALOG",title:s("foundExisitingAttempt_title"),primaryBtnTitle:s("foundExisitingAttempt_continueattempt"),handlePrimaryBtnClicked:()=>{n("EXERCISE"),o()},secondaryBtnTitle:s("foundExisitingAttempt_newattempt"),handleSecondaryBtnClicked:()=>{n("EXERCISE"),a()}},i.createElement("p",null,s("foundExisitingAttempt_descr"),"?"))))}));const lt=()=>{const[e,t]=(0,i.useState)([]),[n,s]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{var e,n,i,o;e=void 0,n=void 0,o=function*(){const e=new URLSearchParams(window.location.search).get("exerciseId");if(null===e||Number.isNaN(+e))throw new Error("Invalid exerciseId url param");const n=r.nC.resolve(V);s(!0);const i=yield n.getExerciseStatistics(+e);T.isRight(i)&&t(i.right),s(!1)},new((i=void 0)||(i=Promise))((function(t,s){function r(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}l((o=o.apply(e,n||[])).next())}))}),[]),i.createElement("div",null,i.createElement("table",{className:"table"},i.createElement("thead",null,i.createElement("tr",null,i.createElement("th",{scope:"col"},"AttemptId"),i.createElement("th",{scope:"col"},"QuestionsCount"),i.createElement("th",{scope:"col"},"TotalInteractionsCount"),i.createElement("th",{scope:"col"},"TotalInteractionsWithErrorsCount"),i.createElement("th",{scope:"col"},"AverageGrade"))),i.createElement("tbody",null,i.createElement(ke,{isLoading:n},e.map((e=>i.createElement("tr",null,i.createElement("th",{scope:"row"},e.attemptId),i.createElement("td",null,e.questionsCount),i.createElement("td",null,e.totalInteractionsCount),i.createElement("td",null,e.totalInteractionsWithErrorsCount),i.createElement("td",null,e.averageGrade))))))))};var ct=n(6712);const dt=(0,me.Pi)((()=>{const[e,t]=(0,i.useState)([]),[n,s]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{var e,n,i,o;e=void 0,n=void 0,o=function*(){s(!0);const e=r.nC.resolve(V),n=yield e.getExercises();T.isRight(n)&&t(n.right),s(!1)},new((i=void 0)||(i=Promise))((function(t,s){function r(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}l((o=o.apply(e,n||[])).next())}))}),[]),i.createElement("div",null,i.createElement(ct.Z,null,e.map((e=>i.createElement(ct.Z.Item,null,i.createElement("a",{href:`exercise?exerciseId=${e}`},e))))))}));(0,s.hydrate)(i.createElement((()=>i.createElement("div",{className:"container comp-ph-container"},i.createElement(ue.VK,null,i.createElement(pe.rs,null,i.createElement(pe.AW,{path:"/**/pages/statistics"},"ExerciseList",i.createElement(lt,null)),i.createElement(pe.AW,{path:"/**/pages/exercise"},i.createElement(at,null)),i.createElement(pe.AW,{path:"/**/pages/exercises-list"},i.createElement(dt,null)))))),null),document.getElementById("root"))}},n={};function s(e){var i=n[e];if(void 0!==i)return i.exports;var r=n[e]={exports:{}};return t[e].call(r.exports,r,r.exports,s),r.exports}s.m=t,e=[],s.O=(t,n,i,r)=>{if(!n){var o=1/0;for(c=0;c<e.length;c++){for(var[n,i,r]=e[c],a=!0,l=0;l<n.length;l++)(!1&r||o>=r)&&Object.keys(s.O).every((e=>s.O[e](n[l])))?n.splice(l--,1):(a=!1,r<o&&(o=r));a&&(e.splice(c--,1),t=i())}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[n,i,r]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={47:0};s.O.j=t=>0===e[t];var t=(t,n)=>{var i,r,[o,a,l]=n,c=0;for(i in a)s.o(a,i)&&(s.m[i]=a[i]);if(l)var d=l(s);for(t&&t(n);c<o.length;c++)r=o[c],s.o(e,r)&&e[r]&&e[r][0](),e[o[c]]=0;return s.O(d)},n=self.webpackChunkcomp_prehension=self.webpackChunkcomp_prehension||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=s.O(void 0,[736],(()=>s(3890)));i=s.O(i)})();