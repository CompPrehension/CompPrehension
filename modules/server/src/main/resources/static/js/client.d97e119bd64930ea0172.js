(()=>{"use strict";var e,t,n,s={3767:(e,t,n)=>{var s=n(5338),r=n(6540),i=(n(8630),n(9627)),a=n(4796);function o(e,t){return a.KC([e,a.ch,a.Vx,a.eu("")],null!=t?t:e.name)}function l(e){return new Promise((t=>setTimeout((()=>t()),e)))}function c(e){return null==e}a.KC([a.ch,a.Vx,a.eu("")]);const u=a.NW({attemptId:a.ai,exerciseId:a.ai,questionIds:a.YO(a.ai)},"ExerciseAttempt"),d=o(u),m=a.NW({attemptId:a.ai,questionsCount:a.ai,totalInteractionsCount:a.ai,totalInteractionsWithErrorsCount:a.ai,averageGrade:a.ai},"ExerciseStatisticsItem"),p=a.YO(m);var g=n(8934),h=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};const v={method:"GET",headers:{"Content-Type":"application/json"}};function f(e,t,n){return h(this,void 0,void 0,(function*(){const s=Object.assign(Object.assign({},v),{signal:n});return yield E(e,s,t)}))}function b(e,t,n,s,r){return h(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},v),{method:"POST",body:JSON.stringify(t),signal:s});return yield E(e,i,n,r)}))}function E(e,t,n,s){return h(this,void 0,void 0,(function*(){var r;null!=s||(s="json");const i=yield fetch(e,t).then((e=>h(this,void 0,void 0,(function*(){return e.ok?{status:"ok",payload:n&&n.decode("json"===s?yield e.json():yield e.text())||a.kX("json"===s?yield e.json():yield e.text())}:401===e.status?{status:"unauthorized"}:500===e.status?{status:"server_error",payload:yield e.json()}:{status:"unexpected",payload:{message:"Unexpected error"}}})))).catch((e=>({status:"unexpected",payload:{message:"Unexpected error "+e}})));if("ok"===i.status){if(g.isLeft(i.payload)){const e={message:`Type inconsistency for properties of ${null==n?void 0:n.name} type: ${w(i.payload.left).join(", ")}`};return console.error(e),g.left(e)}return g.right(i.payload.right)}return"unauthorized"===i.status?g.left({message:"Unauthorized"}):g.left(null!==(r=i.payload)&&void 0!==r?r:{message:"Unexpected error "})}))}const w=e=>e.map((e=>e.context.map((({key:e})=>e)).join("."))),y=window.location.protocol+"//"+window.location.host,x=a.E$([a.NW({forceNewAttemptCreationEnabled:a.zM,newQuestionGenerationEnabled:a.zM,supplementaryQuestionsEnabled:a.zM,correctAnswerGenerationEnabled:a.zM,preferDecisionTreeBasedSupplementaryEnabled:a.zM}),a.OH({surveyOptions:a.NW({enabled:a.zM,surveyId:a.Yj})})],"ExerciseOptions"),C=a.NW({id:a.ai,options:x},"Exercise");let S=class{getExerciseShortInfo(e){return f(`${y}/api/exercise/shortInfo?id=${e}`,C)}getExerciseAttempt(e){return f(`${y}/api/exercise/getExerciseAttempt?attemptId=${e}`,u)}getExistingExerciseAttempt(e){return f(`${y}/api/exercise/getExistingExerciseAttempt?exerciseId=${e}`,d)}createExerciseAttempt(e){return f(`${y}/api/exercise/createExerciseAttempt?exerciseId=${e}`,u)}createDebugExerciseAttempt(e){return f(`${y}/api/exercise/createDebugExerciseAttempt?exerciseId=${e}`,u)}getExerciseStatistics(e){return f(`${y}/api/exercise/getExerciseStatistics?exerciseId=${e}`,p)}getExercises(){return f(`${y}/api/exercise/getExercises`,a.YO(a.ai))}};S=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}([(0,i._G)()],S);var N=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};let _=class{getCurrentUser(){return N(this,void 0,void 0,(function*(){return g.right({id:999999,displayName:"front user",email:"test@mail.ru",roles:["ADMIN"],language:"EN"})}))}getExerciseShortInfo(e){return N(this,void 0,void 0,(function*(){return g.right({id:-1,options:{forceNewAttemptCreationEnabled:!1,correctAnswerGenerationEnabled:!0,newQuestionGenerationEnabled:!0,supplementaryQuestionsEnabled:!0,preferDecisionTreeBasedSupplementaryEnabled:!1}})}))}getExistingExerciseAttempt(e){return N(this,void 0,void 0,(function*(){return console.log(`getExistingExerciseAttempt?exerciseId=${e}`),g.right("")}))}createExerciseAttempt(e){return N(this,void 0,void 0,(function*(){return console.log(`createExerciseAttempt?exerciseId=${e}`),yield l(3e3),g.right({attemptId:-1,exerciseId:-1,questionIds:[1,2,3,4,5,6,7]})}))}createDebugExerciseAttempt(e){return N(this,void 0,void 0,(function*(){return console.log(`createDebugExerciseAttempt?exerciseId=${e}`),yield l(3e3),g.right({attemptId:-1,exerciseId:-1,questionIds:[1,2,3,4,5,6,7]})}))}getQuestion(e){return N(this,void 0,void 0,(function*(){let t;return console.log(`getQuestion?questionId=${e}`),yield l(3e3),1===e&&(t={type:"SINGLE_CHOICE",questionId:1,text:"question text",answers:[{id:0,text:"answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:1,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:2,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "}],responses:[],feedback:null,options:{requireContext:!1,showSupplementaryQuestions:!0,displayMode:"radio"}}),2===e&&(t={type:"MULTI_CHOICE",questionId:2,text:"question text",answers:[{id:0,text:"answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:1,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:2,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "}],responses:[],feedback:null,options:{requireContext:!1,showSupplementaryQuestions:!0,displayMode:"switch"}}),3===e&&(t={type:"SINGLE_CHOICE",questionId:3,text:'question text with <span id="answer_0">select1</span> and <span id="answer_1">select2</span>',answers:[],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"radio"}}),4===e&&(t={type:"MULTI_CHOICE",questionId:4,text:'question text with <span id="answer_0"></span> and <span id="answer_1"></span>',answers:[],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"switch"}}),5===e&&(t={type:"MATCHING",questionId:5,text:"question text ",answers:[{id:0,text:"test1"},{id:1,text:"test2"},{id:3,text:"test3"}],groups:[{id:0,text:'<div style="width:70px; height: 40px;">group1<div/>'},{id:1,text:'<div style="width:50px;height: 100px;">group2 group2 group2 group2<div/>'}],responses:[],feedback:null,options:{requireContext:!1,showSupplementaryQuestions:!0,displayMode:"dragNdrop",multipleSelectionEnabled:!0,dropzoneStyle:'{ "display": "inline-block", "minHeight": "40px", "minWidth": "80px" }',dropzoneHtml:"drop",draggableStyle:'{ "padding": "10px", "border": "5px solid", "borderRadius": "5px", "borderColor": "black", "backgroundColor": "white" }'}}),6===e&&(t={type:"MATCHING",questionId:6,text:'question text with <span id="answer_0">drop</span> and <span id="answer_1">drop</span>',answers:[],groups:[{id:0,text:'<div style="width:70px; height: 40px;">group1<div/>'},{id:1,text:'<div style="width:50px;height: 100px;">group2 group2 group2 group2<div/>'}],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"dragNdrop",multipleSelectionEnabled:!1,dropzoneStyle:'{ "display": "inline-block", "minHeight": "40px", "minWidth": "80px" }',dropzoneHtml:"drop",draggableStyle:'{ "padding": "10px", "border": "5px solid", "borderRadius": "5px", "borderColor": "black", "backgroundColor": "white" }'}}),7===e&&(t={type:"MULTI_CHOICE",questionId:7,text:'question text with <span id="answer_0"></span> and <span id="answer_1"></span>',answers:[],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"dragNdrop",dropzoneStyle:'{ "display": "inline-block", "height": "20px", "width": "20px" }',dropzoneHtml:"",draggableStyle:'{ "height": "20px", "width": "20px" }'}}),t?g.right(t):g.left({message:"No such question"})}))}generateQuestionByAttempt(e){return N(this,void 0,void 0,(function*(){return console.log(`generateQuestionByAttempt?attemptId=${e}`),yield l(3e3),g.left({message:"Method not implemented."})}))}generateQuestionByMetadata(e){return N(this,void 0,void 0,(function*(){return console.log(`generateQuestionByMetadata?metadataId=${e}`),yield l(3e3),g.left({message:"Method not implemented."})}))}generateSupplementaryQuestion(e){return N(this,void 0,void 0,(function*(){return console.log("generateSupplementaryQuestion",e),yield l(3e3),g.left({message:"Method not implemented."})}))}generateNextCorrectAnswer(e){return N(this,void 0,void 0,(function*(){return console.log(`generateNextCorrectAnswer?questionId=${e}`),yield l(3e3),g.left({message:"Method not implemented."})}))}addQuestionAnswer(e){return N(this,void 0,void 0,(function*(){return console.log("addQuestionAnswer",e),yield l(3e3),g.right({isCorrect:!0,grade:.8,correctAnswers:e.answers,correctSteps:1,stepsLeft:1,stepsWithErrors:1,messages:null,strategyDecision:"CONTINUE"})}))}addSupplementaryQuestionAnswer(e){return N(this,void 0,void 0,(function*(){return console.log("addSupplementaryQuestionAnswer",e),yield l(3e3),g.right({message:{type:"SUCCESS",message:"test",violationLaws:[]},action:"CONTINUE_AUTO"})}))}getExerciseStatistics(e){return N(this,void 0,void 0,(function*(){return console.log(`getExerciseStatistics?exerciseId=${e}`),g.left({message:"Method not implemented."})}))}getExercises(){return N(this,void 0,void 0,(function*(){return console.log("getExercises"),g.left({message:"Method not implemented."})}))}getExerciseAttempt(e){return N(this,void 0,void 0,(function*(){return console.log(`getExerciseAttempt?attemptId=${e}`),g.left({message:"Method not implemented."})}))}};_=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}([(0,i._G)()],_);var A,O=n(7813),I=n(3643),q=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},k=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},L=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class j{constructor(e,t){Object.defineProperty(this,"questionController",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"sourceQuestionId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"feedback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"question",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"answer",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"questionState",{enumerable:!0,configurable:!0,writable:!0,value:"INITIAL"}),Object.defineProperty(this,"setQuestionState",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.questionState!==e&&(this.questionState=e)}}),Object.defineProperty(this,"generateSupplementaryQuestion",{enumerable:!0,configurable:!0,writable:!0,value:e=>L(this,void 0,void 0,(function*(){if(0===e.length)throw new Error("violationLaws mist be non-empty");this.setQuestionState("LOADING");const t={questionId:this.sourceQuestionId,violationLaws:e},n=yield this.questionController.generateSupplementaryQuestion(t);(0,O.h5)((()=>{g.isLeft(n)?this.setQuestionState("LOADED"):function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)}(this,A,"f").call(this,n.right.question,n.right.message)}))}))}),Object.defineProperty(this,"sendAnswers",{enumerable:!0,configurable:!0,writable:!0,value:()=>L(this,void 0,void 0,(function*(){const{question:e}=this;if(!e)throw new Error("Question is empty");const t=(0,O.HO)({questionId:e.questionId,answers:(0,O.HO)([...this.answer])});this.setQuestionState("ANSWER_EVALUATING");const n=yield this.questionController.addSupplementaryQuestionAnswer(t);(0,O.h5)((()=>{g.isLeft(n)?this.setQuestionState("LOADED"):(this.setQuestionState("COMPLETED"),this.feedback=n.right)}))}))}),Object.defineProperty(this,"setAnswer",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.answer=e}}),A.set(this,((e,t)=>{var n;(null==e?void 0:e.options.requireContext)&&[...e.text.matchAll(/(\<\w.*?\sid\s*?\=([\'\"]))\s*(answer_(\d+?))\2(.*?\>)/gim)].forEach(((t,n)=>{e.text=e.text.replace(t[0],`${t[1]}question_${e.questionId}_${t[3]}_${n}${t[2]} data-answer-id='${t[4]}' ${t[5]}`)})),this.question=null!=e?e:void 0,this.feedback=null!=t?t:void 0,this.answer=null!==(n=null==e?void 0:e.responses)&&void 0!==n?n:[],this.questionState=e?"LOADED":"COMPLETED"})),this.sourceQuestionId=t,(0,O.Gn)(this)}get isQuestionFreezed(){return"LOADED"!==this.questionState}get isFeedbackLoading(){return"ANSWER_EVALUATING"===this.questionState}get canSendQuestionAnswers(){if(!this.question||"COMPLETED"===this.questionState)return!1;switch(this.question.type){case"SINGLE_CHOICE":case"MULTI_CHOICE":return this.answer.length>0;case"ORDER":return!0;case"MATCHING":return this.answer.length===this.question.answers.length;default:return(0,I.absurd)(this.question)}}get questionSubmitMode(){return this.question?"SINGLE_CHOICE"===this.question.type?"IMPLICIT":"EXPLICIT":null}}A=new WeakMap,q([O.sH,k("design:type",Number)],j.prototype,"sourceQuestionId",void 0),q([O.sH,k("design:type",Object)],j.prototype,"feedback",void 0),q([O.sH,k("design:type",Object)],j.prototype,"question",void 0),q([O.sH,k("design:type",Array)],j.prototype,"answer",void 0),q([O.sH,k("design:type",String)],j.prototype,"questionState",void 0),q([O.XI,k("design:type",Object)],j.prototype,"setQuestionState",void 0),q([O.EW,k("design:type",Object),k("design:paramtypes",[])],j.prototype,"isQuestionFreezed",null),q([O.EW,k("design:type",Object),k("design:paramtypes",[])],j.prototype,"isFeedbackLoading",null),q([O.EW,k("design:type",Boolean),k("design:paramtypes",[])],j.prototype,"canSendQuestionAnswers",null),q([O.EW,k("design:type",Object),k("design:paramtypes",[])],j.prototype,"questionSubmitMode",null),q([O.XI,k("design:type",Object)],j.prototype,"generateSupplementaryQuestion",void 0),q([O.XI,k("design:type",Object)],j.prototype,"sendAnswers",void 0),q([O.XI,k("design:type",Object)],j.prototype,"setAnswer",void 0);const Q=a.E$([a.NW({answer:a.PV([a.ai,a.ai]),isСreatedByUser:a.zM}),a.OH({createdByInteraction:a.KC([a.ai,a.ch])})]),P=a.NW({name:a.Yj,canCreateSupplementaryQuestion:a.zM}),T=a.KC([a.NW({type:a.eu("SUCCESS"),message:a.Yj,violationLaws:a.KC([a.YO(P),a.ch])}),a.NW({type:a.eu("ERROR"),message:a.Yj,violationLaws:a.KC([a.YO(P),a.ch])})]),R=a.E$([a.NW({isCorrect:a.zM}),a.OH({isCorrect:a.zM,grade:a.KC([a.ai,a.ch]),violations:a.KC([a.YO(a.ai),a.ch]),correctAnswers:a.KC([a.YO(Q),a.ch]),correctSteps:a.KC([a.ai,a.ch]),stepsLeft:a.KC([a.ai,a.ch]),stepsWithErrors:a.KC([a.ai,a.ch]),message:a.KC([a.YO(T),a.ch]),strategyDecision:a.KC([a.ZE({CONTINUE:null,FINISH:null}),a.ch])})],"Feedback"),D=a.E$([R,a.OH({trace:a.KC([a.YO(a.Yj),a.ch])})]),M=a.NW({requireContext:a.zM,showSupplementaryQuestions:a.zM},"QuestionOptions"),$=a.E$([M,a.NW({showTrace:a.zM,multipleSelectionEnabled:a.zM,requireAllAnswers:a.zM}),a.OH({orderNumberOptions:a.E$([a.NW({delimiter:a.Yj,position:a.ZE({PREFIX:null,SUFFIX:null,BOTTOM:null,NONE:null})}),a.OH({replacers:a.KC([a.YO(a.Yj),a.ch])})])})],"OrderQuestionOptions"),H=a.E$([M,a.NW({multipleSelectionEnabled:a.zM}),a.KC([a.NW({displayMode:a.eu("combobox")}),a.NW({displayMode:a.eu("dragNdrop"),draggableStyle:a.Yj,dropzoneStyle:a.Yj,dropzoneHtml:a.Yj})])],"MatchingQuestionOptions"),F=a.E$([M,a.NW({displayMode:a.ZE({radio:null,dragNdrop:null})})],"SingleChoiceQuestionOptions"),V=a.E$([M,a.KC([a.E$([a.NW({displayMode:a.eu("switch")}),a.OH({selectorReplacers:a.KC([a.PV([a.Yj,a.Yj]),a.ch])})]),a.NW({displayMode:a.eu("dragNdrop"),dropzoneHtml:a.Yj,dropzoneStyle:a.Yj,draggableStyle:a.Yj})])],"MultiChoiceQuestionOptions"),G=a.ZE({SINGLE_CHOICE:null,MULTI_CHOICE:null,MATCHING:null,ORDER:null},"QuestionType"),B=a.Yj,Y=a.NW({id:a.ai,text:B},"QuestionAnswer"),z=a.NW({questionId:a.ai,type:G,options:M,text:B,answers:a.YO(Y),responses:a.KC([a.YO(Q),a.ch]),feedback:a.KC([R,a.ch])},"QuestionBase"),W=a.E$([z,a.NW({type:a.eu("ORDER"),options:$,feedback:a.KC([D,a.ch])}),a.OH({initialTrace:a.KC([a.YO(a.Yj),a.ch])})],"OrderQuestion"),U=a.E$([z,a.NW({type:a.eu("SINGLE_CHOICE"),options:F})],"SingleChoiceQuestion"),X=a.E$([z,a.NW({type:a.eu("MULTI_CHOICE"),options:V})],"MultiChoiceQuestion"),K=a.E$([z,a.NW({type:a.eu("MATCHING"),answers:a.YO(Y),groups:a.YO(Y),options:H})],"MatchingQuestion"),Z=a.KC([W,U,X,K],"Question"),J=(o(Z),a.ZE({CONTINUE_AUTO:null,CONTINUE_MANUAL:null,FINISH:null})),ee=a.NW({message:T,action:J}),te=a.OH({question:a.KC([Z,a.ch]),message:a.KC([ee,a.ch])});let ne=class{generateQuestionByAttempt(e){return f(`${y}/api/question/generate?attemptId=${e}`,Z)}generateQuestionByMetadata(e){return f(`${y}/api/question/generateByMetadata?metadataId=${e}`,Z)}getQuestion(e){return f(`${y}/api/question?questionId=${e}`,Z)}generateSupplementaryQuestion(e){return b(`${y}/api/question/generateSupplementaryQuestion`,e,te)}generateNextCorrectAnswer(e){return f(`${y}/api/question/generateNextCorrectAnswer?questionId=${e}`,R)}addQuestionAnswer(e){return b(`${y}/api/question/addQuestionAnswer`,e,R)}addSupplementaryQuestionAnswer(e){return b(`${y}/api/question/addSupplementaryQuestionAnswer`,e,ee)}};ne=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}([(0,i._G)()],ne);var se=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},re=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ie=class{constructor(e){Object.defineProperty(this,"questionController",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"isFeedbackVisible",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"isQuestionFreezed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"feedback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"question",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastAnswer",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"answersHistory",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"supplementaryQuestion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"questionState",{enumerable:!0,configurable:!0,writable:!0,value:"INITIAL"}),Object.defineProperty(this,"storeState",{enumerable:!0,configurable:!0,writable:!0,value:{tag:"VALID"}}),Object.defineProperty(this,"onQuestionLoaded",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,n;e.options.requireContext&&[...e.text.matchAll(/(\<\w.*?\sid\s*?\=([\'\"]))\s*(answer_(\d+?))\2(.*?\>)/gim)].forEach(((t,n)=>{e.text=e.text.replace(t[0],`${t[1]}question_${e.questionId}_${t[3]}_${n}${t[2]} data-answer-id='${t[4]}' ${t[5]}`)})),this.question=e,this.supplementaryQuestion=new j(this.questionController,e.questionId),this.feedback=null!==(t=e.feedback)&&void 0!==t?t:void 0,this.isFeedbackVisible=!0,this.answersHistory=[],this.lastAnswer=null!==(n=e.responses)&&void 0!==n?n:[],e.feedback&&0===e.feedback.stepsLeft&&this.setQuestionState("COMPLETED")}}),Object.defineProperty(this,"setQuestionState",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.questionState!==e&&(this.questionState=e)}}),Object.defineProperty(this,"setValidStoreState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{"VALID"!==this.storeState.tag&&(this.storeState={tag:"VALID"})}}),Object.defineProperty(this,"setErrorStoreState",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.storeState={tag:"ERROR",error:e}}}),Object.defineProperty(this,"loadQuestion",{enumerable:!0,configurable:!0,writable:!0,value:(0,O.L3)((function*(e){this.setValidStoreState(),this.setQuestionState("LOADING");const t=yield this.questionController.getQuestion(e);this.setQuestionState("LOADED"),g.isLeft(t)?this.setErrorStoreState(t.left):this.onQuestionLoaded(t.right)}))}),Object.defineProperty(this,"generateQuestion",{enumerable:!0,configurable:!0,writable:!0,value:(0,O.L3)((function*(e){this.setValidStoreState(),this.setQuestionState("LOADING");const t=yield this.questionController.generateQuestionByAttempt(e);this.setQuestionState("LOADED"),g.isLeft(t)?this.setErrorStoreState(t.left):this.onQuestionLoaded(t.right)}))}),Object.defineProperty(this,"generateQuestionByMetadata",{enumerable:!0,configurable:!0,writable:!0,value:(0,O.L3)((function*(e){this.setValidStoreState(),this.setQuestionState("LOADING");const t=yield this.questionController.generateQuestionByMetadata(e);this.setQuestionState("LOADED"),g.isLeft(t)?this.setErrorStoreState(t.left):this.onQuestionLoaded(t.right)}))}),Object.defineProperty(this,"generateNextCorrectAnswer",{enumerable:!0,configurable:!0,writable:!0,value:(0,O.L3)((function*(){const{question:e}=this;if(!e)throw new Error("Current question not found");this.setValidStoreState(),this.setQuestionState("ANSWER_EVALUATING");const t=yield this.questionController.generateNextCorrectAnswer(e.questionId);this.setQuestionState("LOADED"),g.isLeft(t)?this.setErrorStoreState(t.left):this.onAnswerEvaluated(t.right)}))}),Object.defineProperty(this,"sendAnswersImpl",{enumerable:!0,configurable:!0,writable:!0,value:(0,O.L3)((function*(e,t){const n=(0,O.HO)({questionId:e,answers:(0,O.HO)([...t])});this.setValidStoreState(),this.setQuestionState("ANSWER_EVALUATING");const s=yield this.questionController.addQuestionAnswer(n);this.setQuestionState("LOADED"),g.isLeft(s)?this.setErrorStoreState(s.left):this.onAnswerEvaluated(s.right)}))}),Object.defineProperty(this,"sendAnswers",{enumerable:!0,configurable:!0,writable:!0,value:(0,O.L3)((function*(){const{question:e,lastAnswer:t}=this;e&&(yield this.sendAnswersImpl(e.questionId,(0,O.HO)(t)))}))}),Object.defineProperty(this,"onAnswersChanged",{enumerable:!0,configurable:!0,writable:!0,value:(0,O.L3)((function*(e,t=!0){if(this.answersHistory.push(e),t)try{yield this.sendAnswers()}catch(e){this.answersHistory.pop()}}))}),Object.defineProperty(this,"setFullAnswer",{enumerable:!0,configurable:!0,writable:!0,value:(0,O.L3)((function*(e,t=!0){if(!this.isAnswerChanged(e))return!1;const n=this.lastAnswer;if(this.lastAnswer=e,n.length>0&&this.answersHistory.push(n),!t)return!0;try{return yield this.sendAnswers(),!0}catch(e){return this.lastAnswer=n,n.length>0&&this.answersHistory.pop(),!1}}))}),Object.defineProperty(this,"isAnswerChanged",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const{lastAnswer:t,question:n}=this;if(!n)throw new Error("no question");const s=t.map((e=>e.answer)),r=e.map((e=>e.answer));switch(n.type){case"ORDER":return r.length!==s.length||JSON.stringify(r)!==JSON.stringify(s);case"MATCHING":case"MULTI_CHOICE":case"SINGLE_CHOICE":return r.length!==s.length||JSON.stringify(r.sort())!==JSON.stringify(s.sort())}}}),(0,O.Gn)(this)}onAnswerEvaluated(e){this.feedback=e,this.isFeedbackVisible=!0,e&&e.correctAnswers&&(this.setFullAnswer(e.correctAnswers,!1),c(e.stepsLeft)||0!==e.stepsLeft||this.setQuestionState("COMPLETED"))}};var ae,oe;se([O.sH,re("design:type",Boolean)],ie.prototype,"isFeedbackVisible",void 0),se([O.sH,re("design:type",Boolean)],ie.prototype,"isQuestionFreezed",void 0),se([O.sH,re("design:type",Object)],ie.prototype,"feedback",void 0),se([O.sH,re("design:type",Object)],ie.prototype,"question",void 0),se([O.sH,re("design:type",Array)],ie.prototype,"lastAnswer",void 0),se([O.sH,re("design:type",Array)],ie.prototype,"answersHistory",void 0),se([O.sH,re("design:type",j)],ie.prototype,"supplementaryQuestion",void 0),se([O.sH,re("design:type",String)],ie.prototype,"questionState",void 0),se([O.sH,re("design:type",Object)],ie.prototype,"storeState",void 0),se([O.XI,re("design:type",Object)],ie.prototype,"setQuestionState",void 0),se([O.XI,re("design:type",Object)],ie.prototype,"setValidStoreState",void 0),se([O.XI,re("design:type",Object)],ie.prototype,"setErrorStoreState",void 0),ie=se([(0,i._G)(),(ae=0,oe=(0,i.WQ)(ne),function(e,t){oe(e,t,ae)}),re("design:paramtypes",[Object])],ie);const le=a.KC([a.NW({kind:a.eu("AFTER_FIRST")}),a.NW({kind:a.eu("AFTER_LAST")}),a.NW({kind:a.eu("AFTER_EACH")}),a.NW({kind:a.eu("AFTER_SPECIFIC"),numbers:a.YO(a.ai)})]),ce=a.NW({id:a.ai,type:a.eu("yes-no"),text:a.Yj,policy:le,required:a.zM,options:a.NW({yesText:a.Yj,yesValue:a.Yj,noText:a.Yj,noValue:a.Yj})},"YesNoSurveyQuestion"),ue=a.NW({id:a.ai,type:a.eu("single-choice"),text:a.Yj,policy:le,required:a.zM,options:a.YO(a.NW({id:a.Yj,text:a.Yj}))}),de=a.NW({id:a.ai,type:a.eu("open-ended"),text:a.Yj,policy:le,required:a.zM}),me=a.KC([ce,ue,de]),pe=a.NW({surveyId:a.Yj,options:a.NW({}),questions:a.YO(me)},"Survey"),ge=a.NW({surveyQuestionId:a.ai,questionId:a.ai,answer:a.Yj});var he=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};let ve=class{constructor(){Object.defineProperty(this,"surveyCache",{enumerable:!0,configurable:!0,writable:!0,value:{}})}getSurvey(e){return he(this,void 0,void 0,(function*(){if(this.surveyCache[e])return g.right(this.surveyCache[e]);var t=yield f(`${y}/api/survey/${e}`,pe);return g.isRight(t)&&(this.surveyCache[e]=t.right),t}))}postSurveyAnswer(e,t,n){return he(this,void 0,void 0,(function*(){return b(`${y}/api/survey`,{surveyQuestionId:e,questionId:t,answer:n})}))}getCurrentUserAttemptSurveyVotes(e,t){return he(this,void 0,void 0,(function*(){return f(`${y}/api/survey/${encodeURIComponent(e)}/user-votes?attemptId=${t}`,a.YO(ge))}))}};ve=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}([(0,i._G)()],ve);var fe=n(2514),be=n(7042),Ee=n(3702);function we(e){return new URLSearchParams(window.location.search).get(e)}const ye=a.ZE({EN:null,RU:null,PL:null}),xe=a.NW({id:a.ai,displayName:a.Yj,email:a.KC([a.Yj,a.ch]),language:ye,roles:a.YO(a.Yj)},"UserInfo");var Ce=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};let Se=class{getCurrentUser(){return f(`${y}/api/users/whoami`,xe)}getLanguages(){return Ce(this,void 0,void 0,(function*(){return g.right(["EN","RU"])}))}setLanguage(e){return Ce(this,void 0,void 0,(function*(){return b(`${y}/api/users/language`,{language:e},ye,void 0,"raw")}))}};Se=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}([(0,i._G)()],Se);var Ne=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},_e=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ae=function(e,t){return function(n,s){t(n,s,e)}},Oe=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};let Ie=class{constructor(e,t,n,s){Object.defineProperty(this,"exerciseController",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"userController",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"surveyController",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"isExerciseLoading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"exerciseId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exercise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentAttemptId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentQuestion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exerciseState",{enumerable:!0,configurable:!0,writable:!0,value:"INITIAL"}),Object.defineProperty(this,"storeState",{enumerable:!0,configurable:!0,writable:!0,value:{tag:"VALID"}}),Object.defineProperty(this,"survey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDebug",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"registerOnStrategyDecisionChangedAction",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,O.fm)((()=>{var e;"FINISH"===(null===(e=this.currentQuestion.feedback)||void 0===e?void 0:e.strategyDecision)&&"COMPLETED"!==this.exerciseState&&this.setExerciseState("COMPLETED")}))}}),Object.defineProperty(this,"forceSetValidState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{"VALID"!==this.storeState.tag&&(this.storeState={tag:"VALID"})}}),Object.defineProperty(this,"setExerciseState",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.exerciseState!==e&&(this.exerciseState=e)}}),Object.defineProperty(this,"setSurveyAnswers",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{this.survey&&(0,O.h5)((()=>{this.survey.questions[e].status="COMPLETED",this.survey.questions[e].results=t}))}}),Object.defineProperty(this,"loadExercise",{enumerable:!0,configurable:!0,writable:!0,value:()=>Oe(this,void 0,void 0,(function*(){if(this.exercise)throw new Error("exerciseInfo loaded");if(this.isExerciseLoading)return;(0,O.h5)((()=>{this.forceSetValidState(),this.isExerciseLoading=!0}));const e=yield this.exerciseController.getExerciseShortInfo(this.exerciseId);g.isRight(e)?(0,O.h5)((()=>{this.isExerciseLoading=!1,this.exercise=e.right})):(0,O.h5)((()=>{this.isExerciseLoading=!1,this.storeState={tag:"ERROR",error:e.left}}))}))}),Object.defineProperty(this,"loadExerciseAttempt",{enumerable:!0,configurable:!0,writable:!0,value:(0,O.L3)((function*(e){const{exercise:t}=this;if(!t)throw new Error("exerciseInfo is not defined");this.forceSetValidState(),t.id;const n=yield this.exerciseController.getExerciseAttempt(e);if(g.isLeft(n))return void(this.storeState={tag:"ERROR",error:n.left});const s=n.right;return!!s&&(this.currentAttempt=s,yield this.onAttemptLoaded(),!0)}))}),Object.defineProperty(this,"loadExistingExerciseAttempt",{enumerable:!0,configurable:!0,writable:!0,value:(0,O.L3)((function*(){const{exercise:e}=this;if(!e)throw new Error("exercise is not defined");this.forceSetValidState();const t=e.id,n=yield this.exerciseController.getExistingExerciseAttempt(t);if(g.isLeft(n))return void(this.storeState={tag:"ERROR",error:n.left});const s=n.right;return!!s&&(this.currentAttempt=s,yield this.onAttemptLoaded(),!0)}))}),Object.defineProperty(this,"onAttemptLoaded",{enumerable:!0,configurable:!0,writable:!0,value:()=>Oe(this,void 0,void 0,(function*(){yield this.loadSurvey()}))}),Object.defineProperty(this,"createExerciseAttempt",{enumerable:!0,configurable:!0,writable:!0,value:(0,O.L3)((function*(){const{exercise:e}=this;if(!e)throw new Error("exercise is not defined");this.forceSetValidState();const t=e.id,n=yield this.exerciseController.createExerciseAttempt(+t);g.isLeft(n)?this.storeState={tag:"ERROR",error:n.left}:(this.currentAttempt=n.right,yield this.onAttemptLoaded())}))}),Object.defineProperty(this,"createDebugExerciseAttempt",{enumerable:!0,configurable:!0,writable:!0,value:(0,O.L3)((function*(){const{exercise:e}=this;if(!e)throw new Error("exercise is not defined");this.forceSetValidState();const t=e.id,n=yield this.exerciseController.createDebugExerciseAttempt(+t);g.isLeft(n)?this.storeState={tag:"ERROR",error:n.left}:(this.currentAttempt=n.right,yield this.onAttemptLoaded())}))}),Object.defineProperty(this,"generateQuestion",{enumerable:!0,configurable:!0,writable:!0,value:(0,O.L3)((function*(){var e,t;const{exercise:n,currentAttempt:s}=this;if(!n||!s)throw new Error("Session is not defined");this.forceSetValidState(),yield this.currentQuestion.generateQuestion(s.attemptId),s.questionIds.push(null!==(t=null===(e=this.currentQuestion.question)||void 0===e?void 0:e.questionId)&&void 0!==t?t:-1)}))}),Object.defineProperty(this,"loadSurvey",{enumerable:!0,configurable:!0,writable:!0,value:()=>Oe(this,void 0,void 0,(function*(){var e;if(this.survey||!this.currentAttempt||!this.exercise)return;if(!(null===(e=this.exercise.options.surveyOptions)||void 0===e?void 0:e.enabled)||0===this.exercise.options.surveyOptions.surveyId.length)return;const t=this.exercise.options.surveyOptions.surveyId,n=this.currentAttempt.attemptId,[s,r]=yield Promise.all([this.surveyController.getSurvey(t),this.surveyController.getCurrentUserAttemptSurveyVotes(t,n)]);(0,O.h5)((()=>{if(g.isRight(s)&&g.isRight(r)){const e=function(e,t){const n=new Map;return e.forEach((e=>{const t=e.questionId,s=n.get(t);s?s.push(e):n.set(t,[e])})),n}(r.right);this.survey={survey:s.right,questions:[...e.keys()].map((t=>{var n,s,r,i;return{questionId:t,status:"COMPLETED",questions:null!==(s=null===(n=e.get(t))||void 0===n?void 0:n.map((e=>e.surveyQuestionId)))&&void 0!==s?s:[],results:null!==(i=null===(r=e.get(t))||void 0===r?void 0:r.reduce(((e,t)=>(e[t.surveyQuestionId]=t.answer,e)),{}))&&void 0!==i?i:{}}})).reduce(((e,t)=>(e[t.questionId]=t,e)),{})}}}))}))}),Object.defineProperty(this,"ensureQuestionSurveyExists",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,n,s;if(null===(t=this.survey)||void 0===t?void 0:t.questions[e])return null===(n=this.survey)||void 0===n?void 0:n.questions[e].questions;const r=[],i=this.currentAttempt.questionIds.findIndex((e=>{var t;return e===(null===(t=this.currentQuestion.question)||void 0===t?void 0:t.questionId)}));for(let e of(null===(s=this.survey)||void 0===s?void 0:s.survey.questions)||[]){const t=e.policy;("AFTER_EACH"===t.kind||"AFTER_FIRST"===t.kind&&0===i||"AFTER_LAST"===t.kind&&"COMPLETED"===this.exerciseState||"AFTER_SPECIFIC"===t.kind&&t.numbers.includes(i+1))&&r.push(e)}console.log("Selected questions"),console.log((0,O.HO)(r));var a={questionId:e,status:"ACTIVE",questions:r.map((e=>e.id)),results:{}};return(0,O.h5)((()=>{this.survey.questions[e]=a})),r.map((e=>e.id))}}),this.isDebug=null!==we("debug"),this.currentQuestion=s;const r=we("exerciseId");null===r&&(this.exerciseState="LAUNCH_ERROR",this.storeState={tag:"ERROR",error:{message:"Invalid exercise id"}}),this.exerciseId=null!==r?+r:-1;const i=we("attemptId");null!==i&&(this.currentAttemptId=+i),(0,O.Gn)(this),this.registerOnStrategyDecisionChangedAction()}};Ne([O.sH,_e("design:type",Boolean)],Ie.prototype,"isExerciseLoading",void 0),Ne([O.sH,_e("design:type",Number)],Ie.prototype,"exerciseId",void 0),Ne([O.sH,_e("design:type",Object)],Ie.prototype,"exercise",void 0),Ne([O.sH,_e("design:type",Number)],Ie.prototype,"currentAttemptId",void 0),Ne([O.sH,_e("design:type",Object)],Ie.prototype,"currentAttempt",void 0),Ne([O.sH,_e("design:type",ie)],Ie.prototype,"currentQuestion",void 0),Ne([O.sH,_e("design:type",String)],Ie.prototype,"exerciseState",void 0),Ne([O.sH,_e("design:type",Object)],Ie.prototype,"storeState",void 0),Ne([O.sH,_e("design:type",Object)],Ie.prototype,"survey",void 0),Ne([O.sH,_e("design:type",Object)],Ie.prototype,"isDebug",void 0),Ne([O.XI,_e("design:type",Object)],Ie.prototype,"forceSetValidState",void 0),Ne([O.XI,_e("design:type",Object)],Ie.prototype,"setExerciseState",void 0),Ne([O.XI,_e("design:type",Object)],Ie.prototype,"setSurveyAnswers",void 0),Ne([O.XI,_e("design:type",Object)],Ie.prototype,"loadSurvey",void 0),Ne([O.XI,_e("design:type",Object)],Ie.prototype,"ensureQuestionSurveyExists",void 0),Ie=Ne([(0,i._G)(),Ae(0,(0,i.WQ)(S)),Ae(1,(0,i.WQ)(Se)),Ae(2,(0,i.WQ)(ve)),Ae(3,(0,i.WQ)(ie)),_e("design:paramtypes",[Object,Object,ve,ie])],Ie);var qe=n(2635),ke=n(2389);const Le=a.NW({id:a.ai,name:a.Yj}),je=a.NW({name:a.Yj,kind:a.ZE({FORBIDDEN:null,PERMITTED:null,TARGETED:null})}),Qe=a.NW({name:a.Yj,kind:a.ZE({FORBIDDEN:null,PERMITTED:null,TARGETED:null})}),Pe=a.NW({name:a.Yj,kind:a.ZE({FORBIDDEN:null,PERMITTED:null,TARGETED:null})}),Te=a.NW({numberOfQuestions:a.ai,complexity:a.ai,concepts:a.YO(je),laws:a.YO(Qe),skills:a.YO(Pe)}),Re=a.NW({id:a.ai,name:a.Yj,domainId:a.Yj,strategyId:a.Yj,backendId:a.Yj,stages:function(e,t=`NonEmptyArray<${e.name}>`){const n=a.YO(e);return new a.ZU(t,(e=>n.is(e)&&(0,be.isNonEmpty)(e)),((e,t)=>(0,I.pipe)(n.validate(e,t),(0,g.chain)((n=>{const s=(0,fe.fromArray)(n);return(0,Ee.isNone)(s)?a.V2(e,t):a.kX(s.value)})))),(0,fe.map)(e.encode))}(Te),tags:a.YO(a.Yj),options:x}),De=a.FX("DomainSkill",(()=>a.NW({name:a.Yj,displayName:a.Yj,childs:a.YO(De)}))),Me=a.FX("DomainLaw",(()=>a.NW({name:a.Yj,displayName:a.Yj,bitflags:a.ai,childs:a.YO(Me)})));var $e;!function(e){e[e.VisibleToTeacher=1]="VisibleToTeacher",e[e.TargetEnabled=2]="TargetEnabled"}($e||($e={}));const He=a.FX("DomainConcept",(()=>a.NW({name:a.Yj,displayName:a.Yj,bitflags:a.ai,childs:a.YO(He)}))),Fe=a.NW({id:a.Yj,displayName:a.Yj,description:a.KC([a.Yj,a.ch]),laws:a.YO(Me),skills:a.YO(De),concepts:a.YO(He),tags:a.YO(a.Yj)}),Ve=a.NW({id:a.Yj,displayName:a.Yj,description:a.KC([a.Yj,a.ch]),options:a.NW({multiStagesEnabled:a.zM})}),Ge=a.NW({count:a.ai,topRatedCount:a.ai,questions:a.YO(a.NW({metadataId:a.ai,name:a.Yj}))});let Be=class{getAllExercises(){return f(`${y}/api/exercise/all`,a.YO(Le))}getExercise(e){return f(`${y}/api/exercise?id=${encodeURIComponent(e)}`,Re)}saveExercise(e){return b(`${y}/api/exercise`,(0,O.HO)(e))}createExercise(e,t,n){return function(e,t,n,s){return h(this,void 0,void 0,(function*(){const s=Object.assign(Object.assign({},v),{method:"PUT",body:JSON.stringify(t),signal:undefined});return yield E(e,s,n)}))}(`${y}/api/exercise`,{name:e,domainId:t,strategyId:n},a.ai)}deleteExercise(e){return function(e,t,n){return h(this,void 0,void 0,(function*(){const t=Object.assign(Object.assign({},v),{method:"DELETE",signal:undefined});return yield E(e,t,undefined)}))}(`${y}/api/exercise?id=${encodeURIComponent(e)}`)}getStrategies(){return f(`${y}/api/refTables/strategies`,a.YO(Ve))}getBackends(){return f(`${y}/api/refTables/backends`,a.YO(a.Yj))}getDomains(){return f(`${y}/api/refTables/domains`,a.YO(Fe))}getDomainLaws(e){return f(`${y}/api/refTables/domainLaws?domaindId=${encodeURIComponent(e)}`,a.YO(a.Yj))}getDomainConcepts(e){return f(`${y}/api/refTables/domainConcepts?domaindId=${encodeURIComponent(e)}`,a.YO(a.Yj))}search(e,t,n,s,r,i,a,o){return b(`${y}/api/question-bank/search`,{domainId:e,tags:r,concepts:t,laws:n,skills:s,complexity:i,limit:a},Ge,o)}};Be=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}([(0,i._G)()],Be);const Ye=()=>{var e;return null!==(null!==(e=new URLSearchParams(window.location.search).get("sandbox"))&&void 0!==e?e:null)};i.kL.register(S,{useFactory:()=>Ye()?new _:new S}),i.kL.register(ne,{useFactory:()=>Ye()?new _:new ne}),i.kL.register(Se,{useFactory:()=>Ye()?new _:new Se}),i.kL.register(ie,ie),i.kL.registerSingleton(Ie),i.kL.registerSingleton(ve),i.kL.registerSingleton(Be),qe.Ay.use(ke.r9).init({resources:{EN:{translation:{question_header:"Question #{{questionNumber}}",language_header:"Language",signedin_as_header:"Signed in as",nextCorrectAnswerBtn:"I'm confused, tell me the next correct step",generateNextQuestion_nextQuestion:"Next question",generateNextQuestion_warning:"Warning",generateNextQuestion_continueAttempt:"Continue attempt",generateNextQuestion_modalMessage1:"It is recommended to move on to the next question only after solving all the previous ones.",generateNextQuestion_modalMessage2:"Are you sure you want to move on to the next question?",grade_feeback:"Grade",correctsteps_feeback:"Correct steps",stepswitherrors_feeback:"Steps with errors",stepsleft_feeback:"Steps left",issolved_feeback:"Solved",foundExisitingAttempt_title:"Found existing attempt",foundExisitingAttempt_descr:"Would you like to continue the existing attempt or start a new one",foundExisitingAttempt_continueattempt:"Continue",foundExisitingAttempt_newattempt:"New",exercise_completed:"Exercise completed",exercise_supquestion_gotit:"Got it",exercise_supquestion_details:"More details",exercise_supquestion_send_answer:"Send answer",exercise_supquestion_next_question:"Next question",exercisesettings_title:"Exercise settings",exercisesettings_name:"Name",exercisesettings_domain:"Domain",exercisesettings_strategy:"Strategy",exercisesettings_qcomplexity:"Question difficulty",exercisesettings_answlen:"Answer length",exercisesettings_qopt:"Options",exercisesettings_qopt_forceAttCreation:"Always create a new attempt",exercisesettings_qopt_genCorAnsw:"Allow 'generate correct answer' button",exercisesettings_qopt_forceShowGenNextQ:"Always show 'generate new question' button",exercisesettings_qopt_supQ:"Allow supplementary questions",exercisesettings_qopt_preferDTsup:"Prefer Decision-Tree-based approach to supplementary question generation",exercisesettings_survey:"Survey",exercisesettings_tags:"Tags",exercisesettings_commonConcepts:"Common concepts",exercisesettings_commonLaws:"Common laws",exercisesettings_commonSkills:"Common skills",exercisesettings_stages:"Stage",exercisesettings_stageN:"Stage #{{stageNumber}}",exercisesettings_stageN_qnumber:"Number of questions",exercisesettings_stageN_concepts:"Concepts",exercisesettings_stageN_laws:"Laws",exercisesettings_stageN_skills:"Skills",exercisesettings_stageN_matchedQuestionExamples:"Question examples",exercisesettings_addStage:"Add stage",exercisesettings_removeStage:"Remove stage",exercisesettings_save:"Save",exercisesettings_saveNopen:"Save & Open",exercisesettings_open:"Open",exercisesettings_genDebugAtt:"Generate debug attempt",exercisesettings_optDenied:"Denied",exercisesettings_optAllowed:"Allowed",exercisesettings_optTarget:"Target",exercisesettings_questionsInBank:"Questions in bank",exercisesettings_noQuestionsFound:"No suitable questions found",survey_sendresults:"Send survey results"}},RU:{translation:{question_header:"Вопрос #{{questionNumber}}",language_header:"Язык",signedin_as_header:"Пользователь",nextCorrectAnswerBtn:"Я в замешательстве, подскажи следующий корректный шаг",generateNextQuestion_nextQuestion:"Следующий вопрос",generateNextQuestion_warning:"Предупреждение",generateNextQuestion_continueAttempt:"Продолжить попытку",generateNextQuestion_modalMessage1:"Рекомендуется переходить к следующему вопросу только после решения всех предыдущих.",generateNextQuestion_modalMessage2:"Вы действительно хотите перейти к следующему вопросу?",grade_feeback:"Оценка",correctsteps_feeback:"Правильных шагов",stepswitherrors_feeback:"Шагов с ошибками",stepsleft_feeback:"Шагов осталось",issolved_feeback:"Задача решена",foundExisitingAttempt_title:"Найдена неоконченная попытка",foundExisitingAttempt_descr:"Вы хотите продолжить существующую попытку или начать новую",foundExisitingAttempt_continueattempt:"Продолжить",foundExisitingAttempt_newattempt:"Новая",exercise_completed:"Упражнение завершено",exercise_supquestion_gotit:"Понятно",exercise_supquestion_details:"Разобраться подробнее",exercise_supquestion_send_answer:"Отправить ответ",exercise_supquestion_next_question:"Следующий вопрос",exercisesettings_title:"Настройка упражнений",exercisesettings_name:"Название",exercisesettings_domain:"Домен",exercisesettings_strategy:"Стратегия",exercisesettings_qcomplexity:"Сложность вопросов",exercisesettings_answlen:"Длина ответа",exercisesettings_qopt:"Опции",exercisesettings_qopt_forceAttCreation:"Всегда создавать новую попытку",exercisesettings_qopt_genCorAnsw:"Разрешить подсказку следующего шага",exercisesettings_qopt_forceShowGenNextQ:"Разрешить неоконченные вопросы",exercisesettings_qopt_supQ:"Разрешить вспомогательные вопросы",exercisesettings_qopt_preferDTsup:"Предпочитать генерацию вспомогательных вопросов по дереву рассуждений",exercisesettings_survey:"Опрос",exercisesettings_tags:"Теги",exercisesettings_commonConcepts:"Общие концепты",exercisesettings_commonLaws:"Общие законы",exercisesettings_commonSkills:"Общие умения",exercisesettings_stages:"Стадии упражнения",exercisesettings_stageN:"Стадия #{{stageNumber}}",exercisesettings_stageN_qnumber:"Количество вопросов",exercisesettings_stageN_concepts:"Концепты",exercisesettings_stageN_laws:"Законы",exercisesettings_stageN_skills:"Умения",exercisesettings_stageN_matchedQuestionExamples:"Примеры вопросов",exercisesettings_addStage:"Добавить стадию",exercisesettings_removeStage:"Удалить стадию",exercisesettings_save:"Сохранить",exercisesettings_saveNopen:"Сохранить & Открыть",exercisesettings_open:"Открыть",exercisesettings_genDebugAtt:"Создать отладочную попытку",exercisesettings_optDenied:"Запрет",exercisesettings_optAllowed:"Разреш.",exercisesettings_optTarget:"Цель",exercisesettings_questionsInBank:"Вопросов в банке задач",exercisesettings_noQuestionsFound:"Подходящих вопросов не найдено",survey_sendresults:"Отправить результаты опроса"}},PL:{translation:{question_header:"Pytanie #{{questionNumber}}",language_header:"Język",signedin_as_header:"Zalogowany jako",nextCorrectAnswerBtn:"Nie wiem co robić dalej, podpowiedz mi następny poprawny krok",generateNextQuestion_nextQuestion:"Następne pytanie",generateNextQuestion_warning:"Ostrzeżenie",generateNextQuestion_continueAttempt:"Kontynuuj podejście",generateNextQuestion_modalMessage1:"Zaleca się przejście do następnego pytania dopiero po rozwiązaniu wszystkich poprzednich.",generateNextQuestion_modalMessage2:"Czy na pewno chcesz przejść do następnego pytania?",grade_feeback:"Ocena",correctsteps_feeback:"Poprawne kroki",stepswitherrors_feeback:"Kroki z błędami",stepsleft_feeback:"Pozostałe kroki",issolved_feeback:"Rozwiązane",foundExisitingAttempt_title:"Znaleziono już istniejące podejście",foundExisitingAttempt_descr:"Czy chcesz kontynuować dotychczasowe podejście, czy rozpocząć nowe",foundExisitingAttempt_continueattempt:"Kontynuuj",foundExisitingAttempt_newattempt:"Nowe",exercise_completed:"Ćwiczenie zakończone",exercise_supquestion_gotit:"Oczywiście!",exercise_supquestion_details:"Zobacz szczegóły",exercise_supquestion_send_answer:"Wyślij odpowiedź",exercise_supquestion_next_question:"Następne pytanie",exercisesettings_title:"Exercise settings",exercisesettings_name:"Name",exercisesettings_domain:"Domain",exercisesettings_strategy:"Strategy",exercisesettings_qcomplexity:"Question difficulty",exercisesettings_answlen:"Answer length",exercisesettings_qopt:"Options",exercisesettings_qopt_forceAttCreation:"Always create a new attempt",exercisesettings_qopt_genCorAnsw:"Allow 'generate correct answer' button",exercisesettings_qopt_forceShowGenNextQ:"Always show 'generate new question' button",exercisesettings_qopt_supQ:"Allow supplementary questions",exercisesettings_qopt_preferDTsup:"Prefer Decision-Tree-based approach to supplementary question generation",exercisesettings_survey:"Survey",exercisesettings_tags:"Tags",exercisesettings_commonConcepts:"Common concepts",exercisesettings_commonLaws:"Common laws",exercisesettings_stages:"Stage",exercisesettings_stageN:"Stage #{{stageNumber}}",exercisesettings_stageN_qnumber:"Number of questions",exercisesettings_stageN_concepts:"Concepts",exercisesettings_stageN_laws:"Laws",exercisesettings_stageN_matchedQuestionExamples:"Question examples",exercisesettings_addStage:"Add stage",exercisesettings_removeStage:"Remove stage",exercisesettings_save:"Save",exercisesettings_saveNopen:"Save & Open",exercisesettings_open:"Open",exercisesettings_genDebugAtt:"Generate debug attempt",exercisesettings_optDenied:"Denied",exercisesettings_optAllowed:"Allowed",exercisesettings_optTarget:"Target",exercisesettings_questionsInBank:"Questions in bank",exercisesettings_noQuestionsFound:"No suitable questions found",survey_sendresults:"Send survey results"}}},lng:"EN",interpolation:{escapeValue:!1}});var ze=n(4976),We=n(7767),Ue=n(4015),Xe=n(5677),Ke=n(778);const Ze=(0,Ue.PA)((e=>{var t;const n=null!==(t=e.delay)&&void 0!==t?t:0,[s,i]=(0,r.useState)(0===n);return(0,r.useEffect)((()=>{n>0&&setTimeout((()=>!s&&i(!0)),n)})),s?r.createElement(Ke.A,{style:Object.assign({},e.styleOverride),animation:"border",variant:"primary"}):null})),Je=(0,Ue.PA)((e=>{const{children:t,isLoading:n}=e;return n?r.createElement(Ze,Object.assign({},e)):r.createElement(r.Fragment,null,t)}));var et=n(3994),tt=n(5615);const nt=(0,Ue.PA)((e=>{const{isVisible:t,children:n}=e;return t?r.createElement(r.Fragment,null,n):null})),st=e=>{const{title:t,primaryBtnTitle:n,handlePrimaryBtnClicked:s,secondaryBtnTitle:i,handleSecondaryBtnClicked:a,children:o,closeButton:l,show:u,handleClose:d,type:m,size:p}=e;return r.createElement(nt,{isVisible:null==u||u},r.createElement(rt,{type:null!=m?m:"MODAL",show:null==u||u,onHide:null!=d?d:void 0,size:p},r.createElement(nt,{isVisible:!c(t)&&t.length>0},r.createElement(et.A.Header,{closeButton:null!=l?l:void 0,placeholder:null},r.createElement(et.A.Title,null,t))),r.createElement(et.A.Body,null,o),i||n?r.createElement(et.A.Footer,null,i&&r.createElement(tt.A,{variant:"secondary",onClick:null!=a?a:void 0},i),n&&r.createElement(tt.A,{variant:"primary",onClick:null!=s?s:void 0},n)):null))},rt=e=>{const{type:t,show:n,onHide:s,children:i,size:a}=e;return"DIALOG"===t?r.createElement(et.A.Dialog,{size:a},i):r.createElement(et.A,{size:a,show:n,onHide:s},i)};var it=n(8079),at=n(961),ot=n(4853),lt=n(3921),ct=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n};const ut=(0,Ue.PA)((e=>{const{question:t}=e,{options:n}=t;switch(!0){case"combobox"===n.displayMode&&!n.requireContext:return r.createElement(mt,Object.assign({},e));case"combobox"===n.displayMode&&n.requireContext:return r.createElement(pt,Object.assign({},e));case"dragNdrop"===n.displayMode:return r.createElement(dt,Object.assign({},e))}return r.createElement("div",null,"Not Implemented")})),dt=(0,Ue.PA)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;if("dragNdrop"!==t.options.displayMode)return null;const{groups:i=[]}=t,{options:a}=t,o=a.dropzoneStyle&&JSON.parse(a.dropzoneStyle)||{},l=a.dropzoneStyle&&JSON.parse(a.draggableStyle)||{};return(0,r.useEffect)((()=>{document.querySelectorAll(`[id^="question_${t.questionId}_answer_"]`).forEach((e=>{e.classList.add("comp-ph-dropzone"),Object.keys(o).forEach((t=>e.style[t]=o[t])),e.innerHTML=`<div class="comp-ph-dropzone-placeholder">${a.dropzoneHtml}</div>`}));const e=new it.gL(document.querySelectorAll(".comp-ph-droppable-container"),{draggable:".comp-ph-draggable",dropzone:".comp-ph-dropzone",plugins:[it.ry.gU],mirror:{constrainDimensions:!0}});e.on("drag:over",(()=>console.log("is out"))),e.on("droppable:stop",(e=>{var r,i,o,l,c,u,d;const m=null===(l=null===(o=null===(i=null===(r=null==e?void 0:e.data)||void 0===r?void 0:r.dragEvent)||void 0===i?void 0:i.data)||void 0===o?void 0:o.source)||void 0===l?void 0:l.id,p=null===(u=null===(c=null==e?void 0:e.data)||void 0===c?void 0:c.dropzone)||void 0===u?void 0:u.id;if(m&&p){if(a.multipleSelectionEnabled){const e=`dragAnswerWrapper_${null!==(d=m.split("_")[1])&&void 0!==d?d:""}`,t=document.getElementById(e),n=document.getElementById(m);e!==p&&t&&n&&(t.innerHTML=n.outerHTML)}setTimeout((()=>{const e=[...document.querySelectorAll(`[id^="question_${t.questionId}_answer_"] > [id^="dragAnswer_"]`)].map((e=>{var n,s,r;return[+(null!==(s=null===(n=e.parentElement)||void 0===n?void 0:n.id.split(`question_${t.questionId}_answer_`)[1])&&void 0!==s?s:""),+(null!==(r=null==e?void 0:e.id.split("dragAnswer_")[1])&&void 0!==r?r:"")]})),r=n();s(e.map((e=>{var t,n;return{answer:e,isСreatedByUser:null===(n=null===(t=r.find((t=>t.answer[0]===e[0]&&t.answer[1]===e[1])))||void 0===t?void 0:t.isСreatedByUser)||void 0===n||n}})))}),10)}}))}),[t.questionId]),r.createElement("div",null,r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md"},a.requireContext?r.createElement("p",{className:"comp-ph-droppable-container comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}}):r.createElement("p",{className:"d-flex flex-column comp-ph-droppable-container comp-ph-question-text"},t.answers.map((e=>r.createElement("div",{className:"d-flex flex-row mb-3"},r.createElement("div",{className:"mr-2 mt-1"},r.createElement("div",{id:`question_${t.questionId}_answer_${e.id}`})),r.createElement("div",{dangerouslySetInnerHTML:{__html:e.text}})))))),r.createElement("div",{className:"col-md comp-ph-droppable-container d-flex justify-content-start align-items-start flex-column"},i.map((e=>r.createElement("div",{id:`dragAnswerWrapper_${e.id}`,className:"comp-ph-dropzone mb-2",style:o},r.createElement("div",{className:"comp-ph-dropzone-placeholder",dangerouslySetInnerHTML:{__html:a.dropzoneHtml}}),r.createElement("div",{id:`dragAnswer_${e.id}`,className:"comp-ph-draggable",style:l,dangerouslySetInnerHTML:{__html:e.text}})))))))})),mt=(0,Ue.PA)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;if("combobox"!==t.options.displayMode)return null;const{groups:i=[]}=t,a=i.reduce(((e,t)=>t.text.length>e?t.text.length:e),0);return r.createElement("div",null,r.createElement("p",{className:"mb-5 comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}}),r.createElement("div",null,t.answers.map((e=>{var t,o,l;return r.createElement("div",{className:"row mb-3"},r.createElement("div",{className:"col-md-6",dangerouslySetInnerHTML:{__html:e.text}}),r.createElement("div",{className:"col-md-auto"},r.createElement("div",{style:{width:8*a+100+"px"}},r.createElement(ot.Ay,{defaultValue:null!==(l=null===(o=null===(t=n().find((t=>t.answer[0]===e.id)))||void 0===t?void 0:t.answer)||void 0===o?void 0:o[1])&&void 0!==l?l:null,options:i.map((e=>({value:e.id,label:e.text}))),components:{Option:gt,SingleValue:ht},onChange:t=>{if(!t)return;const r=n().filter((t=>t.answer[0]!==e.id)),i=[...r,{answer:[e.id,+t.value],isСreatedByUser:!0}];s(i)}}))))}))))})),pt=(0,Ue.PA)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;if("combobox"!==t.options.displayMode)return null;const{groups:i=[],options:a}=t;return(0,r.useEffect)((()=>{document.querySelectorAll(`#question_${t.questionId} [data-answer-id]`).forEach((e=>{const t=+e.getAttribute("data-answer-id"),a=r.createElement(ot.Ay,{options:i.map((e=>({value:e.id,label:e.text}))),components:{Option:gt,SingleValue:ht},onChange:e=>{if(!e)return;const r=n().filter((e=>e.answer[0]!==t)),i=[...r,{answer:[t,+e.value],isСreatedByUser:!0}];s(i)}});at.render(a,e)}))}),[t.questionId]),r.createElement("div",{id:`question_${t.questionId}`},r.createElement("p",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}}))})),gt=e=>{const{innerRef:t,innerProps:n,children:s}=e,i=ct(e,["innerRef","innerProps","children"]);return r.createElement(lt.c.Option,Object.assign({},i),r.createElement("div",Object.assign({ref:t},n,{dangerouslySetInnerHTML:{__html:e.label}})))},ht=e=>{var t;const{innerRef:n,innerProps:s,children:i}=e,a=ct(e,["innerRef","innerProps","children"]);return r.createElement(lt.c.SingleValue,Object.assign({},a),null===(t=e.getValue())||void 0===t?void 0:t.map((e=>r.createElement("div",Object.assign({ref:n},s,{dangerouslySetInnerHTML:{__html:e.label}})))))};var vt=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n};const ft=e=>{var{id:t,title:n,value:s,onChange:i,isChecked:a,style:o}=e,l=vt(e,["id","title","value","onChange","isChecked","style"]);return r.createElement("label",Object.assign({htmlFor:t,onClick:()=>i(s),style:a&&o||void 0},l),n)},bt=e=>{var{id:t,value:n,name:s,selected:i}=e,a=vt(e,["id","value","name","selected"]);return r.createElement("input",Object.assign({id:t,type:"radio",name:s,checked:i===n,readOnly:!0},a))},Et=(0,Ue.PA)((e=>{const t=t=>{var n;null===(n=e.onChange)||void 0===n||n.call(e,t)};return r.createElement("div",{id:e.id,className:"switch-field d-inline-flex flex-row"},e.values.map(((n,s)=>{var i,a,o,l;return r.createElement("span",{key:s},r.createElement(bt,Object.assign({id:`${e.id}_${n}_checkbox`,name:`${e.id}_switch`,"data-value":n,value:n,selected:e.selected},e.inputAttributes)),r.createElement(ft,Object.assign({id:`${e.id}_${n}_checkbox`,isChecked:n===e.selected,title:null!==(a=null===(i=e.displayNames)||void 0===i?void 0:i[s])&&void 0!==a?a:n,value:n,onChange:t,style:null!==(l=null===(o=e.valueStyles)||void 0===o?void 0:o[s])&&void 0!==l?l:void 0},e.inputAttributes)))})))})),wt=(0,Ue.PA)((e=>{const{question:t}=e,{options:n}=t;switch(!0){case"switch"==n.displayMode&&!n.requireContext:return r.createElement(yt,Object.assign({},e));case"switch"===n.displayMode&&n.requireContext:return r.createElement(xt,Object.assign({},e));case"dragNdrop"===n.displayMode:return r.createElement(Ct,Object.assign({},e))}return r.createElement("div",null,"Not implemented")})),yt=(0,Ue.PA)((e=>{var t;const{question:n,getAnswers:s,onChanged:i}=e;if("switch"!==n.options.displayMode)return null;const{options:a}=n,o=null!==(t=a.selectorReplacers)&&void 0!==t?t:["no","yes"];return r.createElement("div",null,r.createElement("p",null,r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:n.text}})),r.createElement("p",{className:"d-flex flex-column"},n.answers.map((e=>{var t,a,l,c;return r.createElement("div",{className:"d-flex flex-row mb-3"},r.createElement("div",{className:"mr-2 mt-1"},r.createElement(Et,{id:`question_${n.questionId}_anwser_${e.id}`,selected:null!==(c=o[null===(l=null===(a=null===(t=s().filter((t=>t.answer[0]===e.id)))||void 0===t?void 0:t[0])||void 0===a?void 0:a.answer)||void 0===l?void 0:l[1]])&&void 0!==c?c:"",values:o,inputAttributes:{"data-answer-id":e.id},onChange:t=>((e,t)=>{const n=o.indexOf(t),r=[...s().filter((t=>t.answer[0]!==e)),{answer:[e,n],isСreatedByUser:!0}];i(r)})(e.id,t)})),r.createElement("div",null,e.text))}))))})),xt=(0,Ue.PA)((e=>{var t;const{question:n,getAnswers:s,onChanged:i}=e;if("switch"!==n.options.displayMode)return null;const{options:a}=n,o=null!==(t=a.selectorReplacers)&&void 0!==t?t:["no","yes"];return(0,r.useEffect)((()=>{document.querySelectorAll(`#question_${n.questionId} [data-answer-id]`).forEach((e=>{var t,n,a,l,c;const u=+(null!==(t=e.getAttribute("data-answer-id"))&&void 0!==t?t:-1),d=r.createElement(Et,{id:`toggle_answer_${u}`,selected:null!==(c=o[null===(l=null===(a=null===(n=s().filter((e=>e.answer[0]===+u)))||void 0===n?void 0:n[0])||void 0===a?void 0:a.answer)||void 0===l?void 0:l[1]])&&void 0!==c?c:"",inputAttributes:{"data-answer-id":u},values:o,onChange:e=>((e,t)=>{const n=o.indexOf(t),r=[...s().filter((t=>t.answer[0]!==e)),{answer:[e,n],isСreatedByUser:!0}];i(r)})(+u,e)});at.render(d,e),e.id=""}))}),[n.questionId]),(0,r.useEffect)((()=>{document.querySelectorAll(`#question_${n.questionId} input[data-answer-id]`).forEach((e=>{e.getAttribute("data-answer-id"),e.checked=void 0})),s().forEach((({answer:e})=>{const[t,n]=e,s=document.querySelector(`#toggle_answer_${t} input[data-value='${o[n]}']`);s&&!s.checked&&setTimeout((()=>s.checked=!0),10)}))}),[n.questionId,s()]),r.createElement("div",{id:`question_${n.questionId}`},r.createElement("p",null,r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:n.text}})))})),Ct=(0,Ue.PA)((e=>{const{question:t,getAnswers:n,onChanged:s,answers:i}=e;if("dragNdrop"!==t.options.displayMode)return null;const a=Object.assign(Object.assign({},t),{type:"MATCHING",options:Object.assign(Object.assign({},t.options),{multipleSelectionEnabled:!0}),groups:[{id:0,text:'<span class="badge badge-success" style="height: 100%; width: 100%;display: flex; align-items: center;justify-content: center;">✓</span>'},{id:1,text:'<span class="badge badge-danger" style="height: 100%; width: 100%;display: flex; align-items: center;justify-content: center;">x</span>'}]});return r.createElement(dt,{question:a,getAnswers:n,onChanged:s,answers:i})})),St=(0,Ue.PA)((e=>{var t,n,s;const{question:i,getAnswers:a,onChanged:o,getFeedback:l}=e;if(!i.options.requireContext)return null;const{options:u}=i,d=null!==(t=u.orderNumberOptions)&&void 0!==t?t:{delimiter:"/",position:"SUFFIX"},m=(0,r.useMemo)((()=>{const e=document.createElement("div");return e.innerHTML=i.text,e}),[]);(0,r.useEffect)((()=>{document.querySelectorAll(`#question_${i.questionId} [data-answer-id]`).forEach((e=>{var t;const n=+(null!==(t=e.getAttribute("data-answer-id"))&&void 0!==t?t:"");e.addEventListener("click",(()=>o([...a(),{answer:[n,n],isСreatedByUser:!0}])))})),document.querySelectorAll("[data-comp-ph-value]").forEach((e=>{const t=e.getAttribute("data-comp-ph-value");e.innerHTML+=`<span class="comp-ph-expr-bottom-hint">${t}</span>`})),document.querySelectorAll("[data-comp-ph-pos]").forEach((e=>{const t=e.getAttribute("data-comp-ph-pos");e.innerHTML+=`<span class="comp-ph-expr-top-hint">${t}</span>`}))}),[i.questionId]),(0,r.useEffect)((()=>{var e,t;document.querySelectorAll(`#question_${i.questionId} [data-answer-id]`).forEach((e=>{var t;const n=e.getAttribute("data-comp-ph-value"),s=e.getAttribute("data-comp-ph-pos");e.innerHTML=(null===(t=m.querySelector(`#${e.id}`))||void 0===t?void 0:t.innerHTML)+(s?`<span class="comp-ph-expr-top-hint">${s}</span>`:"")+(n?`<span class="comp-ph-expr-bottom-hint">${n}</span>`:""),e.classList.remove("disabled"),e.classList.remove("comp-ph-question-answer--last-selected-by-system")}));const n=null===(t=null===(e=l())||void 0===e?void 0:e.isCorrect)||void 0===t||t?[...a()].reverse().reduce(((e,t)=>{const[n,s]=e;return-1===n?e:t.isСreatedByUser||0!==n&&n!==t.createdByInteraction?[-1,s]:(s.push(t),[t.createdByInteraction||-1,s])}),[0,[]])[1].reverse():[];a().forEach(((e,t,s)=>{const{answer:r}=e,[i]=r,a=document.querySelectorAll(`[data-answer-id='${i}']`);if(!a.length)return 0;a.forEach((s=>{var r,i;if(n.includes(e)&&s.classList.add("comp-ph-question-answer--last-selected-by-system"),"NONE"!==d.position){const e=d.delimiter,n=null!==(i=null===(r=d.replacers)||void 0===r?void 0:r[t])&&void 0!==i?i:t+1,a="PREFIX"===d.position?`${n}${e}${s.innerHTML}`:"SUFFIX"===d.position?`${s.innerHTML}${e}${n}`:"BOTTOM"===d.position?`<span class="comp-ph-expr-bottom-hint">${e}${n}</span>${s.innerHTML}`:s.innerHTML;s.innerHTML=a}u.multipleSelectionEnabled||s.classList.add("disabled")}))}))}),[i.questionId,a().length]);const p=null!==(s=null===(n=l())||void 0===n?void 0:n.trace)&&void 0!==s?s:0===a().length?i.initialTrace:null,g=u.showTrace&&!c(p)&&p.length>0;return r.createElement("div",{id:`question_${i.questionId}`},r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:i.text}}),r.createElement(nt,{isVisible:g},r.createElement("p",null,r.createElement("table",{className:"comp-ph-trace"},r.createElement("tbody",null,null==p?void 0:p.map(((e,t)=>r.createElement("tr",{key:t},r.createElement("td",{dangerouslySetInnerHTML:{__html:e}})))))))))})),Nt=(0,Ue.PA)((e=>{const{question:t}=e;switch(!0){case"radio"===t.options.displayMode&&!t.options.requireContext:return r.createElement(_t,Object.assign({},e));case"radio"===t.options.displayMode&&t.options.requireContext:return r.createElement(At,Object.assign({},e))}return r.createElement("div",null,"Not implemented")})),_t=(0,Ue.PA)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;return"radio"!==t.options.displayMode?null:r.createElement("div",null,r.createElement("div",{className:"mb-3"},r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}})),r.createElement("div",{className:"d-flex flex-column"},t.answers.map(((e,i)=>r.createElement("label",{htmlFor:`question_${t.questionId}_answer_${e.id}`,className:"comp-ph-singlechoice-label d-flex flex-row "+(i!==t.answers.length-1?"mb-3":"")},r.createElement("div",{className:"mr-2 mt-1"},r.createElement("input",{id:`question_${t.questionId}_answer_${e.id}`,name:`switch_${t.questionId}`,type:"radio",checked:n().some((t=>t.answer[0]===e.id)),onChange:t=>{return n=e.id,void(t.target.checked&&s([{answer:[n,n],isСreatedByUser:!0}]));var n},readOnly:!0})),r.createElement("div",null,e.text))))))})),At=(0,Ue.PA)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;if("radio"!==t.options.displayMode)return null;const{options:i}=t;return(0,r.useEffect)((()=>{document.querySelectorAll(`#question_${t.questionId} [data-answer-id]`).forEach((e=>{var i;const a=null!==(i=e.getAttribute("data-answer-id"))&&void 0!==i?i:-1,o=r.createElement("label",{htmlFor:`question_${t.questionId}_answer_${a}`,className:"comp-ph-singlechoice-label"},r.createElement("input",{id:`question_${t.questionId}_answer_${a}`,name:`switch_${t.questionId}`,"data-answer-id":a,type:"radio",checked:n().some((e=>e.answer[0]===+a)),onChange:e=>{return t=+a,void(e.target.checked&&s([{answer:[t,t],isСreatedByUser:!0}]));var t},readOnly:!0}),r.createElement("span",{dangerouslySetInnerHTML:{__html:e.innerHTML}}));at.render(o,e),e.id=""}))}),[t.questionId]),(0,r.useEffect)((()=>{document.querySelectorAll(`#question_${t.questionId} input[data-answer-id]`).forEach((e=>{e.checked=void 0})),n().forEach((({answer:e})=>{const n=e[0],s=document.querySelector(`#question_${t.questionId} input[data-answer-id='${n}']`);s&&setTimeout((()=>s.checked=!0),10)}))}),[t.questionId,n()]),r.createElement("div",{id:`question_${t.questionId}`},r.createElement("p",null,r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}})))})),Ot=(0,Ue.PA)((e=>{var t;const{question:n,answers:s,onChanged:i,getAnswers:a,getFeedback:o,isFeedbackLoading:l,isQuestionFreezed:c}=e;let u;switch(n.type){case"MATCHING":u=r.createElement(ut,{question:n,onChanged:i,answers:s,getAnswers:a});break;case"MULTI_CHOICE":u=r.createElement(wt,{question:n,onChanged:i,answers:s,getAnswers:a});break;case"SINGLE_CHOICE":u=r.createElement(Nt,{question:n,onChanged:i,answers:s,getAnswers:a});break;case"ORDER":u=r.createElement(St,{question:n,onChanged:i,answers:s,getAnswers:a,getFeedback:o});break;default:return(0,I.absurd)(n)}const d=["comp-ph-question-wrapper",0===(null===(t=o())||void 0===t?void 0:t.stepsLeft)?"comp-ph-question-wrapper--finished":"",l?"comp-ph-question-wrapper--loading-feedback":"",c?"comp-ph-question-wrapper--freezed":""].join(" ");return r.createElement("div",{className:d},u)}));var It=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};const qt=(0,Ue.PA)((e=>{const{violationLaw:t,store:n}=e,[s,i]=(0,r.useState)(!1),[a,o]=(0,r.useState)(!0),[c,u]=(0,r.useState)(!0),[d,m]=(0,r.useState)(t),{t:p}=(0,ke.Bd)(),g=()=>It(void 0,void 0,void 0,(function*(){var e;"COMPLETED"!=n.questionState&&n.question||"CONTINUE_AUTO"!==(null===(e=n.feedback)||void 0===e?void 0:e.action)||(console.log("show feedback for 3 seconds"),yield l(3e3),yield h())})),h=()=>It(void 0,void 0,void 0,(function*(){var e,t;const s=(null===(t=null===(e=n.feedback)||void 0===e?void 0:e.message)||void 0===t?void 0:t.violationLaws)||null;if(!s)return console.log("empty violation laws"),void u(!1);m(s),yield n.generateSupplementaryQuestion(s.map((e=>e.name))),yield g()}));return r.createElement(nt,{isVisible:c},r.createElement(nt,{isVisible:a},r.createElement("div",{className:"d-flex flex-row mt-3"},r.createElement(tt.A,{onClick:()=>It(void 0,void 0,void 0,(function*(){var e;o(!1),i(!0),yield n.generateSupplementaryQuestion(d.map((e=>e.name))),n.question&&"FINISH"!==(null===(e=n.feedback)||void 0===e?void 0:e.action)||(console.log("no need to generate sup question"),u(!1))})),variant:"primary"},p("exercise_supquestion_details")),r.createElement(tt.A,{onClick:()=>{u(!1)},variant:"success",className:"ml-2"},p("exercise_supquestion_gotit")))),r.createElement(st,{type:"DIALOG",size:"xl",show:s,closeButton:!1,handleClose:()=>i(!1)},r.createElement(kt,{store:n,onSubmitted:()=>It(void 0,void 0,void 0,(function*(){yield n.sendAnswers();const{feedback:e}=n;if(!e)return console.log("empty feedback for question asnwer"),void u(!1);yield g()})),onNextQuestionRequested:h})))})),kt=(0,Ue.PA)((e=>{var t,n;const{store:s,onSubmitted:i,onNextQuestionRequested:a}=e,{t:o}=(0,ke.Bd)(),l=s.question;if("LOADING"===s.questionState)return r.createElement("div",{className:"mt-2"},r.createElement(Ze,null));const c="EXPLICIT"===s.questionSubmitMode&&s.canSendQuestionAnswers,u="COMPLETED"===s.questionState&&!!s.feedback&&!!l,d="COMPLETED"===s.questionState&&!!s.feedback&&!l,m="CONTINUE_MANUAL"===(null===(t=s.feedback)||void 0===t?void 0:t.action)&&(u||d)&&!!(null===(n=s.feedback)||void 0===n?void 0:n.message.violationLaws);return r.createElement(r.Fragment,null,l&&r.createElement(Ot,{question:l,answers:s.answer,getAnswers:()=>s.answer,onChanged:e=>{s.setAnswer(e),"IMPLICIT"===s.questionSubmitMode&&(null==i||i())},getFeedback:()=>{},isFeedbackLoading:s.isFeedbackLoading,isQuestionFreezed:s.isQuestionFreezed}),s.isFeedbackLoading&&r.createElement("div",{className:"mt-2"},r.createElement(Ze,null)),c&&r.createElement(tt.A,{variant:"primary",onClick:i},o("exercise_supquestion_send_answer")),d&&r.createElement(r.Fragment,null,s.feedback.message.message),u&&r.createElement("div",{className:"mt-2"},r.createElement(Lt,{message:s.feedback.message})),m&&r.createElement("div",{className:"mt-3"},r.createElement(tt.A,{variant:"primary",onClick:a},o("exercise_supquestion_next_question"))))})),Lt=(0,Ue.PA)((e=>{let{supQuestionStore:t,message:n,showGenerateSupQuestion:s}=e;s=s&&null!=t;const i="SUCCESS"===n.type?"success":"danger";return r.createElement(Xe.A,{variant:i},n.message)}));var jt=n(6052);const Qt=(0,Ue.PA)((({store:e,showExtendedFeedback:t})=>{const{feedback:n,isFeedbackVisible:s,question:i}=e,a="ANSWER_EVALUATING"===e.questionState,o="LOADING"===e.questionState,{t:l}=(0,ke.Bd)();if(a)return r.createElement("div",{className:"mt-2"},r.createElement(Ze,null));if(!n||o||!i)return null;const u="COMPLETED"===e.questionState?[{type:"SUCCESS",message:l("issolved_feeback")}]:n.messages;return r.createElement("div",{className:"comp-ph-feedback-wrapper mt-2"},s&&r.createElement(r.Fragment,null,r.createElement("div",{className:"mb-3"},null==u?void 0:u.map((n=>{var s;return r.createElement(Pt,{message:n,supQuestionStore:e.supplementaryQuestion,showGenerateSupQuestion:t&&i.options.showSupplementaryQuestions&&"ERROR"===n.type&&(null===(s=n.violationLaws)||void 0===s?void 0:s.every((e=>e.canCreateSupplementaryQuestion)))})}))),t&&r.createElement("div",null,null!==n.grade&&r.createElement(r.Fragment,null,r.createElement(jt.A,{variant:"primary"},l("grade_feeback"),": ",n.grade)," "),null!==n.correctSteps&&r.createElement(r.Fragment,null,r.createElement(jt.A,{variant:"success"},l("correctsteps_feeback"),": ",n.correctSteps)," "),!c(n.stepsWithErrors)&&n.stepsWithErrors>0&&r.createElement(r.Fragment,null,r.createElement(jt.A,{variant:"danger"},l("stepswitherrors_feeback"),": ",n.stepsWithErrors)," "),!c(n.stepsLeft)&&n.stepsLeft>0&&r.createElement(r.Fragment,null,r.createElement(jt.A,{variant:"info"},l("stepsleft_feeback"),": ",n.stepsLeft)," "))))})),Pt=(0,Ue.PA)((e=>{var t;let{supQuestionStore:n,message:s,showGenerateSupQuestion:i}=e;i=i&&null!=n;const a="SUCCESS"===s.type?"success":"danger";return r.createElement(Xe.A,{variant:a},r.createElement("div",{"data-domain-laws":null===(t=s.violationLaws)||void 0===t?void 0:t.map((e=>e.name)).join(";"),dangerouslySetInnerHTML:{__html:s.message}}),i&&"ERROR"===s.type&&s.violationLaws&&r.createElement(qt,{store:n,violationLaw:s.violationLaws})||null)}));const Tt=(0,Ue.PA)((e=>{const{store:t,showExtendedFeedback:n,onChanged:s}=e,i=t.question;return"LOADING"===t.questionState?r.createElement("div",{className:"mt-2"},r.createElement(Ze,null)):i?r.createElement(r.Fragment,null,r.createElement(Ot,{question:i,answers:t.lastAnswer,getAnswers:()=>t.lastAnswer,onChanged:e=>{return n=void 0,r=void 0,a=function*(){(yield t.setFullAnswer(e))&&(null==s||s(e))},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,o)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a},getFeedback:()=>t.feedback,isFeedbackLoading:"ANSWER_EVALUATING"===t.questionState,isQuestionFreezed:t.isQuestionFreezed}),r.createElement(Qt,{store:t,showExtendedFeedback:n})):null})),Rt=(0,Ue.PA)((()=>{var e,t;const[n]=(0,r.useState)((()=>i.kL.resolve(Ie)));return r.createElement(Tt,{store:n.currentQuestion,showExtendedFeedback:null===(t=null===(e=n.exercise)||void 0===e?void 0:e.options.supplementaryQuestionsEnabled)||void 0===t||t})}));var Dt=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};const Mt=(0,Ue.PA)((()=>{const[e]=(0,r.useState)((()=>i.kL.resolve(Ie))),{t}=(0,ke.Bd)(),[n,s]=(0,r.useState)(!1),{exercise:a,currentAttempt:o}=e,{question:l}=e.currentQuestion,c="ANSWER_EVALUATING"===e.currentQuestion.questionState,u="LOADING"===e.currentQuestion.questionState;if(!l||!a||!o||u||c)return null;const d=()=>{s(!1)},m=()=>Dt(void 0,void 0,void 0,(function*(){s(!1);const{questionIds:t=[]}=o,n=t.indexOf(l.questionId);n===t.length-1?yield e.generateQuestion():yield e.currentQuestion.loadQuestion(t[n+1])}));return r.createElement(r.Fragment,null,r.createElement(tt.A,{onClick:()=>Dt(void 0,void 0,void 0,(function*(){var t;const{questionIds:n=[]}=o,r=n.indexOf(l.questionId)===n.length-1;0!==(null===(t=e.currentQuestion.feedback)||void 0===t?void 0:t.stepsLeft)&&r?s(!0):yield m()})),variant:"primary"},t("generateNextQuestion_nextQuestion")),r.createElement(st,{show:n,title:t("generateNextQuestion_warning"),type:"MODAL",size:"lg",primaryBtnTitle:t("generateNextQuestion_continueAttempt"),handlePrimaryBtnClicked:d,secondaryBtnTitle:t("generateNextQuestion_nextQuestion"),handleSecondaryBtnClicked:m,closeButton:!1,handleClose:d},r.createElement("div",null,t("generateNextQuestion_modalMessage1")),r.createElement("div",null,t("generateNextQuestion_modalMessage2"))))}));var $t=n(1069);const Ht=(0,Ue.PA)((()=>{var e,t;const[n]=(0,r.useState)((()=>i.kL.resolve(Ie)));if(!n.currentQuestion.question||!n.currentAttempt)return null;const{questionId:s}=n.currentQuestion.question,a=n.currentAttempt.questionIds.map(((e,t)=>({id:e,number:t+1})));if(0===a.length)return null;const o=null!==(t=null===(e=a.find((e=>e.id===s)))||void 0===e?void 0:e.number)&&void 0!==t?t:-1,l=o-5<=0?"BEGIN":o+5>a.length?"END":"MIDDLE",c=Math.floor(2.5);return r.createElement("div",{className:"d-flex justify-content-center"},r.createElement($t.A,{className:"p-3",style:{marginBottom:"0 !important"}},r.createElement(nt,{isVisible:a.length<=10},a.map((e=>r.createElement($t.A.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number)))),r.createElement(nt,{isVisible:a.length>10},r.createElement($t.A.First,{disabled:s===a[0].id,onClick:()=>n.currentQuestion.loadQuestion(a[0].id)}),r.createElement($t.A.Prev,{disabled:s===a[0].id,onClick:()=>n.currentQuestion.loadQuestion(a[a.findIndex((e=>s===e.id))-1].id)}),r.createElement(nt,{isVisible:"BEGIN"===l},a.filter((e=>e.number<=7)).map((e=>r.createElement($t.A.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number))),r.createElement($t.A.Ellipsis,{disabled:!0}),r.createElement($t.A.Item,{key:a[a.length-1].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(a[a.length-1].id)},a[a.length-1].number)),r.createElement(nt,{isVisible:"MIDDLE"===l},r.createElement($t.A.Item,{key:a[0].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(a[0].id)},a[0].number),r.createElement($t.A.Ellipsis,{disabled:!0}),a.filter((e=>e.number>=o-c&&e.number<=o+c)).map((e=>r.createElement($t.A.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number))),r.createElement($t.A.Ellipsis,{disabled:!0}),r.createElement($t.A.Item,{key:a[a.length-1].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(a[a.length-1].id)},a[a.length-1].number)),r.createElement(nt,{isVisible:"END"===l},r.createElement($t.A.Item,{key:a[0].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(a[0].id)},a[0].number),r.createElement($t.A.Ellipsis,{disabled:!0}),a.filter((e=>e.number>a.length-7)).map((e=>r.createElement($t.A.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number)))),r.createElement($t.A.Next,{disabled:s===a[a.length-1].id,onClick:()=>n.currentQuestion.loadQuestion(a[a.findIndex((e=>s===e.id))+1].id)}),r.createElement($t.A.Last,{disabled:s===a[a.length-1].id,onClick:()=>n.currentQuestion.loadQuestion(a[a.length-1].id)}))))}));var Ft=n(2406);const Vt=(0,Ue.PA)((e=>{const{text:t,pagination:n,languageHint:s,language:i,onLanguageClicked:a,userHint:o,user:l,onUserClicked:c,userHref:u}=e;return r.createElement(Ft.A,{className:"px-0"},t&&r.createElement("h5",null,t)||null,r.createElement(Ft.A.Collapse,{className:"justify-content-end"},n,r.createElement(Ft.A.Text,{className:"px-2"},s,": ",r.createElement("a",{href:"#",onClick:null!=a?a:void 0},i)),r.createElement(Ft.A.Toggle,null),r.createElement(Ft.A.Text,{className:"px-2"},o,": ",r.createElement("a",{href:null!=u?u:"#",onClick:null!=c?c:void 0},l))))}));var Gt=n(3022),Bt=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Yt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},zt=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class Wt{constructor(){var e,t;Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"languages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"selectedLanguage",{enumerable:!0,configurable:!0,writable:!0,value:null!==(t=null===(e=this.user)||void 0===e?void 0:e.language)&&void 0!==t?t:void 0}),Object.defineProperty(this,"isSessionLoaded",{enumerable:!0,configurable:!0,writable:!0,value:void 0!==this.user}),Object.defineProperty(this,"isSessionLoading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"usersApi",{enumerable:!0,configurable:!0,writable:!0,value:new Se}),Object.defineProperty(this,"loadSessionInfo",{enumerable:!0,configurable:!0,writable:!0,value:()=>zt(this,void 0,void 0,(function*(){if(this.isSessionLoading)return;(0,O.h5)((()=>{this.isSessionLoading=!0}));const[e,t]=yield Promise.all([this.usersApi.getCurrentUser(),this.usersApi.getLanguages()]);Gt.FG(e)&&Gt.FG(t)&&(0,O.h5)((()=>{this.isSessionLoading=!1,this.user=e.right,this.languages=t.right,this.user.language!==qe.Ay.language&&qe.Ay.changeLanguage(this.user.language)}))}))}),Object.defineProperty(this,"changeLanguage",{enumerable:!0,configurable:!0,writable:!0,value:e=>zt(this,void 0,void 0,(function*(){if(this.user&&this.user.language!==e){const t=yield this.usersApi.setLanguage(e);Gt.FG(t)?(0,O.h5)((()=>{this.user.language=t.right,qe.Ay.changeLanguage(t.right)})):console.error("Failed to change language",t.left)}}))})}SessionStore(){(0,O.Gn)(this)}}Bt([O.sH,Yt("design:type",Object)],Wt.prototype,"user",void 0),Bt([O.sH,Yt("design:type",Array)],Wt.prototype,"languages",void 0),Bt([O.EW,Yt("design:type",String)],Wt.prototype,"selectedLanguage",void 0),Bt([O.EW,Yt("design:type",Boolean)],Wt.prototype,"isSessionLoaded",void 0),Bt([O.sH,Yt("design:type",Boolean)],Wt.prototype,"isSessionLoading",void 0);const Ut=(0,r.createContext)(null),Xt=({children:e})=>{const[t]=(0,r.useState)((()=>new Wt));return(0,r.useEffect)((()=>{t.loadSessionInfo()}),[t]),r.createElement(Ut.Provider,{value:t},e)},Kt=()=>{const e=(0,r.useContext)(Ut);if(!e)throw new Error("useSession must be used within a <SessionProvider>");return e},Zt=()=>{const e=Kt();if(!e)throw new Error("useCurrentUser must be used within a <SessionProvider>");return e.user},Jt=(0,Ue.PA)((()=>{const[e]=(0,r.useState)((()=>i.kL.resolve(Ie))),{t,i18n:n}=(0,ke.Bd)(),s=Kt(),a=Zt(),{currentAttempt:o,exercise:l,currentQuestion:c}=e;if(!o||!l||!a)return null;const u=o.questionIds.findIndex((e=>{var t;return(null===(t=c.question)||void 0===t?void 0:t.questionId)===e})),d=(0,r.useCallback)((()=>{const e="RU"===(null==a?void 0:a.language)?"EN":"RU";s.changeLanguage(e)}),[s,null==a?void 0:a.language]);return r.createElement(Vt,{text:-1!==u?t("question_header",{questionNumber:u+1}):"",pagination:r.createElement(Ht,null),languageHint:t("language_header"),language:a.language,userHint:t("signedin_as_header"),user:a.displayName,onLanguageClicked:d})}));var en=n(3133);const tn=e=>{const{survey:t,enabledSurveyQuestions:n,isCompleted:s}=e,[a]=(0,r.useState)((()=>i.kL.resolve(ve))),[o,l]=(0,r.useState)(s?"COMPLETED":"INITAL"),[c,u]=(0,r.useState)(e.value||{}),{t:d}=(0,ke.Bd)(),m=e.survey.questions.filter((e=>n.includes(e.id)));var p=(e,t)=>{const n=Object.assign(Object.assign({},c),{[e]:t});u(n),console.log(n)};return m&&m.length?r.createElement("div",{className:"alert alert-warning rounded",role:"alert"},m.map(((e,t,n)=>r.createElement("div",{key:t,className:t!==n.length-1?"mb-4":""},"yes-no"===e.type&&r.createElement(nn,{isCompleted:s,question:e,onAnswered:p,value:c[e.id]})||"single-choice"===e.type&&r.createElement(sn,{isCompleted:s,question:e,onAnswered:p,value:c[e.id]})||"open-ended"===e.type&&r.createElement(rn,{isCompleted:s,question:e,onAnswered:p,value:c[e.id]})||"invalid question type"))),"SENDING_RESULTS"===o&&r.createElement("div",{className:"mt-2"},r.createElement(Ze,{delay:100})),"VALIDATION_ERROR"===o&&r.createElement("div",{className:"mt-2"},r.createElement("div",{className:"alert alert-danger rounded"},"Необходимо ответить на все обязательные вопросы")),"COMPLETED"!==o&&"SENDING_RESULTS"!==o&&r.createElement("div",{className:"mt-2"},r.createElement(tt.A,{variant:"primary",onClick:()=>{var n,s,r,i;n=void 0,s=void 0,i=function*(){m.filter((e=>e.required)).map((e=>e.id)).every((e=>c[e]))?(l("SENDING_RESULTS"),yield Promise.all(m.map((t=>a.postSurveyAnswer(t.id,e.questionId,c[t.id])))),l("COMPLETED"),e.onAnswersSended(t,e.questionId,c)):l("VALIDATION_ERROR")},new((r=void 0)||(r=Promise))((function(e,t){function a(e){try{l(i.next(e))}catch(e){t(e)}}function o(e){try{l(i.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,o)}l((i=i.apply(n,s||[])).next())}))}},d("survey_sendresults")))):null},nn=e=>{const{question:t,onAnswered:n,value:s,isCompleted:i}=e;return r.createElement("div",null,r.createElement("div",{className:"mb-1"},t.text),r.createElement("div",{className:"d-flex flex-row mt-2"},r.createElement("button",{type:"button",className:"btn btn-secondary mr-2 "+(t.options.yesValue===s?"active":""),onClick:()=>n(t.id,t.options.yesValue),disabled:void 0!==s},t.options.yesText),r.createElement("button",{type:"button",className:"btn btn-secondary "+(t.options.noValue===s?"active":""),onClick:()=>n(t.id,t.options.noValue),disabled:void 0!==s},t.options.noText)))},sn=e=>{const{question:t,onAnswered:n,value:s,isCompleted:i}=e;return r.createElement("div",null,r.createElement("div",{className:"mb-1"},t.text),r.createElement("div",{className:"d-flex mt-2"},r.createElement("div",null,t.options.map(((e,a,o)=>r.createElement("div",{key:e.id},r.createElement(en.A.Check,{disabled:i,checked:s===e.id,name:`radio_qid${t.id}`,type:"radio",id:`radio_qid${t.id}_sqid${e.id}`,label:e.text,value:e.id,onChange:e=>n(t.id,e.target.value)})))))))},rn=e=>{const{question:t,onAnswered:n,value:s,isCompleted:i}=e;return r.createElement("div",null,r.createElement("div",{className:"mb-1"},t.text),r.createElement("div",{className:"d-flex flex-row mt-2"},r.createElement(en.A.Control,{disabled:i,value:s,as:"textarea",rows:3,onChange:e=>n(t.id,e.target.value)})))},an=(0,Ue.PA)((({store:e})=>{const{t}=(0,ke.Bd)(),{question:n,feedback:s}=e,i="ANSWER_EVALUATING"===e.questionState,a="LOADING"===e.questionState;return!n||i||a||0===(null==s?void 0:s.stepsLeft)?null:r.createElement(tt.A,{onClick:()=>{e.generateNextCorrectAnswer()},variant:"primary"},t("nextCorrectAnswerBtn"))}));var on=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};const ln=(0,Ue.PA)((()=>{var e,t,n,s,a,o,l,c,u,d,m,p,g,h,v;const[f]=(0,r.useState)((()=>i.kL.resolve(Ie))),{exerciseState:b,setExerciseState:E,storeState:w,currentQuestion:y,survey:x}=f,{storeState:C}=y,{t:S}=(0,ke.Bd)();(0,r.useEffect)((()=>{on(void 0,void 0,void 0,(function*(){var e;if("LAUNCH_ERROR"===b)return;if(f.currentQuestion.question)return void E("EXERCISE");if(yield f.loadExercise(),f.isDebug)return E("EXERCISE"),void A();const t=f.currentAttemptId;return t&&Number.isInteger(t)?(E("EXERCISE"),void O(+t)):(null===(e=f.exercise)||void 0===e?void 0:e.options.forceNewAttemptCreationEnabled)||!(yield f.loadExistingExerciseAttempt())?(E("EXERCISE"),void _()):void E("MODAL")}))}),[]);const N=(0,r.useCallback)((()=>{on(void 0,void 0,void 0,(function*(){var e,t,n;if(null===(e=f.currentAttempt)||void 0===e?void 0:e.questionIds.length){const e=null===(t=f.currentAttempt)||void 0===t?void 0:t.questionIds.length;yield f.currentQuestion.loadQuestion(null===(n=f.currentAttempt)||void 0===n?void 0:n.questionIds[e-1])}else yield f.generateQuestion()}))}),[f]),_=(0,r.useCallback)((()=>{on(void 0,void 0,void 0,(function*(){f.currentQuestion.setQuestionState("LOADING"),yield f.createExerciseAttempt(),N()}))}),[f]),A=(0,r.useCallback)((()=>{on(void 0,void 0,void 0,(function*(){f.currentQuestion.setQuestionState("LOADING"),yield f.createDebugExerciseAttempt(),N()}))}),[f]),O=(0,r.useCallback)((e=>{on(void 0,void 0,void 0,(function*(){f.currentQuestion.setQuestionState("LOADING"),yield f.loadExerciseAttempt(e),N()}))}),[f]),I=(0,r.useCallback)(((e,t,n)=>{f.setSurveyAnswers(t,n)}),[f]);return r.createElement(r.Fragment,null,r.createElement("div",{className:`compph-exercise ${f.isDebug&&"compph-exercise--debug"}`||""},r.createElement(Je,{isLoading:!0===f.isExerciseLoading||"INITIAL"===b},r.createElement(nt,{isVisible:"EXERCISE"===b||"COMPLETED"===b},r.createElement(Jt,null),r.createElement("div",{className:"mt-5"},r.createElement(Rt,null),null!=x&&("COMPLETED"===f.currentQuestion.questionState||"COMPLETED"===b)&&r.createElement("div",{className:"mt-2"},r.createElement(tn,{questionId:null!==(t=null===(e=f.currentQuestion.question)||void 0===e?void 0:e.questionId)&&void 0!==t?t:-1,survey:x.survey,enabledSurveyQuestions:f.ensureQuestionSurveyExists(null!==(s=null===(n=y.question)||void 0===n?void 0:n.questionId)&&void 0!==s?s:-1),value:null===(l=x.questions[null!==(o=null===(a=f.currentQuestion.question)||void 0===a?void 0:a.questionId)&&void 0!==o?o:-1])||void 0===l?void 0:l.results,onAnswersSended:I,isCompleted:"COMPLETED"===(null===(d=x.questions[null!==(u=null===(c=f.currentQuestion.question)||void 0===c?void 0:c.questionId)&&void 0!==u?u:-1])||void 0===d?void 0:d.status)})),r.createElement(nt,{isVisible:"EXERCISE"===b},r.createElement(nt,{isVisible:"LOADED"===f.currentQuestion.questionState},r.createElement("div",{className:"mt-3"},(null===(m=f.exercise)||void 0===m?void 0:m.options.correctAnswerGenerationEnabled)&&r.createElement(an,{store:f.currentQuestion}))),r.createElement(nt,{isVisible:null==x&&((null===(p=f.exercise)||void 0===p?void 0:p.options.newQuestionGenerationEnabled)||"COMPLETED"===f.currentQuestion.questionState)||null!=x&&"COMPLETED"===(null===(v=x.questions[null!==(h=null===(g=f.currentQuestion.question)||void 0===g?void 0:g.questionId)&&void 0!==h?h:-1])||void 0===v?void 0:v.status)},r.createElement("div",{className:"mt-2"},r.createElement(Mt,null)))),r.createElement(nt,{isVisible:"COMPLETED"===b},r.createElement("div",{className:"mt-3"},r.createElement(Xe.A,{variant:"success"},S("exercise_completed")))))),r.createElement(nt,{isVisible:"MODAL"===b},r.createElement(st,{type:"DIALOG",title:S("foundExisitingAttempt_title"),primaryBtnTitle:S("foundExisitingAttempt_continueattempt"),handlePrimaryBtnClicked:()=>{E("EXERCISE"),N()},secondaryBtnTitle:S("foundExisitingAttempt_newattempt"),handleSecondaryBtnClicked:()=>{E("EXERCISE"),_()}},r.createElement("p",null,S("foundExisitingAttempt_descr"),"?")))),[w,C].filter((e=>"ERROR"===e.tag)).map(((e,t,n)=>"ERROR"===e.tag&&r.createElement("div",{className:"mt-2"},r.createElement(Xe.A,{variant:"danger"},e.error.message))))))}));const cn=()=>{const[e,t]=(0,r.useState)([]),[n,s]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{var e,n,r,a;e=void 0,n=void 0,a=function*(){const e=new URLSearchParams(window.location.search).get("exerciseId");if(null===e||Number.isNaN(+e))throw new Error("Invalid exerciseId url param");const n=i.kL.resolve(S);s(!0);const r=yield n.getExerciseStatistics(+e);g.isRight(r)&&t(r.right),s(!1)},new((r=void 0)||(r=Promise))((function(t,s){function i(e){try{l(a.next(e))}catch(e){s(e)}}function o(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,o)}l((a=a.apply(e,n||[])).next())}))}),[]),r.createElement("div",null,r.createElement("table",{className:"table"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",{scope:"col"},"AttemptId"),r.createElement("th",{scope:"col"},"QuestionsCount"),r.createElement("th",{scope:"col"},"TotalInteractionsCount"),r.createElement("th",{scope:"col"},"TotalInteractionsWithErrorsCount"),r.createElement("th",{scope:"col"},"AverageGrade"))),r.createElement("tbody",null,r.createElement(Je,{isLoading:n},e.map(((e,t)=>r.createElement("tr",{key:t},r.createElement("th",{scope:"row"},e.attemptId),r.createElement("td",null,e.questionsCount),r.createElement("td",null,e.totalInteractionsCount),r.createElement("td",null,e.totalInteractionsWithErrorsCount),r.createElement("td",null,e.averageGrade))))))))};var un=n(2374);const dn=(0,Ue.PA)((()=>{const[e,t]=(0,r.useState)([]),[n,s]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{var e,n,r,a;e=void 0,n=void 0,a=function*(){s(!0);const e=i.kL.resolve(S),n=yield e.getExercises();g.isRight(n)&&t(n.right),s(!1)},new((r=void 0)||(r=Promise))((function(t,s){function i(e){try{l(a.next(e))}catch(e){s(e)}}function o(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,o)}l((a=a.apply(e,n||[])).next())}))}),[]),r.createElement("div",null,r.createElement(un.A,null,e.map((e=>r.createElement(un.A.Item,null,r.createElement("a",{href:`exercise?exerciseId=${e}`},e))))))}));var mn=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};const pn=(0,Ue.PA)((()=>{var e,t,n,s,a,o,l,c,u,d,m;const[p]=(0,r.useState)((()=>i.kL.resolve(Ie))),{exerciseState:g,setExerciseState:h,storeState:v,currentQuestion:f,survey:b}=p,{storeState:E}=f,{t:w}=(0,ke.Bd)(),[y,x]=(0,r.useState)("ACTIVE");(0,r.useEffect)((()=>{mn(void 0,void 0,void 0,(function*(){"LAUNCH_ERROR"!==g&&(p.currentQuestion.question?h("EXERCISE"):(yield p.loadExercise(),h("EXERCISE"),yield C()))}))}),[]);const C=()=>mn(void 0,void 0,void 0,(function*(){p.currentQuestion.setQuestionState("LOADING"),yield p.createExerciseAttempt(),yield mn(void 0,void 0,void 0,(function*(){var e,t,n;if(null===(e=p.currentAttempt)||void 0===e?void 0:e.questionIds.length){const e=null===(t=p.currentAttempt)||void 0===t?void 0:t.questionIds.length;yield p.currentQuestion.loadQuestion(null===(n=p.currentAttempt)||void 0===n?void 0:n.questionIds[e-1])}else yield p.generateQuestion()}))})),S=(0,r.useCallback)(((e,t,n)=>{console.log("лень рефакторить, не работает крч")}),[p]),N=null===(e=p.exercise)||void 0===e?void 0:e.options.surveyOptions;return null===(t=p.currentQuestion.question)||void 0===t||t.questionId,(null==N?void 0:N.enabled)?r.createElement(r.Fragment,null,r.createElement(Je,{isLoading:!0===p.isExerciseLoading||"INITIAL"===g},r.createElement(nt,{isVisible:"EXERCISE"===g||"COMPLETED"===g},r.createElement(Jt,null),r.createElement("div",{className:"mt-5"},r.createElement("div",{style:{pointerEvents:"none"}},r.createElement(Rt,null)),r.createElement(nt,{isVisible:"COMPLETED"===y},r.createElement("div",{className:"mt-2"},r.createElement(Xe.A,{variant:"success"},"Спасибо за участие в опросе!"))),r.createElement(nt,{isVisible:"COMPLETED"!==y&&"LOADED"===f.questionState},r.createElement("div",{className:"mt-2"},r.createElement(tn,{questionId:null!==(s=null===(n=p.currentQuestion.question)||void 0===n?void 0:n.questionId)&&void 0!==s?s:-1,survey:p.survey.survey,value:null===(a=p.survey)||void 0===a?void 0:a.questions[null!==(l=null===(o=p.currentQuestion.question)||void 0===o?void 0:o.questionId)&&void 0!==l?l:-1].results,enabledSurveyQuestions:null!==(m=null===(c=p.survey)||void 0===c?void 0:c.questions[null!==(d=null===(u=p.currentQuestion.question)||void 0===u?void 0:u.questionId)&&void 0!==d?d:-1].questions)&&void 0!==m?m:[],onAnswersSended:S})))))),[v,E].filter((e=>"ERROR"===e.tag)).map(((e,t,n)=>"ERROR"===e.tag&&r.createElement("div",{className:"mt-2"},r.createElement(Xe.A,{variant:"danger"},e.error.message))))):null}));var gn=function(e,t){return function(n,s){t(n,s,e)}},hn=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};class vn{constructor(e,t,n){Object.defineProperty(this,"exerciseSettingsController",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"card",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"concepts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"laws",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"skills",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numberOfQuestions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bankLoadingState",{enumerable:!0,configurable:!0,writable:!0,value:"NOT_STARTED"}),Object.defineProperty(this,"bankSearchResult",{enumerable:!0,configurable:!0,writable:!0,value:{questions:[],count:0,topRatedCount:0}}),Object.defineProperty(this,"complexity",{enumerable:!0,configurable:!0,writable:!0,value:.5}),Object.defineProperty(this,"autorunner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"abortController",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.concepts=n.concepts,this.laws=n.laws,this.skills=n.skills,this.numberOfQuestions=n.numberOfQuestions,this.complexity=n.complexity,this.card=t,(0,O.l_)(this),this.autorunner=(0,O.fm)((()=>hn(this,void 0,void 0,(function*(){const e=this.complexity,n=this.laws.slice(),s=this.concepts.slice(),r=this.skills.slice();this.updateBankStats(s,n,r,t.tags,e)}))),{delay:1e3})}*updateBankStats(e,t,n,s,r){const{card:i}=this;this.abortController&&(this.abortController.abort(),this.abortController=null);const a=new AbortController;this.abortController=a,(0,O.h5)((()=>this.bankLoadingState="IN_PROGRESS"));const o=yield this.exerciseSettingsController.search(i.domainId,e,t,n,s,r,5,a.signal);g.isRight(o)&&((0,O.h5)((()=>{this.bankSearchResult=o.right})),(0,O.h5)((()=>this.bankLoadingState="COMPLETED"))),this.abortController===a&&(this.abortController=null)}[Symbol.dispose](){this.autorunner&&this.autorunner(),this.abortController&&(this.abortController.abort(),this.abortController=null)}}let fn=class{constructor(e,t,n){Object.defineProperty(this,"exerciseSettingsController",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"userController",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"exerciseController",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"exercisesLoadStatus",{enumerable:!0,configurable:!0,writable:!0,value:"NONE"}),Object.defineProperty(this,"exercises",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"domains",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"backends",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"strategies",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"currentCard",{enumerable:!0,configurable:!0,writable:!0,value:null}),(0,O.l_)(this)}toCardViewModel(e){var t;const n=null===(t=this.domains)||void 0===t?void 0:t.find((t=>t.id===e.domainId));if(!n)throw new Error(`не найден домен ${e.domainId}`);const s=(0,O.sH)(Object.assign(Object.assign({},e),{tags:e.tags.filter((e=>n.tags.some((t=>t===e)))),stages:[]}));return s.stages=(0,I.pipe)(e.stages,fe.map((e=>new vn(this.exerciseSettingsController,s,e)))),s}fromCardViewModel(e){return Object.assign(Object.assign({},e),{stages:(0,I.pipe)(e.stages,fe.map((e=>({concepts:e.concepts,laws:e.laws,skills:e.skills,numberOfQuestions:e.numberOfQuestions,complexity:e.complexity}))))})}loadExercises(){return hn(this,void 0,void 0,(function*(){if("LOADED"===this.exercisesLoadStatus||"LOADING"===this.exercisesLoadStatus)return;(0,O.h5)((()=>this.exercisesLoadStatus="LOADING"));const[e,t,n,s,r]=yield Promise.all([this.exerciseSettingsController.getAllExercises(),this.exerciseSettingsController.getDomains(),this.exerciseSettingsController.getBackends(),this.exerciseSettingsController.getStrategies(),this.userController.getCurrentUser()]);g.isRight(e)&&g.isRight(t)&&g.isRight(n)&&g.isRight(s)&&g.isRight(r)&&(0,O.h5)((()=>{this.exercises=e.right,this.domains=t.right,this.backends=n.right,this.strategies=s.right,qe.Ay.changeLanguage(r.right.language)})),(0,O.h5)((()=>this.exercisesLoadStatus="LOADED"))}))}loadExercise(e){return hn(this,void 0,void 0,(function*(){if("LOADED"!==this.exercisesLoadStatus)throw new Error("Exercises must be loaded first");(0,O.h5)((()=>this.exercisesLoadStatus="EXERCISELOADING"));const t=yield this.exerciseSettingsController.getExercise(e);g.isRight(t)&&(0,O.h5)((()=>{this.currentCard=this.toCardViewModel(t.right)})),(0,O.h5)((()=>this.exercisesLoadStatus="LOADED"))}))}createNewExecise(){return hn(this,void 0,void 0,(function*(){if("LOADED"!==this.exercisesLoadStatus)throw new Error("Exercises must be loaded first");const e=yield this.exerciseSettingsController.createExercise("(empty)",this.domains[0].id,this.strategies[0].id);if(!g.isRight(e))return;(0,O.h5)((()=>this.exercisesLoadStatus="EXERCISELOADING"));const[t,n]=yield Promise.all([this.exerciseSettingsController.getExercise(e.right),this.exerciseSettingsController.getAllExercises()]);g.isRight(t)&&g.isRight(n)&&(0,O.h5)((()=>{this.currentCard=this.toCardViewModel(t.right),this.exercises=n.right})),(0,O.h5)((()=>this.exercisesLoadStatus="LOADED"))}))}saveCard(){return hn(this,void 0,void 0,(function*(){if(!this.currentCard)return;(0,O.h5)((()=>this.exercisesLoadStatus="EXERCISELOADING")),yield this.exerciseSettingsController.saveExercise(this.fromCardViewModel(this.currentCard));const e=yield this.exerciseSettingsController.getAllExercises();g.isRight(e)&&(0,O.h5)((()=>{this.exercises=e.right})),(0,O.h5)((()=>this.exercisesLoadStatus="LOADED"))}))}setCardName(e){this.currentCard&&(this.currentCard.name=e)}setCardDomain(e){this.currentCard&&e!==this.currentCard.domainId&&(this.currentCard.stages[0].laws=[],this.currentCard.stages[0].concepts=[],this.currentCard.stages.splice(1),this.currentCard.domainId=e)}setCardStrategy(e){this.currentCard&&this.currentCard.strategyId!==e&&(this.currentCard.stages[0].laws=[],this.currentCard.stages[0].concepts=[],this.currentCard.stages.splice(1),this.currentCard.strategyId=e)}setCardStageComplexity(e,t){if(!this.currentCard||!this.currentCard.stages[e])return;const n=this.currentCard.stages[e],s=Number.parseInt(t);n.complexity=s/100}setCardCommonConceptValue(e,t){if(this.currentCard)for(const n of this.currentCard.stages){const s=n.concepts.findIndex((t=>t.name==e));let r=-1!==s?n.concepts[s]:null;"PERMITTED"!==t?r?n.concepts[s]=Object.assign(Object.assign({},r),{kind:t}):(r={name:e,kind:t},n.concepts=[...n.concepts,r]):r&&n.concepts.splice(s,1)}}setCardStageConceptValue(e,t,n){if(!this.currentCard||!this.currentCard.stages[e])return;const s=this.currentCard.stages[e],r=s.concepts.findIndex((e=>e.name==t));let i=-1!==r?s.concepts[r]:null;"PERMITTED"!==n?i?s.concepts[r]=Object.assign(Object.assign({},i),{kind:n}):(i={name:t,kind:n},s.concepts=[...s.concepts,i]):i&&s.concepts.splice(r,1)}setCardCommonLawValue(e,t){if(this.currentCard)for(const n of this.currentCard.stages){const s=n.laws.findIndex((t=>t.name==e));let r=-1!==s?n.laws[s]:null;"PERMITTED"!==t?r?n.laws[s]=Object.assign(Object.assign({},r),{kind:t}):(r={name:e,kind:t},n.laws=[...n.laws,r]):r&&n.laws.splice(s,1)}}setCardStageLawValue(e,t,n){if(!this.currentCard||!this.currentCard.stages[e])return;const s=this.currentCard.stages[e],r=s.laws.findIndex((e=>e.name==t));let i=-1!==r?s.laws[r]:null;"PERMITTED"!==n?i?s.laws[r]=Object.assign(Object.assign({},i),{kind:n}):(i={name:t,kind:n},s.laws=[...s.laws,i]):i&&s.laws.splice(r,1)}setCardStageSkillValue(e,t,n){if(!this.currentCard||!this.currentCard.stages[e])return;const s=this.currentCard.stages[e],r=s.skills.findIndex((e=>e.name==t));let i=-1!==r?s.skills[r]:null;"PERMITTED"!==n?i?s.skills[r]=Object.assign(Object.assign({},i),{kind:n}):(i={name:t,kind:n},s.skills=[...s.skills,i]):i&&s.skills.splice(r,1)}setCardCommonSkillValue(e,t){if(this.currentCard)for(const n of this.currentCard.stages){const s=n.skills.findIndex((t=>t.name==e));let r=-1!==s?n.laws[s]:null;"PERMITTED"!==t?r?n.skills[s]=Object.assign(Object.assign({},r),{kind:t}):(r={name:e,kind:t},n.skills=[...n.skills,r]):r&&n.laws.splice(s,1)}}setCardStageNumberOfQuestions(e,t){if(!this.currentCard||!this.currentCard.stages[e])return;const n=this.currentCard.stages[e];if(!t.match(/^\d*$/))return;const s=+t||1;n.numberOfQuestions=s}setCardSurveyEnabled(e){this.currentCard&&(this.currentCard.options.surveyOptions?this.currentCard.options.surveyOptions.enabled=e:this.currentCard.options.surveyOptions={enabled:e,surveyId:""})}setCardSurveyId(e){this.currentCard&&(this.currentCard.options.surveyOptions?this.currentCard.options.surveyOptions.surveyId=e:this.currentCard.options.surveyOptions={enabled:!0,surveyId:e})}setCardTags(e){this.currentCard&&(this.currentCard.tags=e)}setCardFlag(e,t){this.currentCard&&(this.currentCard.options[e]=t)}addStage(){if(!this.currentCard||!this.domains)return;const e=this.currentCard,t=new vn(this.exerciseSettingsController,e,{numberOfQuestions:10,complexity:.5,laws:[],concepts:[],skills:[]});this.currentCard.stages.push(t)}removeStage(e){if(!this.currentCard)return;const t=this.currentCard.stages.length;e<0||e>=t||(this.currentCard.stages[e][Symbol.dispose](),this.currentCard.stages.splice(e,1))}};fn=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}([(0,i._G)(),gn(0,(0,i.WQ)(Be)),gn(1,(0,i.WQ)(Se)),gn(2,(0,i.WQ)(S)),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Be,Object,Object])],fn);var bn=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};const En=(0,Ue.PA)((()=>{var e,t,n,s,a,o;const[l]=(0,r.useState)((()=>i.kL.resolve(fn))),{t:c}=(0,ke.Bd)(),u=Zt(),d=Kt();(0,r.useEffect)((()=>{bn(void 0,void 0,void 0,(function*(){yield l.loadExercises();const e=new URL(window.location.href).searchParams.get("exerciseId");e&&(yield l.loadExercise(Number.parseInt(e)))}))}),[]);const m=(0,r.useCallback)((()=>{bn(void 0,void 0,void 0,(function*(){yield l.createNewExecise()}))}),[null===(e=l.exercises)||void 0===e?void 0:e.length]),p=(0,r.useCallback)((()=>{const e="RU"===(null==u?void 0:u.language)?"EN":"RU";d.changeLanguage(e)}),[d,null==u?void 0:u.language]);return"LOADING"===l.exercisesLoadStatus?r.createElement(Ze,null):u?r.createElement("div",{className:"container-fluid"},r.createElement("div",{className:"pt-1 pb-3"},r.createElement(Vt,{text:c("exercisesettings_title"),languageHint:c("language_header"),language:null!==(t=null==u?void 0:u.language)&&void 0!==t?t:"EN",onLanguageClicked:p,userHint:c("signedin_as_header"),user:u.displayName,userHref:null})),r.createElement("div",{className:"flex-xl-nowrap row"},r.createElement("div",{className:"col-xl-3 col-md-3 col-12 d-flex flex-column"},r.createElement("button",{type:"button",className:"btn btn-primary mb-3",onClick:m},"Create new"),r.createElement("ul",{className:"list-group"},null===(n=l.exercises)||void 0===n?void 0:n.map((e=>{var t;return r.createElement(ze.N_,{key:e.id,className:"list-group-item "+(e.id===(null===(t=l.currentCard)||void 0===t?void 0:t.id)?"active":""),to:`?exerciseId=${e.id}`,onClick:()=>l.loadExercise(e.id),title:e.name},e.name.length>22?`${e.name.substring(0,22)}...`:e.name)})))),r.createElement("div",{className:"col-xl-9 col-md-9 col-12"},r.createElement(wn,{store:l,card:l.currentCard,domains:null!==(s=l.domains)&&void 0!==s?s:[],backends:null!==(a=l.backends)&&void 0!==a?a:[],strategies:null!==(o=l.strategies)&&void 0!==o?o:[]})))):r.createElement(Ze,null)})),wn=(0,Ue.PA)((e=>{var t,n,s,i,a;const{card:o,domains:l,backends:c,strategies:u,store:d}=e,{t:m}=(0,ke.Bd)(),p=Zt();if((0,r.useMemo)((()=>[m("exercisesettings_optDenied"),m("exercisesettings_optAllowed"),m("exercisesettings_optTarget")]),[null==p?void 0:p.language]),"EXERCISELOADING"===d.exercisesLoadStatus)return r.createElement(Ze,{delay:200});if(null==o)return r.createElement("div",null,"No exercise selected");const g=l.find((e=>e.id===o.domainId)),h=null==g?void 0:g.laws.filter((e=>(e.bitflags&$e.TargetEnabled)>0)),v=null==g?void 0:g.concepts.filter((e=>(e.bitflags&$e.TargetEnabled)>0)),f=null==g?void 0:g.skills,b=o.stages[0].laws.reduce(((e,t)=>(e[t.name]=t,e)),{}),E=o.stages[0].concepts.reduce(((e,t)=>(e[t.name]=t,e)),{}),w=null==g?void 0:g.laws.filter((e=>!(e.bitflags&$e.TargetEnabled))),y=null==g?void 0:g.concepts.filter((e=>!(e.bitflags&$e.TargetEnabled))),x=[],C=u.find((e=>e.id===o.strategyId));return r.createElement("div",null,r.createElement("form",{className:"exercise-settings-form"},r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold",htmlFor:"exampleInputEmail1"},m("exercisesettings_name")),r.createElement("input",{value:o.name,type:"email",className:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",placeholder:"Enter email",onChange:e=>d.setCardName(e.target.value)})),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},m("exercisesettings_domain")),r.createElement("select",{id:"domainId",className:"form-control","aria-describedby":"domainDescription",value:o.domainId,onChange:e=>d.setCardDomain(e.target.value),title:null==g?void 0:g.displayName},null==l?void 0:l.map((e=>{var t;return r.createElement("option",{key:e.id,value:e.id,title:null!==(t=e.description)&&void 0!==t?t:e.displayName},e.displayName)}))),r.createElement("small",{id:"domainDescription",className:"form-text text-muted"},null!==(t=null==g?void 0:g.description)&&void 0!==t?t:"")),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},m("exercisesettings_strategy")),r.createElement("select",{id:"strategyId",className:"form-control","aria-describedby":"strategyDescription",value:o.strategyId,onChange:e=>d.setCardStrategy(e.target.value),title:null==C?void 0:C.displayName},null==u?void 0:u.map((e=>{var t;return r.createElement("option",{key:e.id,value:e.id,title:null!==(t=e.description)&&void 0!==t?t:e.displayName},e.displayName)}))),r.createElement("small",{id:"strategyDescription",className:"form-text text-muted"},null!==(n=null==C?void 0:C.description)&&void 0!==n?n:"")),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},m("exercisesettings_qopt")),r.createElement("div",{className:"form-check"},r.createElement("input",{checked:o.options.forceNewAttemptCreationEnabled,onChange:e=>d.setCardFlag("forceNewAttemptCreationEnabled",e.target.checked),type:"checkbox",className:"form-check-input",id:"forceNewAttemptCreationEnabled"}),r.createElement("label",{className:"form-check-label",htmlFor:"forceNewAttemptCreationEnabled"},m("exercisesettings_qopt_forceAttCreation"))),r.createElement("div",{className:"form-check"},r.createElement("input",{checked:o.options.correctAnswerGenerationEnabled,onChange:e=>d.setCardFlag("correctAnswerGenerationEnabled",e.target.checked),type:"checkbox",className:"form-check-input",id:"correctAnswerGenerationEnabled"}),r.createElement("label",{className:"form-check-label",htmlFor:"correctAnswerGenerationEnabled"},m("exercisesettings_qopt_genCorAnsw"))),r.createElement("div",{className:"form-check"},r.createElement("input",{checked:o.options.newQuestionGenerationEnabled,onChange:e=>d.setCardFlag("newQuestionGenerationEnabled",e.target.checked),type:"checkbox",className:"form-check-input",id:"newQuestionGenerationEnabled"}),r.createElement("label",{className:"form-check-label",htmlFor:"newQuestionGenerationEnabled"},m("exercisesettings_qopt_forceShowGenNextQ"))),r.createElement("div",{className:"form-check"},r.createElement("input",{checked:o.options.supplementaryQuestionsEnabled,onChange:e=>d.setCardFlag("supplementaryQuestionsEnabled",e.target.checked),type:"checkbox",className:"form-check-input",id:"supplementaryQuestionsEnabled"}),r.createElement("label",{className:"form-check-label",htmlFor:"supplementaryQuestionsEnabled"},m("exercisesettings_qopt_supQ"))),r.createElement("div",{className:"form-check"},r.createElement("input",{checked:o.options.preferDecisionTreeBasedSupplementaryEnabled,onChange:e=>d.setCardFlag("preferDecisionTreeBasedSupplementaryEnabled",e.target.checked),type:"checkbox",className:"form-check-input",id:"preferDecisionTreeBasedSupplementaryEnabled"}),r.createElement("label",{className:"form-check-label",htmlFor:"preferDecisionTreeBasedSupplementaryEnabled"},m("exercisesettings_qopt_preferDTsup")))),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"survOptions",className:"font-weight-bold"},m("exercisesettings_survey")),r.createElement("div",{className:"input-group mb-3"},r.createElement("div",{className:"input-group-prepend"},r.createElement("div",{className:"input-group-text"},r.createElement("input",{checked:null===(s=o.options.surveyOptions)||void 0===s?void 0:s.enabled,type:"checkbox","aria-label":"Checkbox for following text input",onChange:e=>d.setCardSurveyEnabled(e.target.checked)}))),r.createElement("input",{id:"survOptions",type:"text",value:null===(i=o.options.surveyOptions)||void 0===i?void 0:i.surveyId,className:"form-control","aria-label":"Text input with checkbox",disabled:!(null===(a=o.options.surveyOptions)||void 0===a?void 0:a.enabled),onChange:e=>d.setCardSurveyId(e.target.value)}))),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"exTagsValues",className:"font-weight-bold"},m("exercisesettings_tags")),null==g?void 0:g.tags.map(((e,t)=>r.createElement("div",{key:t,className:"form-check"},r.createElement("input",{checked:o.tags.includes(e),onChange:e=>e.target.checked?d.setCardTags([...new Set([...o.tags,e.target.value])]):d.setCardTags([...o.tags.filter((t=>t!==e.target.value))]),type:"checkbox",value:e,className:"form-check-input",id:`tag_checkbox_${e}`}),r.createElement("label",{className:"form-check-label",htmlFor:`tag_checkbox_${e}`},e))))),(null==y?void 0:y.length)&&r.createElement("div",{className:"form-group"},r.createElement("div",null,r.createElement("label",{className:"font-weight-bold"},m("exercisesettings_commonConcepts"))),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-12"},r.createElement("div",{className:"list-group list-group-flush"},r.createElement(xn,{id:"common_concepts",store:d,concepts:y,cardConcepts:E,onChange:(e,t,n)=>{d.setCardCommonConceptValue(e.name,t),n?d.setCardCommonConceptValue(n.name,"PERMITTED"):e.childs.forEach((e=>d.setCardCommonConceptValue(e.name,t)))}})))))||null,(null==w?void 0:w.length)&&r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},m("exercisesettings_commonLaws")),r.createElement("div",{className:"list-group list-group-flush"},r.createElement(Cn,{id:"common_laws",store:d,laws:w,cardLaws:b,onChange:(e,t,n)=>{d.setCardCommonLawValue(e.name,t),n?d.setCardCommonLawValue(n.name,"PERMITTED"):e.childs.forEach((e=>d.setCardCommonLawValue(e.name,t)))}})))||null,(null==x?void 0:x.length)&&r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},m("exercisesettings_commonSkills")),r.createElement("div",{className:"list-group list-group-flush"},r.createElement(Sn,{id:"common_skills",store:d,skills:x,cardSkills:b,onChange:(e,t,n)=>{d.setCardCommonSkillValue(e.name,t),n?d.setCardCommonSkillValue(n.name,"PERMITTED"):e.childs.forEach((e=>d.setCardCommonSkillValue(e.name,t)))}})))||null,r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},m("exercisesettings_stages")),r.createElement("div",{className:"list-group list-group-flush"},o.stages.map(((e,t,n)=>r.createElement(yn,{key:t,store:d,stage:e,stageIdx:t,showDeleteBtn:n.length>1,strategy:C,stageDomainConcepts:v,stageDomainSkills:f,stageDomainLaws:h}))))),o.stages.length<5&&(null==C?void 0:C.options.multiStagesEnabled)?r.createElement("div",{style:{marginTop:"-1rem"}},r.createElement("button",{type:"button",className:"btn btn-success",onClick:()=>d.addStage()},m("exercisesettings_addStage"))):null),(null==p?void 0:p.roles.includes("ADMIN"))&&r.createElement("div",{className:"mt-5"},r.createElement("button",{type:"button",className:"btn btn-primary",onClick:()=>d.saveCard()},m("exercisesettings_save")),r.createElement("button",{type:"button",className:"btn btn-primary ml-2",onClick:()=>d.saveCard().then((()=>{var e;return null===(e=window.open(`${window.location.origin}/pages/exercise?exerciseId=${o.id}`,"_blank"))||void 0===e?void 0:e.focus()}))},m("exercisesettings_saveNopen")),r.createElement("button",{type:"button",className:"btn btn-primary ml-2",onClick:()=>{var e;return null===(e=window.open(`${window.location.origin}/pages/exercise?exerciseId=${o.id}`,"_blank"))||void 0===e?void 0:e.focus()}},m("exercisesettings_open")),(null==C?void 0:C.options.multiStagesEnabled)&&r.createElement("button",{type:"button",className:"btn btn-primary ml-2",onClick:()=>{var e;return null===(e=window.open(`${window.location.origin}/pages/exercise?exerciseId=${o.id}&debug`,"_blank"))||void 0===e?void 0:e.focus()}},m("exercisesettings_genDebugAtt")))||null)})),yn=(0,Ue.PA)((e=>{var t,n;const{t:s}=(0,ke.Bd)(),{store:i,stage:a,strategy:o,stageIdx:l,showDeleteBtn:c,stageDomainConcepts:u,stageDomainLaws:d,stageDomainSkills:m}=e;if(!i.currentCard)throw new Error("card not set");const p=a.concepts.reduce(((e,t)=>(e[t.name]=t,e)),{}),g=a.laws.reduce(((e,t)=>(e[t.name]=t,e)),{}),h=a.skills.reduce(((e,t)=>(e[t.name]=t,e)),{});return r.createElement("div",{className:"card mb-3"},r.createElement("div",{className:"card-body"},r.createElement("div",{className:"form-group",style:{display:"flex",justifyContent:"space-between"}},r.createElement("div",null,s("exercisesettings_stageN",{stageNumber:l+1})),r.createElement("div",null,r.createElement("span",null,s("exercisesettings_questionsInBank"),": "),"IN_PROGRESS"===a.bankLoadingState||null===a.bankSearchResult?r.createElement(Ze,{styleOverride:{width:"1rem",height:"1rem"},delay:0}):r.createElement("span",null,`${a.bankSearchResult.count} (${null===(t=a.bankSearchResult)||void 0===t?void 0:t.topRatedCount})`))),(null==o?void 0:o.options.multiStagesEnabled)&&r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold",htmlFor:`numberOfQuestions_stage${l}`},s("exercisesettings_stageN_qnumber")),r.createElement("input",{type:"text",className:"form-control",id:`numberOfQuestions_stage${l}`,value:a.numberOfQuestions,onChange:e=>i.setCardStageNumberOfQuestions(l,e.target.value)}))||null,r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},s("exercisesettings_qcomplexity")),r.createElement("div",{className:"d-flex"},r.createElement("input",{type:"range",className:"form-control-range",id:`complexity_stage${l}`,value:100*(null!==(n=a.complexity)&&void 0!==n?n:.5),onChange:e=>i.setCardStageComplexity(l,e.target.value)}),r.createElement("div",{className:"ml-2"},a.complexity.toFixed(2)))),u&&u.length>0&&r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},s("exercisesettings_stageN_concepts")),r.createElement("div",{className:"list-group list-group-flush"},r.createElement(xn,{id:`stage${l}_concepts`,store:i,concepts:u,cardConcepts:p,onChange:(e,t,n)=>{i.setCardStageConceptValue(l,e.name,t),n?i.setCardStageConceptValue(l,n.name,"PERMITTED"):e.childs.forEach((e=>i.setCardStageConceptValue(l,e.name,t)))}})))||null,d&&d.length>0&&r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},s("exercisesettings_stageN_laws")),r.createElement("div",{className:"list-group list-group-flush"},r.createElement(Cn,{id:`stage${l}_laws`,store:i,laws:d,cardLaws:g,onChange:(e,t,n)=>{i.setCardStageLawValue(l,e.name,t),n?i.setCardStageLawValue(l,n.name,"PERMITTED"):e.childs.forEach((e=>i.setCardStageLawValue(l,e.name,t)))}})))||null,m&&m.length>0&&r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},s("exercisesettings_stageN_skills")),r.createElement("div",{className:"list-group list-group-flush"},r.createElement(Sn,{id:`stage${l}_skills`,store:i,skills:m,cardSkills:h,onChange:(e,t,n)=>{i.setCardStageSkillValue(l,e.name,t),n?i.setCardStageSkillValue(l,n.name,"PERMITTED"):e.childs.forEach((e=>i.setCardStageSkillValue(l,e.name,t)))}})))||null,r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},s("exercisesettings_stageN_matchedQuestionExamples")),"IN_PROGRESS"===a.bankLoadingState&&r.createElement(Ze,{styleOverride:{width:"1rem",height:"1rem"},delay:0})||r.createElement("div",{className:"list-group"},0===a.bankSearchResult.questions.length?r.createElement("div",{className:"list-group-item"},s("exercisesettings_noQuestionsFound")):a.bankSearchResult.questions.map(((e,t)=>r.createElement("div",{key:t,className:"list-group-item"},r.createElement("a",{target:"_blank",href:`${y}/pages/question?metadataId=${e.metadataId}`},e.name)))))),c&&r.createElement("div",{className:"d-flex justify-content-end"},r.createElement("button",{type:"button",className:"btn btn-danger",onClick:()=>i.removeStage(l)},s("exercisesettings_removeStage")))||null))})),xn=(0,Ue.PA)((e=>{const{id:t,store:n,concepts:s,cardConcepts:i,onChange:a}=e,{t:o}=(0,ke.Bd)(),l=n.currentCard;if(!l)throw new Error("card not set");const c=Zt(),u=(0,r.useMemo)((()=>[o("exercisesettings_optDenied"),o("exercisesettings_optAllowed"),o("exercisesettings_optTarget")]),[null==c?void 0:c.language]);return r.createElement(r.Fragment,null,s.map(((e,n)=>{var s;return r.createElement("div",{key:n,className:"list-group-item p-0 bg-transparent pt-2 pb-2"},r.createElement("div",null,r.createElement("div",{className:"d-flex flex-row align-items-center"},r.createElement(Et,{id:`concept_${t}_toggle_${l.id}_${e.name}_${n}`,selected:Nn(null===(s=i[e.name])||void 0===s?void 0:s.kind),values:An(e),valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],displayNames:u,onChange:t=>a(e,_n(t))}),r.createElement("div",{style:{marginLeft:"15px"}},e.displayName))),e.childs.length>0&&r.createElement("ul",{className:""},e.childs.map(((s,o)=>{var c;return r.createElement(r.Fragment,null,r.createElement("li",{key:o,className:"d-flex flex-row align-items-centers mt-3"},r.createElement(Et,{id:`concept_${t}_toggle_${l.id}_${s.name}_${n}_${o}`,selected:Nn(null===(c=i[s.name])||void 0===c?void 0:c.kind),values:An(s),valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],displayNames:u,onChange:t=>a(s,_n(t),e)}),r.createElement("div",{style:{marginLeft:"15px"}},s.displayName)))}))))})))})),Cn=(0,Ue.PA)((e=>{const{id:t,store:n,laws:s,cardLaws:i,onChange:a}=e,{t:o}=(0,ke.Bd)(),l=n.currentCard;if(!l)throw new Error("card not set");const c=Zt(),u=(0,r.useMemo)((()=>[o("exercisesettings_optDenied"),o("exercisesettings_optAllowed"),o("exercisesettings_optTarget")]),[null==c?void 0:c.language]);return r.createElement(r.Fragment,null,s.map(((e,n)=>{var s;return r.createElement("div",{className:"list-group-item p-0 bg-transparent pt-2 pb-2",key:n},r.createElement("div",null,r.createElement("div",{className:"d-flex flex-row align-items-center"},r.createElement(Et,{id:`law_${t}_toggle_${l.id}_${n}`,selected:Nn(null===(s=i[e.name])||void 0===s?void 0:s.kind),values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],displayNames:u,onChange:t=>a(e,_n(t))}),r.createElement("div",{style:{marginLeft:"15px"}},e.displayName))),e.childs.length>0&&r.createElement("ul",{className:""},e.childs.map(((s,o)=>{var c;return r.createElement(r.Fragment,null,r.createElement("li",{key:o,className:"d-flex flex-row align-items-centers mt-3"},r.createElement(Et,{id:`law_${t}_toggle_${l.id}_${n}_${o}`,selected:Nn(null===(c=i[s.name])||void 0===c?void 0:c.kind),values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],displayNames:u,onChange:t=>a(s,_n(t),e)}),r.createElement("div",{style:{marginLeft:"15px"}},s.displayName)))}))))})))})),Sn=(0,Ue.PA)((e=>{const{id:t,store:n,skills:s,cardSkills:i,onChange:a}=e,{t:o}=(0,ke.Bd)(),l=n.currentCard;if(!l)throw new Error("card not set");const c=Zt(),u=(0,r.useMemo)((()=>[o("exercisesettings_optDenied"),o("exercisesettings_optAllowed"),o("exercisesettings_optTarget")]),[null==c?void 0:c.language]);return r.createElement(r.Fragment,null,s.map(((e,n)=>{var s;return r.createElement("div",{className:"list-group-item p-0 bg-transparent pt-2 pb-2",key:n},r.createElement("div",null,r.createElement("div",{className:"d-flex flex-row align-items-center"},r.createElement(Et,{id:`skill_${t}_toggle_${l.id}_${n}`,selected:Nn(null===(s=i[e.name])||void 0===s?void 0:s.kind),values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],displayNames:u,onChange:t=>a(e,_n(t))}),r.createElement("div",{style:{marginLeft:"15px"}},e.displayName))),e.childs.length>0&&r.createElement("ul",{className:""},e.childs.map(((s,o)=>{var c;return r.createElement(r.Fragment,null,r.createElement("li",{key:o,className:"d-flex flex-row align-items-centers mt-3"},r.createElement(Et,{id:`skill_${t}_toggle_${l.id}_${n}_${o}`,selected:Nn(null===(c=i[s.name])||void 0===c?void 0:c.kind),values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],displayNames:u,onChange:t=>a(s,_n(t),e)}),r.createElement("div",{style:{marginLeft:"15px"}},s.displayName)))}))))})))}));function Nn(e){return"FORBIDDEN"===e?"Denied":"TARGETED"===e?"Target":"Allowed"}function _n(e){return"Denied"===e?"FORBIDDEN":"Target"===e?"TARGETED":"PERMITTED"}function An(e){return(e.bitflags&$e.TargetEnabled)>0?["Denied","Allowed","Target"]:["Denied","Allowed"]}const On={concepts:["literal","variable","arithmetic operator","assignment operator","comparison operator","logical operator","bitwise operator","array access operator","pointer operator","function call"],laws:["Expression contains two operators with different precedence in a row","Expression contains two operators with the same precedence and left associativity in a row","Expression contains two operators with the same precedence and right associativity in a row","Expression contains operators inside parentheses or another operator","Expression contains operators evaluating their operands in a strict order"]},In=(0,Ue.PA)((()=>r.createElement("div",{className:"container-fluid",style:{color:"black",fontSize:"18px"}},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-8"},r.createElement("form",null,r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Domain"),r.createElement("select",{className:"form-control"},r.createElement("option",null,"Order of Expression Evaluation"))),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-6"},r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Question complexity"),r.createElement("div",null,r.createElement("input",{type:"range",className:"form-control-range",id:"formControlRange1"})))),r.createElement("div",{className:"col-md-6"},r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Answer length"),r.createElement("div",null,r.createElement("input",{type:"range",className:"form-control-range",id:"formControlRange1"}))))),r.createElement("div",{className:"form-group"},r.createElement("div",null,r.createElement("label",{className:"font-weight-bold"},"Concepts")),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-6"},On.concepts.filter(((e,t)=>t%2==0)).map(((e,t)=>r.createElement("div",{className:"d-flex flex-row align-items-center",style:{marginBottom:"10px"}},r.createElement(Et,{id:`concept_toggle_${e}_${t}`,selected:"Allowed",values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],onChange:e=>0}),r.createElement("div",{style:{marginLeft:"15px"}},e))))),r.createElement("div",{className:"col-md-6"},On.concepts.filter(((e,t)=>t%2!=0)).map(((e,t)=>r.createElement("div",{className:"d-flex flex-row align-items-center",style:{marginBottom:"10px"}},r.createElement(Et,{id:`concept_toggle_${e}_${t}`,selected:"Allowed",values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],onChange:e=>0}),r.createElement("div",{style:{marginLeft:"15px"}},e))))))),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Laws"),On.laws.map(((e,t)=>r.createElement("div",{className:"d-flex flex-row align-items-start justify-content-start",style:{marginBottom:"10px"}},r.createElement("div",null,r.createElement(Et,{id:`law_toggle_${t}`,selected:"Allowed",values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],onChange:e=>0})),r.createElement("div",{style:{marginLeft:"15px"}},e))))))))))),qn=(0,Ue.PA)((()=>{const[e]=(0,r.useState)((()=>i.kL.resolve(ie)));return(0,r.useEffect)((()=>{const t=new URLSearchParams(window.location.search).get("metadataId");if(!t||Number.isNaN(Number(t)))throw new Error("no metadataId provided in the URL");e.generateQuestionByMetadata(+t)}),[e]),r.createElement(r.Fragment,null,r.createElement(Tt,{store:e,showExtendedFeedback:!0}),r.createElement("div",{className:"mt-3"},r.createElement(an,{store:e})))})),kn=document.getElementById("root");(0,s.H)(kn).render(r.createElement((()=>r.createElement(Xt,null,r.createElement("div",{className:"container comp-ph-container"},r.createElement(ze.Kd,null,r.createElement(We.BV,null,r.createElement(We.qh,{path:"/pages/statistics",element:r.createElement(cn,null)}),r.createElement(We.qh,{path:"/pages/exercise",element:r.createElement(ln,null)}),r.createElement(We.qh,{path:"/pages/exercise-settings",element:r.createElement(En,null)}),r.createElement(We.qh,{path:"/pages/strategy-settings",element:r.createElement(In,null)}),r.createElement(We.qh,{path:"/pages/survey",element:r.createElement(pn,null)}),r.createElement(We.qh,{path:"/pages/question",element:r.createElement(qn,null)}),r.createElement(We.qh,{path:"/pages/exercises-list",element:r.createElement(dn,null)}),r.createElement(We.qh,{path:"/",element:r.createElement(We.C5,{to:"/pages/exercise-settings",replace:!0})})))))),null))}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return s[e].call(n.exports,n,n.exports,i),n.exports}i.m=s,e=[],i.O=(t,n,s,r)=>{if(!n){var a=1/0;for(u=0;u<e.length;u++){for(var[n,s,r]=e[u],o=!0,l=0;l<n.length;l++)(!1&r||a>=r)&&Object.keys(i.O).every((e=>i.O[e](n[l])))?n.splice(l--,1):(o=!1,r<a&&(a=r));if(o){e.splice(u--,1);var c=s();void 0!==c&&(t=c)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[n,s,r]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,s){if(1&s&&(e=this(e)),8&s)return e;if("object"==typeof e&&e){if(4&s&&e.__esModule)return e;if(16&s&&"function"==typeof e.then)return e}var r=Object.create(null);i.r(r);var a={};t=t||[null,n({}),n([]),n(n)];for(var o=2&s&&e;"object"==typeof o&&!~t.indexOf(o);o=n(o))Object.getOwnPropertyNames(o).forEach((t=>a[t]=()=>e[t]));return a.default=()=>e,i.d(r,a),r},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={818:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var s,r,[a,o,l]=n,c=0;if(a.some((t=>0!==e[t]))){for(s in o)i.o(o,s)&&(i.m[s]=o[s]);if(l)var u=l(i)}for(t&&t(n);c<a.length;c++)r=a[c],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(u)},n=self.webpackChunkcomp_prehension=self.webpackChunkcomp_prehension||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=i.O(void 0,[121],(()=>i(3767)));a=i.O(a)})();