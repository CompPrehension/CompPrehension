(()=>{"use strict";var e,t={9602:(e,t,n)=>{var s=n(3935),r=n(7294),i=(n(8660),n(3195)),o=n(935);function a(e,t){return o.G0([e,o.lB,o.S1,o.i0("")],null!=t?t:e.name)}function l(e){return new Promise((t=>setTimeout((()=>t()),e)))}function c(e){return null!=e}const d=o.dt({attemptId:o.pk,exerciseId:o.pk,questionIds:o.IX(o.pk)},"ExerciseAttempt"),u=a(d),p=o.dt({attemptId:o.pk,questionsCount:o.pk,totalInteractionsCount:o.pk,totalInteractionsWithErrorsCount:o.pk,averageGrade:o.pk},"ExerciseStatisticsItem"),m=o.IX(p),v=o.jV([o.dt({answer:o.bc([o.pk,o.pk]),isСreatedByUser:o.O7}),o.r$({createdByInteraction:o.G0([o.pk,o.lB])})]),g=o.dt({name:o.Z_,canCreateSupplementaryQuestion:o.O7}),h=o.G0([o.dt({type:o.i0("SUCCESS"),message:o.Z_,violationLaw:g}),o.dt({type:o.i0("ERROR"),message:o.Z_,violationLaw:g})]),E=o.jV([o.dt({isCorrect:o.O7}),o.r$({isCorrect:o.O7,grade:o.G0([o.pk,o.lB]),violations:o.G0([o.IX(o.pk),o.lB]),correctAnswers:o.G0([o.IX(v),o.lB]),correctSteps:o.G0([o.pk,o.lB]),stepsLeft:o.G0([o.pk,o.lB]),stepsWithErrors:o.G0([o.pk,o.lB]),message:o.G0([o.IX(h),o.lB]),strategyDecision:o.G0([o.mM({CONTINUE:null,FINISH:null}),o.lB])})],"Feedback"),w=o.jV([E,o.r$({trace:o.G0([o.IX(o.Z_),o.lB])})]),f=o.dt({requireContext:o.O7,showSupplementaryQuestions:o.O7},"QuestionOptions"),y=o.jV([f,o.dt({showTrace:o.O7,multipleSelectionEnabled:o.O7,requireAllAnswers:o.O7}),o.r$({orderNumberOptions:o.jV([o.dt({delimiter:o.Z_,position:o.mM({PREFIX:null,SUFFIX:null,NONE:null})}),o.r$({replacers:o.G0([o.IX(o.Z_),o.lB])})])})],"OrderQuestionOptions"),x=o.jV([f,o.dt({multipleSelectionEnabled:o.O7}),o.G0([o.dt({displayMode:o.i0("combobox")}),o.dt({displayMode:o.i0("dragNdrop"),draggableStyle:o.Z_,dropzoneStyle:o.Z_,dropzoneHtml:o.Z_})])],"MatchingQuestionOptions"),b=o.jV([f,o.dt({displayMode:o.mM({radio:null,dragNdrop:null})})],"SingleChoiceQuestionOptions"),I=o.jV([f,o.G0([o.jV([o.dt({displayMode:o.i0("switch")}),o.r$({selectorReplacers:o.G0([o.bc([o.Z_,o.Z_]),o.lB])})]),o.dt({displayMode:o.i0("dragNdrop"),dropzoneHtml:o.Z_,dropzoneStyle:o.Z_,draggableStyle:o.Z_})])],"MultiChoiceQuestionOptions"),S=o.mM({SINGLE_CHOICE:null,MULTI_CHOICE:null,MATCHING:null,ORDER:null},"QuestionType"),C=o.Z_,_=o.dt({id:o.pk,text:C},"QuestionAnswer"),A=o.dt({attemptId:o.pk,questionId:o.pk,type:S,options:f,text:C,answers:o.IX(_),responses:o.G0([o.IX(v),o.lB]),feedback:o.G0([E,o.lB])},"QuestionBase"),N=o.jV([A,o.dt({type:o.i0("ORDER"),options:y,feedback:o.G0([w,o.lB])}),o.r$({initialTrace:o.G0([o.IX(o.Z_),o.lB])})],"OrderQuestion"),q=o.jV([A,o.dt({type:o.i0("SINGLE_CHOICE"),options:b})],"SingleChoiceQuestion"),O=o.jV([A,o.dt({type:o.i0("MULTI_CHOICE"),options:I})],"MultiChoiceQuestion"),L=o.jV([A,o.dt({type:o.i0("MATCHING"),answers:o.IX(_),groups:o.IX(_),options:x})],"MatchingQuestion"),k=o.G0([N,q,O,L],"Question"),Q=a(k),R=o.dt({id:o.pk,displayName:o.Z_,email:o.G0([o.Z_,o.lB])},"UserInfo"),T=o.jV([o.dt({forceNewAttemptCreationEnabled:o.O7,newQuestionGenerationEnabled:o.O7,supplementaryQuestionsEnabled:o.O7,correctAnswerGenerationEnabled:o.O7}),o.r$({surveyOptions:o.dt({enabled:o.O7,surveyId:o.Z_})})],"ExerciseOptions"),D=o.dt({id:o.pk,options:T},"Exercise"),P=o.mM({EN:null,RU:null,PL:null}),M=o.dt({sessionId:o.Z_,exercise:D,user:R,language:P},"SessionInfo");var $=n(7997),j=n(5974),Z=n(7967),V=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};function G(e,t){return V(this,void 0,void 0,(function*(){return console.log(`ajax get: ${e}`),yield z(e,void 0,t)}))}function H(e,t,n){return V(this,void 0,void 0,(function*(){const s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return console.log(`ajax post: ${e}`,t),yield z(e,s,n)}))}function z(e,t,n){return V(this,void 0,void 0,(function*(){const s=new $.Fetcher(e,t).handle(200,(e=>(0,j.right)(e)),n).handle(500,(e=>(0,j.left)(e))).discardRest((()=>(0,j.left)({message:"Unexpected server error"}))),[r,i]=yield s.run().catch((()=>V(this,void 0,void 0,(function*(){return[(0,j.left)({message:"Connection error"}),Z.none]}))));if(j.fold((e=>console.error(e)),(e=>console.log(e)))(r),Z.isSome(i)){const e={message:`Type inconsistency for properties of ${null==n?void 0:n.name} type: ${B(i.value).join(", ")}`};return console.error(e),(0,j.left)(e)}return r}))}const B=e=>e.map((e=>e.context.map((({key:e})=>e)).join(".")));var F;let U=F=class{static initEndpointPath(){const e=/^\/(?:.+\/(?<!\/pages\/))?/.exec(window.location.pathname);return e?`/${e[0].substring(1)}`:"/"}loadSessionInfo(){return G(`${F.endpointPath}loadSessionInfo`,M)}getQuestion(e){return G(`${F.endpointPath}getQuestion?questionId=${e}`,k)}generateQuestion(e){return G(`${F.endpointPath}generateQuestion?attemptId=${e}`,k)}generateSupplementaryQuestion(e){return H(`${F.endpointPath}generateSupplementaryQuestion`,e,Q)}generateNextCorrectAnswer(e){return G(`${F.endpointPath}generateNextCorrectAnswer?questionId=${e}`,E)}addQuestionAnswer(e){return H(`${F.endpointPath}addQuestionAnswer`,e,E)}getExistingExerciseAttempt(e){return G(`${F.endpointPath}getExistingExerciseAttempt?exerciseId=${e}`,u)}createExerciseAttempt(e){return G(`${F.endpointPath}createExerciseAttempt?exerciseId=${e}`,d)}getExerciseStatistics(e){return G(`${F.endpointPath}getExerciseStatistics?exerciseId=${e}`,m)}getExercises(){return G(`${F.endpointPath}getExercises`,o.IX(o.pk))}};U.endpointPath=F.initEndpointPath(),U=F=function(e,t,n,s){var r,i=arguments.length,o=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(i<3?r(o):i>3?r(t,n,o):r(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o}([(0,i.b2)()],U);var X=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};let W=class{loadSessionInfo(){return X(this,void 0,void 0,(function*(){return console.log("loadSessionInfo"),yield l(1e3),j.right({sessionId:"test_session",exercise:{id:-1,options:{forceNewAttemptCreationEnabled:!1,correctAnswerGenerationEnabled:!0,newQuestionGenerationEnabled:!0,supplementaryQuestionsEnabled:!0}},language:"EN",user:{id:999999,displayName:"front user",email:"test@mail.ru",roles:["ADMIN"]}})}))}getExistingExerciseAttempt(e){return X(this,void 0,void 0,(function*(){return console.log(`getExistingExerciseAttempt?exerciseId=${e}`),j.right("")}))}createExerciseAttempt(e){return X(this,void 0,void 0,(function*(){return console.log(`createExerciseAttempt?exerciseId=${e}`),yield l(3e3),j.right({attemptId:-1,exerciseId:-1,questionIds:[1,2,3,4,5,6,7]})}))}getQuestion(e){return X(this,void 0,void 0,(function*(){let t;return console.log(`getQuestion?questionId=${e}`),yield l(3e3),1===e&&(t={type:"SINGLE_CHOICE",attemptId:-1,questionId:1,text:"question text",answers:[{id:0,text:"answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:1,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:2,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "}],responses:[],feedback:null,options:{requireContext:!1,showSupplementaryQuestions:!0,displayMode:"radio"}}),2===e&&(t={type:"MULTI_CHOICE",attemptId:-1,questionId:2,text:"question text",answers:[{id:0,text:"answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:1,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:2,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "}],responses:[],feedback:null,options:{requireContext:!1,showSupplementaryQuestions:!0,displayMode:"switch"}}),3===e&&(t={type:"SINGLE_CHOICE",attemptId:-1,questionId:3,text:'question text with <span id="answer_0">select1</span> and <span id="answer_1">select2</span>',answers:[],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"radio"}}),4===e&&(t={type:"MULTI_CHOICE",attemptId:-1,questionId:4,text:'question text with <span id="answer_0"></span> and <span id="answer_1"></span>',answers:[],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"switch"}}),5===e&&(t={type:"MATCHING",attemptId:-1,questionId:5,text:"question text ",answers:[{id:0,text:"test1"},{id:1,text:"test2"},{id:3,text:"test3"}],groups:[{id:0,text:'<div style="width:70px; height: 40px;">group1<div/>'},{id:1,text:'<div style="width:50px;height: 100px;">group2 group2 group2 group2<div/>'}],responses:[],feedback:null,options:{requireContext:!1,showSupplementaryQuestions:!0,displayMode:"dragNdrop",multipleSelectionEnabled:!0,dropzoneStyle:'{ "display": "inline-block", "minHeight": "40px", "minWidth": "80px" }',dropzoneHtml:"drop",draggableStyle:'{ "padding": "10px", "border": "5px solid", "borderRadius": "5px", "borderColor": "black", "backgroundColor": "white" }'}}),6===e&&(t={type:"MATCHING",attemptId:-1,questionId:6,text:'question text with <span id="answer_0">drop</span> and <span id="answer_1">drop</span>',answers:[],groups:[{id:0,text:'<div style="width:70px; height: 40px;">group1<div/>'},{id:1,text:'<div style="width:50px;height: 100px;">group2 group2 group2 group2<div/>'}],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"dragNdrop",multipleSelectionEnabled:!1,dropzoneStyle:'{ "display": "inline-block", "minHeight": "40px", "minWidth": "80px" }',dropzoneHtml:"drop",draggableStyle:'{ "padding": "10px", "border": "5px solid", "borderRadius": "5px", "borderColor": "black", "backgroundColor": "white" }'}}),7===e&&(t={type:"MULTI_CHOICE",attemptId:-1,questionId:7,text:'question text with <span id="answer_0"></span> and <span id="answer_1"></span>',answers:[],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"dragNdrop",dropzoneStyle:'{ "display": "inline-block", "height": "20px", "width": "20px" }',dropzoneHtml:"",draggableStyle:'{ "height": "20px", "width": "20px" }'}}),t?j.right(t):j.left({message:"No such question"})}))}generateQuestion(e){return X(this,void 0,void 0,(function*(){return console.log(`generateQuestion?attemptId=${e}`),yield l(3e3),j.left({message:"Method not implemented."})}))}generateSupplementaryQuestion(e){return X(this,void 0,void 0,(function*(){return console.log("generateSupplementaryQuestion",e),yield l(3e3),j.left({message:"Method not implemented."})}))}generateNextCorrectAnswer(e){return X(this,void 0,void 0,(function*(){return console.log(`generateNextCorrectAnswer?questionId=${e}`),yield l(3e3),j.left({message:"Method not implemented."})}))}addQuestionAnswer(e){return X(this,void 0,void 0,(function*(){return console.log("addQuestionAnswer",e),yield l(3e3),j.left({message:"Method not implemented."})}))}getExerciseStatistics(e){return X(this,void 0,void 0,(function*(){return console.log(`getExerciseStatistics?exerciseId=${e}`),j.left({message:"Method not implemented."})}))}getExercises(){return X(this,void 0,void 0,(function*(){return console.log("getExercises"),j.left({message:"Method not implemented."})}))}};W=function(e,t,n,s){var r,i=arguments.length,o=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(i<3?r(o):i>3?r(t,n,o):r(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o}([(0,i.b2)()],W);var J=n(8949),K=n(427),Y=n(902),ee=function(e,t,n,s){var r,i=arguments.length,o=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(i<3?r(o):i>3?r(t,n,o):r(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o},te=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ne=class{constructor(e){this.exerciseController=e,this.isFeedbackVisible=!0,this.isQuestionFreezed=!1,this.feedback=void 0,this.question=void 0,this.lastAnswer=[],this.answersHistory=[],this.questionState="INITIAL",this.storeState={tag:"VALID"},this.onQuestionLoaded=e=>{var t,n;e.options.requireContext&&(e.text=e.text.replaceAll(/(\<.*?\sid\s*?\=([\'\"]))\s*(answer_\d+?\2)(.*?\>)/gim,`$1question_${e.questionId}_$3$4`)),this.question=e,this.feedback=null!==(t=e.feedback)&&void 0!==t?t:void 0,this.isFeedbackVisible=!0,this.answersHistory=[],this.lastAnswer=null!==(n=e.responses)&&void 0!==n?n:[],e.feedback&&0===e.feedback.stepsLeft&&this.setQuestionState("COMPLETED")},this.setQuestionState=e=>{this.questionState!==e&&(this.questionState=e)},this.setValidStoreState=()=>{"VALID"!==this.storeState.tag&&(this.storeState={tag:"VALID"})},this.setErrorStoreState=e=>{this.storeState={tag:"ERROR",error:e}},this.loadQuestion=(0,J.ls)((function*(e){this.setValidStoreState(),this.setQuestionState("LOADING");const t=yield this.exerciseController.getQuestion(e);this.setQuestionState("LOADED"),j.isLeft(t)?this.setErrorStoreState(t.left):this.onQuestionLoaded(t.right)})),this.generateQuestion=(0,J.ls)((function*(e){this.setValidStoreState(),this.setQuestionState("LOADING");const t=yield this.exerciseController.generateQuestion(e);this.setQuestionState("LOADED"),j.isLeft(t)?this.setErrorStoreState(t.left):this.onQuestionLoaded(t.right)})),this.generateSupplementaryQuestion=(0,J.ls)((function*(e,t,n){this.setValidStoreState();const s={exerciseAttemptId:e,questionId:t,violationLaws:(0,Y.pipe)(K.fromArray(n),Z.getOrElse((()=>["invalid_law"])))};this.setQuestionState("LOADING");const r=yield this.exerciseController.generateSupplementaryQuestion(s);this.setQuestionState("LOADED"),j.isLeft(r)?this.setErrorStoreState(r.left):r.right&&this.onQuestionLoaded(r.right)})),this.generateNextCorrectAnswer=(0,J.ls)((function*(){const{question:e}=this;if(!e)throw new Error("Current question not found");this.setValidStoreState(),this.setQuestionState("ANSWER_EVALUATING");const t=yield this.exerciseController.generateNextCorrectAnswer(e.questionId);this.setQuestionState("LOADED"),j.isLeft(t)?this.setErrorStoreState(t.left):this.onAnswerEvaluated(t.right)})),this.sendAnswersImpl=(0,J.ls)((function*(e,t,n){const s=(0,J.ZN)({attemptId:e,questionId:t,answers:(0,J.ZN)([...n])});this.setValidStoreState(),this.setQuestionState("ANSWER_EVALUATING");const r=yield this.exerciseController.addQuestionAnswer(s);this.setQuestionState("LOADED"),j.isLeft(r)?this.setErrorStoreState(r.left):this.onAnswerEvaluated(r.right)})),this.sendAnswers=(0,J.ls)((function*(){const{question:e,lastAnswer:t}=this;e&&(yield this.sendAnswersImpl(e.attemptId,e.questionId,(0,J.ZN)(t)))})),this.onAnswersChanged=(0,J.ls)((function*(e,t=!0){if(this.answersHistory.push(e),t)try{yield this.sendAnswers()}catch(e){this.answersHistory.pop()}})),this.setFullAnswer=(0,J.ls)((function*(e,t=!0){if(!this.isAnswerChanged(e))return!1;const n=this.lastAnswer;if(this.lastAnswer=e,n.length>0&&this.answersHistory.push(n),!t)return!0;try{return yield this.sendAnswers(),!0}catch(e){return this.lastAnswer=n,n.length>0&&this.answersHistory.pop(),!1}})),this.isAnswerChanged=e=>{const{lastAnswer:t,question:n}=this;if(!n)throw new Error("no question");const s=t.map((e=>e.answer)),r=e.map((e=>e.answer));switch(n.type){case"ORDER":return r.length!==s.length||JSON.stringify(r)!==JSON.stringify(s);case"MATCHING":case"MULTI_CHOICE":case"SINGLE_CHOICE":return r.length!==s.length||JSON.stringify(r.sort())!==JSON.stringify(s.sort())}},(0,J.rC)(this)}onAnswerEvaluated(e){this.feedback=e,this.isFeedbackVisible=!0,e&&e.correctAnswers&&(this.setFullAnswer(e.correctAnswers,!1),c(e.stepsLeft)&&0===e.stepsLeft&&this.setQuestionState("COMPLETED"))}};var se,re;ee([J.LO,te("design:type",Boolean)],ne.prototype,"isFeedbackVisible",void 0),ee([J.LO,te("design:type",Boolean)],ne.prototype,"isQuestionFreezed",void 0),ee([J.LO,te("design:type",Object)],ne.prototype,"feedback",void 0),ee([J.LO,te("design:type",Object)],ne.prototype,"question",void 0),ee([J.LO,te("design:type",Array)],ne.prototype,"lastAnswer",void 0),ee([J.LO,te("design:type",Array)],ne.prototype,"answersHistory",void 0),ee([J.LO,te("design:type",String)],ne.prototype,"questionState",void 0),ee([J.LO,te("design:type",Object)],ne.prototype,"storeState",void 0),ee([J.aD,te("design:type",Object)],ne.prototype,"setQuestionState",void 0),ee([J.aD,te("design:type",Object)],ne.prototype,"setValidStoreState",void 0),ee([J.aD,te("design:type",Object)],ne.prototype,"setErrorStoreState",void 0),ne=ee([(0,i.b2)(),(se=0,re=(0,i.f3)(U),function(e,t){re(e,t,se)}),te("design:paramtypes",[Object])],ne);var ie=n(7581);const oe=o.G0([o.dt({kind:o.i0("AFTER_FIRST")}),o.dt({kind:o.i0("AFTER_LAST")}),o.dt({kind:o.i0("AFTER_EACH")}),o.dt({kind:o.i0("AFTER_SPECIFIC"),numbers:o.IX(o.pk)})]),ae=o.dt({id:o.pk,type:o.i0("yes-no"),text:o.Z_,policy:oe,required:o.O7,options:o.dt({yesText:o.Z_,yesValue:o.Z_,noText:o.Z_,noValue:o.Z_})},"YesNoSurveyQuestion"),le=o.dt({id:o.pk,type:o.i0("single-choice"),text:o.Z_,policy:oe,required:o.O7,options:o.IX(o.dt({id:o.Z_,text:o.Z_}))}),ce=o.dt({id:o.pk,type:o.i0("open-ended"),text:o.Z_,policy:oe,required:o.O7}),de=o.G0([ae,le,ce]),ue=o.dt({surveyId:o.Z_,options:o.dt({}),questions:o.IX(de)},"Survey"),pe=o.dt({surveyQuestionId:o.pk,questionId:o.pk,answer:o.Z_});var me=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};let ve=class{constructor(){this.surveyCache={}}getSurvey(e){return me(this,void 0,void 0,(function*(){if(this.surveyCache[e])return j.right(this.surveyCache[e]);var t=yield G(`/survey/${e}`,ue);return j.isRight(t)&&(this.surveyCache[e]=t.right),t}))}postSurveyAnswer(e,t,n){return me(this,void 0,void 0,(function*(){return H("/survey",{surveyQuestionId:e,questionId:t,answer:n})}))}getCurrentUserAttemptSurveyVotes(e,t){return me(this,void 0,void 0,(function*(){return G(`/survey/${encodeURIComponent(e)}/user-votes?attemptId=${t}`,o.IX(pe))}))}};ve=function(e,t,n,s){var r,i=arguments.length,o=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(i<3?r(o):i>3?r(t,n,o):r(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o}([(0,i.b2)()],ve);var ge=function(e,t,n,s){var r,i=arguments.length,o=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(i<3?r(o):i>3?r(t,n,o):r(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o},he=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ee=function(e,t){return function(n,s){t(n,s,e)}},we=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};let fe=class{constructor(e,t,n){this.exerciseController=e,this.surveyController=t,this.isSessionLoading=!1,this.sessionInfo=void 0,this.currentAttempt=void 0,this.survey=void 0,this.registerOnStrategyDecisionChangedAction=()=>{(0,J.EH)((()=>{var e;"FINISH"===(null===(e=this.currentQuestion.feedback)||void 0===e?void 0:e.strategyDecision)&&"COMPLETED"!==this.exerciseState&&this.setExerciseState("COMPLETED")}))},this.forceSetValidState=()=>{"VALID"!==this.storeState.tag&&(this.storeState={tag:"VALID"})},this.setExerciseState=e=>{this.exerciseState!==e&&(this.exerciseState=e)},this.setSurveyAnswers=(e,t)=>{this.survey&&(0,J.z)((()=>{this.survey.questions[e].status="COMPLETED",this.survey.questions[e].results=t}))},this.loadSessionInfo=(0,J.ls)((function*(){if(this.sessionInfo)throw new Error("Session exists");if(this.isSessionLoading)return;this.forceSetValidState(),this.isSessionLoading=!0;const e=yield this.exerciseController.loadSessionInfo();this.isSessionLoading=!1,j.isLeft(e)?this.storeState={tag:"ERROR",error:e.left}:this.onSessionLoaded(e.right)})),this.loadExistingExerciseAttempt=(0,J.ls)((function*(){const{sessionInfo:e}=this;if(!e)throw new Error("Session is not defined");this.forceSetValidState();const t=e.exercise.id,n=yield this.exerciseController.getExistingExerciseAttempt(t);if(j.isLeft(n))return void(this.storeState={tag:"ERROR",error:n.left});const s=n.right;return!!s&&(this.currentAttempt=s,yield this.onAttemptLoaded(),!0)})),this.onAttemptLoaded=()=>we(this,void 0,void 0,(function*(){yield this.loadSurvey()})),this.createExerciseAttempt=(0,J.ls)((function*(){const{sessionInfo:e}=this;if(!e)throw new Error("Session is not defined");this.forceSetValidState();const t=e.exercise.id,n=yield this.exerciseController.createExerciseAttempt(+t);j.isLeft(n)?this.storeState={tag:"ERROR",error:n.left}:(this.currentAttempt=n.right,yield this.onAttemptLoaded())})),this.generateQuestion=(0,J.ls)((function*(){var e,t;const{sessionInfo:n,currentAttempt:s}=this;if(!n||!s)throw new Error("Session is not defined");this.forceSetValidState(),yield this.currentQuestion.generateQuestion(s.attemptId),s.questionIds.push(null!==(t=null===(e=this.currentQuestion.question)||void 0===e?void 0:e.questionId)&&void 0!==t?t:-1)})),this.changeLanguage=e=>{this.sessionInfo&&this.sessionInfo.language!==e&&(this.sessionInfo.language=e,ie.Z.changeLanguage(e))},this.loadSurvey=()=>we(this,void 0,void 0,(function*(){var e;if(this.survey||!this.currentAttempt||!this.sessionInfo)return;if(!(null===(e=this.sessionInfo.exercise.options.surveyOptions)||void 0===e?void 0:e.enabled)||0===this.sessionInfo.exercise.options.surveyOptions.surveyId.length)return;const t=this.sessionInfo.exercise.options.surveyOptions.surveyId,n=this.currentAttempt.attemptId,[s,r]=yield Promise.all([this.surveyController.getSurvey(t),this.surveyController.getCurrentUserAttemptSurveyVotes(t,n)]);(0,J.z)((()=>{if(j.isRight(s)&&j.isRight(r)){const e=function(e,t){const n=new Map;return e.forEach((e=>{const t=e.questionId,s=n.get(t);s?s.push(e):n.set(t,[e])})),n}(r.right);this.survey={survey:s.right,questions:[...e.keys()].map((t=>{var n,s,r,i;return{questionId:t,status:"COMPLETED",questions:null!==(s=null===(n=e.get(t))||void 0===n?void 0:n.map((e=>e.surveyQuestionId)))&&void 0!==s?s:[],results:null!==(i=null===(r=e.get(t))||void 0===r?void 0:r.reduce(((e,t)=>(e[t.surveyQuestionId]=t.answer,e)),{}))&&void 0!==i?i:{}}})).reduce(((e,t)=>(e[t.questionId]=t,e)),{})},console.log("Loaded survey"),console.log((0,J.ZN)(this.survey))}}))})),this.ensureQuestionSurveyExists=e=>{var t,n,s;if(null===(t=this.survey)||void 0===t?void 0:t.questions[e])return null===(n=this.survey)||void 0===n?void 0:n.questions[e].questions;const r=[],i=this.currentAttempt.questionIds.findIndex((e=>{var t;return e===(null===(t=this.currentQuestion.question)||void 0===t?void 0:t.questionId)}));for(let e of(null===(s=this.survey)||void 0===s?void 0:s.survey.questions)||[]){const t=e.policy;("AFTER_EACH"===t.kind||"AFTER_FIRST"===t.kind&&0===i||"AFTER_LAST"===t.kind&&"COMPLETED"===this.exerciseState||"AFTER_SPECIFIC"===t.kind&&t.numbers.includes(i+1))&&r.push(e)}console.log("Selected questions"),console.log((0,J.ZN)(r));var o={questionId:e,status:"ACTIVE",questions:r.map((e=>e.id)),results:{}};return(0,J.z)((()=>{this.survey.questions[e]=o})),r.map((e=>e.id))},CompPh.exerciseLaunchError?(this.exerciseState="LAUNCH_ERROR",this.storeState={tag:"ERROR",error:{message:CompPh.exerciseLaunchError}}):(this.exerciseState="INITIAL",this.storeState={tag:"VALID"}),this.currentQuestion=n,(0,J.rC)(this),this.registerOnStrategyDecisionChangedAction()}onSessionLoaded(e){this.sessionInfo=e,this.sessionInfo.language!==ie.Z.language&&ie.Z.changeLanguage(this.sessionInfo.language)}};ge([J.LO,he("design:type",Boolean)],fe.prototype,"isSessionLoading",void 0),ge([J.LO,he("design:type",Object)],fe.prototype,"sessionInfo",void 0),ge([J.LO,he("design:type",Object)],fe.prototype,"currentAttempt",void 0),ge([J.LO,he("design:type",ne)],fe.prototype,"currentQuestion",void 0),ge([J.LO,he("design:type",String)],fe.prototype,"exerciseState",void 0),ge([J.LO,he("design:type",Object)],fe.prototype,"storeState",void 0),ge([J.LO,he("design:type",Object)],fe.prototype,"survey",void 0),ge([J.aD,he("design:type",Object)],fe.prototype,"forceSetValidState",void 0),ge([J.aD,he("design:type",Object)],fe.prototype,"setExerciseState",void 0),ge([J.aD,he("design:type",Object)],fe.prototype,"setSurveyAnswers",void 0),ge([J.aD,he("design:type",Object)],fe.prototype,"changeLanguage",void 0),ge([J.aD,he("design:type",Object)],fe.prototype,"loadSurvey",void 0),ge([J.aD,he("design:type",Object)],fe.prototype,"ensureQuestionSurveyExists",void 0),fe=ge([(0,i.b2)(),Ee(0,(0,i.f3)(U)),Ee(1,(0,i.f3)(ve)),Ee(2,(0,i.f3)(ne)),he("design:paramtypes",[Object,ve,ne])],fe);var ye=n(5397);const xe=o.dt({id:o.pk,name:o.Z_}),be=o.dt({name:o.Z_,kind:o.mM({FORBIDDEN:null,PERMITTED:null,TARGETED:null})}),Ie=o.dt({name:o.Z_,kind:o.mM({FORBIDDEN:null,PERMITTED:null,TARGETED:null})}),Se=o.dt({id:o.pk,name:o.Z_,domainId:o.Z_,strategyId:o.Z_,backendId:o.Z_,complexity:o.pk,answerLength:o.pk,concepts:o.IX(be),laws:o.IX(Ie)}),Ce=o.dt({name:o.Z_});var _e;!function(e){e[e.VisibleToTeacher=1]="VisibleToTeacher",e[e.TargetEnabled=2]="TargetEnabled"}(_e||(_e={}));const Ae=o.dt({name:o.Z_,displayName:o.Z_,bitflags:o.pk}),Ne=o.dt({id:o.Z_,name:o.Z_,laws:o.IX(Ce),concepts:o.IX(Ae)});var qe;let Oe=qe=class{static initEndpointPath(){const e=/^\/(?:.+\/(?<!\/pages\/))?/.exec(window.location.pathname);return e?`/${e[0].substring(1)}`:"/"}getAllExercises(){return G(`${qe.endpointPath}exercise/all`,o.IX(xe))}getExercise(e){return G(`${qe.endpointPath}exercise?id=${encodeURIComponent(e)}`,Se)}getStrategies(){return G(`${qe.endpointPath}refTables/strategies`,o.IX(o.Z_))}getBackends(){return G(`${qe.endpointPath}refTables/backends`,o.IX(o.Z_))}getDomains(){return G(`${qe.endpointPath}refTables/domains`,o.IX(Ne))}getDomainLaws(e){return G(`${qe.endpointPath}refTables/domainLaws?domaindId=${encodeURIComponent(e)}`,o.IX(o.Z_))}getDomainConcepts(e){return G(`${qe.endpointPath}refTables/domainConcepts?domaindId=${encodeURIComponent(e)}`,o.IX(o.Z_))}};Oe.endpointPath=qe.initEndpointPath(),Oe=qe=function(e,t,n,s){var r,i=arguments.length,o=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(i<3?r(o):i>3?r(t,n,o):r(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o}([(0,i.b2)()],Oe),i.nC.register(U,{useFactory:()=>{var e;return null!==(null!==(e=new URLSearchParams(window.location.search).get("sandbox"))&&void 0!==e?e:null)?new W:new U}}),i.nC.register(ne,ne),i.nC.registerSingleton(fe),i.nC.registerSingleton(ve),i.nC.registerSingleton(Oe),ie.Z.use(ye.Db).init({resources:{EN:{translation:{question_header:"Question",language_header:"Language",signedin_as_header:"Signed in as",nextCorrectAnswerBtn:"I'm confused, tell me the next correct step",generateNextQuestion_nextQuestion:"Next question",generateNextQuestion_warning:"Warning",generateNextQuestion_continueAttempt:"Continue attempt",generateNextQuestion_modalMessage1:"It is recommended to move on to the next question only after solving all the previous ones.",generateNextQuestion_modalMessage2:"Are you sure you want to move on to the next question?",generateSupQuestion_gotit:"Got it",generateSupQuestion_details:"More details",grade_feeback:"Grade",correctsteps_feeback:"Correct steps",stepswitherrors_feeback:"Steps with errors",stepsleft_feeback:"Steps left",issolved_feeback:"Solved",foundExisitingAttempt_title:"Found existing attempt",foundExisitingAttempt_descr:"Would you like to continue the existing attempt or start a new one",foundExisitingAttempt_continueattempt:"Continue",foundExisitingAttempt_newattempt:"New",exercise_completed:"Exercise completed"}},RU:{translation:{question_header:"Вопрос",language_header:"Язык",signedin_as_header:"Пользователь",nextCorrectAnswerBtn:"Я в замешательстве, подскажи следующий корректный шаг",generateNextQuestion_nextQuestion:"Следующий вопрос",generateNextQuestion_warning:"Предупреждение",generateNextQuestion_continueAttempt:"Продолжить попытку",generateNextQuestion_modalMessage1:"Рекомендуется переходить к следующему вопросу только после решения всех предыдущих.",generateNextQuestion_modalMessage2:"Вы действительно хотите перейти к следующему вопросу?",generateSupQuestion_gotit:"Понятно",generateSupQuestion_details:"Разобраться подробнее",grade_feeback:"Оценка",correctsteps_feeback:"Правильных шагов",stepswitherrors_feeback:"Шагов с ошибками",stepsleft_feeback:"Шагов осталось",issolved_feeback:"Задача решена",foundExisitingAttempt_title:"Найдена неоконченная попытка",foundExisitingAttempt_descr:"Вы хотите продолжить существующую попытку или начать новую",foundExisitingAttempt_continueattempt:"Продолжить",foundExisitingAttempt_newattempt:"Новая",exercise_completed:"Упражнение завершено"}},PL:{translation:{question_header:"Pytanie",language_header:"Język",signedin_as_header:"Zalogowany jako",nextCorrectAnswerBtn:"Nie wiem co robić dalej, podpowiedz mi następny poprawny krok",generateNextQuestion_nextQuestion:"Następne pytanie",generateNextQuestion_warning:"Ostrzeżenie",generateNextQuestion_continueAttempt:"Kontynuuj podejście",generateNextQuestion_modalMessage1:"Zaleca się przejście do następnego pytania dopiero po rozwiązaniu wszystkich poprzednich.",generateNextQuestion_modalMessage2:"Czy na pewno chcesz przejść do następnego pytania?",generateSupQuestion_gotit:"Oczywiście!",generateSupQuestion_details:"Zobacz szczegóły",grade_feeback:"Ocena",correctsteps_feeback:"Poprawne kroki",stepswitherrors_feeback:"Kroki z błędami",stepsleft_feeback:"Pozostałe kroki",issolved_feeback:"Rozwiązane",foundExisitingAttempt_title:"Znaleziono już istniejące podejście",foundExisitingAttempt_descr:"Czy chcesz kontynuować dotychczasowe podejście, czy rozpocząć nowe",foundExisitingAttempt_continueattempt:"Kontynuuj",foundExisitingAttempt_newattempt:"Nowe",exercise_completed:"Ćwiczenie zakończone"}}},lng:"EN",interpolation:{escapeValue:!1}});var Le=n(3727),ke=n(5977),Qe=n(150),Re=n(5005),Te=n(5443),De=n(6966);const Pe=e=>{const{isVisible:t,children:n}=e;return t?r.createElement(r.Fragment,null,n):null},Me=e=>{const{title:t,primaryBtnTitle:n,handlePrimaryBtnClicked:s,secondaryBtnTitle:i,handleSecondaryBtnClicked:o,children:a,closeButton:l,show:d,handleClose:u,type:p,size:m}=e;return r.createElement(Pe,{isVisible:null==d||d},r.createElement($e,{type:null!=p?p:"MODAL",show:null==d||d,onHide:u,size:m},r.createElement(Pe,{isVisible:c(t)&&t.length>0},r.createElement(De.Z.Header,{closeButton:l},r.createElement(De.Z.Title,null,t))),r.createElement(De.Z.Body,null,a),i||n?r.createElement(De.Z.Footer,null,i&&r.createElement(Re.Z,{variant:"secondary",onClick:o},i),n&&r.createElement(Re.Z,{variant:"primary",onClick:s},n)):null))},$e=e=>{const{type:t,show:n,onHide:s,children:i,size:o}=e;return"DIALOG"===t?r.createElement(De.Z.Dialog,{size:o},i):r.createElement(De.Z,{size:o,show:n,onHide:s},i)};var je=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const Ze=(0,Qe.Pi)((()=>{var e;const[t]=(0,r.useState)((()=>i.nC.resolve(fe))),{t:n}=(0,Te.$)(),[s,o]=(0,r.useState)(!1);if(!(null===(e=t.sessionInfo)||void 0===e?void 0:e.exercise.options.newQuestionGenerationEnabled))return null;const{sessionInfo:a,currentAttempt:l}=t,{question:c}=t.currentQuestion,d="ANSWER_EVALUATING"===t.currentQuestion.questionState,u="LOADING"===t.currentQuestion.questionState;if(!c||!a||!l||u||d)return null;const p=()=>{o(!1)},m=()=>je(void 0,void 0,void 0,(function*(){o(!1);const{questionIds:e=[]}=l,n=e.indexOf(c.questionId);n===e.length-1?yield t.generateQuestion():yield t.currentQuestion.loadQuestion(e[n+1])}));return r.createElement(r.Fragment,null,r.createElement(Re.Z,{onClick:()=>je(void 0,void 0,void 0,(function*(){var e;const{questionIds:n=[]}=l,s=n.indexOf(c.questionId)===n.length-1;0!==(null===(e=t.currentQuestion.feedback)||void 0===e?void 0:e.stepsLeft)&&s?o(!0):yield m()})),variant:"primary"},n("generateNextQuestion_nextQuestion")),r.createElement(Me,{show:s,title:n("generateNextQuestion_warning"),type:"MODAL",size:"lg",primaryBtnTitle:n("generateNextQuestion_continueAttempt"),handlePrimaryBtnClicked:p,secondaryBtnTitle:n("generateNextQuestion_nextQuestion"),handleSecondaryBtnClicked:m,closeButton:!1,handleClose:p},r.createElement("div",null,n("generateNextQuestion_modalMessage1")),r.createElement("div",null,n("generateNextQuestion_modalMessage2"))))}));var Ve=n(8889),Ge=n(8966);const He=(0,Qe.Pi)((()=>{var e,t;const[n]=(0,r.useState)((()=>i.nC.resolve(fe)));if(!n.currentQuestion.question||!n.currentAttempt)return null;const{questionId:s}=n.currentQuestion.question,o=n.currentAttempt.questionIds.map(((e,t)=>({id:e,number:t+1})));if(0===o.length)return null;const a=null!==(t=null===(e=o.find((e=>e.id===s)))||void 0===e?void 0:e.number)&&void 0!==t?t:-1,l=a-5<=0?"BEGIN":a+5>o.length?"END":"MIDDLE",c=Math.floor(2.5);return r.createElement("div",{className:"d-flex justify-content-center"},r.createElement(Ge.Z,{className:"p-3",style:{marginBottom:"0 !important"}},r.createElement(Pe,{isVisible:o.length<=10},o.map((e=>r.createElement(Ge.Z.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number)))),r.createElement(Pe,{isVisible:o.length>10},r.createElement(Ge.Z.First,{disabled:s===o[0].id,onClick:()=>n.currentQuestion.loadQuestion(o[0].id)}),r.createElement(Ge.Z.Prev,{disabled:s===o[0].id,onClick:()=>n.currentQuestion.loadQuestion(o[o.findIndex((e=>s===e.id))-1].id)}),r.createElement(Pe,{isVisible:"BEGIN"===l},o.filter((e=>e.number<=7)).map((e=>r.createElement(Ge.Z.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number))),r.createElement(Ge.Z.Ellipsis,{disabled:!0}),r.createElement(Ge.Z.Item,{key:o[o.length-1].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(o[o.length-1].id)},o[o.length-1].number)),r.createElement(Pe,{isVisible:"MIDDLE"===l},r.createElement(Ge.Z.Item,{key:o[0].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(o[0].id)},o[0].number),r.createElement(Ge.Z.Ellipsis,{disabled:!0}),o.filter((e=>e.number>=a-c&&e.number<=a+c)).map((e=>r.createElement(Ge.Z.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number))),r.createElement(Ge.Z.Ellipsis,{disabled:!0}),r.createElement(Ge.Z.Item,{key:o[o.length-1].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(o[o.length-1].id)},o[o.length-1].number)),r.createElement(Pe,{isVisible:"END"===l},r.createElement(Ge.Z.Item,{key:o[0].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(o[0].id)},o[0].number),r.createElement(Ge.Z.Ellipsis,{disabled:!0}),o.filter((e=>e.number>o.length-7)).map((e=>r.createElement(Ge.Z.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number)))),r.createElement(Ge.Z.Next,{disabled:s===o[o.length-1].id,onClick:()=>n.currentQuestion.loadQuestion(o[o.findIndex((e=>s===e.id))+1].id)}),r.createElement(Ge.Z.Last,{disabled:s===o[o.length-1].id,onClick:()=>n.currentQuestion.loadQuestion(o[o.length-1].id)}))))})),ze=(0,Qe.Pi)((()=>{const[e]=(0,r.useState)((()=>i.nC.resolve(fe))),{t,i18n:n}=(0,Te.$)(),{currentAttempt:s,sessionInfo:o,currentQuestion:a}=e;if(!s||!o)return null;const{user:l}=o,c=s.questionIds.findIndex((e=>{var t;return(null===(t=a.question)||void 0===t?void 0:t.questionId)===e}));return r.createElement(Ve.Z,{className:"px-0"},r.createElement(Pe,{isVisible:-1!==c},r.createElement("h5",null,t("question_header")," #",c+1)),r.createElement(Ve.Z.Collapse,{className:"justify-content-end"},r.createElement(He,null),r.createElement(Ve.Z.Text,{className:"px-2"},t("language_header"),": ",r.createElement("a",{href:"#"},o.language)),r.createElement(Ve.Z.Toggle,null),r.createElement(Ve.Z.Text,{className:"px-2"},t("signedin_as_header"),": ",r.createElement("a",{href:"#"},l.displayName))))}));var Be=n(6968);const Fe=e=>{var t;const n=null!==(t=e.delay)&&void 0!==t?t:0,[s,i]=(0,r.useState)(0===n);return(0,r.useEffect)((()=>{n>0&&setTimeout((()=>!s&&i(!0)),n)})),s?r.createElement(Be.Z,{animation:"border",variant:"primary"}):null},Ue=e=>{const{children:t,isLoading:n}=e;return n?r.createElement(Fe,Object.assign({},e)):r.createElement(r.Fragment,null,t)},Xe=(0,Qe.Pi)((()=>{var e;const[t]=(0,r.useState)((()=>i.nC.resolve(fe))),{t:n}=(0,Te.$)();if(!(null===(e=t.sessionInfo)||void 0===e?void 0:e.exercise.options.correctAnswerGenerationEnabled))return null;const{sessionInfo:s,currentAttempt:o,currentQuestion:a}=t,{question:l,feedback:c}=a,d="ANSWER_EVALUATING"===a.questionState,u="LOADING"===a.questionState;return l&&s&&o&&!d&&!u&&0!==(null==c?void 0:c.stepsLeft)?r.createElement(Re.Z,{onClick:()=>{t.currentQuestion.generateNextCorrectAnswer()},variant:"primary"},n("nextCorrectAnswerBtn")):null}));var We=n(4320),Je=n(9970),Ke=n(1208),Ye=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n};const et=(0,Qe.Pi)((e=>{const{question:t}=e,{options:n}=t;switch(!0){case"combobox"===n.displayMode&&!n.requireContext:return r.createElement(nt,Object.assign({},e));case"combobox"===n.displayMode&&n.requireContext:return r.createElement(st,Object.assign({},e));case"dragNdrop"===n.displayMode:return r.createElement(tt,Object.assign({},e))}return r.createElement("div",null,"Not Implemented")})),tt=(0,Qe.Pi)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;if("dragNdrop"!==t.options.displayMode)return null;const{groups:i=[]}=t,{options:o}=t,a=o.dropzoneStyle&&JSON.parse(o.dropzoneStyle)||{},l=o.dropzoneStyle&&JSON.parse(o.draggableStyle)||{};return(0,r.useEffect)((()=>{document.querySelectorAll(`[id^="question_${t.questionId}_answer_"]`).forEach((e=>{e.classList.add("comp-ph-dropzone"),Object.keys(a).forEach((t=>e.style[t]=a[t])),e.innerHTML=`<div class="comp-ph-dropzone-placeholder">${o.dropzoneHtml}</div>`}));const e=new We.Droppable(document.querySelectorAll(".comp-ph-droppable-container"),{draggable:".comp-ph-draggable",dropzone:".comp-ph-dropzone",plugins:[We.Plugins.ResizeMirror],mirror:{constrainDimensions:!0}});e.on("drag:over",(()=>console.log("is out"))),e.on("droppable:stop",(e=>{var r,i,a,l,c,d,u;const p=null===(l=null===(a=null===(i=null===(r=null==e?void 0:e.data)||void 0===r?void 0:r.dragEvent)||void 0===i?void 0:i.data)||void 0===a?void 0:a.source)||void 0===l?void 0:l.id,m=null===(d=null===(c=null==e?void 0:e.data)||void 0===c?void 0:c.dropzone)||void 0===d?void 0:d.id;if(p&&m){if(o.multipleSelectionEnabled){const e=`dragAnswerWrapper_${null!==(u=p.split("_")[1])&&void 0!==u?u:""}`,t=document.getElementById(e),n=document.getElementById(p);e!==m&&t&&n&&(t.innerHTML=n.outerHTML)}setTimeout((()=>{const e=[...document.querySelectorAll(`[id^="question_${t.questionId}_answer_"] > [id^="dragAnswer_"]`)].map((e=>{var n,s,r;return[+(null!==(s=null===(n=e.parentElement)||void 0===n?void 0:n.id.split(`question_${t.questionId}_answer_`)[1])&&void 0!==s?s:""),+(null!==(r=null==e?void 0:e.id.split("dragAnswer_")[1])&&void 0!==r?r:"")]})),r=n();s(e.map((e=>{var t,n;return{answer:e,isСreatedByUser:null===(n=null===(t=r.find((t=>t.answer[0]===e[0]&&t.answer[1]===e[1])))||void 0===t?void 0:t.isСreatedByUser)||void 0===n||n}})))}),10)}}))}),[t.questionId]),r.createElement("div",null,r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md"},o.requireContext?r.createElement("p",{className:"comp-ph-droppable-container comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}}):r.createElement("p",{className:"d-flex flex-column comp-ph-droppable-container comp-ph-question-text"},t.answers.map((e=>r.createElement("div",{className:"d-flex flex-row mb-3"},r.createElement("div",{className:"mr-2 mt-1"},r.createElement("div",{id:`question_${t.questionId}_answer_${e.id}`})),r.createElement("div",{dangerouslySetInnerHTML:{__html:e.text}})))))),r.createElement("div",{className:"col-md comp-ph-droppable-container d-flex justify-content-start align-items-start flex-column"},i.map((e=>r.createElement("div",{id:`dragAnswerWrapper_${e.id}`,className:"comp-ph-dropzone mb-2",style:a},r.createElement("div",{className:"comp-ph-dropzone-placeholder",dangerouslySetInnerHTML:{__html:o.dropzoneHtml}}),r.createElement("div",{id:`dragAnswer_${e.id}`,className:"comp-ph-draggable",style:l,dangerouslySetInnerHTML:{__html:e.text}})))))))})),nt=(0,Qe.Pi)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;if("combobox"!==t.options.displayMode)return null;const{groups:i=[]}=t,o=i.reduce(((e,t)=>t.text.length>e?t.text.length:e),0);return r.createElement("div",null,r.createElement("p",{className:"mb-5 comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}}),r.createElement("div",null,t.answers.map((e=>{var a,l,c;return r.createElement("div",{className:"row mb-3"},r.createElement("div",{className:"col-md-6",dangerouslySetInnerHTML:{__html:t.text}}),r.createElement("div",{className:"col-md-auto"},r.createElement("div",{style:{width:8*o+100+"px"}},r.createElement(Je.ZP,{defaultValue:null!==(c=null===(l=null===(a=n().find((t=>t.answer[0]===e.id)))||void 0===a?void 0:a.answer)||void 0===l?void 0:l[1])&&void 0!==c?c:null,options:i.map((e=>({value:e.id,label:e.text}))),components:{Option:rt,SingleValue:it},onChange:t=>{if(!t)return;const r=n().filter((t=>t.answer[0]!==e.id)),i=[...r,{answer:[e.id,+t.value],isСreatedByUser:!0}];s(i)}}))))}))))})),st=(0,Qe.Pi)((e=>{const{question:t,getAnswers:n,onChanged:i}=e;if("combobox"!==t.options.displayMode)return null;const{groups:o=[],options:a}=t;return(0,r.useEffect)((()=>{document.querySelectorAll(`[id^="question_${t.questionId}_answer_"]`).forEach((e=>{var a;const l=+(null===(a=e.id)||void 0===a?void 0:a.split(`question_${t.questionId}_answer_`)[1]),c=r.createElement(Je.ZP,{options:o.map((e=>({value:e.id,label:e.text}))),components:{Option:rt,SingleValue:it},onChange:e=>{if(!e)return;const t=n().filter((e=>e.answer[0]!==l)),s=[...t,{answer:[l,+e.value],isСreatedByUser:!0}];i(s)}});s.render(c,e)}))}),[t.questionId]),r.createElement("div",null,r.createElement("p",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}}))})),rt=e=>{const{innerRef:t,innerProps:n,children:s}=e,i=Ye(e,["innerRef","innerProps","children"]);return r.createElement(Ke.c.Option,Object.assign({},i),r.createElement("div",Object.assign({ref:t},n,{dangerouslySetInnerHTML:{__html:e.label}})))},it=e=>{var t;const{innerRef:n,innerProps:s,children:i}=e,o=Ye(e,["innerRef","innerProps","children"]);return r.createElement(Ke.c.SingleValue,Object.assign({},o),null===(t=e.getValue())||void 0===t?void 0:t.map((e=>r.createElement("div",Object.assign({ref:n},s,{dangerouslySetInnerHTML:{__html:e.label}})))))},ot=({id:e,title:t,onChange:n,isChecked:s,style:i})=>r.createElement("label",{htmlFor:e,onClick:()=>n(t),style:s&&i||void 0},t.split(/\s+/).map((e=>e[0].toUpperCase()+e.slice(1))).join(" ")),at=({id:e,value:t,name:n,selected:s})=>r.createElement("input",{id:e,type:"radio",name:n,checked:s===t,readOnly:!0}),lt=e=>{const[t,n]=(0,r.useState)(e.selected),s=t=>{var s;n(t),null===(s=e.onChange)||void 0===s||s.call(e,t)};return r.createElement("div",{id:e.id,className:"switch-field d-inline-flex flex-row"},e.values.map(((n,i)=>{var o,a;return r.createElement("span",null,r.createElement(at,{id:`${e.id}_${n}_checkbox`,name:`${e.id}_switch`,value:n,selected:t}),r.createElement(ot,{id:`${e.id}_${n}_checkbox`,isChecked:n===t,title:n,onChange:s,style:null!==(a=null===(o=e.valueStyles)||void 0===o?void 0:o[i])&&void 0!==a?a:void 0}))})))},ct=(0,Qe.Pi)((e=>{const{question:t}=e,{options:n}=t;switch(!0){case"switch"==n.displayMode&&!n.requireContext:return r.createElement(dt,Object.assign({},e));case"switch"===n.displayMode&&n.requireContext:return r.createElement(ut,Object.assign({},e));case"dragNdrop"===n.displayMode:return r.createElement(pt,Object.assign({},e))}return r.createElement("div",null,"Not implemented")})),dt=(0,Qe.Pi)((e=>{var t;const{question:n,getAnswers:s,onChanged:i}=e;if("switch"!==n.options.displayMode)return null;const{options:o}=n,a=null!==(t=o.selectorReplacers)&&void 0!==t?t:["no","yes"];return r.createElement("div",null,r.createElement("p",null,r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:n.text}})),r.createElement("p",{className:"d-flex flex-column"},n.answers.map((e=>{var t,o,l,c;return r.createElement("div",{className:"d-flex flex-row mb-3"},r.createElement("div",{className:"mr-2 mt-1"},r.createElement(lt,{id:`question_${n.questionId}_anwser_${e.id}`,selected:null!==(c=a[null===(l=null===(o=null===(t=s().filter((t=>t.answer[0]===e.id)))||void 0===t?void 0:t[0])||void 0===o?void 0:o.answer)||void 0===l?void 0:l[1]])&&void 0!==c?c:"",values:a,onChange:t=>((e,t)=>{const n=a.indexOf(t),r=[...s().filter((t=>t.answer[0]!==e)),{answer:[e,n],isСreatedByUser:!0}];i(r)})(e.id,t)})),r.createElement("div",null,e.text))}))))})),ut=(0,Qe.Pi)((e=>{var t;const{question:n,getAnswers:i,onChanged:o}=e;if("switch"!==n.options.displayMode)return null;const{options:a}=n,l=null!==(t=a.selectorReplacers)&&void 0!==t?t:["no","yes"];return(0,r.useEffect)((()=>{document.querySelectorAll(`[id^="question_${n.questionId}_answer_"]`).forEach((e=>{var t,a,c,d,u,p;const m=null!==(a=null===(t=e.id)||void 0===t?void 0:t.split(`question_${n.questionId}_answer_`)[1])&&void 0!==a?a:-1,v=r.createElement(lt,{id:e.id,selected:null!==(p=l[null===(u=null===(d=null===(c=i().filter((e=>e.answer[0]===+m)))||void 0===c?void 0:c[0])||void 0===d?void 0:d.answer)||void 0===u?void 0:u[1]])&&void 0!==p?p:"",values:l,onChange:e=>((e,t)=>{const n=l.indexOf(t),s=[...i().filter((t=>t.answer[0]!==e)),{answer:[e,n],isСreatedByUser:!0}];o(s)})(+m,e)});s.render(v,e),e.id=""}))}),[n.questionId]),(0,r.useEffect)((()=>{document.querySelectorAll(`input[id^="question_${n.questionId}_answer_"]`).forEach((e=>{var t;null===(t=e.id)||void 0===t||t.split(`question_${n.questionId}_answer_`)[1],e.checked=void 0})),i().forEach((({answer:e})=>{const[t,s]=e,r=`question_${n.questionId}_answer_${t}_${l[s]}_checkbox`,i=document.getElementById(r);i&&setTimeout((()=>i.checked=!0),10)}))}),[n.questionId]),r.createElement("div",null,r.createElement("p",null,r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:n.text}})))})),pt=(0,Qe.Pi)((e=>{const{question:t,getAnswers:n,onChanged:s,answers:i}=e;if("dragNdrop"!==t.options.displayMode)return null;const o=Object.assign(Object.assign({},t),{type:"MATCHING",options:Object.assign(Object.assign({},t.options),{multipleSelectionEnabled:!0}),groups:[{id:0,text:'<span class="badge badge-success" style="height: 100%; width: 100%;display: flex; align-items: center;justify-content: center;">✓</span>'},{id:1,text:'<span class="badge badge-danger" style="height: 100%; width: 100%;display: flex; align-items: center;justify-content: center;">x</span>'}]});return r.createElement(tt,{question:o,getAnswers:n,onChanged:s,answers:i})})),mt=(0,Qe.Pi)((e=>{var t,n,s;const{question:i,getAnswers:o,onChanged:a,getFeedback:l}=e;if(!i.options.requireContext)return null;const{options:d}=i,u=null!==(t=d.orderNumberOptions)&&void 0!==t?t:{delimiter:"/",position:"SUFFIX"},p=document.createElement("div");p.innerHTML=i.text,(0,r.useEffect)((()=>{document.querySelectorAll(`[id^="question_${i.questionId}_answer_"]`).forEach((e=>{var t,n;const s=+(null!==(n=null===(t=e.id)||void 0===t?void 0:t.split(`question_${i.questionId}_answer_`)[1])&&void 0!==n?n:"");e.addEventListener("click",(()=>a([...o(),{answer:[s,s],isСreatedByUser:!0}])))})),document.querySelectorAll("[data-comp-ph-value]").forEach((e=>{const t=e.getAttribute("data-comp-ph-value");e.innerHTML+=`<span class="comp-ph-expr-bottom-hint">${t}</span>`})),document.querySelectorAll("[data-comp-ph-pos]").forEach((e=>{const t=e.getAttribute("data-comp-ph-pos");e.innerHTML+=`<span class="comp-ph-expr-top-hint">${t}</span>`}))}),[i.questionId]),(0,r.useEffect)((()=>{var e,t;document.querySelectorAll(`[id^="question_${i.questionId}_answer_"]`).forEach((e=>{var t;const n=e.getAttribute("data-comp-ph-value"),s=e.getAttribute("data-comp-ph-pos");e.innerHTML=(null===(t=p.querySelector(`#${e.id}`))||void 0===t?void 0:t.innerHTML)+(s?`<span class="comp-ph-expr-top-hint">${s}</span>`:"")+(n?`<span class="comp-ph-expr-bottom-hint">${n}</span>`:""),e.classList.remove("disabled"),e.classList.remove("comp-ph-question-answer--last-selected-by-system")}));const n=null===(t=null===(e=l())||void 0===e?void 0:e.isCorrect)||void 0===t||t?[...o()].reverse().reduce(((e,t)=>{const[n,s]=e;return-1===n?e:t.isСreatedByUser||0!==n&&n!==t.createdByInteraction?[-1,s]:(s.push(t),[t.createdByInteraction||-1,s])}),[0,[]])[1].reverse():[];o().forEach(((e,t,s)=>{var r,o;const{answer:a}=e,[l]=a,c=document.querySelector(`#question_${i.questionId}_answer_${l}`);if(!c)return 0;if(n.includes(e)&&c.classList.add("comp-ph-question-answer--last-selected-by-system"),"NONE"!==u.position){const e=null!==(o=null===(r=u.replacers)||void 0===r?void 0:r[t])&&void 0!==o?o:t+1,n="PREFIX"===u.position?[e,c.innerHTML]:"SUFFIX"===u.position?[c.innerHTML,e]:[c.innerHTML];c.innerHTML=n.join(u.delimiter)}d.multipleSelectionEnabled||c.classList.add("disabled")}))}),[i.questionId,o().length]);const m=null!==(s=null===(n=l())||void 0===n?void 0:n.trace)&&void 0!==s?s:0===o().length?i.initialTrace:null,v=d.showTrace&&c(m)&&m.length>0;return r.createElement("div",null,r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:i.text}}),r.createElement(Pe,{isVisible:v},r.createElement("p",null,r.createElement("table",{className:"comp-ph-trace"},r.createElement("tbody",null,null==m?void 0:m.map((e=>r.createElement("tr",null,r.createElement("td",{dangerouslySetInnerHTML:{__html:e}})))))))))})),vt=(0,Qe.Pi)((e=>{const{question:t}=e;switch(!0){case"radio"===t.options.displayMode&&!t.options.requireContext:return r.createElement(gt,Object.assign({},e));case"radio"===t.options.displayMode&&t.options.requireContext:return r.createElement(ht,Object.assign({},e))}return r.createElement("div",null,"Not implemented")})),gt=(0,Qe.Pi)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;return"radio"!==t.options.displayMode?null:r.createElement("div",null,r.createElement("div",{className:"mb-3"},r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}})),r.createElement("div",{className:"d-flex flex-column"},t.answers.map(((e,i)=>r.createElement("label",{htmlFor:`question_${t.questionId}_answer_${e.id}`,className:"comp-ph-singlechoice-label d-flex flex-row "+(i!==t.answers.length-1?"mb-3":"")},r.createElement("div",{className:"mr-2 mt-1"},r.createElement("input",{id:`question_${t.questionId}_answer_${e.id}`,name:`switch_${t.questionId}`,type:"radio",checked:n().some((t=>t.answer[0]===e.id)),onChange:t=>{return n=e.id,void(t.target.checked&&s([{answer:[n,n],isСreatedByUser:!0}]));var n},readOnly:!0})),r.createElement("div",null,e.text))))))})),ht=(0,Qe.Pi)((e=>{const{question:t,getAnswers:n,onChanged:i}=e;if("radio"!==t.options.displayMode)return null;const{options:o}=t;return(0,r.useEffect)((()=>{document.querySelectorAll(`[id^="question_${t.questionId}_answer_"]`).forEach((e=>{var o,a;const l=null!==(a=null===(o=e.id)||void 0===o?void 0:o.split(`question_${t.questionId}_answer_`)[1])&&void 0!==a?a:-1,c=r.createElement("label",{htmlFor:`question_${t.questionId}_answer_${l}`,className:"comp-ph-singlechoice-label"},r.createElement("input",{id:`question_${t.questionId}_answer_${l}`,name:`switch_${t.questionId}`,type:"radio",checked:n().some((e=>e.answer[0]===+l)),onChange:e=>{return t=+l,void(e.target.checked&&i([{answer:[t,t],isСreatedByUser:!0}]));var t},readOnly:!0}),r.createElement("span",{dangerouslySetInnerHTML:{__html:e.innerHTML}}));s.render(c,e),e.id=""}))}),[t.questionId]),(0,r.useEffect)((()=>{document.querySelectorAll(`input[id^="question_${t.questionId}_answer_"]`).forEach((e=>{e.checked=void 0})),n().forEach((({answer:e})=>{const n=e[0],s=document.getElementById(`question_${t.questionId}_answer_${n}`);s&&setTimeout((()=>s.checked=!0),10)}))}),[t.questionId,n()]),r.createElement("div",null,r.createElement("p",null,r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}})))})),Et=(0,Qe.Pi)((e=>{var t;const{question:n,answers:s,onChanged:i,getAnswers:o,getFeedback:a,isFeedbackLoading:l,isQuestionFreezed:c}=e;let d;switch(n.type){case"MATCHING":d=r.createElement(et,{question:n,onChanged:i,answers:s,getAnswers:o});break;case"MULTI_CHOICE":d=r.createElement(ct,{question:n,onChanged:i,answers:s,getAnswers:o});break;case"SINGLE_CHOICE":d=r.createElement(vt,{question:n,onChanged:i,answers:s,getAnswers:o});break;case"ORDER":d=r.createElement(mt,{question:n,onChanged:i,answers:s,getAnswers:o,getFeedback:a});break;default:return(0,Y.absurd)(n)}const u=["comp-ph-question-wrapper",0===(null===(t=a())||void 0===t?void 0:t.stepsLeft)?"comp-ph-question-wrapper--finished":"",l?"comp-ph-question-wrapper--loading-feedback":"",c?"comp-ph-question-wrapper--freezed":""].join(" ");return r.createElement("div",{className:u},d)}));var wt=n(7977),ft=n(8375),yt=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const xt=(0,Qe.Pi)((({violationLaw:e})=>{var t;const[n]=(0,r.useState)((()=>i.nC.resolve(fe))),[s]=(0,r.useState)((()=>i.nC.resolve(ne))),{t:o}=(0,Te.$)(),[a,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!0),[p,m]=(0,r.useState)(!0);return(null===(t=n.sessionInfo)||void 0===t?void 0:t.exercise.options.supplementaryQuestionsEnabled)&&!1!==e.canCreateSupplementaryQuestion?r.createElement(Pe,{isVisible:p},r.createElement(Pe,{isVisible:d},r.createElement("div",{className:"d-flex flex-row mt-3"},r.createElement(Re.Z,{onClick:()=>yt(void 0,void 0,void 0,(function*(){var t,r;u(!1),c(!0),(null===(t=n.currentAttempt)||void 0===t?void 0:t.attemptId)&&n.currentQuestion.question&&(yield s.generateSupplementaryQuestion(n.currentAttempt.attemptId,null===(r=n.currentQuestion.question)||void 0===r?void 0:r.questionId,[e].map((e=>e.name))),s.question||(console.log("no need to generate sup question"),m(!1)))})),variant:"primary"},o("generateSupQuestion_details")),r.createElement(Re.Z,{onClick:()=>{m(!1)},variant:"success",className:"ml-2"},o("generateSupQuestion_gotit")))),r.createElement(Me,{type:"DIALOG",size:"xl",show:a,closeButton:!1,handleClose:()=>c(!1)},r.createElement(bt,{store:s,showExtendedFeedback:!1,onChanged:()=>yt(void 0,void 0,void 0,(function*(){var e,t,r;try{s.isQuestionFreezed=!0,console.log("show feedback for 3 seconds"),yield l(3e3);const i=(null===(e=s.feedback)||void 0===e?void 0:e.messages)&&s.feedback.messages[0].violationLaw||null;if(!i)return console.log("empty violation laws"),void m(!1);if(!(null===(t=n.currentAttempt)||void 0===t?void 0:t.attemptId)||!n.currentQuestion.question)return void console.log("problems with attempt");yield s.generateSupplementaryQuestion(n.currentAttempt.attemptId,null===(r=n.currentQuestion.question)||void 0===r?void 0:r.questionId,[i].map((e=>e.name))),s.question||(console.log("no need to generate sup question"),m(!1))}finally{s.isQuestionFreezed=!1}}))}),"ERROR"===s.storeState.tag&&r.createElement("div",{className:"mt-2"},r.createElement(ft.Z,{variant:"danger"},s.storeState.error.message)))):null}));const bt=(0,Qe.Pi)((e=>{const{store:t,showExtendedFeedback:n,onChanged:s}=e,i=t.question;return"LOADING"===t.questionState?r.createElement("div",{className:"mt-2"},r.createElement(Fe,null)):i?r.createElement(r.Fragment,null,r.createElement(Et,{question:i,answers:t.lastAnswer,getAnswers:()=>t.lastAnswer,onChanged:e=>{return n=void 0,r=void 0,o=function*(){(yield t.setFullAnswer(e))&&(null==s||s(e))},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(o.next(e))}catch(e){t(e)}}function a(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,a)}l((o=o.apply(n,r||[])).next())}));var n,r,i,o},getFeedback:()=>t.feedback,isFeedbackLoading:"ANSWER_EVALUATING"===t.questionState,isQuestionFreezed:t.isQuestionFreezed}),r.createElement(It,{store:t,showExtendedFeedback:n})):null})),It=(0,Qe.Pi)((({store:e,showExtendedFeedback:t})=>{const{feedback:n,isFeedbackVisible:s,question:i}=e,o="ANSWER_EVALUATING"===e.questionState,a="LOADING"===e.questionState,{t:l}=(0,Te.$)();if(o)return r.createElement("div",{className:"mt-2"},r.createElement(Fe,null));if(!n||a||!i)return null;const d="COMPLETED"===e.questionState?[{type:"SUCCESS",message:l("issolved_feeback")}]:n.messages;return r.createElement("div",{className:"comp-ph-feedback-wrapper mt-2"},r.createElement(Pe,{isVisible:s},r.createElement("div",{className:"mb-3"},null==d?void 0:d.map((e=>r.createElement(St,{message:e,showGenerateSupQuestion:t&&i.options.showSupplementaryQuestions&&"ERROR"===e.type&&e.violationLaw.canCreateSupplementaryQuestion})))),r.createElement(Pe,{isVisible:t},r.createElement("div",null,r.createElement(Pe,{isVisible:null!==n.grade},r.createElement(wt.Z,{variant:"primary"},l("grade_feeback"),": ",n.grade)," "),r.createElement(Pe,{isVisible:null!==n.correctSteps},r.createElement(wt.Z,{variant:"success"},l("correctsteps_feeback"),": ",n.correctSteps)," "),r.createElement(Pe,{isVisible:c(n.stepsWithErrors)&&n.stepsWithErrors>0},r.createElement(wt.Z,{variant:"danger"},l("stepswitherrors_feeback"),": ",n.stepsWithErrors)," "),r.createElement(Pe,{isVisible:c(n.stepsLeft)&&n.stepsLeft>0},r.createElement(wt.Z,{variant:"info"},l("stepsleft_feeback"),": ",n.stepsLeft)," ")))))})),St=(0,Qe.Pi)((({message:e,showGenerateSupQuestion:t})=>{const n="SUCCESS"===e.type?"success":"danger";return r.createElement(ft.Z,{variant:n},e.message,t&&"ERROR"===e.type&&e.violationLaw&&r.createElement(xt,{violationLaw:e.violationLaw})||null)})),Ct=(0,Qe.Pi)((()=>{const[e]=(0,r.useState)((()=>i.nC.resolve(fe)));return r.createElement(bt,{store:e.currentQuestion,showExtendedFeedback:!0})}));var _t=n(548);const At=e=>{const{survey:t,enabledSurveyQuestions:n,isCompleted:s}=e,[o]=(0,r.useState)((()=>i.nC.resolve(ve))),[a,l]=(0,r.useState)(s?"COMPLETED":"INITAL"),[c,d]=(0,r.useState)(e.value||{}),u=e.survey.questions.filter((e=>n.includes(e.id)));var p=(e,t)=>{const n=Object.assign(Object.assign({},c),{[e]:t});d(n),console.log(n)};return u&&u.length?r.createElement("div",{className:"alert alert-warning rounded",role:"alert"},u.map(((e,t,n)=>r.createElement("div",{key:t,className:t!==n.length-1?"mb-4":""},"yes-no"===e.type&&r.createElement(Nt,{isCompleted:s,question:e,onAnswered:p,value:c[e.id]})||"single-choice"===e.type&&r.createElement(qt,{isCompleted:s,question:e,onAnswered:p,value:c[e.id]})||"open-ended"===e.type&&r.createElement(Ot,{isCompleted:s,question:e,onAnswered:p,value:c[e.id]})||"invalid question type"))),"SENDING_RESULTS"===a&&r.createElement("div",{className:"mt-2"},r.createElement(Fe,{delay:100})),"VALIDATION_ERROR"===a&&r.createElement("div",{className:"mt-2"},r.createElement("div",{className:"alert alert-danger rounded"},"Необходимо ответить на все обязательные вопросы")),"COMPLETED"!==a&&"SENDING_RESULTS"!==a&&r.createElement("div",{className:"mt-2"},r.createElement(Re.Z,{variant:"primary",onClick:()=>{var n,s,r,i;n=void 0,s=void 0,i=function*(){u.filter((e=>e.required)).map((e=>e.id)).every((e=>c[e]))?(l("SENDING_RESULTS"),yield Promise.all(u.map((t=>o.postSurveyAnswer(t.id,e.questionId,c[t.id])))),l("COMPLETED"),e.onAnswersSended(t,e.questionId,c)):l("VALIDATION_ERROR")},new((r=void 0)||(r=Promise))((function(e,t){function o(e){try{l(i.next(e))}catch(e){t(e)}}function a(e){try{l(i.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,a)}l((i=i.apply(n,s||[])).next())}))}},"Send survey results"))):null},Nt=e=>{const{question:t,onAnswered:n,value:s,isCompleted:i}=e;return r.createElement("div",null,r.createElement("div",{className:"mb-1"},t.text),r.createElement("div",{className:"d-flex flex-row mt-2"},r.createElement("button",{type:"button",className:"btn btn-secondary mr-2 "+(t.options.yesValue===s?"active":""),onClick:()=>n(t.id,t.options.yesValue),disabled:void 0!==s},t.options.yesText),r.createElement("button",{type:"button",className:"btn btn-secondary "+(t.options.noValue===s?"active":""),onClick:()=>n(t.id,t.options.noValue),disabled:void 0!==s},t.options.noText)))},qt=e=>{const{question:t,onAnswered:n,value:s,isCompleted:i}=e;return r.createElement("div",null,r.createElement("div",{className:"mb-1"},t.text),r.createElement("div",{className:"d-flex mt-2"},r.createElement("div",null,t.options.map(((e,o,a)=>r.createElement("div",{key:e.id},r.createElement(_t.Z.Check,{disabled:i,checked:s===e.id,name:`radio_qid${t.id}`,type:"radio",id:`radio_qid${t.id}_sqid${e.id}`,label:e.text,value:e.id,onChange:e=>n(t.id,e.target.value)})))))))},Ot=e=>{const{question:t,onAnswered:n,value:s,isCompleted:i}=e;return r.createElement("div",null,r.createElement("div",{className:"mb-1"},t.text),r.createElement("div",{className:"d-flex flex-row mt-2"},r.createElement(_t.Z.Control,{disabled:i,value:s,as:"textarea",rows:3,onChange:e=>n(t.id,e.target.value)})))};var Lt=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const kt=(0,Qe.Pi)((()=>{var e,t,n,s,o,a,l,c,d,u,p,m,v;const[g]=(0,r.useState)((()=>i.nC.resolve(fe))),{exerciseState:h,setExerciseState:E,storeState:w,currentQuestion:f,survey:y}=g,{storeState:x}=f,{t:b}=(0,Te.$)();(0,r.useEffect)((()=>{Lt(void 0,void 0,void 0,(function*(){var e;"LAUNCH_ERROR"!==h&&(g.currentQuestion.question?E("EXERCISE"):(yield g.loadSessionInfo(),(null===(e=g.sessionInfo)||void 0===e?void 0:e.exercise.options.forceNewAttemptCreationEnabled)||!(yield g.loadExistingExerciseAttempt())?(E("EXERCISE"),S()):E("MODAL")))}))}),[]);const I=(0,r.useCallback)((()=>{Lt(void 0,void 0,void 0,(function*(){var e,t,n;if(null===(e=g.currentAttempt)||void 0===e?void 0:e.questionIds.length){const e=null===(t=g.currentAttempt)||void 0===t?void 0:t.questionIds.length;yield g.currentQuestion.loadQuestion(null===(n=g.currentAttempt)||void 0===n?void 0:n.questionIds[e-1])}else yield g.generateQuestion()}))}),[g]),S=(0,r.useCallback)((()=>{Lt(void 0,void 0,void 0,(function*(){g.currentQuestion.setQuestionState("LOADING"),yield g.createExerciseAttempt(),I()}))}),[g]),C=(0,r.useCallback)(((e,t,n)=>{g.setSurveyAnswers(t,n)}),[g]);return r.createElement(r.Fragment,null,r.createElement(Ue,{isLoading:!0===g.isSessionLoading||"INITIAL"===h},r.createElement(Pe,{isVisible:"EXERCISE"===h||"COMPLETED"===h},r.createElement(ze,null),r.createElement("div",{className:"mt-5"},r.createElement(Ct,null),null!=y&&("COMPLETED"===g.currentQuestion.questionState||"COMPLETED"===h)&&r.createElement("div",{className:"mt-2"},r.createElement(At,{questionId:null!==(t=null===(e=g.currentQuestion.question)||void 0===e?void 0:e.questionId)&&void 0!==t?t:-1,survey:y.survey,enabledSurveyQuestions:g.ensureQuestionSurveyExists(null!==(s=null===(n=f.question)||void 0===n?void 0:n.questionId)&&void 0!==s?s:-1),value:null===(l=y.questions[null!==(a=null===(o=g.currentQuestion.question)||void 0===o?void 0:o.questionId)&&void 0!==a?a:-1])||void 0===l?void 0:l.results,onAnswersSended:C,isCompleted:"COMPLETED"===(null===(u=y.questions[null!==(d=null===(c=g.currentQuestion.question)||void 0===c?void 0:c.questionId)&&void 0!==d?d:-1])||void 0===u?void 0:u.status)})),r.createElement(Pe,{isVisible:"EXERCISE"===h},r.createElement(Pe,{isVisible:"LOADED"===g.currentQuestion.questionState},r.createElement("div",{className:"mt-3"},r.createElement(Xe,null))),r.createElement(Pe,{isVisible:"COMPLETED"!==g.currentQuestion.questionState||null==y||"COMPLETED"===(null===(v=y.questions[null!==(m=null===(p=g.currentQuestion.question)||void 0===p?void 0:p.questionId)&&void 0!==m?m:-1])||void 0===v?void 0:v.status)},r.createElement("div",{className:"mt-2"},r.createElement(Ze,null)))),r.createElement(Pe,{isVisible:"COMPLETED"===h},r.createElement("div",{className:"mt-3"},r.createElement(ft.Z,{variant:"success"},b("exercise_completed")))))),r.createElement(Pe,{isVisible:"MODAL"===h},r.createElement(Me,{type:"DIALOG",title:b("foundExisitingAttempt_title"),primaryBtnTitle:b("foundExisitingAttempt_continueattempt"),handlePrimaryBtnClicked:()=>{E("EXERCISE"),I()},secondaryBtnTitle:b("foundExisitingAttempt_newattempt"),handleSecondaryBtnClicked:()=>{E("EXERCISE"),S()}},r.createElement("p",null,b("foundExisitingAttempt_descr"),"?")))),[w,x].filter((e=>"ERROR"===e.tag)).map(((e,t,n)=>"ERROR"===e.tag&&r.createElement("div",{className:"mt-2"},r.createElement(ft.Z,{variant:"danger"},e.error.message)))))}));const Qt=()=>{const[e,t]=(0,r.useState)([]),[n,s]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{var e,n,r,o;e=void 0,n=void 0,o=function*(){const e=new URLSearchParams(window.location.search).get("exerciseId");if(null===e||Number.isNaN(+e))throw new Error("Invalid exerciseId url param");const n=i.nC.resolve(U);s(!0);const r=yield n.getExerciseStatistics(+e);j.isRight(r)&&t(r.right),s(!1)},new((r=void 0)||(r=Promise))((function(t,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,a)}l((o=o.apply(e,n||[])).next())}))}),[]),r.createElement("div",null,r.createElement("table",{className:"table"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",{scope:"col"},"AttemptId"),r.createElement("th",{scope:"col"},"QuestionsCount"),r.createElement("th",{scope:"col"},"TotalInteractionsCount"),r.createElement("th",{scope:"col"},"TotalInteractionsWithErrorsCount"),r.createElement("th",{scope:"col"},"AverageGrade"))),r.createElement("tbody",null,r.createElement(Ue,{isLoading:n},e.map((e=>r.createElement("tr",null,r.createElement("th",{scope:"row"},e.attemptId),r.createElement("td",null,e.questionsCount),r.createElement("td",null,e.totalInteractionsCount),r.createElement("td",null,e.totalInteractionsWithErrorsCount),r.createElement("td",null,e.averageGrade))))))))};var Rt=n(6712);const Tt=(0,Qe.Pi)((()=>{const[e,t]=(0,r.useState)([]),[n,s]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{var e,n,r,o;e=void 0,n=void 0,o=function*(){s(!0);const e=i.nC.resolve(U),n=yield e.getExercises();j.isRight(n)&&t(n.right),s(!1)},new((r=void 0)||(r=Promise))((function(t,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,a)}l((o=o.apply(e,n||[])).next())}))}),[]),r.createElement("div",null,r.createElement(Rt.Z,null,e.map((e=>r.createElement(Rt.Z.Item,null,r.createElement("a",{href:`exercise?exerciseId=${e}`},e))))))}));var Dt=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const Pt=(0,Qe.Pi)((()=>{var e,t,n,s,o,a,l,c,d,u,p;const[m]=(0,r.useState)((()=>i.nC.resolve(fe))),{exerciseState:v,setExerciseState:g,storeState:h,currentQuestion:E,survey:w}=m,{storeState:f}=E,{t:y}=(0,Te.$)(),[x,b]=(0,r.useState)("ACTIVE");(0,r.useEffect)((()=>{Dt(void 0,void 0,void 0,(function*(){"LAUNCH_ERROR"!==v&&(m.currentQuestion.question?g("EXERCISE"):(yield m.loadSessionInfo(),g("EXERCISE"),yield I()))}))}),[]);const I=()=>Dt(void 0,void 0,void 0,(function*(){m.currentQuestion.setQuestionState("LOADING"),yield m.createExerciseAttempt(),yield Dt(void 0,void 0,void 0,(function*(){var e,t,n;if(null===(e=m.currentAttempt)||void 0===e?void 0:e.questionIds.length){const e=null===(t=m.currentAttempt)||void 0===t?void 0:t.questionIds.length;yield m.currentQuestion.loadQuestion(null===(n=m.currentAttempt)||void 0===n?void 0:n.questionIds[e-1])}else yield m.generateQuestion()}))})),S=(0,r.useCallback)(((e,t,n)=>{console.log("лень рефакторить, не работает крч")}),[m]),C=null===(e=m.sessionInfo)||void 0===e?void 0:e.exercise.options.surveyOptions;return null===(t=m.currentQuestion.question)||void 0===t||t.questionId,(null==C?void 0:C.enabled)?r.createElement(r.Fragment,null,r.createElement(Ue,{isLoading:!0===m.isSessionLoading||"INITIAL"===v},r.createElement(Pe,{isVisible:"EXERCISE"===v||"COMPLETED"===v},r.createElement(ze,null),r.createElement("div",{className:"mt-5"},r.createElement("div",{style:{pointerEvents:"none"}},r.createElement(Ct,null)),r.createElement(Pe,{isVisible:"COMPLETED"===x},r.createElement("div",{className:"mt-2"},r.createElement(ft.Z,{variant:"success"},"Спасибо за участие в опросе!"))),r.createElement(Pe,{isVisible:"COMPLETED"!==x&&"LOADED"===E.questionState},r.createElement("div",{className:"mt-2"},r.createElement(At,{questionId:null!==(s=null===(n=m.currentQuestion.question)||void 0===n?void 0:n.questionId)&&void 0!==s?s:-1,survey:m.survey.survey,value:null===(o=m.survey)||void 0===o?void 0:o.questions[null!==(l=null===(a=m.currentQuestion.question)||void 0===a?void 0:a.questionId)&&void 0!==l?l:-1].results,enabledSurveyQuestions:null!==(p=null===(c=m.survey)||void 0===c?void 0:c.questions[null!==(u=null===(d=m.currentQuestion.question)||void 0===d?void 0:d.questionId)&&void 0!==u?u:-1].questions)&&void 0!==p?p:[],onAnswersSended:S})))))),[h,f].filter((e=>"ERROR"===e.tag)).map(((e,t,n)=>"ERROR"===e.tag&&r.createElement("div",{className:"mt-2"},r.createElement(ft.Z,{variant:"danger"},e.error.message))))):null}));var Mt=function(e,t,n,s){var r,i=arguments.length,o=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(i<3?r(o):i>3?r(t,n,o):r(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o},$t=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},jt=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};let Zt=class{constructor(e){this.exerciseSettingsController=e,this.exercisesLoadStatus="NONE",this.exercises=null,this.domains=null,this.backends=null,this.strategies=null,this.currentCard=null,(0,J.rC)(this)}loadExercises(){return jt(this,void 0,void 0,(function*(){if("LOADED"===this.exercisesLoadStatus||"LOADING"===this.exercisesLoadStatus)return;(0,J.z)((()=>this.exercisesLoadStatus="LOADING"));const e=yield this.exerciseSettingsController.getAllExercises(),t=yield this.exerciseSettingsController.getDomains(),n=yield this.exerciseSettingsController.getBackends(),s=yield this.exerciseSettingsController.getStrategies();j.isRight(e)&&j.isRight(t)&&j.isRight(n)&&j.isRight(s)&&(0,J.z)((()=>{this.exercises=e.right,this.domains=t.right,this.backends=n.right,this.strategies=s.right})),(0,J.z)((()=>this.exercisesLoadStatus="LOADED"))}))}loadExercise(e){return jt(this,void 0,void 0,(function*(){if("LOADED"!==this.exercisesLoadStatus)throw new Error("Exercises must be loaded first");(0,J.z)((()=>this.exercisesLoadStatus="LOADING"));const t=yield this.exerciseSettingsController.getExercise(e);j.isRight(t)&&(0,J.z)((()=>{this.currentCard=t.right})),(0,J.z)((()=>this.exercisesLoadStatus="LOADED"))}))}saveCard(){return jt(this,void 0,void 0,(function*(){console.log((0,J.ZN)(this.currentCard))}))}setCardName(e){this.currentCard&&(this.currentCard.name=e)}setCardDomain(e){this.currentCard&&(this.currentCard.domainId=e)}setCardStrategy(e){this.currentCard&&(this.currentCard.strategyId=e)}setCardQuestionComplexity(e){if(!this.currentCard)return;const t=Number.parseInt(e);this.currentCard.complexity=t/100}setCardAnswerLength(e){if(!this.currentCard)return;const t=Number.parseInt(e);this.currentCard.answerLength=t/100}setCardConceptValue(e,t){if(!this.currentCard)return;const n=this.currentCard.concepts.findIndex((t=>t.name==e));let s=-1!==n?this.currentCard.concepts[n]:null;"PERMITTED"===t&&s?s&&this.currentCard.laws.splice(n,1):(s||(s={name:e,kind:t},this.currentCard.concepts.push(s)),s.kind=t)}setCardLawValue(e,t){if(!this.currentCard)return;const n=this.currentCard.laws.findIndex((t=>t.name==e));let s=-1!==n?this.currentCard.laws[n]:null;"PERMITTED"!==t?(s||(s={name:e,kind:t},this.currentCard.laws.push(s)),s.kind=t):s&&this.currentCard.laws.splice(n,1)}};Mt([J.LO,$t("design:type",String)],Zt.prototype,"exercisesLoadStatus",void 0),Mt([J.LO,$t("design:type",Object)],Zt.prototype,"exercises",void 0),Mt([J.LO,$t("design:type",Object)],Zt.prototype,"domains",void 0),Mt([J.LO,$t("design:type",Object)],Zt.prototype,"backends",void 0),Mt([J.LO,$t("design:type",Object)],Zt.prototype,"strategies",void 0),Mt([J.LO,$t("design:type",Object)],Zt.prototype,"currentCard",void 0),Mt([J.aD,$t("design:type",Function),$t("design:paramtypes",[String]),$t("design:returntype",void 0)],Zt.prototype,"setCardName",null),Mt([J.aD,$t("design:type",Function),$t("design:paramtypes",[String]),$t("design:returntype",void 0)],Zt.prototype,"setCardDomain",null),Mt([J.aD,$t("design:type",Function),$t("design:paramtypes",[String]),$t("design:returntype",void 0)],Zt.prototype,"setCardStrategy",null),Mt([J.aD,$t("design:type",Function),$t("design:paramtypes",[String]),$t("design:returntype",void 0)],Zt.prototype,"setCardQuestionComplexity",null),Mt([J.aD,$t("design:type",Function),$t("design:paramtypes",[String]),$t("design:returntype",void 0)],Zt.prototype,"setCardAnswerLength",null),Mt([J.aD,$t("design:type",Function),$t("design:paramtypes",[String,String]),$t("design:returntype",void 0)],Zt.prototype,"setCardConceptValue",null),Mt([J.aD,$t("design:type",Function),$t("design:paramtypes",[String,String]),$t("design:returntype",void 0)],Zt.prototype,"setCardLawValue",null),Zt=Mt([(0,i.b2)(),function(e,t){return function(n,s){t(n,s,e)}}(0,(0,i.f3)(Oe)),$t("design:paramtypes",[Oe])],Zt);const Vt=(0,Qe.Pi)((()=>{var e,t,n,s;const[o]=(0,r.useState)((()=>i.nC.resolve(Zt)));return(0,r.useEffect)((()=>{var e,t,n,s;e=void 0,t=void 0,s=function*(){yield o.loadExercises();const e=new URL(window.location.href).searchParams.get("exerciseId");e&&(yield o.loadExercise(Number.parseInt(e)))},new((n=void 0)||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))}),[]),r.createElement("div",{className:"container-fluid"},r.createElement("div",{className:"flex-xl-nowrap row"},r.createElement("div",{className:"col-xl-3 col-md-3 col-12 d-flex flex-column"},r.createElement("ul",{className:"list-group"},null===(e=o.exercises)||void 0===e?void 0:e.map((e=>{var t;return r.createElement(Le.rU,{key:e.id,className:"list-group-item "+(e.id===(null===(t=o.currentCard)||void 0===t?void 0:t.id)?"active":""),to:`?exerciseId=${e.id}`,onClick:()=>o.loadExercise(e.id)},e.name)})),r.createElement("button",{style:{marginTop:"10px"},type:"button",className:"btn btn-primary"},"Create new"))),r.createElement("div",{className:"col-xl-9 col-md-9 col-12"},r.createElement(Gt,{store:o,card:o.currentCard,domains:null!==(t=o.domains)&&void 0!==t?t:[],backends:null!==(n=o.backends)&&void 0!==n?n:[],strategies:null!==(s=o.strategies)&&void 0!==s?s:[]}))))})),Gt=(0,Qe.Pi)((e=>{var t,n,s,i,o,a;const{card:l,domains:c,backends:d,strategies:u,store:p}=e;if("LOADING"===p.exercisesLoadStatus)return r.createElement(Fe,{delay:100});if(null==l)return r.createElement("div",null,"No exercise selected");const m=l.laws.reduce(((e,t)=>(e[t.name]=t,e)),{}),v=l.concepts.reduce(((e,t)=>(e[t.name]=t,e)),{});function g(e){return"FORBIDDEN"===e?"Denied":"TARGETED"===e?"Target":"Allowed"}function h(e){return"Denied"===e?"FORBIDDEN":"Target"===e?"TARGETED":"PERMITTED"}const E=null===(t=c.find((e=>e.id===l.domainId)))||void 0===t?void 0:t.laws,w=null===(n=c.find((e=>e.id===l.domainId)))||void 0===n?void 0:n.concepts;return r.createElement("div",null,r.createElement("form",{className:"exercise-settings-form"},r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"exampleInputEmail1"},"Name"),r.createElement("input",{value:l.name,type:"email",className:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",placeholder:"Enter email",onChange:e=>p.setCardName(e.target.value)})),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Domain"),r.createElement("select",{className:"form-control",value:l.domainId,onChange:e=>p.setCardDomain(e.target.value)},null==c?void 0:c.map((e=>r.createElement("option",null,e.name))))),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Strategy"),r.createElement("select",{className:"form-control",value:l.strategyId,onChange:e=>p.setCardStrategy(e.target.value)},null==u?void 0:u.map((e=>r.createElement("option",null,e))))),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-6"},r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Question complexity"),r.createElement("div",null,r.createElement("input",{type:"range",className:"form-control-range",id:"formControlRange1",value:100*(null!==(i=null===(s=p.currentCard)||void 0===s?void 0:s.complexity)&&void 0!==i?i:.5),onChange:e=>p.setCardQuestionComplexity(e.target.value)})))),r.createElement("div",{className:"col-md-6"},r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Answer length"),r.createElement("div",null,r.createElement("input",{type:"range",className:"form-control-range",id:"formControlRange1",value:100*(null!==(a=null===(o=p.currentCard)||void 0===o?void 0:o.answerLength)&&void 0!==a?a:.5),onChange:e=>p.setCardAnswerLength(e.target.value)}))))),(null==w?void 0:w.length)&&r.createElement("div",{className:"form-group"},r.createElement("div",null,r.createElement("label",{className:"font-weight-bold"},"Concepts")),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-12"},w.filter((e=>e.bitflags&_e.VisibleToTeacher)).map(((e,t)=>{var n;return r.createElement("div",{key:`concept_toggle_${l.id}_${e.name}_${t}`,className:"d-flex flex-row align-items-center",style:{marginBottom:"10px"}},r.createElement(lt,{id:`concept_toggle_${l.id}_${e.name}_${t}`,selected:g(null===(n=v[e.name])||void 0===n?void 0:n.kind),values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],onChange:t=>p.setCardConceptValue(e.name,h(t))}),r.createElement("div",{style:{marginLeft:"15px"}},e.displayName))})))))||null,(null==E?void 0:E.length)&&r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Laws"),E.map(((e,t)=>{var n;return r.createElement("div",{key:`law_toggle_${l.id}_${t}`,className:"d-flex flex-row align-items-start justify-content-start",style:{marginBottom:"10px"}},r.createElement("div",null,r.createElement(lt,{id:`law_toggle_${l.id}_${t}`,selected:g(null===(n=m[e.name])||void 0===n?void 0:n.kind),values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],onChange:t=>p.setCardLawValue(e.name,h(t))})),r.createElement("div",{style:{marginLeft:"15px"}},e.name))})))||null),r.createElement("button",{type:"button",className:"btn btn-primary",onClick:()=>p.saveCard()},"Save"))})),Ht={concepts:["literal","variable","arithmetic operator","assignment operator","comparison operator","logical operator","bitwise operator","array access operator","pointer operator","function call"],laws:["Expression contains two operators with different precedence in a row","Expression contains two operators with the same precedence and left associativity in a row","Expression contains two operators with the same precedence and right associativity in a row","Expression contains operators inside parentheses or another operator","Expression contains operators evaluating their operands in a strict order"]},zt=(0,Qe.Pi)((()=>r.createElement("div",{className:"container-fluid",style:{color:"black",fontSize:"18px"}},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-8"},r.createElement("form",null,r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Domain"),r.createElement("select",{className:"form-control"},r.createElement("option",null,"Order of Expression Evaluation"))),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-6"},r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Question complexity"),r.createElement("div",null,r.createElement("input",{type:"range",className:"form-control-range",id:"formControlRange1"})))),r.createElement("div",{className:"col-md-6"},r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Answer length"),r.createElement("div",null,r.createElement("input",{type:"range",className:"form-control-range",id:"formControlRange1"}))))),r.createElement("div",{className:"form-group"},r.createElement("div",null,r.createElement("label",{className:"font-weight-bold"},"Concepts")),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-6"},Ht.concepts.filter(((e,t)=>t%2==0)).map(((e,t)=>r.createElement("div",{className:"d-flex flex-row align-items-center",style:{marginBottom:"10px"}},r.createElement(lt,{id:`concept_toggle_${e}_${t}`,selected:"Allowed",values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],onChange:e=>0}),r.createElement("div",{style:{marginLeft:"15px"}},e))))),r.createElement("div",{className:"col-md-6"},Ht.concepts.filter(((e,t)=>t%2!=0)).map(((e,t)=>r.createElement("div",{className:"d-flex flex-row align-items-center",style:{marginBottom:"10px"}},r.createElement(lt,{id:`concept_toggle_${e}_${t}`,selected:"Allowed",values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],onChange:e=>0}),r.createElement("div",{style:{marginLeft:"15px"}},e))))))),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Laws"),Ht.laws.map(((e,t)=>r.createElement("div",{className:"d-flex flex-row align-items-start justify-content-start",style:{marginBottom:"10px"}},r.createElement("div",null,r.createElement(lt,{id:`law_toggle_${t}`,selected:"Allowed",values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],onChange:e=>0})),r.createElement("div",{style:{marginLeft:"15px"}},e)))))))))));(0,s.hydrate)(r.createElement((()=>r.createElement("div",{className:"container comp-ph-container"},r.createElement(Le.VK,null,r.createElement(ke.rs,null,r.createElement(ke.AW,{path:"/**/pages/statistics"},"ExerciseList",r.createElement(Qt,null)),r.createElement(ke.AW,{path:"/**/pages/exercise"},r.createElement(kt,null)),r.createElement(ke.AW,{path:"/**/pages/exercise-settings"},r.createElement(Vt,null)),r.createElement(ke.AW,{path:"/**/pages/strategy-settings"},r.createElement(zt,null)),r.createElement(ke.AW,{path:"/**/pages/survey"},r.createElement(Pt,null)),r.createElement(ke.AW,{path:"/**/pages/exercises-list"},r.createElement(Tt,null)))))),null),document.getElementById("root"))}},n={};function s(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}};return t[e].call(i.exports,i,i.exports,s),i.exports}s.m=t,e=[],s.O=(t,n,r,i)=>{if(!n){var o=1/0;for(d=0;d<e.length;d++){for(var[n,r,i]=e[d],a=!0,l=0;l<n.length;l++)(!1&i||o>=i)&&Object.keys(s.O).every((e=>s.O[e](n[l])))?n.splice(l--,1):(a=!1,i<o&&(o=i));if(a){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[n,r,i]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={47:0};s.O.j=t=>0===e[t];var t=(t,n)=>{var r,i,[o,a,l]=n,c=0;if(o.some((t=>0!==e[t]))){for(r in a)s.o(a,r)&&(s.m[r]=a[r]);if(l)var d=l(s)}for(t&&t(n);c<o.length;c++)i=o[c],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(d)},n=self.webpackChunkcomp_prehension=self.webpackChunkcomp_prehension||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=s.O(void 0,[736],(()=>s(9602)));r=s.O(r)})();