(()=>{"use strict";var e,t,n,s={5101:(e,t,n)=>{var s=n(745),r=n(7294),i=(n(8660),n(4846)),a=n(935);function o(e,t){return a.G0([e,a.lB,a.S1,a.i0("")],null!=t?t:e.name)}function l(e){return new Promise((t=>setTimeout((()=>t()),e)))}function c(e){return null!=e}a.G0([a.lB,a.S1,a.i0("")]);const d=a.dt({attemptId:a.pk,exerciseId:a.pk,questionIds:a.IX(a.pk)},"ExerciseAttempt"),u=o(d),m=a.dt({attemptId:a.pk,questionsCount:a.pk,totalInteractionsCount:a.pk,totalInteractionsWithErrorsCount:a.pk,averageGrade:a.pk},"ExerciseStatisticsItem"),p=a.IX(m),g=a.jV([a.dt({answer:a.bc([a.pk,a.pk]),isÐ¡reatedByUser:a.O7}),a.r$({createdByInteraction:a.G0([a.pk,a.lB])})]),v=a.dt({name:a.Z_,canCreateSupplementaryQuestion:a.O7}),h=a.G0([a.dt({type:a.i0("SUCCESS"),message:a.Z_,violationLaw:v}),a.dt({type:a.i0("ERROR"),message:a.Z_,violationLaw:v})]),E=a.jV([a.dt({isCorrect:a.O7}),a.r$({isCorrect:a.O7,grade:a.G0([a.pk,a.lB]),violations:a.G0([a.IX(a.pk),a.lB]),correctAnswers:a.G0([a.IX(g),a.lB]),correctSteps:a.G0([a.pk,a.lB]),stepsLeft:a.G0([a.pk,a.lB]),stepsWithErrors:a.G0([a.pk,a.lB]),message:a.G0([a.IX(h),a.lB]),strategyDecision:a.G0([a.mM({CONTINUE:null,FINISH:null}),a.lB])})],"Feedback"),f=a.jV([E,a.r$({trace:a.G0([a.IX(a.Z_),a.lB])})]),y=a.dt({requireContext:a.O7,showSupplementaryQuestions:a.O7},"QuestionOptions"),w=a.jV([y,a.dt({showTrace:a.O7,multipleSelectionEnabled:a.O7,requireAllAnswers:a.O7}),a.r$({orderNumberOptions:a.jV([a.dt({delimiter:a.Z_,position:a.mM({PREFIX:null,SUFFIX:null,NONE:null})}),a.r$({replacers:a.G0([a.IX(a.Z_),a.lB])})])})],"OrderQuestionOptions"),x=a.jV([y,a.dt({multipleSelectionEnabled:a.O7}),a.G0([a.dt({displayMode:a.i0("combobox")}),a.dt({displayMode:a.i0("dragNdrop"),draggableStyle:a.Z_,dropzoneStyle:a.Z_,dropzoneHtml:a.Z_})])],"MatchingQuestionOptions"),b=a.jV([y,a.dt({displayMode:a.mM({radio:null,dragNdrop:null})})],"SingleChoiceQuestionOptions"),C=a.jV([y,a.G0([a.jV([a.dt({displayMode:a.i0("switch")}),a.r$({selectorReplacers:a.G0([a.bc([a.Z_,a.Z_]),a.lB])})]),a.dt({displayMode:a.i0("dragNdrop"),dropzoneHtml:a.Z_,dropzoneStyle:a.Z_,draggableStyle:a.Z_})])],"MultiChoiceQuestionOptions"),S=a.mM({SINGLE_CHOICE:null,MULTI_CHOICE:null,MATCHING:null,ORDER:null},"QuestionType"),_=a.Z_,I=a.dt({id:a.pk,text:_},"QuestionAnswer"),N=a.dt({attemptId:a.pk,questionId:a.pk,type:S,options:y,text:_,answers:a.IX(I),responses:a.G0([a.IX(g),a.lB]),feedback:a.G0([E,a.lB])},"QuestionBase"),A=a.jV([N,a.dt({type:a.i0("ORDER"),options:w,feedback:a.G0([f,a.lB])}),a.r$({initialTrace:a.G0([a.IX(a.Z_),a.lB])})],"OrderQuestion"),O=a.jV([N,a.dt({type:a.i0("SINGLE_CHOICE"),options:b})],"SingleChoiceQuestion"),q=a.jV([N,a.dt({type:a.i0("MULTI_CHOICE"),options:C})],"MultiChoiceQuestion"),k=a.jV([N,a.dt({type:a.i0("MATCHING"),answers:a.IX(I),groups:a.IX(I),options:x})],"MatchingQuestion"),L=a.G0([A,O,q,k],"Question"),Q=o(L);var D=n(7997),T=n(5974),R=n(7967),M=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};function j(e,t){return M(this,void 0,void 0,(function*(){return console.log(`ajax get: ${e}`),yield P(e,void 0,t)}))}function $(e,t,n){return M(this,void 0,void 0,(function*(){const s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return console.log(`ajax post: ${e}`,t),yield P(e,s,n)}))}function P(e,t,n){return M(this,void 0,void 0,(function*(){const s=new D.Fetcher(e,t).handle(200,(e=>(0,T.right)(e)),n).handle(500,(e=>(0,T.left)(e))).discardRest((()=>(0,T.left)({message:"Unexpected server error"}))),[r,i]=yield s.run().catch((()=>M(this,void 0,void 0,(function*(){return[(0,T.left)({message:"Connection error"}),R.none]}))));if(T.fold((e=>console.error(e)),(e=>console.log(e)))(r),R.isSome(i)){const e={message:`Type inconsistency for properties of ${null==n?void 0:n.name} type: ${V(i.value).join(", ")}`};return console.error(e),(0,T.left)(e)}return r}))}const V=e=>e.map((e=>e.context.map((({key:e})=>e)).join("."))),Z=a.mM({EN:null,RU:null,PL:null}),G=a.dt({id:a.pk,displayName:a.Z_,email:a.G0([a.Z_,a.lB]),language:Z},"UserInfo"),F=a.jV([a.dt({forceNewAttemptCreationEnabled:a.O7,newQuestionGenerationEnabled:a.O7,supplementaryQuestionsEnabled:a.O7,correctAnswerGenerationEnabled:a.O7}),a.r$({surveyOptions:a.dt({enabled:a.O7,surveyId:a.Z_})})],"ExerciseOptions"),z=a.dt({id:a.pk,options:F},"Exercise");let H=class{getCurrentUser(){return j("/api/users/whoami",G)}getExerciseShortInfo(e){return j(`/api/exercise/shortInfo?id=${e}`,z)}getQuestion(e){return j(`/api/exercise/getQuestion?questionId=${e}`,L)}generateQuestion(e){return j(`/api/exercise/generateQuestion?attemptId=${e}`,L)}generateSupplementaryQuestion(e){return $("/api/exercise/generateSupplementaryQuestion",e,Q)}generateNextCorrectAnswer(e){return j(`/api/exercise/generateNextCorrectAnswer?questionId=${e}`,E)}addQuestionAnswer(e){return $("/api/exercise/addQuestionAnswer",e,E)}getExerciseAttempt(e){return j(`/api/exercise/getExerciseAttempt?attemptId=${e}`,d)}getExistingExerciseAttempt(e){return j(`/api/exercise/getExistingExerciseAttempt?exerciseId=${e}`,u)}createExerciseAttempt(e){return j(`/api/exercise/createExerciseAttempt?exerciseId=${e}`,d)}createDebugExerciseAttempt(e){return j(`/api/exercise/createDebugExerciseAttempt?exerciseId=${e}`,d)}getExerciseStatistics(e){return j(`/api/exercise/getExerciseStatistics?exerciseId=${e}`,p)}getExercises(){return j("/api/exercise/getExercises",a.IX(a.pk))}};H=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}([(0,i.b2)()],H);var B=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};let U=class{getCurrentUser(){return B(this,void 0,void 0,(function*(){return T.right({id:999999,displayName:"front user",email:"test@mail.ru",roles:["ADMIN"],language:"EN"})}))}getExerciseShortInfo(e){return B(this,void 0,void 0,(function*(){return T.right({id:-1,options:{forceNewAttemptCreationEnabled:!1,correctAnswerGenerationEnabled:!0,newQuestionGenerationEnabled:!0,supplementaryQuestionsEnabled:!0}})}))}getExistingExerciseAttempt(e){return B(this,void 0,void 0,(function*(){return console.log(`getExistingExerciseAttempt?exerciseId=${e}`),T.right("")}))}createExerciseAttempt(e){return B(this,void 0,void 0,(function*(){return console.log(`createExerciseAttempt?exerciseId=${e}`),yield l(3e3),T.right({attemptId:-1,exerciseId:-1,questionIds:[1,2,3,4,5,6,7]})}))}createDebugExerciseAttempt(e){return B(this,void 0,void 0,(function*(){return console.log(`createDebugExerciseAttempt?exerciseId=${e}`),yield l(3e3),T.right({attemptId:-1,exerciseId:-1,questionIds:[1,2,3,4,5,6,7]})}))}getQuestion(e){return B(this,void 0,void 0,(function*(){let t;return console.log(`getQuestion?questionId=${e}`),yield l(3e3),1===e&&(t={type:"SINGLE_CHOICE",attemptId:-1,questionId:1,text:"question text",answers:[{id:0,text:"answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:1,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:2,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "}],responses:[],feedback:null,options:{requireContext:!1,showSupplementaryQuestions:!0,displayMode:"radio"}}),2===e&&(t={type:"MULTI_CHOICE",attemptId:-1,questionId:2,text:"question text",answers:[{id:0,text:"answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:1,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "},{id:2,text:"answer2answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 answer1 answer1 answer1answer1answer1answer1answer1 answer1answer1 "}],responses:[],feedback:null,options:{requireContext:!1,showSupplementaryQuestions:!0,displayMode:"switch"}}),3===e&&(t={type:"SINGLE_CHOICE",attemptId:-1,questionId:3,text:'question text with <span id="answer_0">select1</span> and <span id="answer_1">select2</span>',answers:[],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"radio"}}),4===e&&(t={type:"MULTI_CHOICE",attemptId:-1,questionId:4,text:'question text with <span id="answer_0"></span> and <span id="answer_1"></span>',answers:[],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"switch"}}),5===e&&(t={type:"MATCHING",attemptId:-1,questionId:5,text:"question text ",answers:[{id:0,text:"test1"},{id:1,text:"test2"},{id:3,text:"test3"}],groups:[{id:0,text:'<div style="width:70px; height: 40px;">group1<div/>'},{id:1,text:'<div style="width:50px;height: 100px;">group2 group2 group2 group2<div/>'}],responses:[],feedback:null,options:{requireContext:!1,showSupplementaryQuestions:!0,displayMode:"dragNdrop",multipleSelectionEnabled:!0,dropzoneStyle:'{ "display": "inline-block", "minHeight": "40px", "minWidth": "80px" }',dropzoneHtml:"drop",draggableStyle:'{ "padding": "10px", "border": "5px solid", "borderRadius": "5px", "borderColor": "black", "backgroundColor": "white" }'}}),6===e&&(t={type:"MATCHING",attemptId:-1,questionId:6,text:'question text with <span id="answer_0">drop</span> and <span id="answer_1">drop</span>',answers:[],groups:[{id:0,text:'<div style="width:70px; height: 40px;">group1<div/>'},{id:1,text:'<div style="width:50px;height: 100px;">group2 group2 group2 group2<div/>'}],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"dragNdrop",multipleSelectionEnabled:!1,dropzoneStyle:'{ "display": "inline-block", "minHeight": "40px", "minWidth": "80px" }',dropzoneHtml:"drop",draggableStyle:'{ "padding": "10px", "border": "5px solid", "borderRadius": "5px", "borderColor": "black", "backgroundColor": "white" }'}}),7===e&&(t={type:"MULTI_CHOICE",attemptId:-1,questionId:7,text:'question text with <span id="answer_0"></span> and <span id="answer_1"></span>',answers:[],responses:[],feedback:null,options:{requireContext:!0,showSupplementaryQuestions:!0,displayMode:"dragNdrop",dropzoneStyle:'{ "display": "inline-block", "height": "20px", "width": "20px" }',dropzoneHtml:"",draggableStyle:'{ "height": "20px", "width": "20px" }'}}),t?T.right(t):T.left({message:"No such question"})}))}generateQuestion(e){return B(this,void 0,void 0,(function*(){return console.log(`generateQuestion?attemptId=${e}`),yield l(3e3),T.left({message:"Method not implemented."})}))}generateSupplementaryQuestion(e){return B(this,void 0,void 0,(function*(){return console.log("generateSupplementaryQuestion",e),yield l(3e3),T.left({message:"Method not implemented."})}))}generateNextCorrectAnswer(e){return B(this,void 0,void 0,(function*(){return console.log(`generateNextCorrectAnswer?questionId=${e}`),yield l(3e3),T.left({message:"Method not implemented."})}))}addQuestionAnswer(e){return B(this,void 0,void 0,(function*(){return console.log("addQuestionAnswer",e),yield l(3e3),T.right({isCorrect:!0,grade:.8,correctAnswers:e.answers,correctSteps:1,stepsLeft:1,stepsWithErrors:1,messages:null,strategyDecision:"CONTINUE"})}))}getExerciseStatistics(e){return B(this,void 0,void 0,(function*(){return console.log(`getExerciseStatistics?exerciseId=${e}`),T.left({message:"Method not implemented."})}))}getExercises(){return B(this,void 0,void 0,(function*(){return console.log("getExercises"),T.left({message:"Method not implemented."})}))}getExerciseAttempt(e){return B(this,void 0,void 0,(function*(){return console.log(`getExerciseAttempt?attemptId=${e}`),T.left({message:"Method not implemented."})}))}};U=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}([(0,i.b2)()],U);var X=n(8949),W=n(427),J=n(902),K=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ee=class{constructor(e){this.exerciseController=e,this.isFeedbackVisible=!0,this.isQuestionFreezed=!1,this.feedback=void 0,this.question=void 0,this.lastAnswer=[],this.answersHistory=[],this.questionState="INITIAL",this.storeState={tag:"VALID"},this.onQuestionLoaded=e=>{var t,n;e.options.requireContext&&[...e.text.matchAll(/(\<\w.*?\sid\s*?\=([\'\"]))\s*(answer_(\d+?))\2(.*?\>)/gim)].forEach(((t,n)=>{e.text=e.text.replace(t[0],`${t[1]}question_${e.questionId}_${t[3]}_${n}${t[2]} data-answer-id='${t[4]}' ${t[5]}`)})),this.question=e,this.feedback=null!==(t=e.feedback)&&void 0!==t?t:void 0,this.isFeedbackVisible=!0,this.answersHistory=[],this.lastAnswer=null!==(n=e.responses)&&void 0!==n?n:[],e.feedback&&0===e.feedback.stepsLeft&&this.setQuestionState("COMPLETED")},this.setQuestionState=e=>{this.questionState!==e&&(this.questionState=e)},this.setValidStoreState=()=>{"VALID"!==this.storeState.tag&&(this.storeState={tag:"VALID"})},this.setErrorStoreState=e=>{this.storeState={tag:"ERROR",error:e}},this.loadQuestion=(0,X.ls)((function*(e){this.setValidStoreState(),this.setQuestionState("LOADING");const t=yield this.exerciseController.getQuestion(e);this.setQuestionState("LOADED"),T.isLeft(t)?this.setErrorStoreState(t.left):this.onQuestionLoaded(t.right)})),this.generateQuestion=(0,X.ls)((function*(e){this.setValidStoreState(),this.setQuestionState("LOADING");const t=yield this.exerciseController.generateQuestion(e);this.setQuestionState("LOADED"),T.isLeft(t)?this.setErrorStoreState(t.left):this.onQuestionLoaded(t.right)})),this.generateSupplementaryQuestion=(0,X.ls)((function*(e,t,n){this.setValidStoreState();const s={exerciseAttemptId:e,questionId:t,violationLaws:(0,J.pipe)(W.fromArray(n),R.getOrElse((()=>["invalid_law"])))};this.setQuestionState("LOADING");const r=yield this.exerciseController.generateSupplementaryQuestion(s);this.setQuestionState("LOADED"),T.isLeft(r)?this.setErrorStoreState(r.left):r.right&&this.onQuestionLoaded(r.right)})),this.generateNextCorrectAnswer=(0,X.ls)((function*(){const{question:e}=this;if(!e)throw new Error("Current question not found");this.setValidStoreState(),this.setQuestionState("ANSWER_EVALUATING");const t=yield this.exerciseController.generateNextCorrectAnswer(e.questionId);this.setQuestionState("LOADED"),T.isLeft(t)?this.setErrorStoreState(t.left):this.onAnswerEvaluated(t.right)})),this.sendAnswersImpl=(0,X.ls)((function*(e,t,n){const s=(0,X.ZN)({attemptId:e,questionId:t,answers:(0,X.ZN)([...n])});this.setValidStoreState(),this.setQuestionState("ANSWER_EVALUATING");const r=yield this.exerciseController.addQuestionAnswer(s);this.setQuestionState("LOADED"),T.isLeft(r)?this.setErrorStoreState(r.left):this.onAnswerEvaluated(r.right)})),this.sendAnswers=(0,X.ls)((function*(){const{question:e,lastAnswer:t}=this;e&&(yield this.sendAnswersImpl(e.attemptId,e.questionId,(0,X.ZN)(t)))})),this.onAnswersChanged=(0,X.ls)((function*(e,t=!0){if(this.answersHistory.push(e),t)try{yield this.sendAnswers()}catch(e){this.answersHistory.pop()}})),this.setFullAnswer=(0,X.ls)((function*(e,t=!0){if(!this.isAnswerChanged(e))return!1;const n=this.lastAnswer;if(this.lastAnswer=e,n.length>0&&this.answersHistory.push(n),!t)return!0;try{return yield this.sendAnswers(),!0}catch(e){return this.lastAnswer=n,n.length>0&&this.answersHistory.pop(),!1}})),this.isAnswerChanged=e=>{const{lastAnswer:t,question:n}=this;if(!n)throw new Error("no question");const s=t.map((e=>e.answer)),r=e.map((e=>e.answer));switch(n.type){case"ORDER":return r.length!==s.length||JSON.stringify(r)!==JSON.stringify(s);case"MATCHING":case"MULTI_CHOICE":case"SINGLE_CHOICE":return r.length!==s.length||JSON.stringify(r.sort())!==JSON.stringify(s.sort())}},(0,X.rC)(this)}onAnswerEvaluated(e){this.feedback=e,this.isFeedbackVisible=!0,e&&e.correctAnswers&&(this.setFullAnswer(e.correctAnswers,!1),c(e.stepsLeft)&&0===e.stepsLeft&&this.setQuestionState("COMPLETED"))}};var te,ne;K([X.LO,Y("design:type",Boolean)],ee.prototype,"isFeedbackVisible",void 0),K([X.LO,Y("design:type",Boolean)],ee.prototype,"isQuestionFreezed",void 0),K([X.LO,Y("design:type",Object)],ee.prototype,"feedback",void 0),K([X.LO,Y("design:type",Object)],ee.prototype,"question",void 0),K([X.LO,Y("design:type",Array)],ee.prototype,"lastAnswer",void 0),K([X.LO,Y("design:type",Array)],ee.prototype,"answersHistory",void 0),K([X.LO,Y("design:type",String)],ee.prototype,"questionState",void 0),K([X.LO,Y("design:type",Object)],ee.prototype,"storeState",void 0),K([X.aD,Y("design:type",Object)],ee.prototype,"setQuestionState",void 0),K([X.aD,Y("design:type",Object)],ee.prototype,"setValidStoreState",void 0),K([X.aD,Y("design:type",Object)],ee.prototype,"setErrorStoreState",void 0),ee=K([(0,i.b2)(),(te=0,ne=(0,i.f3)(H),function(e,t){ne(e,t,te)}),Y("design:paramtypes",[Object])],ee);var se=n(8752);const re=a.G0([a.dt({kind:a.i0("AFTER_FIRST")}),a.dt({kind:a.i0("AFTER_LAST")}),a.dt({kind:a.i0("AFTER_EACH")}),a.dt({kind:a.i0("AFTER_SPECIFIC"),numbers:a.IX(a.pk)})]),ie=a.dt({id:a.pk,type:a.i0("yes-no"),text:a.Z_,policy:re,required:a.O7,options:a.dt({yesText:a.Z_,yesValue:a.Z_,noText:a.Z_,noValue:a.Z_})},"YesNoSurveyQuestion"),ae=a.dt({id:a.pk,type:a.i0("single-choice"),text:a.Z_,policy:re,required:a.O7,options:a.IX(a.dt({id:a.Z_,text:a.Z_}))}),oe=a.dt({id:a.pk,type:a.i0("open-ended"),text:a.Z_,policy:re,required:a.O7}),le=a.G0([ie,ae,oe]),ce=a.dt({surveyId:a.Z_,options:a.dt({}),questions:a.IX(le)},"Survey"),de=a.dt({surveyQuestionId:a.pk,questionId:a.pk,answer:a.Z_});var ue=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};let me=class{constructor(){this.surveyCache={}}getSurvey(e){return ue(this,void 0,void 0,(function*(){if(this.surveyCache[e])return T.right(this.surveyCache[e]);var t=yield j(`/api/survey/${e}`,ce);return T.isRight(t)&&(this.surveyCache[e]=t.right),t}))}postSurveyAnswer(e,t,n){return ue(this,void 0,void 0,(function*(){return $("/api/survey",{surveyQuestionId:e,questionId:t,answer:n})}))}getCurrentUserAttemptSurveyVotes(e,t){return ue(this,void 0,void 0,(function*(){return j(`/api/survey/${encodeURIComponent(e)}/user-votes?attemptId=${t}`,a.IX(de))}))}};me=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}([(0,i.b2)()],me);var pe=n(3258);function ge(e){return new URLSearchParams(window.location.search).get(e)}var ve=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},he=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ee=function(e,t){return function(n,s){t(n,s,e)}},fe=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};let ye=class{constructor(e,t,n){this.exerciseController=e,this.surveyController=t,this.isSessionLoading=!1,this.user=void 0,this.exercise=void 0,this.currentAttemptId=void 0,this.currentAttempt=void 0,this.exerciseState="INITIAL",this.storeState={tag:"VALID"},this.survey=void 0,this.isDebug=!1,this.registerOnStrategyDecisionChangedAction=()=>{(0,X.EH)((()=>{var e;"FINISH"===(null===(e=this.currentQuestion.feedback)||void 0===e?void 0:e.strategyDecision)&&"COMPLETED"!==this.exerciseState&&this.setExerciseState("COMPLETED")}))},this.forceSetValidState=()=>{"VALID"!==this.storeState.tag&&(this.storeState={tag:"VALID"})},this.setExerciseState=e=>{this.exerciseState!==e&&(this.exerciseState=e)},this.setSurveyAnswers=(e,t)=>{this.survey&&(0,X.z)((()=>{this.survey.questions[e].status="COMPLETED",this.survey.questions[e].results=t}))},this.loadSessionInfo=()=>fe(this,void 0,void 0,(function*(){if(this.exercise)throw new Error("exerciseInfo loaded");if(this.isSessionLoading)return;(0,X.z)((()=>{this.forceSetValidState(),this.isSessionLoading=!0}));const[e,t]=yield Promise.all([this.exerciseController.getCurrentUser(),this.exerciseController.getExerciseShortInfo(this.exerciseId)]);T.isRight(e)&&T.isRight(t)?(0,X.z)((()=>{this.isSessionLoading=!1,this.onSessionLoaded(e.right,t.right)})):T.isLeft(e)&&T.isLeft(t)&&(0,X.z)((()=>{var n;this.isSessionLoading=!1,this.storeState={tag:"ERROR",error:null!==(n=e.left)&&void 0!==n?n:t.left}}))})),this.loadExerciseAttempt=(0,X.ls)((function*(e){const{exercise:t}=this;if(!t)throw new Error("exerciseInfo is not defined");this.forceSetValidState(),t.id;const n=yield this.exerciseController.getExerciseAttempt(e);if(T.isLeft(n))return void(this.storeState={tag:"ERROR",error:n.left});const s=n.right;return!!s&&(this.currentAttempt=s,yield this.onAttemptLoaded(),!0)})),this.loadExistingExerciseAttempt=(0,X.ls)((function*(){const{exercise:e}=this;if(!e)throw new Error("exercise is not defined");this.forceSetValidState();const t=e.id,n=yield this.exerciseController.getExistingExerciseAttempt(t);if(T.isLeft(n))return void(this.storeState={tag:"ERROR",error:n.left});const s=n.right;return!!s&&(this.currentAttempt=s,yield this.onAttemptLoaded(),!0)})),this.onAttemptLoaded=()=>fe(this,void 0,void 0,(function*(){yield this.loadSurvey()})),this.createExerciseAttempt=(0,X.ls)((function*(){const{exercise:e}=this;if(!e)throw new Error("exercise is not defined");this.forceSetValidState();const t=e.id,n=yield this.exerciseController.createExerciseAttempt(+t);T.isLeft(n)?this.storeState={tag:"ERROR",error:n.left}:(this.currentAttempt=n.right,yield this.onAttemptLoaded())})),this.createDebugExerciseAttempt=(0,X.ls)((function*(){const{exercise:e}=this;if(!e)throw new Error("exercise is not defined");this.forceSetValidState();const t=e.id,n=yield this.exerciseController.createDebugExerciseAttempt(+t);T.isLeft(n)?this.storeState={tag:"ERROR",error:n.left}:(this.currentAttempt=n.right,yield this.onAttemptLoaded())})),this.generateQuestion=(0,X.ls)((function*(){var e,t;const{exercise:n,currentAttempt:s}=this;if(!n||!s)throw new Error("Session is not defined");this.forceSetValidState(),yield this.currentQuestion.generateQuestion(s.attemptId),s.questionIds.push(null!==(t=null===(e=this.currentQuestion.question)||void 0===e?void 0:e.questionId)&&void 0!==t?t:-1)})),this.changeLanguage=e=>{this.user&&this.user.language!==e&&(this.user.language=e,se.ZP.changeLanguage(e))},this.loadSurvey=()=>fe(this,void 0,void 0,(function*(){var e;if(this.survey||!this.currentAttempt||!this.exercise)return;if(!(null===(e=this.exercise.options.surveyOptions)||void 0===e?void 0:e.enabled)||0===this.exercise.options.surveyOptions.surveyId.length)return;const t=this.exercise.options.surveyOptions.surveyId,n=this.currentAttempt.attemptId,[s,r]=yield Promise.all([this.surveyController.getSurvey(t),this.surveyController.getCurrentUserAttemptSurveyVotes(t,n)]);(0,X.z)((()=>{if(T.isRight(s)&&T.isRight(r)){const e=function(e,t){const n=new Map;return e.forEach((e=>{const t=e.questionId,s=n.get(t);s?s.push(e):n.set(t,[e])})),n}(r.right);this.survey={survey:s.right,questions:[...e.keys()].map((t=>{var n,s,r,i;return{questionId:t,status:"COMPLETED",questions:null!==(s=null===(n=e.get(t))||void 0===n?void 0:n.map((e=>e.surveyQuestionId)))&&void 0!==s?s:[],results:null!==(i=null===(r=e.get(t))||void 0===r?void 0:r.reduce(((e,t)=>(e[t.surveyQuestionId]=t.answer,e)),{}))&&void 0!==i?i:{}}})).reduce(((e,t)=>(e[t.questionId]=t,e)),{})},console.log("Loaded survey"),console.log((0,X.ZN)(this.survey))}}))})),this.ensureQuestionSurveyExists=e=>{var t,n,s;if(null===(t=this.survey)||void 0===t?void 0:t.questions[e])return null===(n=this.survey)||void 0===n?void 0:n.questions[e].questions;const r=[],i=this.currentAttempt.questionIds.findIndex((e=>{var t;return e===(null===(t=this.currentQuestion.question)||void 0===t?void 0:t.questionId)}));for(let e of(null===(s=this.survey)||void 0===s?void 0:s.survey.questions)||[]){const t=e.policy;("AFTER_EACH"===t.kind||"AFTER_FIRST"===t.kind&&0===i||"AFTER_LAST"===t.kind&&"COMPLETED"===this.exerciseState||"AFTER_SPECIFIC"===t.kind&&t.numbers.includes(i+1))&&r.push(e)}console.log("Selected questions"),console.log((0,X.ZN)(r));var a={questionId:e,status:"ACTIVE",questions:r.map((e=>e.id)),results:{}};return(0,X.z)((()=>{this.survey.questions[e]=a})),r.map((e=>e.id))},this.isDebug=null!==ge("debug"),this.currentQuestion=n;const s=ge("exerciseId");null===s&&(this.exerciseState="LAUNCH_ERROR",this.storeState={tag:"ERROR",error:{message:"Invalid exercise id"}}),this.exerciseId=null!==s?+s:-1;const r=ge("attemptId");null!==r&&(this.currentAttemptId=+r),(0,X.rC)(this),this.registerOnStrategyDecisionChangedAction()}onSessionLoaded(e,t){(0,X.z)((()=>{this.user=e,this.exercise=t,e.language!==se.ZP.language&&se.ZP.changeLanguage(e.language)}))}};ve([X.LO,he("design:type",Boolean)],ye.prototype,"isSessionLoading",void 0),ve([X.LO,he("design:type",Object)],ye.prototype,"user",void 0),ve([X.LO,he("design:type",Number)],ye.prototype,"exerciseId",void 0),ve([X.LO,he("design:type",Object)],ye.prototype,"exercise",void 0),ve([X.LO,he("design:type",Number)],ye.prototype,"currentAttemptId",void 0),ve([X.LO,he("design:type",Object)],ye.prototype,"currentAttempt",void 0),ve([X.LO,he("design:type",ee)],ye.prototype,"currentQuestion",void 0),ve([X.LO,he("design:type",String)],ye.prototype,"exerciseState",void 0),ve([X.LO,he("design:type",Object)],ye.prototype,"storeState",void 0),ve([X.LO,he("design:type",Object)],ye.prototype,"survey",void 0),ve([X.LO,he("design:type",Object)],ye.prototype,"isDebug",void 0),ve([X.aD,he("design:type",Object)],ye.prototype,"forceSetValidState",void 0),ve([X.aD,he("design:type",Object)],ye.prototype,"setExerciseState",void 0),ve([X.aD,he("design:type",Object)],ye.prototype,"setSurveyAnswers",void 0),ve([X.aD,he("design:type",Object)],ye.prototype,"changeLanguage",void 0),ve([X.aD,he("design:type",Object)],ye.prototype,"loadSurvey",void 0),ve([X.aD,he("design:type",Object)],ye.prototype,"ensureQuestionSurveyExists",void 0),ye=ve([(0,i.b2)(),Ee(0,(0,i.f3)(H)),Ee(1,(0,i.f3)(me)),Ee(2,(0,i.f3)(ee)),he("design:paramtypes",[Object,me,ee])],ye);var we=n(1072);const xe=a.dt({id:a.pk,name:a.Z_}),be=a.dt({name:a.Z_,kind:a.mM({FORBIDDEN:null,PERMITTED:null,TARGETED:null})}),Ce=a.dt({name:a.Z_,kind:a.mM({FORBIDDEN:null,PERMITTED:null,TARGETED:null})}),Se=a.dt({numberOfQuestions:a.pk,concepts:a.IX(be),laws:a.IX(Ce)}),_e=a.dt({id:a.pk,name:a.Z_,domainId:a.Z_,strategyId:a.Z_,backendId:a.Z_,complexity:a.pk,stages:function(e,t=`NonEmptyArray<${e.name}>`){const n=a.IX(e);return new a.Dy(t,(e=>n.is(e)&&(0,pe.isNonEmpty)(e)),((e,t)=>(0,J.pipe)(n.validate(e,t),(0,T.chain)((n=>{const s=(0,W.fromArray)(n);return(0,R.isNone)(s)?a.Rn(e,t):a.Vp(s.value)})))),(0,W.map)(e.encode))}(Se),tags:a.IX(a.Z_),options:F}),Ie=a.dt({name:a.Z_,displayName:a.Z_,bitflags:a.pk});var Ne;!function(e){e[e.VisibleToTeacher=1]="VisibleToTeacher",e[e.TargetEnabled=2]="TargetEnabled"}(Ne||(Ne={}));const Ae=a.sH("DomainConcept",(()=>a.dt({name:a.Z_,displayName:a.Z_,bitflags:a.pk,childs:a.IX(Ae)}))),Oe=a.dt({id:a.Z_,name:a.Z_,laws:a.IX(Ie),concepts:a.IX(Ae)}),qe=a.dt({id:a.Z_,options:a.dt({multiStagesEnabled:a.O7})});let ke=class{getAllExercises(){return j("/api/exercise/all",a.IX(xe))}getExercise(e){return j(`/api/exercise?id=${encodeURIComponent(e)}`,_e)}saveExercise(e){return $("/api/exercise",(0,X.ZN)(e))}createExercise(e,t,n){return function(e,t,n){return M(this,void 0,void 0,(function*(){const s={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return console.log(`ajax put: ${e}`,t),yield P(e,s,n)}))}("/api/exercise",{name:e,domainId:t,strategyId:n},a.pk)}deleteExercise(e){return function(e,t){return M(this,void 0,void 0,(function*(){return console.log(`ajax delete: ${e}`),yield P(e,{method:"DELETE",headers:{"Content-Type":"application/json"}},undefined)}))}(`/api/exercise?id=${encodeURIComponent(e)}`)}getStrategies(){return j("/api/refTables/strategies",a.IX(qe))}getBackends(){return j("/api/refTables/backends",a.IX(a.Z_))}getDomains(){return j("/api/refTables/domains",a.IX(Oe))}getDomainLaws(e){return j(`/api/refTables/domainLaws?domaindId=${encodeURIComponent(e)}`,a.IX(a.Z_))}getDomainConcepts(e){return j(`/api/refTables/domainConcepts?domaindId=${encodeURIComponent(e)}`,a.IX(a.Z_))}};ke=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}([(0,i.b2)()],ke),i.nC.register(H,{useFactory:()=>{var e;return null!==(null!==(e=new URLSearchParams(window.location.search).get("sandbox"))&&void 0!==e?e:null)?new U:new H}}),i.nC.register(ee,ee),i.nC.registerSingleton(ye),i.nC.registerSingleton(me),i.nC.registerSingleton(ke),se.ZP.use(we.Db).init({resources:{EN:{translation:{question_header:"Question #{{questionNumber}}",language_header:"Language",signedin_as_header:"Signed in as",nextCorrectAnswerBtn:"I'm confused, tell me the next correct step",generateNextQuestion_nextQuestion:"Next question",generateNextQuestion_warning:"Warning",generateNextQuestion_continueAttempt:"Continue attempt",generateNextQuestion_modalMessage1:"It is recommended to move on to the next question only after solving all the previous ones.",generateNextQuestion_modalMessage2:"Are you sure you want to move on to the next question?",generateSupQuestion_gotit:"Got it",generateSupQuestion_details:"More details",grade_feeback:"Grade",correctsteps_feeback:"Correct steps",stepswitherrors_feeback:"Steps with errors",stepsleft_feeback:"Steps left",issolved_feeback:"Solved",foundExisitingAttempt_title:"Found existing attempt",foundExisitingAttempt_descr:"Would you like to continue the existing attempt or start a new one",foundExisitingAttempt_continueattempt:"Continue",foundExisitingAttempt_newattempt:"New",exercise_completed:"Exercise completed",exercisesettings_title:"Exercise settings",exercisesettings_name:"Name",exercisesettings_domain:"Domain",exercisesettings_strategy:"Strategy",exercisesettings_qcomplexity:"Question complexity",exercisesettings_answlen:"Answer length",exercisesettings_qopt:"Options",exercisesettings_qopt_forceAttCreation:"Always create a new attempt",exercisesettings_qopt_genCorAnsw:"Allow 'generate correct answer' button",exercisesettings_qopt_forceShowGenNextQ:"Always show 'generate new question' button",exercisesettings_qopt_supQ:"Allow supplementary questions",exercisesettings_survey:"Survey",exercisesettings_tags:"Tags",exercisesettings_commonConcepts:"Common concepts",exercisesettings_commonLaws:"Common laws",exercisesettings_stages:"Stage",exercisesettings_stageN:"Stage #{{stageNumber}}",exercisesettings_stageN_qnumber:"Number of questions",exercisesettings_stageN_concepts:"Concepts",exercisesettings_stageN_laws:"Laws",exercisesettings_addStage:"Add stage",exercisesettings_save:"Save",exercisesettings_saveNopen:"Save & Open",exercisesettings_open:"Open",exercisesettings_genDebugAtt:"Generate debug attempt",exercisesettings_optDenied:"Denied",exercisesettings_optAllowed:"Allowed",exercisesettings_optTarget:"Target",survey_sendresults:"Send survey results"}},RU:{translation:{question_header:"ÐÐ¾Ð¿ÑÐ¾Ñ #{{questionNumber}}",language_header:"Ð¯Ð·ÑÐº",signedin_as_header:"ÐÐ¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»Ñ",nextCorrectAnswerBtn:"Ð¯ Ð² Ð·Ð°Ð¼ÐµÑÐ°ÑÐµÐ»ÑÑÑÐ²Ðµ, Ð¿Ð¾Ð´ÑÐºÐ°Ð¶Ð¸ ÑÐ»ÐµÐ´ÑÑÑÐ¸Ð¹ ÐºÐ¾ÑÑÐµÐºÑÐ½ÑÐ¹ ÑÐ°Ð³",generateNextQuestion_nextQuestion:"Ð¡Ð»ÐµÐ´ÑÑÑÐ¸Ð¹ Ð²Ð¾Ð¿ÑÐ¾Ñ",generateNextQuestion_warning:"ÐÑÐµÐ´ÑÐ¿ÑÐµÐ¶Ð´ÐµÐ½Ð¸Ðµ",generateNextQuestion_continueAttempt:"ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ Ð¿Ð¾Ð¿ÑÑÐºÑ",generateNextQuestion_modalMessage1:"Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑÐµÑÑÑ Ð¿ÐµÑÐµÑÐ¾Ð´Ð¸ÑÑ Ðº ÑÐ»ÐµÐ´ÑÑÑÐµÐ¼Ñ Ð²Ð¾Ð¿ÑÐ¾ÑÑ ÑÐ¾Ð»ÑÐºÐ¾ Ð¿Ð¾ÑÐ»Ðµ ÑÐµÑÐµÐ½Ð¸Ñ Ð²ÑÐµÑ Ð¿ÑÐµÐ´ÑÐ´ÑÑÐ¸Ñ.",generateNextQuestion_modalMessage2:"ÐÑ Ð´ÐµÐ¹ÑÑÐ²Ð¸ÑÐµÐ»ÑÐ½Ð¾ ÑÐ¾ÑÐ¸ÑÐµ Ð¿ÐµÑÐµÐ¹ÑÐ¸ Ðº ÑÐ»ÐµÐ´ÑÑÑÐµÐ¼Ñ Ð²Ð¾Ð¿ÑÐ¾ÑÑ?",generateSupQuestion_gotit:"ÐÐ¾Ð½ÑÑÐ½Ð¾",generateSupQuestion_details:"Ð Ð°Ð·Ð¾Ð±ÑÐ°ÑÑÑÑ Ð¿Ð¾Ð´ÑÐ¾Ð±Ð½ÐµÐµ",grade_feeback:"ÐÑÐµÐ½ÐºÐ°",correctsteps_feeback:"ÐÑÐ°Ð²Ð¸Ð»ÑÐ½ÑÑ ÑÐ°Ð³Ð¾Ð²",stepswitherrors_feeback:"Ð¨Ð°Ð³Ð¾Ð² Ñ Ð¾ÑÐ¸Ð±ÐºÐ°Ð¼Ð¸",stepsleft_feeback:"Ð¨Ð°Ð³Ð¾Ð² Ð¾ÑÑÐ°Ð»Ð¾ÑÑ",issolved_feeback:"ÐÐ°Ð´Ð°ÑÐ° ÑÐµÑÐµÐ½Ð°",foundExisitingAttempt_title:"ÐÐ°Ð¹Ð´ÐµÐ½Ð° Ð½ÐµÐ¾ÐºÐ¾Ð½ÑÐµÐ½Ð½Ð°Ñ Ð¿Ð¾Ð¿ÑÑÐºÐ°",foundExisitingAttempt_descr:"ÐÑ ÑÐ¾ÑÐ¸ÑÐµ Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ ÑÑÑÐµÑÑÐ²ÑÑÑÑÑ Ð¿Ð¾Ð¿ÑÑÐºÑ Ð¸Ð»Ð¸ Ð½Ð°ÑÐ°ÑÑ Ð½Ð¾Ð²ÑÑ",foundExisitingAttempt_continueattempt:"ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ",foundExisitingAttempt_newattempt:"ÐÐ¾Ð²Ð°Ñ",exercise_completed:"Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²ÐµÑÑÐµÐ½Ð¾",exercisesettings_title:"ÐÐ°ÑÑÑÐ¾ÐºÐ° ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹",exercisesettings_name:"ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ",exercisesettings_domain:"ÐÐ¾Ð¼ÐµÐ½",exercisesettings_strategy:"Ð¡ÑÑÐ°ÑÐµÐ³Ð¸Ñ",exercisesettings_qcomplexity:"Ð¡Ð»Ð¾Ð¶Ð½Ð¾ÑÑÑ Ð²Ð¾Ð¿ÑÐ¾ÑÐ¾Ð²",exercisesettings_answlen:"ÐÐ»Ð¸Ð½Ð° Ð¾ÑÐ²ÐµÑÐ°",exercisesettings_qopt:"ÐÐ¿ÑÐ¸Ð¸",exercisesettings_qopt_forceAttCreation:"ÐÑÐµÐ³Ð´Ð° ÑÐ¾Ð·Ð´Ð°Ð²Ð°ÑÑ Ð½Ð¾Ð²ÑÑ Ð¿Ð¾Ð¿ÑÑÐºÑ",exercisesettings_qopt_genCorAnsw:"Ð Ð°Ð·ÑÐµÑÐ¸ÑÑ Ð¿Ð¾Ð´ÑÐºÐ°Ð·ÐºÑ ÑÐ»ÐµÐ´ÑÑÑÐµÐ³Ð¾ ÑÐ°Ð³Ð°",exercisesettings_qopt_forceShowGenNextQ:"Ð Ð°Ð·ÑÐµÑÐ¸ÑÑ Ð½ÐµÐ¾ÐºÐ¾Ð½ÑÐµÐ½Ð½ÑÐµ Ð²Ð¾Ð¿ÑÐ¾ÑÑ",exercisesettings_qopt_supQ:"Ð Ð°Ð·ÑÐµÑÐ¸ÑÑ Ð²ÑÐ¿Ð¾Ð¼Ð¾Ð³Ð°ÑÐµÐ»ÑÐ½ÑÐµ Ð²Ð¾Ð¿ÑÐ¾ÑÑ",exercisesettings_survey:"ÐÐ¿ÑÐ¾Ñ",exercisesettings_tags:"Ð¢ÑÐ³Ð¸",exercisesettings_commonConcepts:"ÐÐ±ÑÐ¸Ðµ ÐºÐ¾Ð½ÑÐµÐ¿ÑÑ",exercisesettings_commonLaws:"ÐÐ±ÑÐ¸Ðµ Ð·Ð°ÐºÐ¾Ð½Ñ",exercisesettings_stages:"Ð¡ÑÐ°Ð´Ð¸Ð¸ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ",exercisesettings_stageN:"Ð¡ÑÐ°Ð´Ð¸Ñ #{{stageNumber}}",exercisesettings_stageN_qnumber:"ÐÐ¾Ð»Ð¸ÑÐµÑÑÐ²Ð¾ Ð²Ð¾Ð¿ÑÐ¾ÑÐ¾Ð²",exercisesettings_stageN_concepts:"ÐÐ¾Ð½ÑÐµÐ¿ÑÑ",exercisesettings_stageN_laws:"ÐÐ°ÐºÐ¾Ð½Ñ",exercisesettings_addStage:"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ ÑÑÐ°Ð´Ð¸Ñ",exercisesettings_save:"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ",exercisesettings_saveNopen:"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ & ÐÑÐºÑÑÑÑ",exercisesettings_open:"ÐÑÐºÑÑÑÑ",exercisesettings_genDebugAtt:"Ð¡Ð¾Ð·Ð´Ð°ÑÑ Ð¾ÑÐ»Ð°Ð´Ð¾ÑÐ½ÑÑ Ð¿Ð¾Ð¿ÑÑÐºÑ",exercisesettings_optDenied:"ÐÐ°Ð¿ÑÐµÑ",exercisesettings_optAllowed:"Ð Ð°Ð·ÑÐµÑ.",exercisesettings_optTarget:"Ð¦ÐµÐ»Ñ",survey_sendresults:"ÐÑÐ¿ÑÐ°Ð²Ð¸ÑÑ ÑÐµÐ·ÑÐ»ÑÑÐ°ÑÑ Ð¾Ð¿ÑÐ¾ÑÐ°"}},PL:{translation:{question_header:"Pytanie #{{questionNumber}}",language_header:"JÄzyk",signedin_as_header:"Zalogowany jako",nextCorrectAnswerBtn:"Nie wiem co robiÄ dalej, podpowiedz mi nastÄpny poprawny krok",generateNextQuestion_nextQuestion:"NastÄpne pytanie",generateNextQuestion_warning:"OstrzeÅ¼enie",generateNextQuestion_continueAttempt:"Kontynuuj podejÅcie",generateNextQuestion_modalMessage1:"Zaleca siÄ przejÅcie do nastÄpnego pytania dopiero po rozwiÄzaniu wszystkich poprzednich.",generateNextQuestion_modalMessage2:"Czy na pewno chcesz przejÅÄ do nastÄpnego pytania?",generateSupQuestion_gotit:"OczywiÅcie!",generateSupQuestion_details:"Zobacz szczegÃ³Åy",grade_feeback:"Ocena",correctsteps_feeback:"Poprawne kroki",stepswitherrors_feeback:"Kroki z bÅÄdami",stepsleft_feeback:"PozostaÅe kroki",issolved_feeback:"RozwiÄzane",foundExisitingAttempt_title:"Znaleziono juÅ¼ istniejÄce podejÅcie",foundExisitingAttempt_descr:"Czy chcesz kontynuowaÄ dotychczasowe podejÅcie, czy rozpoczÄÄ nowe",foundExisitingAttempt_continueattempt:"Kontynuuj",foundExisitingAttempt_newattempt:"Nowe",exercise_completed:"Äwiczenie zakoÅczone",exercisesettings_title:"Exercise settings",exercisesettings_name:"Name",exercisesettings_domain:"Domain",exercisesettings_strategy:"Strategy",exercisesettings_qcomplexity:"Question complexity",exercisesettings_answlen:"Answer length",exercisesettings_qopt:"Options",exercisesettings_qopt_forceAttCreation:"Always create a new attempt",exercisesettings_qopt_genCorAnsw:"Allow 'generate correct answer' button",exercisesettings_qopt_forceShowGenNextQ:"Always show 'generate new question' button",exercisesettings_qopt_supQ:"Allow supplementary questions",exercisesettings_survey:"Survey",exercisesettings_tags:"Tags",exercisesettings_commonConcepts:"Common concepts",exercisesettings_commonLaws:"Common laws",exercisesettings_stages:"Stage",exercisesettings_stageN:"Stage #{{stageNumber}}",exercisesettings_stageN_qnumber:"Number of questions",exercisesettings_stageN_concepts:"Concepts",exercisesettings_stageN_laws:"Laws",exercisesettings_addStage:"Add stage",exercisesettings_save:"Save",exercisesettings_saveNopen:"Save & Open",exercisesettings_open:"Open",exercisesettings_genDebugAtt:"Generate debug attempt",exercisesettings_optDenied:"Denied",exercisesettings_optAllowed:"Allowed",exercisesettings_optTarget:"Target",survey_sendresults:"Send survey results"}}},lng:"EN",interpolation:{escapeValue:!1}});var Le=n(9655),Qe=n(9250),De=n(1647),Te=n(5005),Re=n(1131);const Me=(0,De.Pi)((e=>{const{isVisible:t,children:n}=e;return t?r.createElement(r.Fragment,null,n):null})),je=e=>{const{title:t,primaryBtnTitle:n,handlePrimaryBtnClicked:s,secondaryBtnTitle:i,handleSecondaryBtnClicked:a,children:o,closeButton:l,show:d,handleClose:u,type:m,size:p}=e;return r.createElement(Me,{isVisible:null==d||d},r.createElement($e,{type:null!=m?m:"MODAL",show:null==d||d,onHide:null!=u?u:void 0,size:p},r.createElement(Me,{isVisible:c(t)&&t.length>0},r.createElement(Re.Z.Header,{closeButton:null!=l?l:void 0},r.createElement(Re.Z.Title,null,t))),r.createElement(Re.Z.Body,null,o),i||n?r.createElement(Re.Z.Footer,null,i&&r.createElement(Te.Z,{variant:"secondary",onClick:null!=a?a:void 0},i),n&&r.createElement(Te.Z,{variant:"primary",onClick:null!=s?s:void 0},n)):null))},$e=e=>{const{type:t,show:n,onHide:s,children:i,size:a}=e;return"DIALOG"===t?r.createElement(Re.Z.Dialog,{size:a},i):r.createElement(Re.Z,{size:a,show:n,onHide:s},i)};var Pe=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};const Ve=(0,De.Pi)((()=>{const[e]=(0,r.useState)((()=>i.nC.resolve(ye))),{t}=(0,we.$G)(),[n,s]=(0,r.useState)(!1),{exercise:a,currentAttempt:o}=e,{question:l}=e.currentQuestion,c="ANSWER_EVALUATING"===e.currentQuestion.questionState,d="LOADING"===e.currentQuestion.questionState;if(!l||!a||!o||d||c)return null;const u=()=>{s(!1)},m=()=>Pe(void 0,void 0,void 0,(function*(){s(!1);const{questionIds:t=[]}=o,n=t.indexOf(l.questionId);n===t.length-1?yield e.generateQuestion():yield e.currentQuestion.loadQuestion(t[n+1])}));return r.createElement(r.Fragment,null,r.createElement(Te.Z,{onClick:()=>Pe(void 0,void 0,void 0,(function*(){var t;const{questionIds:n=[]}=o,r=n.indexOf(l.questionId)===n.length-1;0!==(null===(t=e.currentQuestion.feedback)||void 0===t?void 0:t.stepsLeft)&&r?s(!0):yield m()})),variant:"primary"},t("generateNextQuestion_nextQuestion")),r.createElement(je,{show:n,title:t("generateNextQuestion_warning"),type:"MODAL",size:"lg",primaryBtnTitle:t("generateNextQuestion_continueAttempt"),handlePrimaryBtnClicked:u,secondaryBtnTitle:t("generateNextQuestion_nextQuestion"),handleSecondaryBtnClicked:m,closeButton:!1,handleClose:u},r.createElement("div",null,t("generateNextQuestion_modalMessage1")),r.createElement("div",null,t("generateNextQuestion_modalMessage2"))))}));var Ze=n(8966);const Ge=(0,De.Pi)((()=>{var e,t;const[n]=(0,r.useState)((()=>i.nC.resolve(ye)));if(!n.currentQuestion.question||!n.currentAttempt)return null;const{questionId:s}=n.currentQuestion.question,a=n.currentAttempt.questionIds.map(((e,t)=>({id:e,number:t+1})));if(0===a.length)return null;const o=null!==(t=null===(e=a.find((e=>e.id===s)))||void 0===e?void 0:e.number)&&void 0!==t?t:-1,l=o-5<=0?"BEGIN":o+5>a.length?"END":"MIDDLE",c=Math.floor(2.5);return r.createElement("div",{className:"d-flex justify-content-center"},r.createElement(Ze.Z,{className:"p-3",style:{marginBottom:"0 !important"}},r.createElement(Me,{isVisible:a.length<=10},a.map((e=>r.createElement(Ze.Z.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number)))),r.createElement(Me,{isVisible:a.length>10},r.createElement(Ze.Z.First,{disabled:s===a[0].id,onClick:()=>n.currentQuestion.loadQuestion(a[0].id)}),r.createElement(Ze.Z.Prev,{disabled:s===a[0].id,onClick:()=>n.currentQuestion.loadQuestion(a[a.findIndex((e=>s===e.id))-1].id)}),r.createElement(Me,{isVisible:"BEGIN"===l},a.filter((e=>e.number<=7)).map((e=>r.createElement(Ze.Z.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number))),r.createElement(Ze.Z.Ellipsis,{disabled:!0}),r.createElement(Ze.Z.Item,{key:a[a.length-1].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(a[a.length-1].id)},a[a.length-1].number)),r.createElement(Me,{isVisible:"MIDDLE"===l},r.createElement(Ze.Z.Item,{key:a[0].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(a[0].id)},a[0].number),r.createElement(Ze.Z.Ellipsis,{disabled:!0}),a.filter((e=>e.number>=o-c&&e.number<=o+c)).map((e=>r.createElement(Ze.Z.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number))),r.createElement(Ze.Z.Ellipsis,{disabled:!0}),r.createElement(Ze.Z.Item,{key:a[a.length-1].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(a[a.length-1].id)},a[a.length-1].number)),r.createElement(Me,{isVisible:"END"===l},r.createElement(Ze.Z.Item,{key:a[0].number,active:!1,onClick:()=>n.currentQuestion.loadQuestion(a[0].id)},a[0].number),r.createElement(Ze.Z.Ellipsis,{disabled:!0}),a.filter((e=>e.number>a.length-7)).map((e=>r.createElement(Ze.Z.Item,{key:e.number,active:s===e.id,onClick:()=>n.currentQuestion.loadQuestion(e.id)},e.number)))),r.createElement(Ze.Z.Next,{disabled:s===a[a.length-1].id,onClick:()=>n.currentQuestion.loadQuestion(a[a.findIndex((e=>s===e.id))+1].id)}),r.createElement(Ze.Z.Last,{disabled:s===a[a.length-1].id,onClick:()=>n.currentQuestion.loadQuestion(a[a.length-1].id)}))))}));var Fe=n(8889);const ze=(0,De.Pi)((e=>{const{text:t,pagination:n,languageHint:s,language:i,onLanguageClicked:a,userHint:o,user:l,onUserClicked:c,userHref:d}=e;return r.createElement(Fe.Z,{className:"px-0"},t&&r.createElement("h5",null,t)||null,r.createElement(Fe.Z.Collapse,{className:"justify-content-end"},n,r.createElement(Fe.Z.Text,{className:"px-2"},s,": ",r.createElement("a",{href:"#",onClick:null!=a?a:void 0},i)),r.createElement(Fe.Z.Toggle,null),r.createElement(Fe.Z.Text,{className:"px-2"},o,": ",r.createElement("a",{href:null!=d?d:"#",onClick:null!=c?c:void 0},l))))})),He=(0,De.Pi)((()=>{const[e]=(0,r.useState)((()=>i.nC.resolve(ye))),{t,i18n:n}=(0,we.$G)(),{currentAttempt:s,exercise:a,user:o,currentQuestion:l}=e;if(!s||!a||!o)return null;const c=s.questionIds.findIndex((e=>{var t;return(null===(t=l.question)||void 0===t?void 0:t.questionId)===e}));return r.createElement(ze,{text:-1!==c?t("question_header",{questionNumber:c+1}):"",pagination:r.createElement(Ge,null),languageHint:t("language_header"),language:o.language,userHint:t("signedin_as_header"),user:o.displayName})}));var Be=n(6968);const Ue=e=>{var t;const n=null!==(t=e.delay)&&void 0!==t?t:0,[s,i]=(0,r.useState)(0===n);return(0,r.useEffect)((()=>{n>0&&setTimeout((()=>!s&&i(!0)),n)})),s?r.createElement(Be.Z,{animation:"border",variant:"primary"}):null},Xe=e=>{const{children:t,isLoading:n}=e;return n?r.createElement(Ue,Object.assign({},e)):r.createElement(r.Fragment,null,t)},We=(0,De.Pi)((()=>{var e;const[t]=(0,r.useState)((()=>i.nC.resolve(ye))),{t:n}=(0,we.$G)();if(!(null===(e=t.exercise)||void 0===e?void 0:e.options.correctAnswerGenerationEnabled))return null;const{exercise:s,currentAttempt:a,currentQuestion:o}=t,{question:l,feedback:c}=o,d="ANSWER_EVALUATING"===o.questionState,u="LOADING"===o.questionState;return l&&s&&a&&!d&&!u&&0!==(null==c?void 0:c.stepsLeft)?r.createElement(Te.Z,{onClick:()=>{t.currentQuestion.generateNextCorrectAnswer()},variant:"primary"},n("nextCorrectAnswerBtn")):null}));var Je=n(4320),Ke=n(3935),Ye=n(6691),et=n(8119),tt=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n};const nt=(0,De.Pi)((e=>{const{question:t}=e,{options:n}=t;switch(!0){case"combobox"===n.displayMode&&!n.requireContext:return r.createElement(rt,Object.assign({},e));case"combobox"===n.displayMode&&n.requireContext:return r.createElement(it,Object.assign({},e));case"dragNdrop"===n.displayMode:return r.createElement(st,Object.assign({},e))}return r.createElement("div",null,"Not Implemented")})),st=(0,De.Pi)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;if("dragNdrop"!==t.options.displayMode)return null;const{groups:i=[]}=t,{options:a}=t,o=a.dropzoneStyle&&JSON.parse(a.dropzoneStyle)||{},l=a.dropzoneStyle&&JSON.parse(a.draggableStyle)||{};return(0,r.useEffect)((()=>{document.querySelectorAll(`[id^="question_${t.questionId}_answer_"]`).forEach((e=>{e.classList.add("comp-ph-dropzone"),Object.keys(o).forEach((t=>e.style[t]=o[t])),e.innerHTML=`<div class="comp-ph-dropzone-placeholder">${a.dropzoneHtml}</div>`}));const e=new Je.Droppable(document.querySelectorAll(".comp-ph-droppable-container"),{draggable:".comp-ph-draggable",dropzone:".comp-ph-dropzone",plugins:[Je.Plugins.ResizeMirror],mirror:{constrainDimensions:!0}});e.on("drag:over",(()=>console.log("is out"))),e.on("droppable:stop",(e=>{var r,i,o,l,c,d,u;const m=null===(l=null===(o=null===(i=null===(r=null==e?void 0:e.data)||void 0===r?void 0:r.dragEvent)||void 0===i?void 0:i.data)||void 0===o?void 0:o.source)||void 0===l?void 0:l.id,p=null===(d=null===(c=null==e?void 0:e.data)||void 0===c?void 0:c.dropzone)||void 0===d?void 0:d.id;if(m&&p){if(a.multipleSelectionEnabled){const e=`dragAnswerWrapper_${null!==(u=m.split("_")[1])&&void 0!==u?u:""}`,t=document.getElementById(e),n=document.getElementById(m);e!==p&&t&&n&&(t.innerHTML=n.outerHTML)}setTimeout((()=>{const e=[...document.querySelectorAll(`[id^="question_${t.questionId}_answer_"] > [id^="dragAnswer_"]`)].map((e=>{var n,s,r;return[+(null!==(s=null===(n=e.parentElement)||void 0===n?void 0:n.id.split(`question_${t.questionId}_answer_`)[1])&&void 0!==s?s:""),+(null!==(r=null==e?void 0:e.id.split("dragAnswer_")[1])&&void 0!==r?r:"")]})),r=n();s(e.map((e=>{var t,n;return{answer:e,isÐ¡reatedByUser:null===(n=null===(t=r.find((t=>t.answer[0]===e[0]&&t.answer[1]===e[1])))||void 0===t?void 0:t.isÐ¡reatedByUser)||void 0===n||n}})))}),10)}}))}),[t.questionId]),r.createElement("div",null,r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md"},a.requireContext?r.createElement("p",{className:"comp-ph-droppable-container comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}}):r.createElement("p",{className:"d-flex flex-column comp-ph-droppable-container comp-ph-question-text"},t.answers.map((e=>r.createElement("div",{className:"d-flex flex-row mb-3"},r.createElement("div",{className:"mr-2 mt-1"},r.createElement("div",{id:`question_${t.questionId}_answer_${e.id}`})),r.createElement("div",{dangerouslySetInnerHTML:{__html:e.text}})))))),r.createElement("div",{className:"col-md comp-ph-droppable-container d-flex justify-content-start align-items-start flex-column"},i.map((e=>r.createElement("div",{id:`dragAnswerWrapper_${e.id}`,className:"comp-ph-dropzone mb-2",style:o},r.createElement("div",{className:"comp-ph-dropzone-placeholder",dangerouslySetInnerHTML:{__html:a.dropzoneHtml}}),r.createElement("div",{id:`dragAnswer_${e.id}`,className:"comp-ph-draggable",style:l,dangerouslySetInnerHTML:{__html:e.text}})))))))})),rt=(0,De.Pi)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;if("combobox"!==t.options.displayMode)return null;const{groups:i=[]}=t,a=i.reduce(((e,t)=>t.text.length>e?t.text.length:e),0);return r.createElement("div",null,r.createElement("p",{className:"mb-5 comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}}),r.createElement("div",null,t.answers.map((e=>{var o,l,c;return r.createElement("div",{className:"row mb-3"},r.createElement("div",{className:"col-md-6",dangerouslySetInnerHTML:{__html:t.text}}),r.createElement("div",{className:"col-md-auto"},r.createElement("div",{style:{width:8*a+100+"px"}},r.createElement(Ye.ZP,{defaultValue:null!==(c=null===(l=null===(o=n().find((t=>t.answer[0]===e.id)))||void 0===o?void 0:o.answer)||void 0===l?void 0:l[1])&&void 0!==c?c:null,options:i.map((e=>({value:e.id,label:e.text}))),components:{Option:at,SingleValue:ot},onChange:t=>{if(!t)return;const r=n().filter((t=>t.answer[0]!==e.id)),i=[...r,{answer:[e.id,+t.value],isÐ¡reatedByUser:!0}];s(i)}}))))}))))})),it=(0,De.Pi)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;if("combobox"!==t.options.displayMode)return null;const{groups:i=[],options:a}=t;return(0,r.useEffect)((()=>{document.querySelectorAll(`#question_${t.questionId} [data-answer-id]`).forEach((e=>{const t=+e.getAttribute("data-answer-id"),a=r.createElement(Ye.ZP,{options:i.map((e=>({value:e.id,label:e.text}))),components:{Option:at,SingleValue:ot},onChange:e=>{if(!e)return;const r=n().filter((e=>e.answer[0]!==t)),i=[...r,{answer:[t,+e.value],isÐ¡reatedByUser:!0}];s(i)}});Ke.render(a,e)}))}),[t.questionId]),r.createElement("div",{id:`question_${t.questionId}`},r.createElement("p",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}}))})),at=e=>{const{innerRef:t,innerProps:n,children:s}=e,i=tt(e,["innerRef","innerProps","children"]);return r.createElement(et.c.Option,Object.assign({},i),r.createElement("div",Object.assign({ref:t},n,{dangerouslySetInnerHTML:{__html:e.label}})))},ot=e=>{var t;const{innerRef:n,innerProps:s,children:i}=e,a=tt(e,["innerRef","innerProps","children"]);return r.createElement(et.c.SingleValue,Object.assign({},a),null===(t=e.getValue())||void 0===t?void 0:t.map((e=>r.createElement("div",Object.assign({ref:n},s,{dangerouslySetInnerHTML:{__html:e.label}})))))};var lt=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n};const ct=e=>{var{id:t,title:n,value:s,onChange:i,isChecked:a,style:o}=e,l=lt(e,["id","title","value","onChange","isChecked","style"]);return r.createElement("label",Object.assign({htmlFor:t,onClick:()=>i(s),style:a&&o||void 0},l),n)},dt=e=>{var{id:t,value:n,name:s,selected:i}=e,a=lt(e,["id","value","name","selected"]);return r.createElement("input",Object.assign({id:t,type:"radio",name:s,checked:i===n,readOnly:!0},a))},ut=e=>{const t=t=>{var n;null===(n=e.onChange)||void 0===n||n.call(e,t)};return r.createElement("div",{id:e.id,className:"switch-field d-inline-flex flex-row"},e.values.map(((n,s)=>{var i,a,o,l;return r.createElement("span",{key:s},r.createElement(dt,Object.assign({id:`${e.id}_${n}_checkbox`,name:`${e.id}_switch`,"data-value":n,value:n,selected:e.selected},e.inputAttributes)),r.createElement(ct,Object.assign({id:`${e.id}_${n}_checkbox`,isChecked:n===e.selected,title:null!==(a=null===(i=e.displayNames)||void 0===i?void 0:i[s])&&void 0!==a?a:n,value:n,onChange:t,style:null!==(l=null===(o=e.valueStyles)||void 0===o?void 0:o[s])&&void 0!==l?l:void 0},e.inputAttributes)))})))},mt=(0,De.Pi)((e=>{const{question:t}=e,{options:n}=t;switch(!0){case"switch"==n.displayMode&&!n.requireContext:return r.createElement(pt,Object.assign({},e));case"switch"===n.displayMode&&n.requireContext:return r.createElement(gt,Object.assign({},e));case"dragNdrop"===n.displayMode:return r.createElement(vt,Object.assign({},e))}return r.createElement("div",null,"Not implemented")})),pt=(0,De.Pi)((e=>{var t;const{question:n,getAnswers:s,onChanged:i}=e;if("switch"!==n.options.displayMode)return null;const{options:a}=n,o=null!==(t=a.selectorReplacers)&&void 0!==t?t:["no","yes"];return r.createElement("div",null,r.createElement("p",null,r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:n.text}})),r.createElement("p",{className:"d-flex flex-column"},n.answers.map((e=>{var t,a,l,c;return r.createElement("div",{className:"d-flex flex-row mb-3"},r.createElement("div",{className:"mr-2 mt-1"},r.createElement(ut,{id:`question_${n.questionId}_anwser_${e.id}`,selected:null!==(c=o[null===(l=null===(a=null===(t=s().filter((t=>t.answer[0]===e.id)))||void 0===t?void 0:t[0])||void 0===a?void 0:a.answer)||void 0===l?void 0:l[1]])&&void 0!==c?c:"",values:o,inputAttributes:{"data-answer-id":e.id},onChange:t=>((e,t)=>{const n=o.indexOf(t),r=[...s().filter((t=>t.answer[0]!==e)),{answer:[e,n],isÐ¡reatedByUser:!0}];i(r)})(e.id,t)})),r.createElement("div",null,e.text))}))))})),gt=(0,De.Pi)((e=>{var t;const{question:n,getAnswers:s,onChanged:i}=e;if("switch"!==n.options.displayMode)return null;const{options:a}=n,o=null!==(t=a.selectorReplacers)&&void 0!==t?t:["no","yes"];return(0,r.useEffect)((()=>{document.querySelectorAll(`#question_${n.questionId} [data-answer-id]`).forEach((e=>{var t,n,a,l,c;const d=+(null!==(t=e.getAttribute("data-answer-id"))&&void 0!==t?t:-1),u=r.createElement(ut,{id:`toggle_answer_${d}`,selected:null!==(c=o[null===(l=null===(a=null===(n=s().filter((e=>e.answer[0]===+d)))||void 0===n?void 0:n[0])||void 0===a?void 0:a.answer)||void 0===l?void 0:l[1]])&&void 0!==c?c:"",inputAttributes:{"data-answer-id":d},values:o,onChange:e=>((e,t)=>{const n=o.indexOf(t),r=[...s().filter((t=>t.answer[0]!==e)),{answer:[e,n],isÐ¡reatedByUser:!0}];i(r)})(+d,e)});Ke.render(u,e),e.id=""}))}),[n.questionId]),(0,r.useEffect)((()=>{document.querySelectorAll(`#question_${n.questionId} input[data-answer-id]`).forEach((e=>{e.getAttribute("data-answer-id"),e.checked=void 0})),s().forEach((({answer:e})=>{const[t,n]=e,s=document.querySelector(`#toggle_answer_${t} input[data-value='${o[n]}']`);s&&!s.checked&&setTimeout((()=>s.checked=!0),10)}))}),[n.questionId,s()]),r.createElement("div",{id:`question_${n.questionId}`},r.createElement("p",null,r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:n.text}})))})),vt=(0,De.Pi)((e=>{const{question:t,getAnswers:n,onChanged:s,answers:i}=e;if("dragNdrop"!==t.options.displayMode)return null;const a=Object.assign(Object.assign({},t),{type:"MATCHING",options:Object.assign(Object.assign({},t.options),{multipleSelectionEnabled:!0}),groups:[{id:0,text:'<span class="badge badge-success" style="height: 100%; width: 100%;display: flex; align-items: center;justify-content: center;">â</span>'},{id:1,text:'<span class="badge badge-danger" style="height: 100%; width: 100%;display: flex; align-items: center;justify-content: center;">x</span>'}]});return r.createElement(st,{question:a,getAnswers:n,onChanged:s,answers:i})})),ht=(0,De.Pi)((e=>{var t,n,s;const{question:i,getAnswers:a,onChanged:o,getFeedback:l}=e;if(!i.options.requireContext)return null;const{options:d}=i,u=null!==(t=d.orderNumberOptions)&&void 0!==t?t:{delimiter:"/",position:"SUFFIX"},m=(0,r.useMemo)((()=>{const e=document.createElement("div");return e.innerHTML=i.text,e}),[]);(0,r.useEffect)((()=>{document.querySelectorAll(`#question_${i.questionId} [data-answer-id]`).forEach((e=>{var t;const n=+(null!==(t=e.getAttribute("data-answer-id"))&&void 0!==t?t:"");e.addEventListener("click",(()=>o([...a(),{answer:[n,n],isÐ¡reatedByUser:!0}])))})),document.querySelectorAll("[data-comp-ph-value]").forEach((e=>{const t=e.getAttribute("data-comp-ph-value");e.innerHTML+=`<span class="comp-ph-expr-bottom-hint">${t}</span>`})),document.querySelectorAll("[data-comp-ph-pos]").forEach((e=>{const t=e.getAttribute("data-comp-ph-pos");e.innerHTML+=`<span class="comp-ph-expr-top-hint">${t}</span>`}))}),[i.questionId]),(0,r.useEffect)((()=>{var e,t;document.querySelectorAll(`#question_${i.questionId} [data-answer-id]`).forEach((e=>{var t;const n=e.getAttribute("data-comp-ph-value"),s=e.getAttribute("data-comp-ph-pos");e.innerHTML=(null===(t=m.querySelector(`#${e.id}`))||void 0===t?void 0:t.innerHTML)+(s?`<span class="comp-ph-expr-top-hint">${s}</span>`:"")+(n?`<span class="comp-ph-expr-bottom-hint">${n}</span>`:""),e.classList.remove("disabled"),e.classList.remove("comp-ph-question-answer--last-selected-by-system")}));const n=null===(t=null===(e=l())||void 0===e?void 0:e.isCorrect)||void 0===t||t?[...a()].reverse().reduce(((e,t)=>{const[n,s]=e;return-1===n?e:t.isÐ¡reatedByUser||0!==n&&n!==t.createdByInteraction?[-1,s]:(s.push(t),[t.createdByInteraction||-1,s])}),[0,[]])[1].reverse():[];a().forEach(((e,t,s)=>{const{answer:r}=e,[i]=r,a=document.querySelectorAll(`[data-answer-id='${i}']`);if(!a.length)return 0;a.forEach((s=>{var r,i;if(n.includes(e)&&s.classList.add("comp-ph-question-answer--last-selected-by-system"),"NONE"!==u.position){const e=null!==(i=null===(r=u.replacers)||void 0===r?void 0:r[t])&&void 0!==i?i:t+1,n="PREFIX"===u.position?[e,s.innerHTML]:"SUFFIX"===u.position?[s.innerHTML,e]:[s.innerHTML];s.innerHTML=n.join(u.delimiter)}d.multipleSelectionEnabled||s.classList.add("disabled")}))}))}),[i.questionId,a().length]);const p=null!==(s=null===(n=l())||void 0===n?void 0:n.trace)&&void 0!==s?s:0===a().length?i.initialTrace:null,g=d.showTrace&&c(p)&&p.length>0;return r.createElement("div",{id:`question_${i.questionId}`},r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:i.text}}),r.createElement(Me,{isVisible:g},r.createElement("p",null,r.createElement("table",{className:"comp-ph-trace"},r.createElement("tbody",null,null==p?void 0:p.map((e=>r.createElement("tr",null,r.createElement("td",{dangerouslySetInnerHTML:{__html:e}})))))))))})),Et=(0,De.Pi)((e=>{const{question:t}=e;switch(!0){case"radio"===t.options.displayMode&&!t.options.requireContext:return r.createElement(ft,Object.assign({},e));case"radio"===t.options.displayMode&&t.options.requireContext:return r.createElement(yt,Object.assign({},e))}return r.createElement("div",null,"Not implemented")})),ft=(0,De.Pi)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;return"radio"!==t.options.displayMode?null:r.createElement("div",null,r.createElement("div",{className:"mb-3"},r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}})),r.createElement("div",{className:"d-flex flex-column"},t.answers.map(((e,i)=>r.createElement("label",{htmlFor:`question_${t.questionId}_answer_${e.id}`,className:"comp-ph-singlechoice-label d-flex flex-row "+(i!==t.answers.length-1?"mb-3":"")},r.createElement("div",{className:"mr-2 mt-1"},r.createElement("input",{id:`question_${t.questionId}_answer_${e.id}`,name:`switch_${t.questionId}`,type:"radio",checked:n().some((t=>t.answer[0]===e.id)),onChange:t=>{return n=e.id,void(t.target.checked&&s([{answer:[n,n],isÐ¡reatedByUser:!0}]));var n},readOnly:!0})),r.createElement("div",null,e.text))))))})),yt=(0,De.Pi)((e=>{const{question:t,getAnswers:n,onChanged:s}=e;if("radio"!==t.options.displayMode)return null;const{options:i}=t;return(0,r.useEffect)((()=>{document.querySelectorAll(`#question_${t.questionId} [data-answer-id]`).forEach((e=>{var i;const a=null!==(i=e.getAttribute("data-answer-id"))&&void 0!==i?i:-1,o=r.createElement("label",{htmlFor:`question_${t.questionId}_answer_${a}`,className:"comp-ph-singlechoice-label"},r.createElement("input",{id:`question_${t.questionId}_answer_${a}`,name:`switch_${t.questionId}`,"data-answer-id":a,type:"radio",checked:n().some((e=>e.answer[0]===+a)),onChange:e=>{return t=+a,void(e.target.checked&&s([{answer:[t,t],isÐ¡reatedByUser:!0}]));var t},readOnly:!0}),r.createElement("span",{dangerouslySetInnerHTML:{__html:e.innerHTML}}));Ke.render(o,e),e.id=""}))}),[t.questionId]),(0,r.useEffect)((()=>{document.querySelectorAll(`#question_${t.questionId} input[data-answer-id]`).forEach((e=>{e.checked=void 0})),n().forEach((({answer:e})=>{const n=e[0],s=document.querySelector(`#question_${t.questionId} input[data-answer-id='${n}']`);s&&setTimeout((()=>s.checked=!0),10)}))}),[t.questionId,n()]),r.createElement("div",{id:`question_${t.questionId}`},r.createElement("p",null,r.createElement("div",{className:"comp-ph-question-text",dangerouslySetInnerHTML:{__html:t.text}})))})),wt=(0,De.Pi)((e=>{var t;const{question:n,answers:s,onChanged:i,getAnswers:a,getFeedback:o,isFeedbackLoading:l,isQuestionFreezed:c}=e;let d;switch(n.type){case"MATCHING":d=r.createElement(nt,{question:n,onChanged:i,answers:s,getAnswers:a});break;case"MULTI_CHOICE":d=r.createElement(mt,{question:n,onChanged:i,answers:s,getAnswers:a});break;case"SINGLE_CHOICE":d=r.createElement(Et,{question:n,onChanged:i,answers:s,getAnswers:a});break;case"ORDER":d=r.createElement(ht,{question:n,onChanged:i,answers:s,getAnswers:a,getFeedback:o});break;default:return(0,J.absurd)(n)}const u=["comp-ph-question-wrapper",0===(null===(t=o())||void 0===t?void 0:t.stepsLeft)?"comp-ph-question-wrapper--finished":"",l?"comp-ph-question-wrapper--loading-feedback":"",c?"comp-ph-question-wrapper--freezed":""].join(" ");return r.createElement("div",{className:u},d)}));var xt=n(7977),bt=n(8375),Ct=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};const St=(0,De.Pi)((({violationLaw:e})=>{var t;const[n]=(0,r.useState)((()=>i.nC.resolve(ye))),[s]=(0,r.useState)((()=>i.nC.resolve(ee))),{t:a}=(0,we.$G)(),[o,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!0),[m,p]=(0,r.useState)(!0);return(null===(t=n.exercise)||void 0===t?void 0:t.options.supplementaryQuestionsEnabled)&&!1!==e.canCreateSupplementaryQuestion?r.createElement(Me,{isVisible:m},r.createElement(Me,{isVisible:d},r.createElement("div",{className:"d-flex flex-row mt-3"},r.createElement(Te.Z,{onClick:()=>Ct(void 0,void 0,void 0,(function*(){var t,r;u(!1),c(!0),(null===(t=n.currentAttempt)||void 0===t?void 0:t.attemptId)&&n.currentQuestion.question&&(yield s.generateSupplementaryQuestion(n.currentAttempt.attemptId,null===(r=n.currentQuestion.question)||void 0===r?void 0:r.questionId,[e].map((e=>e.name))),s.question||(console.log("no need to generate sup question"),p(!1)))})),variant:"primary"},a("generateSupQuestion_details")),r.createElement(Te.Z,{onClick:()=>{p(!1)},variant:"success",className:"ml-2"},a("generateSupQuestion_gotit")))),r.createElement(je,{type:"DIALOG",size:"xl",show:o,closeButton:!1,handleClose:()=>c(!1)},r.createElement(_t,{store:s,showExtendedFeedback:!1,onChanged:()=>Ct(void 0,void 0,void 0,(function*(){var e,t,r;try{s.isQuestionFreezed=!0,console.log("show feedback for 3 seconds"),yield l(3e3);const i=(null===(e=s.feedback)||void 0===e?void 0:e.messages)&&s.feedback.messages[0].violationLaw||null;if(!i)return console.log("empty violation laws"),void p(!1);if(!(null===(t=n.currentAttempt)||void 0===t?void 0:t.attemptId)||!n.currentQuestion.question)return void console.log("problems with attempt");yield s.generateSupplementaryQuestion(n.currentAttempt.attemptId,null===(r=n.currentQuestion.question)||void 0===r?void 0:r.questionId,[i].map((e=>e.name))),s.question||(console.log("no need to generate sup question"),p(!1))}finally{s.isQuestionFreezed=!1}}))}),"ERROR"===s.storeState.tag&&r.createElement("div",{className:"mt-2"},r.createElement(bt.Z,{variant:"danger"},s.storeState.error.message)))):null}));const _t=(0,De.Pi)((e=>{const{store:t,showExtendedFeedback:n,onChanged:s}=e,i=t.question;return"LOADING"===t.questionState?r.createElement("div",{className:"mt-2"},r.createElement(Ue,null)):i?r.createElement(r.Fragment,null,r.createElement(wt,{question:i,answers:t.lastAnswer,getAnswers:()=>t.lastAnswer,onChanged:e=>{return n=void 0,r=void 0,a=function*(){(yield t.setFullAnswer(e))&&(null==s||s(e))},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,o)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a},getFeedback:()=>t.feedback,isFeedbackLoading:"ANSWER_EVALUATING"===t.questionState,isQuestionFreezed:t.isQuestionFreezed}),r.createElement(It,{store:t,showExtendedFeedback:n})):null})),It=(0,De.Pi)((({store:e,showExtendedFeedback:t})=>{const{feedback:n,isFeedbackVisible:s,question:i}=e,a="ANSWER_EVALUATING"===e.questionState,o="LOADING"===e.questionState,{t:l}=(0,we.$G)();if(a)return r.createElement("div",{className:"mt-2"},r.createElement(Ue,null));if(!n||o||!i)return null;const d="COMPLETED"===e.questionState?[{type:"SUCCESS",message:l("issolved_feeback")}]:n.messages;return r.createElement("div",{className:"comp-ph-feedback-wrapper mt-2"},r.createElement(Me,{isVisible:s},r.createElement("div",{className:"mb-3"},null==d?void 0:d.map((e=>r.createElement(Nt,{message:e,showGenerateSupQuestion:t&&i.options.showSupplementaryQuestions&&"ERROR"===e.type&&e.violationLaw.canCreateSupplementaryQuestion})))),r.createElement(Me,{isVisible:t},r.createElement("div",null,r.createElement(Me,{isVisible:null!==n.grade},r.createElement(xt.Z,{variant:"primary"},l("grade_feeback"),": ",n.grade)," "),r.createElement(Me,{isVisible:null!==n.correctSteps},r.createElement(xt.Z,{variant:"success"},l("correctsteps_feeback"),": ",n.correctSteps)," "),r.createElement(Me,{isVisible:c(n.stepsWithErrors)&&n.stepsWithErrors>0},r.createElement(xt.Z,{variant:"danger"},l("stepswitherrors_feeback"),": ",n.stepsWithErrors)," "),r.createElement(Me,{isVisible:c(n.stepsLeft)&&n.stepsLeft>0},r.createElement(xt.Z,{variant:"info"},l("stepsleft_feeback"),": ",n.stepsLeft)," ")))))})),Nt=(0,De.Pi)((({message:e,showGenerateSupQuestion:t})=>{const n="SUCCESS"===e.type?"success":"danger";return r.createElement(bt.Z,{variant:n},e.message,t&&"ERROR"===e.type&&e.violationLaw&&r.createElement(St,{violationLaw:e.violationLaw})||null)})),At=(0,De.Pi)((()=>{const[e]=(0,r.useState)((()=>i.nC.resolve(ye)));return r.createElement(_t,{store:e.currentQuestion,showExtendedFeedback:!0})}));var Ot=n(548);const qt=e=>{const{survey:t,enabledSurveyQuestions:n,isCompleted:s}=e,[a]=(0,r.useState)((()=>i.nC.resolve(me))),[o,l]=(0,r.useState)(s?"COMPLETED":"INITAL"),[c,d]=(0,r.useState)(e.value||{}),{t:u}=(0,we.$G)(),m=e.survey.questions.filter((e=>n.includes(e.id)));var p=(e,t)=>{const n=Object.assign(Object.assign({},c),{[e]:t});d(n),console.log(n)};return m&&m.length?r.createElement("div",{className:"alert alert-warning rounded",role:"alert"},m.map(((e,t,n)=>r.createElement("div",{key:t,className:t!==n.length-1?"mb-4":""},"yes-no"===e.type&&r.createElement(kt,{isCompleted:s,question:e,onAnswered:p,value:c[e.id]})||"single-choice"===e.type&&r.createElement(Lt,{isCompleted:s,question:e,onAnswered:p,value:c[e.id]})||"open-ended"===e.type&&r.createElement(Qt,{isCompleted:s,question:e,onAnswered:p,value:c[e.id]})||"invalid question type"))),"SENDING_RESULTS"===o&&r.createElement("div",{className:"mt-2"},r.createElement(Ue,{delay:100})),"VALIDATION_ERROR"===o&&r.createElement("div",{className:"mt-2"},r.createElement("div",{className:"alert alert-danger rounded"},"ÐÐµÐ¾Ð±ÑÐ¾Ð´Ð¸Ð¼Ð¾ Ð¾ÑÐ²ÐµÑÐ¸ÑÑ Ð½Ð° Ð²ÑÐµ Ð¾Ð±ÑÐ·Ð°ÑÐµÐ»ÑÐ½ÑÐµ Ð²Ð¾Ð¿ÑÐ¾ÑÑ")),"COMPLETED"!==o&&"SENDING_RESULTS"!==o&&r.createElement("div",{className:"mt-2"},r.createElement(Te.Z,{variant:"primary",onClick:()=>{var n,s,r,i;n=void 0,s=void 0,i=function*(){m.filter((e=>e.required)).map((e=>e.id)).every((e=>c[e]))?(l("SENDING_RESULTS"),yield Promise.all(m.map((t=>a.postSurveyAnswer(t.id,e.questionId,c[t.id])))),l("COMPLETED"),e.onAnswersSended(t,e.questionId,c)):l("VALIDATION_ERROR")},new((r=void 0)||(r=Promise))((function(e,t){function a(e){try{l(i.next(e))}catch(e){t(e)}}function o(e){try{l(i.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,o)}l((i=i.apply(n,s||[])).next())}))}},u("survey_sendresults")))):null},kt=e=>{const{question:t,onAnswered:n,value:s,isCompleted:i}=e;return r.createElement("div",null,r.createElement("div",{className:"mb-1"},t.text),r.createElement("div",{className:"d-flex flex-row mt-2"},r.createElement("button",{type:"button",className:"btn btn-secondary mr-2 "+(t.options.yesValue===s?"active":""),onClick:()=>n(t.id,t.options.yesValue),disabled:void 0!==s},t.options.yesText),r.createElement("button",{type:"button",className:"btn btn-secondary "+(t.options.noValue===s?"active":""),onClick:()=>n(t.id,t.options.noValue),disabled:void 0!==s},t.options.noText)))},Lt=e=>{const{question:t,onAnswered:n,value:s,isCompleted:i}=e;return r.createElement("div",null,r.createElement("div",{className:"mb-1"},t.text),r.createElement("div",{className:"d-flex mt-2"},r.createElement("div",null,t.options.map(((e,a,o)=>r.createElement("div",{key:e.id},r.createElement(Ot.Z.Check,{disabled:i,checked:s===e.id,name:`radio_qid${t.id}`,type:"radio",id:`radio_qid${t.id}_sqid${e.id}`,label:e.text,value:e.id,onChange:e=>n(t.id,e.target.value)})))))))},Qt=e=>{const{question:t,onAnswered:n,value:s,isCompleted:i}=e;return r.createElement("div",null,r.createElement("div",{className:"mb-1"},t.text),r.createElement("div",{className:"d-flex flex-row mt-2"},r.createElement(Ot.Z.Control,{disabled:i,value:s,as:"textarea",rows:3,onChange:e=>n(t.id,e.target.value)})))};var Dt=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};const Tt=(0,De.Pi)((()=>{var e,t,n,s,a,o,l,c,d,u,m,p,g,v;const[h]=(0,r.useState)((()=>i.nC.resolve(ye))),{exerciseState:E,setExerciseState:f,storeState:y,currentQuestion:w,survey:x}=h,{storeState:b}=w,{t:C}=(0,we.$G)();(0,r.useEffect)((()=>{Dt(void 0,void 0,void 0,(function*(){var e;if("LAUNCH_ERROR"===E)return;if(h.currentQuestion.question)return void f("EXERCISE");if(yield h.loadSessionInfo(),h.isDebug)return f("EXERCISE"),void I();const t=h.currentAttemptId;return t&&Number.isInteger(t)?(f("EXERCISE"),void N(+t)):(null===(e=h.exercise)||void 0===e?void 0:e.options.forceNewAttemptCreationEnabled)||!(yield h.loadExistingExerciseAttempt())?(f("EXERCISE"),void _()):void f("MODAL")}))}),[]);const S=(0,r.useCallback)((()=>{Dt(void 0,void 0,void 0,(function*(){var e,t,n;if(null===(e=h.currentAttempt)||void 0===e?void 0:e.questionIds.length){const e=null===(t=h.currentAttempt)||void 0===t?void 0:t.questionIds.length;yield h.currentQuestion.loadQuestion(null===(n=h.currentAttempt)||void 0===n?void 0:n.questionIds[e-1])}else yield h.generateQuestion()}))}),[h]),_=(0,r.useCallback)((()=>{Dt(void 0,void 0,void 0,(function*(){h.currentQuestion.setQuestionState("LOADING"),yield h.createExerciseAttempt(),S()}))}),[h]),I=(0,r.useCallback)((()=>{Dt(void 0,void 0,void 0,(function*(){h.currentQuestion.setQuestionState("LOADING"),yield h.createDebugExerciseAttempt(),S()}))}),[h]),N=(0,r.useCallback)((e=>{Dt(void 0,void 0,void 0,(function*(){h.currentQuestion.setQuestionState("LOADING"),yield h.loadExerciseAttempt(e),S()}))}),[h]),A=(0,r.useCallback)(((e,t,n)=>{h.setSurveyAnswers(t,n)}),[h]);return r.createElement(r.Fragment,null,r.createElement("div",{className:`compph-exercise ${h.isDebug&&"compph-exercise--debug"}`||""},r.createElement(Xe,{isLoading:!0===h.isSessionLoading||"INITIAL"===E},r.createElement(Me,{isVisible:"EXERCISE"===E||"COMPLETED"===E},r.createElement(He,null),r.createElement("div",{className:"mt-5"},r.createElement(At,null),null!=x&&("COMPLETED"===h.currentQuestion.questionState||"COMPLETED"===E)&&r.createElement("div",{className:"mt-2"},r.createElement(qt,{questionId:null!==(t=null===(e=h.currentQuestion.question)||void 0===e?void 0:e.questionId)&&void 0!==t?t:-1,survey:x.survey,enabledSurveyQuestions:h.ensureQuestionSurveyExists(null!==(s=null===(n=w.question)||void 0===n?void 0:n.questionId)&&void 0!==s?s:-1),value:null===(l=x.questions[null!==(o=null===(a=h.currentQuestion.question)||void 0===a?void 0:a.questionId)&&void 0!==o?o:-1])||void 0===l?void 0:l.results,onAnswersSended:A,isCompleted:"COMPLETED"===(null===(u=x.questions[null!==(d=null===(c=h.currentQuestion.question)||void 0===c?void 0:c.questionId)&&void 0!==d?d:-1])||void 0===u?void 0:u.status)})),r.createElement(Me,{isVisible:"EXERCISE"===E},r.createElement(Me,{isVisible:"LOADED"===h.currentQuestion.questionState},r.createElement("div",{className:"mt-3"},r.createElement(We,null))),r.createElement(Me,{isVisible:null==x&&((null===(m=h.exercise)||void 0===m?void 0:m.options.newQuestionGenerationEnabled)||"COMPLETED"===h.currentQuestion.questionState)||null!=x&&"COMPLETED"===(null===(v=x.questions[null!==(g=null===(p=h.currentQuestion.question)||void 0===p?void 0:p.questionId)&&void 0!==g?g:-1])||void 0===v?void 0:v.status)},r.createElement("div",{className:"mt-2"},r.createElement(Ve,null)))),r.createElement(Me,{isVisible:"COMPLETED"===E},r.createElement("div",{className:"mt-3"},r.createElement(bt.Z,{variant:"success"},C("exercise_completed")))))),r.createElement(Me,{isVisible:"MODAL"===E},r.createElement(je,{type:"DIALOG",title:C("foundExisitingAttempt_title"),primaryBtnTitle:C("foundExisitingAttempt_continueattempt"),handlePrimaryBtnClicked:()=>{f("EXERCISE"),S()},secondaryBtnTitle:C("foundExisitingAttempt_newattempt"),handleSecondaryBtnClicked:()=>{f("EXERCISE"),_()}},r.createElement("p",null,C("foundExisitingAttempt_descr"),"?")))),[y,b].filter((e=>"ERROR"===e.tag)).map(((e,t,n)=>"ERROR"===e.tag&&r.createElement("div",{className:"mt-2"},r.createElement(bt.Z,{variant:"danger"},e.error.message))))))}));const Rt=()=>{const[e,t]=(0,r.useState)([]),[n,s]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{var e,n,r,a;e=void 0,n=void 0,a=function*(){const e=new URLSearchParams(window.location.search).get("exerciseId");if(null===e||Number.isNaN(+e))throw new Error("Invalid exerciseId url param");const n=i.nC.resolve(H);s(!0);const r=yield n.getExerciseStatistics(+e);T.isRight(r)&&t(r.right),s(!1)},new((r=void 0)||(r=Promise))((function(t,s){function i(e){try{l(a.next(e))}catch(e){s(e)}}function o(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,o)}l((a=a.apply(e,n||[])).next())}))}),[]),r.createElement("div",null,r.createElement("table",{className:"table"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",{scope:"col"},"AttemptId"),r.createElement("th",{scope:"col"},"QuestionsCount"),r.createElement("th",{scope:"col"},"TotalInteractionsCount"),r.createElement("th",{scope:"col"},"TotalInteractionsWithErrorsCount"),r.createElement("th",{scope:"col"},"AverageGrade"))),r.createElement("tbody",null,r.createElement(Xe,{isLoading:n},e.map(((e,t)=>r.createElement("tr",{key:t},r.createElement("th",{scope:"row"},e.attemptId),r.createElement("td",null,e.questionsCount),r.createElement("td",null,e.totalInteractionsCount),r.createElement("td",null,e.totalInteractionsWithErrorsCount),r.createElement("td",null,e.averageGrade))))))))};var Mt=n(6712);const jt=(0,De.Pi)((()=>{const[e,t]=(0,r.useState)([]),[n,s]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{var e,n,r,a;e=void 0,n=void 0,a=function*(){s(!0);const e=i.nC.resolve(H),n=yield e.getExercises();T.isRight(n)&&t(n.right),s(!1)},new((r=void 0)||(r=Promise))((function(t,s){function i(e){try{l(a.next(e))}catch(e){s(e)}}function o(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,o)}l((a=a.apply(e,n||[])).next())}))}),[]),r.createElement("div",null,r.createElement(Mt.Z,null,e.map((e=>r.createElement(Mt.Z.Item,null,r.createElement("a",{href:`exercise?exerciseId=${e}`},e))))))}));var $t=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};const Pt=(0,De.Pi)((()=>{var e,t,n,s,a,o,l,c,d,u,m;const[p]=(0,r.useState)((()=>i.nC.resolve(ye))),{exerciseState:g,setExerciseState:v,storeState:h,currentQuestion:E,survey:f}=p,{storeState:y}=E,{t:w}=(0,we.$G)(),[x,b]=(0,r.useState)("ACTIVE");(0,r.useEffect)((()=>{$t(void 0,void 0,void 0,(function*(){"LAUNCH_ERROR"!==g&&(p.currentQuestion.question?v("EXERCISE"):(yield p.loadSessionInfo(),v("EXERCISE"),yield C()))}))}),[]);const C=()=>$t(void 0,void 0,void 0,(function*(){p.currentQuestion.setQuestionState("LOADING"),yield p.createExerciseAttempt(),yield $t(void 0,void 0,void 0,(function*(){var e,t,n;if(null===(e=p.currentAttempt)||void 0===e?void 0:e.questionIds.length){const e=null===(t=p.currentAttempt)||void 0===t?void 0:t.questionIds.length;yield p.currentQuestion.loadQuestion(null===(n=p.currentAttempt)||void 0===n?void 0:n.questionIds[e-1])}else yield p.generateQuestion()}))})),S=(0,r.useCallback)(((e,t,n)=>{console.log("Ð»ÐµÐ½Ñ ÑÐµÑÐ°ÐºÑÐ¾ÑÐ¸ÑÑ, Ð½Ðµ ÑÐ°Ð±Ð¾ÑÐ°ÐµÑ ÐºÑÑ")}),[p]),_=null===(e=p.exercise)||void 0===e?void 0:e.options.surveyOptions;return null===(t=p.currentQuestion.question)||void 0===t||t.questionId,(null==_?void 0:_.enabled)?r.createElement(r.Fragment,null,r.createElement(Xe,{isLoading:!0===p.isSessionLoading||"INITIAL"===g},r.createElement(Me,{isVisible:"EXERCISE"===g||"COMPLETED"===g},r.createElement(He,null),r.createElement("div",{className:"mt-5"},r.createElement("div",{style:{pointerEvents:"none"}},r.createElement(At,null)),r.createElement(Me,{isVisible:"COMPLETED"===x},r.createElement("div",{className:"mt-2"},r.createElement(bt.Z,{variant:"success"},"Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° ÑÑÐ°ÑÑÐ¸Ðµ Ð² Ð¾Ð¿ÑÐ¾ÑÐµ!"))),r.createElement(Me,{isVisible:"COMPLETED"!==x&&"LOADED"===E.questionState},r.createElement("div",{className:"mt-2"},r.createElement(qt,{questionId:null!==(s=null===(n=p.currentQuestion.question)||void 0===n?void 0:n.questionId)&&void 0!==s?s:-1,survey:p.survey.survey,value:null===(a=p.survey)||void 0===a?void 0:a.questions[null!==(l=null===(o=p.currentQuestion.question)||void 0===o?void 0:o.questionId)&&void 0!==l?l:-1].results,enabledSurveyQuestions:null!==(m=null===(c=p.survey)||void 0===c?void 0:c.questions[null!==(u=null===(d=p.currentQuestion.question)||void 0===d?void 0:d.questionId)&&void 0!==u?u:-1].questions)&&void 0!==m?m:[],onAnswersSended:S})))))),[h,y].filter((e=>"ERROR"===e.tag)).map(((e,t,n)=>"ERROR"===e.tag&&r.createElement("div",{className:"mt-2"},r.createElement(bt.Z,{variant:"danger"},e.error.message))))):null}));var Vt=function(e,t,n,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Zt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Gt=function(e,t){return function(n,s){t(n,s,e)}},Ft=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};let zt=class{constructor(e,t){this.exerciseSettingsController=e,this.exerciseController=t,this.exercisesLoadStatus="NONE",this.exercises=null,this.domains=null,this.backends=null,this.strategies=null,this.currentCard=null,this.user=null,this.changeLanguage=e=>{this.user&&this.user.language!==e&&(this.user.language=e,se.ZP.changeLanguage(e))},(0,X.rC)(this)}toCardViewModel(e){var t;const n=null===(t=this.domains)||void 0===t?void 0:t.find((t=>t.id===e.domainId));if(!n)throw new Error(`Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ð´Ð¾Ð¼ÐµÐ½ ${e.domainId}`);return Object.assign(Object.assign({},e),{tags:e.tags.join(", "),stages:e.stages.map((e=>Object.assign(Object.assign({},e),{concepts:e.concepts.filter((e=>n.concepts.some((t=>t.name===e.name)))),laws:e.laws.filter((e=>n.laws.some((t=>t.name===e.name))))})))})}fromCardViewModel(e){return Object.assign(Object.assign({},e),{tags:e.tags.split(",").map((e=>e.trim()))})}loadExercises(){return Ft(this,void 0,void 0,(function*(){if("LOADED"===this.exercisesLoadStatus||"LOADING"===this.exercisesLoadStatus)return;(0,X.z)((()=>this.exercisesLoadStatus="LOADING"));const[e,t,n,s,r]=yield Promise.all([this.exerciseSettingsController.getAllExercises(),this.exerciseSettingsController.getDomains(),this.exerciseSettingsController.getBackends(),this.exerciseSettingsController.getStrategies(),this.exerciseController.getCurrentUser()]);T.isRight(e)&&T.isRight(t)&&T.isRight(n)&&T.isRight(s)&&T.isRight(r)&&(0,X.z)((()=>{this.exercises=e.right,this.domains=t.right,this.backends=n.right,this.strategies=s.right,this.user=r.right,se.ZP.changeLanguage(r.right.language)})),(0,X.z)((()=>this.exercisesLoadStatus="LOADED"))}))}loadExercise(e){return Ft(this,void 0,void 0,(function*(){if("LOADED"!==this.exercisesLoadStatus)throw new Error("Exercises must be loaded first");(0,X.z)((()=>this.exercisesLoadStatus="EXERCISELOADING"));const t=yield this.exerciseSettingsController.getExercise(e);T.isRight(t)&&(0,X.z)((()=>{this.currentCard=this.toCardViewModel(t.right)})),(0,X.z)((()=>this.exercisesLoadStatus="LOADED"))}))}createNewExecise(){return Ft(this,void 0,void 0,(function*(){if("LOADED"!==this.exercisesLoadStatus)throw new Error("Exercises must be loaded first");const e=yield this.exerciseSettingsController.createExercise("(empty)",this.domains[0].id,this.strategies[0].id);if(!T.isRight(e))return;(0,X.z)((()=>this.exercisesLoadStatus="EXERCISELOADING"));const[t,n]=yield Promise.all([this.exerciseSettingsController.getExercise(e.right),this.exerciseSettingsController.getAllExercises()]);T.isRight(t)&&T.isRight(n)&&(0,X.z)((()=>{this.currentCard=this.toCardViewModel(t.right),this.exercises=n.right})),(0,X.z)((()=>this.exercisesLoadStatus="LOADED"))}))}saveCard(){return Ft(this,void 0,void 0,(function*(){if(!this.currentCard)return;(0,X.z)((()=>this.exercisesLoadStatus="EXERCISELOADING")),yield this.exerciseSettingsController.saveExercise(this.fromCardViewModel(this.currentCard));const e=yield this.exerciseSettingsController.getAllExercises();T.isRight(e)&&(0,X.z)((()=>{this.exercises=e.right})),(0,X.z)((()=>this.exercisesLoadStatus="LOADED"))}))}setCardName(e){this.currentCard&&(this.currentCard.name=e)}setCardDomain(e){this.currentCard&&e!==this.currentCard.domainId&&(this.currentCard.stages[0].laws=[],this.currentCard.stages[0].concepts=[],this.currentCard.stages.splice(1),this.currentCard.domainId=e)}setCardStrategy(e){this.currentCard&&this.currentCard.strategyId!==e&&(this.currentCard.stages[0].laws=[],this.currentCard.stages[0].concepts=[],this.currentCard.stages.splice(1),this.currentCard.strategyId=e)}setCardQuestionComplexity(e){if(!this.currentCard)return;const t=Number.parseInt(e);this.currentCard.complexity=t/100}setCardCommonConceptValue(e,t){if(this.currentCard)for(const n of this.currentCard.stages){const s=n.concepts.findIndex((t=>t.name==e));let r=-1!==s?n.concepts[s]:null;"PERMITTED"!==t?(r||(r={name:e,kind:t},n.concepts.push(r)),r.kind=t):r&&n.concepts.splice(s,1)}}setCardStageConceptValue(e,t,n){if(!this.currentCard||!this.currentCard.stages[e])return;const s=this.currentCard.stages[e],r=s.concepts.findIndex((e=>e.name==t));let i=-1!==r?s.concepts[r]:null;"PERMITTED"!==n?(i||(i={name:t,kind:n},s.concepts.push(i)),i.kind=n):i&&s.concepts.splice(r,1)}setCardCommonLawValue(e,t){if(this.currentCard)for(const n of this.currentCard.stages){const s=n.laws.findIndex((t=>t.name==e));let r=-1!==s?n.laws[s]:null;"PERMITTED"!==t?(r||(r={name:e,kind:t},n.laws.push(r)),r.kind=t):r&&n.laws.splice(s,1)}}setCardStageLawValue(e,t,n){if(!this.currentCard||!this.currentCard.stages[e])return;const s=this.currentCard.stages[e],r=s.laws.findIndex((e=>e.name==t));let i=-1!==r?s.laws[r]:null;"PERMITTED"!==n?(i||(i={name:t,kind:n},s.laws.push(i)),i.kind=n):i&&s.laws.splice(r,1)}setCardStageNumberOfQuestions(e,t){if(!this.currentCard||!this.currentCard.stages[e])return;const n=this.currentCard.stages[e];if(!t.match(/^\d*$/))return;const s=+t||1;n.numberOfQuestions=s}setCardSurveyEnabled(e){this.currentCard&&(this.currentCard.options.surveyOptions?this.currentCard.options.surveyOptions.enabled=e:this.currentCard.options.surveyOptions={enabled:e,surveyId:""})}setCardSurveyId(e){this.currentCard&&(this.currentCard.options.surveyOptions?this.currentCard.options.surveyOptions.surveyId=e:this.currentCard.options.surveyOptions={enabled:!0,surveyId:e})}setCardTags(e){this.currentCard&&(this.currentCard.tags=e)}setCardFlag(e,t){this.currentCard&&(this.currentCard.options[e]=t)}addStage(){var e,t,n,s;if(!this.currentCard||!this.domains)return;const r=this.currentCard,i=null!==(t=null===(e=this.domains.find((e=>e.id===r.domainId)))||void 0===e?void 0:e.laws.filter((e=>0==(e.bitflags&Ne.TargetEnabled))))&&void 0!==t?t:[],a=null!==(s=null===(n=this.domains.find((e=>e.id===r.domainId)))||void 0===n?void 0:n.concepts.flatMap((e=>[e,...e.childs])).filter((e=>0==(e.bitflags&Ne.TargetEnabled))))&&void 0!==s?s:[];var o=r.stages[0].concepts.filter((e=>"PERMITTED"!==e.kind&&a.some((t=>t.name===e.name)))),l=r.stages[0].laws.filter((e=>"PERMITTED"!==e.kind&&i.some((t=>t.name===e.name))));this.currentCard.stages.push({numberOfQuestions:10,laws:l,concepts:o})}removeStage(e){if(!this.currentCard)return;const t=this.currentCard.stages.length;e<0||e>=t||this.currentCard.stages.splice(e,1)}};Vt([X.LO,Zt("design:type",String)],zt.prototype,"exercisesLoadStatus",void 0),Vt([X.LO,Zt("design:type",Object)],zt.prototype,"exercises",void 0),Vt([X.LO,Zt("design:type",Object)],zt.prototype,"domains",void 0),Vt([X.LO,Zt("design:type",Object)],zt.prototype,"backends",void 0),Vt([X.LO,Zt("design:type",Object)],zt.prototype,"strategies",void 0),Vt([X.LO,Zt("design:type",Object)],zt.prototype,"currentCard",void 0),Vt([X.LO,Zt("design:type",Object)],zt.prototype,"user",void 0),Vt([X.aD,Zt("design:type",Object)],zt.prototype,"changeLanguage",void 0),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[String]),Zt("design:returntype",void 0)],zt.prototype,"setCardName",null),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[String]),Zt("design:returntype",void 0)],zt.prototype,"setCardDomain",null),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[String]),Zt("design:returntype",void 0)],zt.prototype,"setCardStrategy",null),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[String]),Zt("design:returntype",void 0)],zt.prototype,"setCardQuestionComplexity",null),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[String,String]),Zt("design:returntype",void 0)],zt.prototype,"setCardCommonConceptValue",null),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[Number,String,String]),Zt("design:returntype",void 0)],zt.prototype,"setCardStageConceptValue",null),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[String,String]),Zt("design:returntype",void 0)],zt.prototype,"setCardCommonLawValue",null),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[Number,String,String]),Zt("design:returntype",void 0)],zt.prototype,"setCardStageLawValue",null),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[Number,String]),Zt("design:returntype",void 0)],zt.prototype,"setCardStageNumberOfQuestions",null),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[Boolean]),Zt("design:returntype",void 0)],zt.prototype,"setCardSurveyEnabled",null),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[String]),Zt("design:returntype",void 0)],zt.prototype,"setCardSurveyId",null),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[String]),Zt("design:returntype",void 0)],zt.prototype,"setCardTags",null),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[Object,Boolean]),Zt("design:returntype",void 0)],zt.prototype,"setCardFlag",null),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[]),Zt("design:returntype",void 0)],zt.prototype,"addStage",null),Vt([X.aD,Zt("design:type",Function),Zt("design:paramtypes",[Number]),Zt("design:returntype",void 0)],zt.prototype,"removeStage",null),zt=Vt([(0,i.b2)(),Gt(0,(0,i.f3)(ke)),Gt(1,(0,i.f3)(H)),Zt("design:paramtypes",[ke,Object])],zt);var Ht=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))};const Bt=(0,De.Pi)((()=>{var e,t,n,s,a,o,l;const[c]=(0,r.useState)((()=>i.nC.resolve(zt))),{t:d}=(0,we.$G)();(0,r.useEffect)((()=>{Ht(void 0,void 0,void 0,(function*(){yield c.loadExercises();const e=new URL(window.location.href).searchParams.get("exerciseId");e&&(yield c.loadExercise(Number.parseInt(e)))}))}),[]);const u=(0,r.useCallback)((()=>{Ht(void 0,void 0,void 0,(function*(){yield c.createNewExecise()}))}),[null===(e=c.exercises)||void 0===e?void 0:e.length]);if("LOADING"===c.exercisesLoadStatus)return r.createElement(Ue,null);const{user:m}=c;return m?r.createElement("div",{className:"container-fluid"},r.createElement("div",{className:"pt-1 pb-3"},r.createElement(ze,{text:d("exercisesettings_title"),languageHint:d("language_header"),language:null!==(n=null===(t=c.user)||void 0===t?void 0:t.language)&&void 0!==n?n:"EN",onLanguageClicked:null,userHint:d("signedin_as_header"),user:m.displayName,userHref:null})),r.createElement("div",{className:"flex-xl-nowrap row"},r.createElement("div",{className:"col-xl-3 col-md-3 col-12 d-flex flex-column"},r.createElement("button",{type:"button",className:"btn btn-primary mb-3",onClick:u},"Create new"),r.createElement("ul",{className:"list-group"},null===(s=c.exercises)||void 0===s?void 0:s.map((e=>{var t;return r.createElement(Le.rU,{key:e.id,className:"list-group-item "+(e.id===(null===(t=c.currentCard)||void 0===t?void 0:t.id)?"active":""),to:`?exerciseId=${e.id}`,onClick:()=>c.loadExercise(e.id),title:e.name},e.name.length>22?`${e.name.substring(0,22)}...`:e.name)})))),r.createElement("div",{className:"col-xl-9 col-md-9 col-12"},r.createElement(Ut,{store:c,card:c.currentCard,domains:null!==(a=c.domains)&&void 0!==a?a:[],backends:null!==(o=c.backends)&&void 0!==o?o:[],strategies:null!==(l=c.strategies)&&void 0!==l?l:[]})))):r.createElement(Ue,null)})),Ut=(0,De.Pi)((e=>{var t,n,s,i,a,o,l,c,d,u;const{card:m,domains:p,backends:g,strategies:v,store:h}=e,{t:E}=(0,we.$G)(),f=(0,r.useMemo)((()=>[E("exercisesettings_optDenied"),E("exercisesettings_optAllowed"),E("exercisesettings_optTarget")]),[null===(t=h.user)||void 0===t?void 0:t.language]);if("EXERCISELOADING"===h.exercisesLoadStatus)return r.createElement(Ue,{delay:200});if(null==m)return r.createElement("div",null,"No exercise selected");function y(e){return"FORBIDDEN"===e?"Denied":"TARGETED"===e?"Target":"Allowed"}function w(e){return"Denied"===e?"FORBIDDEN":"Target"===e?"TARGETED":"PERMITTED"}function x(e){return(e.bitflags&Ne.TargetEnabled)>0?["Denied","Allowed","Target"]:["Denied","Allowed"]}const b=null===(n=p.find((e=>e.id===m.domainId)))||void 0===n?void 0:n.laws.filter((e=>(e.bitflags&Ne.TargetEnabled)>0)),C=null===(s=p.find((e=>e.id===m.domainId)))||void 0===s?void 0:s.concepts.filter((e=>(e.bitflags&Ne.TargetEnabled)>0)),S=m.stages[0].laws.reduce(((e,t)=>(e[t.name]=t,e)),{}),_=m.stages[0].concepts.reduce(((e,t)=>(e[t.name]=t,e)),{}),I=null===(i=p.find((e=>e.id===m.domainId)))||void 0===i?void 0:i.laws.filter((e=>0==(e.bitflags&Ne.TargetEnabled))),N=null===(a=p.find((e=>e.id===m.domainId)))||void 0===a?void 0:a.concepts.filter((e=>0==(e.bitflags&Ne.TargetEnabled))),A=v.find((e=>e.id===m.strategyId));return r.createElement("div",null,r.createElement("form",{className:"exercise-settings-form"},r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold",htmlFor:"exampleInputEmail1"},E("exercisesettings_name")),r.createElement("input",{value:m.name,type:"email",className:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",placeholder:"Enter email",onChange:e=>h.setCardName(e.target.value)})),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},E("exercisesettings_domain")),r.createElement("select",{className:"form-control",value:m.domainId,onChange:e=>h.setCardDomain(e.target.value)},null==p?void 0:p.map((e=>r.createElement("option",null,e.name))))),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},E("exercisesettings_strategy")),r.createElement("select",{className:"form-control",value:m.strategyId,onChange:e=>h.setCardStrategy(e.target.value)},null==v?void 0:v.map((e=>r.createElement("option",{value:e.id},e.id))))),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-6"},r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},E("exercisesettings_qcomplexity")),r.createElement("div",null,r.createElement("input",{type:"range",className:"form-control-range",id:"formControlRange1",value:100*(null!==(l=null===(o=h.currentCard)||void 0===o?void 0:o.complexity)&&void 0!==l?l:.5),onChange:e=>h.setCardQuestionComplexity(e.target.value)}))))),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},E("exercisesettings_qopt")),r.createElement("div",{className:"form-check"},r.createElement("input",{checked:m.options.forceNewAttemptCreationEnabled,onChange:e=>h.setCardFlag("forceNewAttemptCreationEnabled",e.target.checked),type:"checkbox",className:"form-check-input",id:"forceNewAttemptCreationEnabled"}),r.createElement("label",{className:"form-check-label",htmlFor:"forceNewAttemptCreationEnabled"},E("exercisesettings_qopt_forceAttCreation"))),r.createElement("div",{className:"form-check"},r.createElement("input",{checked:m.options.correctAnswerGenerationEnabled,onChange:e=>h.setCardFlag("correctAnswerGenerationEnabled",e.target.checked),type:"checkbox",className:"form-check-input",id:"correctAnswerGenerationEnabled"}),r.createElement("label",{className:"form-check-label",htmlFor:"correctAnswerGenerationEnabled"},E("exercisesettings_qopt_genCorAnsw"))),r.createElement("div",{className:"form-check"},r.createElement("input",{checked:m.options.newQuestionGenerationEnabled,onChange:e=>h.setCardFlag("newQuestionGenerationEnabled",e.target.checked),type:"checkbox",className:"form-check-input",id:"newQuestionGenerationEnabled"}),r.createElement("label",{className:"form-check-label",htmlFor:"newQuestionGenerationEnabled"},E("exercisesettings_qopt_forceShowGenNextQ"))),r.createElement("div",{className:"form-check"},r.createElement("input",{checked:m.options.supplementaryQuestionsEnabled,onChange:e=>h.setCardFlag("supplementaryQuestionsEnabled",e.target.checked),type:"checkbox",className:"form-check-input",id:"supplementaryQuestionsEnabled"}),r.createElement("label",{className:"form-check-label",htmlFor:"supplementaryQuestionsEnabled"},E("exercisesettings_qopt_supQ")))),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"survOptions",className:"font-weight-bold"},E("exercisesettings_survey")),r.createElement("div",{className:"input-group mb-3"},r.createElement("div",{className:"input-group-prepend"},r.createElement("div",{className:"input-group-text"},r.createElement("input",{checked:null===(c=m.options.surveyOptions)||void 0===c?void 0:c.enabled,type:"checkbox","aria-label":"Checkbox for following text input",onChange:e=>h.setCardSurveyEnabled(e.target.checked)}))),r.createElement("input",{id:"survOptions",type:"text",value:null===(d=m.options.surveyOptions)||void 0===d?void 0:d.surveyId,className:"form-control","aria-label":"Text input with checkbox",disabled:!(null===(u=m.options.surveyOptions)||void 0===u?void 0:u.enabled),onChange:e=>h.setCardSurveyId(e.target.value)}))),r.createElement("div",{className:"form-group"},r.createElement("label",{htmlFor:"exTagsValues",className:"font-weight-bold"},E("exercisesettings_tags")),r.createElement("input",{id:"exTagsValues",value:m.tags,className:"form-control",onChange:e=>h.setCardTags(e.target.value)})),(null==N?void 0:N.length)&&r.createElement("div",{className:"form-group"},r.createElement("div",null,r.createElement("label",{className:"font-weight-bold"},E("exercisesettings_commonConcepts"))),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-12"},r.createElement("div",{className:"list-group list-group-flush"},N.map(((e,t)=>{var n;return r.createElement("div",{key:t,className:"list-group-item p-0 bg-transparent pt-2 pb-2"},r.createElement("div",null,r.createElement("div",{className:"d-flex flex-row align-items-center"},r.createElement(ut,{id:`sharedconcept_toggle_${m.id}_${e.name}_${t}`,selected:y(null===(n=_[e.name])||void 0===n?void 0:n.kind),values:x(e),valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],displayNames:f,onChange:t=>{h.setCardCommonConceptValue(e.name,w(t)),e.childs.forEach((e=>h.setCardCommonConceptValue(e.name,w(t))))}}),r.createElement("div",{style:{marginLeft:"15px"}},e.displayName))),e.childs.length>0&&r.createElement("ul",{className:""},e.childs.map(((n,s)=>{var i;return r.createElement(r.Fragment,null,r.createElement("li",{key:s,className:"d-flex flex-row align-items-centers mt-3"},r.createElement(ut,{id:`sharedconcept_toggle_${m.id}_${n.name}_${t}`,selected:y(null===(i=_[n.name])||void 0===i?void 0:i.kind),values:x(n),valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],displayNames:f,onChange:t=>{h.setCardCommonConceptValue(n.name,w(t)),h.setCardCommonConceptValue(e.name,"PERMITTED")}}),r.createElement("div",{style:{marginLeft:"15px"}},n.displayName)))}))))}))))))||null,(null==I?void 0:I.length)&&r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},E("exercisesettings_commonLaws")),r.createElement("div",{className:"list-group list-group-flush"},I.map(((e,t)=>{var n;return r.createElement("div",{className:"list-group-item p-0 bg-transparent pt-2 pb-2",key:t},r.createElement("div",{className:"d-flex flex-row align-items-start justify-content-start"},r.createElement("div",null,r.createElement(ut,{id:`sharedlaw_toggle_${m.id}_${t}`,selected:y(null===(n=S[e.name])||void 0===n?void 0:n.kind),values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],displayNames:f,onChange:t=>h.setCardCommonLawValue(e.name,w(t))})),r.createElement("div",{style:{marginLeft:"15px"}},e.displayName)))}))))||null,r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},E("exercisesettings_stages")),r.createElement("div",{className:"list-group list-group-flush"},m.stages.map(((e,t,n)=>r.createElement(r.Fragment,null,r.createElement("div",{className:"card mb-3"},n.length>1&&r.createElement("button",{type:"button",className:"close","aria-label":"Close",style:{position:"absolute",top:"10px",right:"10px"},onClick:()=>h.removeStage(t)},r.createElement("span",{"aria-hidden":"true"},"Ã"))||null,r.createElement("div",{className:"card-body"},r.createElement("div",{className:"form-group"},E("exercisesettings_stageN",{stageNumber:t+1})),(null==A?void 0:A.options.multiStagesEnabled)&&r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold",htmlFor:`numberOfQuestions_stage${t}`},E("exercisesettings_stageN_qnumber")),r.createElement("input",{type:"text",className:"form-control",id:`numberOfQuestions_stage${t}`,value:e.numberOfQuestions,onChange:e=>h.setCardStageNumberOfQuestions(t,e.target.value)}))||null,C&&C.length>0&&r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},E("exercisesettings_stageN_concepts")),r.createElement("div",{className:"list-group list-group-flush"},null==C?void 0:C.map(((n,s)=>{var i;return r.createElement("div",{key:s,className:"list-group-item p-0 bg-transparent pt-2 pb-2"},r.createElement("div",null,r.createElement("div",{className:"d-flex flex-row align-items-center"},r.createElement(ut,{id:`stageconcept${t}_toggle_${m.id}_${n.name}_${s}`,selected:y(null===(i=e.concepts.find((e=>e.name===n.name)))||void 0===i?void 0:i.kind),values:x(n),valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],displayNames:f,onChange:e=>{h.setCardStageConceptValue(t,n.name,w(e)),n.childs.forEach((n=>h.setCardStageConceptValue(t,n.name,w(e))))}}),r.createElement("div",{style:{marginLeft:"15px"}},n.displayName))),n.childs.length>0&&r.createElement("ul",{className:""},n.childs.map(((i,a)=>{var o;return r.createElement(r.Fragment,null,r.createElement("li",{key:a,className:"d-flex flex-row align-items-centers mt-3"},r.createElement(ut,{id:`stageconcept${t}_toggle_${m.id}_${i.name}_${s}`,selected:y(null===(o=e.concepts.find((e=>e.name===i.name)))||void 0===o?void 0:o.kind),values:x(i),valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],displayNames:f,onChange:e=>{h.setCardStageConceptValue(t,i.name,w(e)),h.setCardStageConceptValue(t,n.name,"PERMITTED")}}),r.createElement("div",{style:{marginLeft:"15px"}},i.displayName)))}))))}))))||null,b&&b.length>0&&r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},E("exercisesettings_stageN_laws")),r.createElement("div",{className:"list-group list-group-flush"},b.map(((n,s)=>{var i;return r.createElement("div",{className:"list-group-item p-0 bg-transparent pt-2 pb-2",key:s},r.createElement("div",{className:"d-flex flex-row align-items-start justify-content-start"},r.createElement("div",null,r.createElement(ut,{id:`stagelaw${t}_toggle_${m.id}_${s}`,selected:y(null===(i=e.laws.find((e=>e.name===n.name)))||void 0===i?void 0:i.kind),values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],displayNames:f,onChange:e=>h.setCardStageLawValue(t,n.name,w(e))})),r.createElement("div",{style:{marginLeft:"15px"}},n.displayName)))}))))||null))))))),m.stages.length<5&&(null==A?void 0:A.options.multiStagesEnabled)?r.createElement("div",{style:{marginTop:"-1rem"}},r.createElement("button",{type:"button",className:"btn btn-success",onClick:()=>h.addStage()},E("exercisesettings_addStage"))):null),r.createElement("div",{className:"mt-5"},r.createElement("button",{type:"button",className:"btn btn-primary",onClick:()=>h.saveCard()},E("exercisesettings_save")),r.createElement("button",{type:"button",className:"btn btn-primary ml-2",onClick:()=>h.saveCard().then((()=>{var e;return null===(e=window.open(`${window.location.origin}/pages/exercise?exerciseId=${m.id}`,"_blank"))||void 0===e?void 0:e.focus()}))},E("exercisesettings_saveNopen")),r.createElement("button",{type:"button",className:"btn btn-primary ml-2",onClick:()=>{var e;return null===(e=window.open(`${window.location.origin}/pages/exercise?exerciseId=${m.id}`,"_blank"))||void 0===e?void 0:e.focus()}},E("exercisesettings_open")),(null==A?void 0:A.options.multiStagesEnabled)&&r.createElement("button",{type:"button",className:"btn btn-primary ml-2",onClick:()=>{var e;return null===(e=window.open(`${window.location.origin}/pages/exercise?exerciseId=${m.id}&debug`,"_blank"))||void 0===e?void 0:e.focus()}},E("exercisesettings_genDebugAtt"))))})),Xt={concepts:["literal","variable","arithmetic operator","assignment operator","comparison operator","logical operator","bitwise operator","array access operator","pointer operator","function call"],laws:["Expression contains two operators with different precedence in a row","Expression contains two operators with the same precedence and left associativity in a row","Expression contains two operators with the same precedence and right associativity in a row","Expression contains operators inside parentheses or another operator","Expression contains operators evaluating their operands in a strict order"]},Wt=(0,De.Pi)((()=>r.createElement("div",{className:"container-fluid",style:{color:"black",fontSize:"18px"}},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-8"},r.createElement("form",null,r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Domain"),r.createElement("select",{className:"form-control"},r.createElement("option",null,"Order of Expression Evaluation"))),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-6"},r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Question complexity"),r.createElement("div",null,r.createElement("input",{type:"range",className:"form-control-range",id:"formControlRange1"})))),r.createElement("div",{className:"col-md-6"},r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Answer length"),r.createElement("div",null,r.createElement("input",{type:"range",className:"form-control-range",id:"formControlRange1"}))))),r.createElement("div",{className:"form-group"},r.createElement("div",null,r.createElement("label",{className:"font-weight-bold"},"Concepts")),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-md-6"},Xt.concepts.filter(((e,t)=>t%2==0)).map(((e,t)=>r.createElement("div",{className:"d-flex flex-row align-items-center",style:{marginBottom:"10px"}},r.createElement(ut,{id:`concept_toggle_${e}_${t}`,selected:"Allowed",values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],onChange:e=>0}),r.createElement("div",{style:{marginLeft:"15px"}},e))))),r.createElement("div",{className:"col-md-6"},Xt.concepts.filter(((e,t)=>t%2!=0)).map(((e,t)=>r.createElement("div",{className:"d-flex flex-row align-items-center",style:{marginBottom:"10px"}},r.createElement(ut,{id:`concept_toggle_${e}_${t}`,selected:"Allowed",values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],onChange:e=>0}),r.createElement("div",{style:{marginLeft:"15px"}},e))))))),r.createElement("div",{className:"form-group"},r.createElement("label",{className:"font-weight-bold"},"Laws"),Xt.laws.map(((e,t)=>r.createElement("div",{className:"d-flex flex-row align-items-start justify-content-start",style:{marginBottom:"10px"}},r.createElement("div",null,r.createElement(ut,{id:`law_toggle_${t}`,selected:"Allowed",values:["Denied","Allowed","Target"],valueStyles:[{backgroundColor:"#eb2828"},null,{backgroundColor:"#009700"}],onChange:e=>0})),r.createElement("div",{style:{marginLeft:"15px"}},e))))))))))),Jt=document.getElementById("root");(0,s.s)(Jt).render(r.createElement((()=>r.createElement("div",{className:"container comp-ph-container"},r.createElement(Le.VK,null,r.createElement(Qe.Z5,null,r.createElement(Qe.AW,{path:"/pages/statistics",element:r.createElement(Rt,null)}),r.createElement(Qe.AW,{path:"/pages/exercise",element:r.createElement(Tt,null)}),r.createElement(Qe.AW,{path:"/pages/exercise-settings",element:r.createElement(Bt,null)}),r.createElement(Qe.AW,{path:"/pages/strategy-settings",element:r.createElement(Wt,null)}),r.createElement(Qe.AW,{path:"/pages/survey",element:r.createElement(Pt,null)}),r.createElement(Qe.AW,{path:"/pages/exercises-list",element:r.createElement(jt,null)}))))),null))}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return s[e].call(n.exports,n,n.exports,i),n.exports}i.m=s,e=[],i.O=(t,n,s,r)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){for(var[n,s,r]=e[d],o=!0,l=0;l<n.length;l++)(!1&r||a>=r)&&Object.keys(i.O).every((e=>i.O[e](n[l])))?n.splice(l--,1):(o=!1,r<a&&(a=r));if(o){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,s,r]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,s){if(1&s&&(e=this(e)),8&s)return e;if("object"==typeof e&&e){if(4&s&&e.__esModule)return e;if(16&s&&"function"==typeof e.then)return e}var r=Object.create(null);i.r(r);var a={};t=t||[null,n({}),n([]),n(n)];for(var o=2&s&&e;"object"==typeof o&&!~t.indexOf(o);o=n(o))Object.getOwnPropertyNames(o).forEach((t=>a[t]=()=>e[t]));return a.default=()=>e,i.d(r,a),r},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={47:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var s,r,[a,o,l]=n,c=0;if(a.some((t=>0!==e[t]))){for(s in o)i.o(o,s)&&(i.m[s]=o[s]);if(l)var d=l(i)}for(t&&t(n);c<a.length;c++)r=a[c],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(d)},n=self.webpackChunkcomp_prehension=self.webpackChunkcomp_prehension||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=i.O(void 0,[736],(()=>i(5101)));a=i.O(a)})();